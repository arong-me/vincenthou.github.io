[{"title":"build(deps): bump tar from 2.2.1 to 2.2.2","url":"https://vincenthou.github.io/2019/10/29/build-deps-bump-tar-from-2-2-1-to-2-2-2/","content":"<p>Bumps <a href=\"https://github.com/npm/node-tar\" target=\"_blank\" rel=\"noopener\">tar</a> from 2.2.1 to 2.2.2.</p>\n<details><br><summary>Commits</summary><br><br>- <a href=\"https://github.com/npm/node-tar/commit/523c5c7fef48b10811fccd12b42803c61b6aead8\" target=\"_blank\" rel=\"noopener\"><code>523c5c7</code></a> 2.2.2<br>- <a href=\"https://github.com/npm/node-tar/commit/7ecef07da6a9e72cc0c4d0c9c6a8e85b6b52395d\" target=\"_blank\" rel=\"noopener\"><code>7ecef07</code></a> Bump fstream to fix hardlink overwriting vulnerability<br>- <a href=\"https://github.com/npm/node-tar/commit/9fc84b9c596c3589d4c1ab050843de0eafb002e8\" target=\"_blank\" rel=\"noopener\"><code>9fc84b9</code></a> Use {} for hardlink tracking instead of []<br>- <a href=\"https://github.com/npm/node-tar/commit/15e59f1d671ffbe4ae7c74dafcbec93ea2584e34\" target=\"_blank\" rel=\"noopener\"><code>15e59f1</code></a> Only track previously seen hardlinks<br>- <a href=\"https://github.com/npm/node-tar/commit/4f8585178af78f8f64c5ca38e923c306613278b9\" target=\"_blank\" rel=\"noopener\"><code>4f85851</code></a> Ignore potentially unsafe files<br>- See full diff in <a href=\"https://github.com/npm/node-tar/compare/v2.2.1...v2.2.2\" target=\"_blank\" rel=\"noopener\">compare view</a><br></details><br><br><br><br><a href=\"https://help.github.com/articles/configuring-automated-security-fixes\" target=\"_blank\" rel=\"noopener\"><img src=\"https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=tar&amp;package-manager=npm_and_yarn&amp;previous-version=2.2.1&amp;new-version=2.2.2\" alt=\"Dependabot compatibility score\"></a><br><br>Dependabot will resolve any conflicts with this PR as long as you don’t alter it yourself. You can also trigger a rebase manually by commenting <code>@dependabot rebase</code>.<br><br>[//]: # (dependabot-automerge-start)<br>[//]: # (dependabot-automerge-end)<br><br>—<br><br><details><br><summary>Dependabot commands and options</summary><br><br><br><br>You can trigger Dependabot actions by commenting on this PR:<br>- <code>@dependabot rebase</code> will rebase this PR<br>- <code>@dependabot recreate</code> will recreate this PR, overwriting any edits that have been made to it<br>- <code>@dependabot merge</code> will merge this PR after your CI passes on it<br>- <code>@dependabot squash and merge</code> will squash and merge this PR after your CI passes on it<br>- <code>@dependabot cancel merge</code> will cancel a previously requested merge and block automerging<br>- <code>@dependabot reopen</code> will reopen this PR if it is closed<br>- <code>@dependabot ignore this [patch|minor|major] version</code> will close this PR and stop Dependabot creating any more for this minor/major version (unless you reopen the PR or upgrade to it yourself)<br>- <code>@dependabot ignore this dependency</code> will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)<br>- <code>@dependabot use these labels</code> will set the current labels as the default for future PRs for this repo and language<br>- <code>@dependabot use these reviewers</code> will set the current reviewers as the default for future PRs for this repo and language<br>- <code>@dependabot use these assignees</code> will set the current assignees as the default for future PRs for this repo and language<br>- <code>@dependabot use this milestone</code> will set the current milestone as the default for future PRs for this repo and language<br><br>You can disable automated security fix PRs for this repo from the <a href=\"https://github.com/vincenthou/vincenthou.github.io/network/alerts\" target=\"_blank\" rel=\"noopener\">Security Alerts page</a>.<br><br></details>","categories":[],"tags":["dependencies"]},{"title":"通用表单搭建器信息收集","url":"https://vincenthou.github.io/2019/10/04/通用表单搭建器信息收集/","content":"<h1 id=\"技术目标\"><a href=\"#技术目标\" class=\"headerlink\" title=\"技术目标\"></a>技术目标</h1><ul>\n<li>语言和UI组件框架无关性</li>\n<li>搭建和渲染态最小依赖<ul>\n<li>Editor -&gt; schema(DSL)</li>\n<li>schema(DSL) + renderer -&gt; page</li>\n</ul>\n</li>\n<li>源码生态互通</li>\n<li>搭建器的各部分可插拔可扩展，抽取通用搭建行为的接口以及底层搭建器能力</li>\n</ul>\n<h1 id=\"产品目标\"><a href=\"#产品目标\" class=\"headerlink\" title=\"产品目标\"></a>产品目标</h1><ul>\n<li>根据用户区分，覆盖light和pro用户诉求</li>\n<li>搭建体验参考sketch，支持自由拖拽并方便对齐(栅格化，多选排列)</li>\n<li>遵循奥卡姆剃刀原则，最小化用户认知障碍，内置用户引导能力</li>\n</ul>\n<h1 id=\"设计\"><a href=\"#设计\" class=\"headerlink\" title=\"设计\"></a>设计</h1><ul>\n<li><a href=\"https://experience.sap.com/fiori-design-web/form/\" target=\"_blank\" rel=\"noopener\">SAP Form Design</a></li>\n</ul>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><h2 id=\"产品方案\"><a href=\"#产品方案\" class=\"headerlink\" title=\"产品方案\"></a>产品方案</h2><ul>\n<li><a href=\"https://help.form.io/\" target=\"_blank\" rel=\"noopener\">form.io</a>：单据中心的产品方向</li>\n<li><a href=\"https://github.com/formio\" target=\"_blank\" rel=\"noopener\">formio</a>：form.io开源代码</li>\n<li><a href=\"https://calderaforms.com/\" target=\"_blank\" rel=\"noopener\">calderaforms</a>: wordpress插件</li>\n</ul>\n<h2 id=\"关于APaas\"><a href=\"#关于APaas\" class=\"headerlink\" title=\"关于APaas\"></a>关于APaas</h2><ul>\n<li><a href=\"https://36kr.com/p/5251547\" target=\"_blank\" rel=\"noopener\">细说APaaS这个独特的软件门类</a></li>\n<li><a href=\"https://hc.qingflow.com/article-categories/form/\" target=\"_blank\" rel=\"noopener\">轻流</a></li>\n<li><a href=\"https://hc.jiandaoyun.com/doc/9013\" target=\"_blank\" rel=\"noopener\">简道云</a></li>\n<li><a href=\"https://doc.baibaoyun.com/doc/108\" target=\"_blank\" rel=\"noopener\">百宝云</a></li>\n<li><a href=\"https://help.h3yun.com/#%E8%A1%A8%E5%8D%95%E8%AE%BE%E8%AE%A1\" target=\"_blank\" rel=\"noopener\">氚云</a></li>\n<li><a href=\"http://support.mingdao.com/hc/kb/article/1029033/\" target=\"_blank\" rel=\"noopener\">明道云</a></li>\n<li><a href=\"https://www.huoban.com/discovery/manual/create/create_from_yourself.html\" target=\"_blank\" rel=\"noopener\">伙伴云</a></li>\n</ul>\n<h2 id=\"完整能力\"><a href=\"#完整能力\" class=\"headerlink\" title=\"完整能力\"></a>完整能力</h2><ul>\n<li><a href=\"https://github.com/orbeon/orbeon-forms\" target=\"_blank\" rel=\"noopener\">orbeon-forms</a>: 商业解决方案</li>\n<li><a href=\"https://github.com/dream2023/vue-ele-form\" target=\"_blank\" rel=\"noopener\">vue-ele-form</a>: vue语言绑定，布局和动态代码</li>\n<li><a href=\"https://github.com/formql/formql\" target=\"_blank\" rel=\"noopener\">formql</a>: angular语言绑定</li>\n<li><a href=\"https://github.com/blackjk3/react-form-builder\" target=\"_blank\" rel=\"noopener\">react-form-builder</a>: react语言绑定，不再维护</li>\n<li><a href=\"https://github.com/giscafer/ngx-form-builder\" target=\"_blank\" rel=\"noopener\">ngx-form-builder</a>：angular语言绑定，不再维护</li>\n</ul>\n<h2 id=\"搭建器\"><a href=\"#搭建器\" class=\"headerlink\" title=\"搭建器\"></a>搭建器</h2><ul>\n<li><a href=\"https://github.com/Draggable/formeo\" target=\"_blank\" rel=\"noopener\">formeo</a></li>\n<li><a href=\"https://www.formsite.com/\" target=\"_blank\" rel=\"noopener\">formsite</a></li>\n<li><a href=\"https://www.cognitoforms.com/forms/build\" target=\"_blank\" rel=\"noopener\">cognitoforms</a></li>\n<li><a href=\"https://github.com/sethsandaru/vue-form-builder\" target=\"_blank\" rel=\"noopener\">vue-form-builder</a></li>\n<li><a href=\"https://github.com/surveyjs/survey-creator\" target=\"_blank\" rel=\"noopener\">survey-creator</a></li>\n</ul>\n<h2 id=\"源码开发封装\"><a href=\"#源码开发封装\" class=\"headerlink\" title=\"源码开发封装\"></a>源码开发封装</h2><h3 id=\"通用\"><a href=\"#通用\" class=\"headerlink\" title=\"通用\"></a>通用</h3><ul>\n<li><a href=\"https://github.com/json-editor/json-editor\" target=\"_blank\" rel=\"noopener\">json-editor</a>: JSON schema + renderer -&gt; JSON schema<h3 id=\"Vue\"><a href=\"#Vue\" class=\"headerlink\" title=\"Vue\"></a>Vue</h3></li>\n<li><a href=\"https://github.com/xaboy/form-create\" target=\"_blank\" rel=\"noopener\">form-create</a></li>\n<li><a href=\"https://github.com/codetrial/element-form-builder\" target=\"_blank\" rel=\"noopener\">element-form-builder</a><h3 id=\"React\"><a href=\"#React\" class=\"headerlink\" title=\"React\"></a>React</h3></li>\n<li><a href=\"https://github.com/dog-days/antd-form-component\" target=\"_blank\" rel=\"noopener\">antd-form-component</a></li>\n<li><a href=\"https://github.com/rjsf-team/react-jsonschema-form\" target=\"_blank\" rel=\"noopener\">react-jsonschema-form</a><h3 id=\"Angular\"><a href=\"#Angular\" class=\"headerlink\" title=\"Angular\"></a>Angular</h3></li>\n<li><a href=\"https://ng-alain.com/form/getting-started/zh\" target=\"_blank\" rel=\"noopener\">@alain/form</a></li>\n<li><a href=\"https://github.com/guillotinaweb/ngx-schema-form\" target=\"_blank\" rel=\"noopener\">ngx-schema-form</a></li>\n<li><a href=\"https://github.com/ngx-formly/ngx-formly\" target=\"_blank\" rel=\"noopener\">ngx-formly</a></li>\n<li><a href=\"https://github.com/EndyKaufman/ngx-dynamic-form-builder\" target=\"_blank\" rel=\"noopener\">ngx-dynamic-form-builder</a></li>\n</ul>\n<h2 id=\"图形编辑器\"><a href=\"#图形编辑器\" class=\"headerlink\" title=\"图形编辑器\"></a>图形编辑器</h2><ul>\n<li><a href=\"https://github.com/alibaba/ggeditor\" target=\"_blank\" rel=\"noopener\">ggeditor</a>：</li>\n<li><a href=\"https://github.com/samsha/graph.editor\" target=\"_blank\" rel=\"noopener\">graph.editor</a></li>\n</ul>\n","categories":[],"tags":[]},{"title":"开发工具库","url":"https://vincenthou.github.io/2019/10/04/开发工具库/","content":"<h1 id=\"功能型\"><a href=\"#功能型\" class=\"headerlink\" title=\"功能型\"></a>功能型</h1><ul>\n<li><a href=\"https://github.com/eligrey/FileSaver.js\" target=\"_blank\" rel=\"noopener\">FileSaver.js</a>: 通过创建blob对象在前端另存为</li>\n<li><a href=\"https://github.com/MrRio/jsPDF\" target=\"_blank\" rel=\"noopener\">jsPDF</a>: 前端专业生成PDF</li>\n<li><a href=\"https://github.com/mailru/FileAPI\" target=\"_blank\" rel=\"noopener\">FileAPI</a>：各种（文本，图片）文件多方式（批量，拖拽）上传</li>\n<li><a href=\"https://github.com/davidshimjs/qrcodejs\" target=\"_blank\" rel=\"noopener\">qrcodejs</a>：二维码生成器</li>\n<li><a href=\"https://github.com/iamkun/dayjs\" target=\"_blank\" rel=\"noopener\">dayjs</a>: 日期格式化，moment的light版</li>\n<li><a href=\"https://github.com/zenorocha/clipboard.js\" target=\"_blank\" rel=\"noopener\">clipboard.js</a>: 拷贝到剪切板</li>\n<li><a href=\"https://github.com/SheetJS/js-xlsx\" target=\"_blank\" rel=\"noopener\">js-xlsx</a>：前端保存为excel<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> workbook = XLSX.utils.table_to_book(<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'table'</span>));</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h1 id=\"事件封装\"><a href=\"#事件封装\" class=\"headerlink\" title=\"事件封装\"></a>事件封装</h1><ul>\n<li><a href=\"https://github.com/alexgibson/shake.js\" target=\"_blank\" rel=\"noopener\">shake.js</a>：摇一摇</li>\n<li><a href=\"https://github.com/any86/any-touch\" target=\"_blank\" rel=\"noopener\">any-touch</a>：移动手势库</li>\n</ul>\n<h1 id=\"小组件\"><a href=\"#小组件\" class=\"headerlink\" title=\"小组件\"></a>小组件</h1><ul>\n<li><a href=\"https://github.com/nolimits4web/swiper\" target=\"_blank\" rel=\"noopener\">swiper</a>：轮播图</li>\n<li><a href=\"https://github.com/jackmoore/autosize\" target=\"_blank\" rel=\"noopener\">autosize</a>：textarea高度根据输入实时自适应</li>\n<li><a href=\"https://github.com/kimmobrunfeldt/progressbar.js\" target=\"_blank\" rel=\"noopener\">progressbar.js</a>：高可定制进度条</li>\n<li><a href=\"https://github.com/josdejong/jsoneditor\" target=\"_blank\" rel=\"noopener\">jsoneditor</a>: json编辑器</li>\n</ul>\n<h1 id=\"可视化搭建\"><a href=\"#可视化搭建\" class=\"headerlink\" title=\"可视化搭建\"></a>可视化搭建</h1><ul>\n<li><a href=\"https://github.com/yyccmmkk/js-reference-line\" target=\"_blank\" rel=\"noopener\">js-reference-line</a>: js 拖动时生成对齐线</li>\n<li><a href=\"https://github.com/yyccmmkk/js-resize-ui\" target=\"_blank\" rel=\"noopener\">js-resize-ui</a>: 对页面元素进行缩放操作，支持按下ctrl 后同比例缩放，及任意缩放</li>\n<li><a href=\"https://github.com/zinkey/react-cool-layout\" target=\"_blank\" rel=\"noopener\">react-cool-layout</a>：定义元素的相对位置关系来自适应布局，布局位置根据相对位置关系动态计算</li>\n</ul>\n<h1 id=\"snippet\"><a href=\"#snippet\" class=\"headerlink\" title=\"snippet\"></a>snippet</h1><ul>\n<li><a href=\"https://github.com/any86/any-rule\" target=\"_blank\" rel=\"noopener\">any-rule</a>: 常用正则表达式</li>\n</ul>\n","categories":[],"tags":["frontend","collection"]},{"title":"寓教于乐的技术教程","url":"https://vincenthou.github.io/2018/08/21/寓教于乐的技术教程/","content":"<h1 id=\"CSS布局\"><a href=\"#CSS布局\" class=\"headerlink\" title=\"CSS布局\"></a>CSS布局</h1><ul>\n<li>Flexbox: <a href=\"https://flexboxfroggy.com/\" target=\"_blank\" rel=\"noopener\">flexboxfroggy</a></li>\n<li>CSS Grid: <a href=\"https://cssgridgarden.com/\" target=\"_blank\" rel=\"noopener\">cssgridgarden</a>，<a href=\"https://juejin.im/post/5b70c7c7e51d45666e2c6ade\" target=\"_blank\" rel=\"noopener\">解说</a></li>\n</ul>\n","categories":[],"tags":["frontend","collection"]},{"title":"WebAssembly应用","url":"https://vincenthou.github.io/2018/08/12/WebAssembly应用/","content":"<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://segmentfault.com/a/1190000012110615\" target=\"_blank\" rel=\"noopener\">认识 WebAssembly</a></li>\n<li><a href=\"https://blog.zhouzhipeng.com/debug-webassembly.html\" target=\"_blank\" rel=\"noopener\">走近WebAssembly之调试大法</a></li>\n</ul>\n","categories":[],"tags":["frontend","collection","pefermance"]},{"title":"设计语言","url":"https://vincenthou.github.io/2018/08/09/设计语言/","content":"<h1 id=\"原子设计\"><a href=\"#原子设计\" class=\"headerlink\" title=\"原子设计\"></a>原子设计</h1><p><a href=\"http://atomicdesign.bradfrost.com/table-of-contents/\" target=\"_blank\" rel=\"noopener\">http://atomicdesign.bradfrost.com/table-of-contents/</a></p>\n<h1 id=\"Ant-Design\"><a href=\"#Ant-Design\" class=\"headerlink\" title=\"Ant Design\"></a>Ant Design</h1><p><a href=\"https://ant.design/docs/spec/introduce-cn\" target=\"_blank\" rel=\"noopener\">https://ant.design/docs/spec/introduce-cn</a></p>\n<h1 id=\"Teambition\"><a href=\"#Teambition\" class=\"headerlink\" title=\"Teambition\"></a>Teambition</h1><p><a href=\"https://design.teambition.com/\" target=\"_blank\" rel=\"noopener\">https://design.teambition.com/</a></p>\n<h1 id=\"Material-Design\"><a href=\"#Material-Design\" class=\"headerlink\" title=\"Material Design\"></a>Material Design</h1><p><a href=\"https://material.io/\" target=\"_blank\" rel=\"noopener\">https://material.io/</a></p>\n<h1 id=\"优质的组件库\"><a href=\"#优质的组件库\" class=\"headerlink\" title=\"优质的组件库\"></a>优质的组件库</h1><ul>\n<li><a href=\"https://www.iviewui.com/\" target=\"_blank\" rel=\"noopener\">iView</a>：一套基于 Vue.js 的高质量UI 组件库</li>\n</ul>\n","categories":[],"tags":["design"]},{"title":"Interesting","url":"https://vincenthou.github.io/2018/08/06/Interesting/","content":"<h1 id=\"Title\"><a href=\"#Title\" class=\"headerlink\" title=\"Title\"></a>Title</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/*</span><br><span class=\"line\"> * We&apos;re hiring developers.</span><br><span class=\"line\">*/</span><br></pre></td></tr></table></figure>\n<h1 id=\"Content\"><a href=\"#Content\" class=\"headerlink\" title=\"Content\"></a>Content</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (You.job == Developer.App | Developer.Web) &#123;</span><br><span class=\"line\">    if (You.status == status.Unhappy) &#123;</span><br><span class=\"line\">        stopUnhappy();</span><br><span class=\"line\">        applyBagelLabs();</span><br><span class=\"line\">        beAwesome();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/43693741-43183908-9962-11e8-9747-c7abe58faddd.png\" alt=\"image\"></p>\n","categories":[],"tags":["collection"]},{"title":"【摘录】人工智能理解","url":"https://vincenthou.github.io/2018/08/02/【摘录】人工智能理解/","content":"<p>人工智能并不是一个新的术语，它已经有几十年的历史了，大约从80年代初开始，计算机科学家们开始设计可以学习和模仿人类行为的算法。在算法方面，最重要的算法是<strong>神经网络</strong>，由于<strong>过拟合</strong>而不是很成功（模型太强大，但<strong>数据不足</strong>）。尽管如此，在一些更具体的任务中，使用数据来适应功能的想法已经取得了显着的成功，并且这也构成了当今机器学习的基础。在模仿方面，人工智能专注于图像识别，语音识别和自然语言处理。人工智能专家们花费了大量的时间来创建诸如边缘检测，颜色配置文件，N-gram，语法树等。不过，这些进步还不足以达到我们的需求。</p>\n<h2 id=\"传统的机器学习\"><a href=\"#传统的机器学习\" class=\"headerlink\" title=\"传统的机器学习\"></a>传统的机器学习</h2><p>机器学习（ML）技术在预测中发挥了重要的作用，ML经历了多代的发展，形成了具有丰富的模型结构，例如：</p>\n<ul>\n<li>线性回归</li>\n<li>逻辑回归</li>\n<li>决策树</li>\n<li>支持向量机</li>\n<li>贝叶斯模型</li>\n<li>正则化模型</li>\n<li>模型集成</li>\n<li>神经网络</li>\n</ul>\n<p>这些预测模型中的每一个都基于特定的算法结构，参数都是可调的。训练预测模型涉及以下步骤：</p>\n<ol>\n<li>选择一个模型结构（例如逻辑回归，随机森林等）。</li>\n<li>用训练数据（输入和输出）输入模型。</li>\n<li>学习算法将输出最优模型（即具有使训练错误最小化的特定参数的模型）。</li>\n</ol>\n<p>每种模式都有自己的特点，在一些任务中表现不错，但在其他方面表现不佳。但总的来说，我们可以把它们分成<strong>低功耗（简单）模型</strong>和<strong>高功耗（复杂）模型</strong>。选择不同的模型是一个非常棘手的问题。</p>\n<p>由于以下原因，使用低功率/简单模型是优于使用高功率/复杂模型：</p>\n<ul>\n<li><strong>算力：</strong>在我们拥有强大的处理能力之前，训练高功率模型将需要很长的时间。</li>\n<li><strong>数据不足：</strong> 在我们拥有大量数据之前，训练高功率模型会导致过度拟合问题（因为高功率模型具有丰富的参数并且可以适应广泛的数据形状，所以我们最终可能训练一个适合于特定到当前的训练数据，而不是推广到足以对未来的数据做好预测）。</li>\n</ul>\n<p>然而，选择一个低功率的模型会遇到所谓的“欠拟合”的问题，模型结构太简单，如果它复杂，就无法适应训练数据。（想象一下，基础数据有一个二次方关系：y = 5 <em> x ^ 2;你无法适应线性回归：y = a </em> x + b，不管我们选择什么样的a和b。</p>\n<p>为了缓解“不适合的问题”，数据科学家通常会运用他们的“领域知识”来提出“输入特征”，这与输出关系更为直接。（例如，返回二次关系y = 5 <em> square（x），如果创建了一个特征z = x ^ 2，则可以拟合线性回归：y = a </em> z + b，通过选择a = 5和b = 0）。</p>\n<p>机器学习的主要障碍是特征工程这个步骤，这需要领域专家在进入训练过程之前就要找到非常重要的特征。特征工程步骤是要靠手动完成的，而且需要大量领域专业知识，因此它成为当今大多数机器学习任务的主要瓶颈。</p>\n<p>换句话说，如果我们没有足够的处理能力和足够的数据，那么我们必须使用低功耗/更简单的模型，这就需要我们花费大量的时间和精力来创建合适的输入特征。这是大多数数据科学家今天花时间去做的地方。（算力和数据不足依赖于领域知识）</p>\n<h2 id=\"神经网络的回归\"><a href=\"#神经网络的回归\" class=\"headerlink\" title=\"神经网络的回归\"></a>神经网络的回归</h2><p>在大数据时代，云计算和大规模并行处理基础架构的共同发展，使得机器处理能力在二十一世纪初得到了极大的提升。我们不再局限于低功耗/简单的模型。例如，当今最流行的两种主流机器学习模型是随机森林和梯度提升树。尽管如此，两者都非常强大，并且提供了非线性模型拟合的训练数据，但数据科学家仍然需要仔细地创建特征以获得良好的性能。</p>\n<p>与此同时，计算机科学家重新使用神经网络的许多层来完成这些人类模仿的任务。这给DNN（深度神经网络）带来了新的生机，并在图像分类和语音识别任务方面提供了重大突破。DNN的主要区别在于，你可以将原始信号（例如RGB像素值）直接输入DNN，而不需要创建任何域特定的输入功能。通过多层神经元（这就是为什么它被称为“深度”神经网络），DNN可以“自动”通过每一层产生适当的特征，最后提供一个非常好的预测。这极大地消除了寻找“特征工程”的麻烦，这是数据科学家们最喜欢看到的。</p>\n<p>DNN也演变成许多不同的网络拓扑结构，所以有CNN（卷积神经网络），RNN（递归神经网络），LSTM（长期短期记忆），GAN（生成敌对网络），转移学习，注意模型（attention model）所有的这些被统称为深度学习（Deep Learning），它正在引起整个机器学习界的关注。</p>\n<h2 id=\"强化学习\"><a href=\"#强化学习\" class=\"headerlink\" title=\"强化学习\"></a>强化学习</h2><p>另一个关键组成部分是关于如何模仿一个人（或动物）的学习，设想感知/行为/奖励循环的非常自然的动物行为。一个人或者一个动物首先会通过感知他或者她所处的状态来了解环境。在此基础上，他或者她会选择一个“动作”，将他或者她带到另一个“状态”。那么他或她将获得“奖励”，循环重复，直到他或她消失。这种学习方式（称为强化学习）与传统监督机器学习的曲线拟合方法有很大不同。尤其是，强化学习学习得非常快，因为每一个新的反馈（例如执行一个行动并获得奖励）都被立即发送到影响随后的决定。</p>\n<p>强化学习也提供了预测和优化的平滑整合，因为它在采取不同的行动时保持当前状态的信念和可能的转换概率，然后做出决定哪些行动可以导致最佳结果。</p>\n<h2 id=\"深度学习-强化学习-AI\"><a href=\"#深度学习-强化学习-AI\" class=\"headerlink\" title=\"深度学习+强化学习= AI\"></a>深度学习+强化学习= AI</h2><p>与经典的ML技术相比，DL提供了一个更强大的预测模型，通常可以产生良好的预测结果。与经典优化模型相比，强化学习提供了更快的学习机制，并且更适应环境的变化。</p>\n<h2 id=\"机器学习-vs-深度学习\"><a href=\"#机器学习-vs-深度学习\" class=\"headerlink\" title=\"机器学习 vs 深度学习\"></a>机器学习 vs 深度学习</h2><p>在深度探讨machine learning和data science的联系之前，这里简要地讨论一下machine learning 和deep learning。machine learning是一套算法，来训练数据集做预测或者采取行动以使得系统最优化。举例来说，supervised classification algorithms被用来根据历史数据将想要贷款的客户分成预期好的和预期差的(good or bad prospects)。对于给定的任务(比如监督聚类)，需要的技术多种多样：naive Bayes、SVM、neural nets、ensembles、association rules、decision trees、logistic regression，或者是很多技术的组合。所有这些都是数据科学的子集。当这些算法自动化后，比如无人驾驶飞机或者无人驾驶汽车，这就叫AI了，或者说的具体一点，deep learning。如果采集的数据来自传感器并且通过互联网传播，那么这就是机器学习或数据科学或深度学习应用于物联网了。</p>\n<p>有些人对深度学习有不同的定义，他们认为深度学习是更深层次的神经网络(一种机器学习的技术)。AI(Artificial Intelligence)是创建于20世纪60年代的计算机科学的一个子领域，是关于解决那些对人类来讲非常容易但是对计算机而言很难的任务。值得一提的是，所谓的strong AI可能可以做所有人类可以做的事情(可能除了纯粹的物理问题)。这是相当广泛的，包括各种各样的事情，比如做计划，在世界上到处溜达，识别物体和声音，说话，翻译，社交或者商业交易，还有创造性工作(比如写诗画画)等等。</p>\n<p>NLP(Natural language processing)只是AI要处理的语言部分，尤其是写。</p>\n<p>Machine learning是这样的一种情况：给出一些可以被以离散形式描述的AI问题(比如从一系列动作中选出对的那个)，然后给定一堆外部世界的信息，在不需要程序员手动写程序的情况下选出那个“正确的”行为。通常情况需要借助外界的一些过程来判断这个动作对不对。在数学上，这就是函数：你给一些输入，然后你想要他处理一下得到正确的输出，所以整个问题就简化为用一些自动的方式建立这种数学函数模型。和AI区分一下：如果我写了一段特别机智的程序有着人类的行为，那这就可以是AI，但是除非它的参量都是自动从数据中学会的，否则就不是机器学习。</p>\n<p>Deep learning是当下非常流行的机器学习的一种。它包含一种特殊的数学模型，可以想成是一种特定类型的简单块的组合(或者说是块的功能的组合)，这些块可以进行调整来更好的预测最终结果。</p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-4515dd3be22d73d16a20603bd8f3bbfc_hd.png\" alt=\"img\"></p>\n<p><img src=\"https://pic4.zhimg.com/80/v2-7ecc88c589c468069639ae4ca8cc0a7b_hd.jpg\" alt=\"img\"></p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-5981d160a0e020c585fcb01420ec2108_hd.jpg\" alt=\"img\"></p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://www.zhihu.com/question/57770020\" target=\"_blank\" rel=\"noopener\">人工智能、机器学习和深度学习的区别?</a></li>\n<li><a href=\"https://www.zhihu.com/question/53740695\" target=\"_blank\" rel=\"noopener\">现在tensorflow和mxnet很火，是否还有必要学习scikit-learn等框架？</a></li>\n<li><a href=\"https://universalflowuniversity.com/Books/Computer%20Programming/Machine%20Learning%20and%20Deep%20Learning/Hands-On%20Machine%20Learning%20with%20Scikit-Learn%20%26%20TensorFlow.pdf\" target=\"_blank\" rel=\"noopener\">Hands-On Machine Learning with Scikit-Learn &amp; TensorFlow</a></li>\n</ul>\n<h1 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h1><ul>\n<li><a href=\"http://scikit-learn.org/stable/\" target=\"_blank\" rel=\"noopener\">scikit-learn</a>：通用机器学习库，利用特征工程(feature engineering)，人为对数据进行提炼清洗</li>\n<li><a href=\"https://www.tensorflow.org/\" target=\"_blank\" rel=\"noopener\">tensorflow</a>：深度学习库，利用特征工程(feature engineering)，人为对数据进行提炼清洗</li>\n</ul>\n","categories":[],"tags":["collection","AI"]},{"title":"Lint工具在前端工程化中的价值和应用","url":"https://vincenthou.github.io/2017/10/02/Lint工具在前端工程化中的价值和应用/","content":"<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://slides.com/ai/linters#/\" target=\"_blank\" rel=\"noopener\">Robots must suffer — linters and tools for front-end development</a></li>\n</ul>\n","categories":[],"tags":["blog","frontend","todo","build"]},{"title":"【翻译】早安OpenFaaS CLI","url":"https://vincenthou.github.io/2017/09/28/【翻译】早安OpenFaaS-CLI/","content":"<p>原文链接: <a href=\"https://blog.alexellis.io/quickstart-openfaas-cli/\" target=\"_blank\" rel=\"noopener\">https://blog.alexellis.io/quickstart-openfaas-cli/</a></p>\n","categories":[],"tags":["architecture","todo","backend","translation"]},{"title":"GraphQL实践","url":"https://vincenthou.github.io/2017/09/12/GraphQL实践/","content":"<ul>\n<li><a href=\"https://github.com/facebook/graphql\" target=\"_blank\" rel=\"noopener\">GraphQL Spec</a></li>\n<li><a href=\"https://github.com/graphql/graphql-js\" target=\"_blank\" rel=\"noopener\">Node.js reference implementation</a></li>\n<li><a href=\"https://github.com/chentsulin/koa-graphql\" target=\"_blank\" rel=\"noopener\">Koa middleware</a></li>\n<li><a href=\"https://github.com/relax/relax\" target=\"_blank\" rel=\"noopener\">relax CMS</a></li>\n<li><a href=\"https://github.com/apollographql/apollo-client\" target=\"_blank\" rel=\"noopener\">Apollo Client for GraphQL consumer</a></li>\n<li><a href=\"https://github.com/chentsulin/awesome-graphql\" target=\"_blank\" rel=\"noopener\">Awesome GraphQL</a></li>\n<li><a href=\"http://www.zcfy.cc/article/rest-apis-are-rest-in-peace-apis-long-live-graphql-3935.html\" target=\"_blank\" rel=\"noopener\">安息吧 REST API，GraphQL 长存</a></li>\n</ul>\n","categories":[],"tags":["blog","architecture","todo"]},{"title":"《别告诉我你懂PPT》摘要","url":"https://vincenthou.github.io/2017/09/08/《别告诉我你懂PPT》摘要/","content":"<h1 id=\"让你的-PPT-讲故事\"><a href=\"#让你的-PPT-讲故事\" class=\"headerlink\" title=\"让你的 PPT 讲故事\"></a>让你的 PPT 讲故事</h1><h2 id=\"抓住眼球的雷人主标题\"><a href=\"#抓住眼球的雷人主标题\" class=\"headerlink\" title=\"抓住眼球的雷人主标题\"></a>抓住眼球的雷人主标题</h2><h3 id=\"标题-震撼力\"><a href=\"#标题-震撼力\" class=\"headerlink\" title=\"标题 = 震撼力\"></a>标题 = 震撼力</h3><p>好的标题应该是“镖题”，有创意的名字可以立即博人眼球，例如《High 5》，简单清楚又表明有5个方案，表达出团队合作和成功的喜悦。再例如《Burn the midnight Oil》，是有关于油的项目，也体现出来团队加班加点的辛苦。</p>\n<h3 id=\"三步起一个精妙的主标题\"><a href=\"#三步起一个精妙的主标题\" class=\"headerlink\" title=\"三步起一个精妙的主标题\"></a>三步起一个精妙的主标题</h3><ul>\n<li>列出客观关键词：动词，形容词，副词，数量词，名词</li>\n<li>提炼主观关键词：指这个项目背后，项目组成员体现的精神、克服的困难、表达的情绪，表达出工作背后的“软成果”</li>\n<li>把主观关键词“嫁”给客观关键词</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:right\">词性</th>\n<th>客观关键词</th>\n<th>联想</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:right\">动词</td>\n<td>选择</td>\n<td>不选最贵只选最好</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">形容词、副词</td>\n<td>最终</td>\n<td>已终未始</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">数词、量词</td>\n<td>5个</td>\n<td>High 5</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">名词</td>\n<td>洗衣粉、配方</td>\n<td>洗刷刷全靠它</td>\n</tr>\n</tbody>\n</table>\n<p>使用双关，言在此而意在彼，此和彼在这里就是客观关键词和主观关键词，例如“Happy 牛 year”，”OIC -&gt; Oh, I see”，摩尔香烟“Ask for More”。</p>\n<p><strong>Tip:</strong> 客观、主观关键词结合后，千万别忘了反过来想想，题目风格是否合适用在当前PPT中，场合、听众对象以及情绪表达是否恰当。</p>\n<blockquote>\n<p>职场感悟：世界上没有失败的项目，把“失败的项目”变个节奏，不但演奏者心情变了，听到音乐的人心情也跟着变了。</p>\n</blockquote>\n<h4 id=\"双关联想法\"><a href=\"#双关联想法\" class=\"headerlink\" title=\"双关联想法\"></a>双关联想法</h4><ul>\n<li>偷梁换柱：把一个词里的一部分用我们想要的关键词来替换（换一个谐音字，或者换一个同音字），例如One Wash, One Dream（一次洗涤，一个梦想）</li>\n<li>通过时间来双关：把表示时间或者具有时代感的词语拿来套用，拉近与听众的距离，增强感染力，例如Merry Xmas and Healthy New Year（下年关于健康食品的研发计划）; 恭喜发财，“报表”拿来; 春江水暖“股”先知; “销售部”里说丰年（年底销售汇总）</li>\n<li>通过缩写变换：缩写尽量用简单的词，这个简单的单词和句子之一要表达主观关键词，而另一个要表达出客观关键词，例如 RISE(Refreshed Innovation Cuts Edge) <strong>使用动画在鼠标点击的时候像巨幕拉开一样</strong></li>\n<li>通过字形变化：OMO（奥妙） -&gt; WOW, OMO</li>\n<li>通过成语来双关：置换成语的字，常间于广告，例如步步为“赢”，Like White on Rice（像米上的白色，也是紧密的意思，表达了团队精神）</li>\n</ul>\n<h3 id=\"找到一个精妙标题的路径\"><a href=\"#找到一个精妙标题的路径\" class=\"headerlink\" title=\"找到一个精妙标题的路径\"></a>找到一个精妙标题的路径</h3><h4 id=\"多积累、勤思考，精妙标题不请自来\"><a href=\"#多积累、勤思考，精妙标题不请自来\" class=\"headerlink\" title=\"多积累、勤思考，精妙标题不请自来\"></a>多积累、勤思考，精妙标题不请自来</h4><p>多看书名、电影名、唱片名设置是网络流行语、广告语，思考这些标题为什么能够吸人眼球，多进行brainstorm，积累多了就自然而然了。例如使用Live Free or Die Hard（虎胆龙威，表达悲壮的气氛），不见不散（粒子对撞试验）</p>\n<ul>\n<li>XX总动员</li>\n<li>我和XX有个约会</li>\n<li>今天你XX了吗</li>\n<li>XX一箩筐</li>\n<li>我的XX我做主<br>× 做的不是XX，是寂寞</li>\n</ul>\n<h4 id=\"巧用搜索引擎\"><a href=\"#巧用搜索引擎\" class=\"headerlink\" title=\"巧用搜索引擎\"></a>巧用搜索引擎</h4><p>在搜索栏中输入客观关键词和“成语”这个词，例如google就是 oil 和 idiom，再根据自己的实际项目情况筛选赋予意义。两个好用的英语在线成语词典：<a href=\"http://idioms.thefreedictionary.com/\" target=\"_blank\" rel=\"noopener\">thefreedictionary</a>，<a href=\"https://www.usingenglish.com/reference/idioms/\" target=\"_blank\" rel=\"noopener\">usingenglish</a>，都可以按关键词查找。</p>\n<blockquote>\n<p>职场感悟：带团队的时候，注意分配任务的时候强调细节，并寻求对方的反馈，确认是否交代清楚，让自己承担团队的责任。出问题也要用于承担责任</p>\n</blockquote>\n<h2 id=\"用副标题点破窗户纸\"><a href=\"#用副标题点破窗户纸\" class=\"headerlink\" title=\"用副标题点破窗户纸\"></a>用副标题点破窗户纸</h2><h3 id=\"清晰副标题的必要性\"><a href=\"#清晰副标题的必要性\" class=\"headerlink\" title=\"清晰副标题的必要性\"></a>清晰副标题的必要性</h3><p>主标题只是隐藏了客观关键词，副标题是主标题的一个呼应、补充和平衡。主标题要生动、形象、概括力强，那么副标题要明确清楚、一目了然，怎么明白怎么来，副标题要包含尽量多的客观关键词。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:right\">主标题</th>\n<th>副标题</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:right\">High 5</td>\n<td>某洗衣粉最终配方的筛选</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">Merry Xmas and Healthy New Year</td>\n<td>百事食品亚太区XXX年度健康视频开发计划</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">WOW, OMO</td>\n<td>奥妙新配方的测试报告</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">不见不散</td>\n<td>某对撞机的实验报告</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"清晰副标题的要点\"><a href=\"#清晰副标题的要点\" class=\"headerlink\" title=\"清晰副标题的要点\"></a>清晰副标题的要点</h3><ul>\n<li>加强针对性：把目标的范围缩小，尽可能精确的表达内容，并指出PPT的目标听众，找准靶子，让听众对号入座</li>\n<li>明确的时间段：如果报告有时间方面的内容，最好也在副标题中体现</li>\n<li>定义内容的性质：性质不同，风格也迥然不同，要考虑说什么，怎么说，不但要考虑表达自己的观点，更重要是 <strong>展示公司的形象</strong></li>\n</ul>\n<h2 id=\"不简单的简单完整句\"><a href=\"#不简单的简单完整句\" class=\"headerlink\" title=\"不简单的简单完整句\"></a>不简单的简单完整句</h2><h3 id=\"简单完整句其实不简单\"><a href=\"#简单完整句其实不简单\" class=\"headerlink\" title=\"简单完整句其实不简单\"></a>简单完整句其实不简单</h3><p>PPT里面要有完整的观点，让人能够看得明白，短语的信息基本为零，完整句一目了然。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:right\">短语</th>\n<th>完整句</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:right\">项目背景</td>\n<td>项目得到了集团总公司的大力支持</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">项目计划</td>\n<td>项目计划制定得仔细周到</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">项目实施</td>\n<td>项目实施得到了各方面的支持</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">项目进展</td>\n<td>项目中收获酸甜苦辣</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">项目收尾</td>\n<td>项目圆满完成</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>职场感悟：每次汇报工作用1页纸和10分钟，纸上用简单句列举项目的进展、下一步的计划以及遇到的问题，同时列出列有和希望老板知道的部分，每一部分都用不同的颜色标出是顺利进行还是遇到阻力、面临风险。</p>\n</blockquote>\n<h3 id=\"完整你的简单句\"><a href=\"#完整你的简单句\" class=\"headerlink\" title=\"完整你的简单句\"></a>完整你的简单句</h3><p>不要迷恋KISS原则，重要的信息的传递，明确表达出你的观点。</p>\n<ul>\n<li>句子结构完整：一个句子有一个谓语，例如 project management -&gt; manage project</li>\n<li>观点明确：句子中不仅要陈述事实还要表达观点。一个句子中要有形容词或者副词来表明态度，不怕错就怕模糊，例如 rehearsal -&gt; importance of rehearsal -&gt; Rehearsal is important -&gt;Rehearsal is very important -&gt; Rehearsal is very important to build up confidence</li>\n</ul>\n<blockquote>\n<p>职场感悟：You must have your point of view. Otherwise, you can only be a good technician. 屁股决定脑袋，向老板勇敢说出自己的看法就是让他看到你屁股的高度，明确的观点也有助于让老板给出明确的答复。Bad workers always blames tools.</p>\n</blockquote>\n<h2 id=\"骨灰级的PPT结构——总分总\"><a href=\"#骨灰级的PPT结构——总分总\" class=\"headerlink\" title=\"骨灰级的PPT结构——总分总\"></a>骨灰级的PPT结构——总分总</h2><h3 id=\"第一个总：概述\"><a href=\"#第一个总：概述\" class=\"headerlink\" title=\"第一个总：概述\"></a>第一个总：概述</h3><p>使用概述（contents）或者议程（agenda），分条写，每一条都要用简单完整句，最好的效果是让听众1分钟内把握真个PPT的内容。如果是使用提问的方式写概要要注意下面亮点</p>\n<ul>\n<li>要一问到底，保持统一：所有的观点都用问题的方式提出，同时要在每一部分的开始或者结束时，给出一个明确的解答</li>\n<li>注意场合：提问这种方式用在听众比较少的workshop和公司内部会议上比较好，可以引人入胜。如果重要的项目汇报，提问打方式就是弄巧成拙</li>\n</ul>\n<blockquote>\n<p>职场感悟：要时刻保持自己看到 big picture，作为项目经理或者部分经理，要告诉团队伟大的项目到底是什么，它的前途如何光明，道路如何曲折，这样才能赢得士气。</p>\n</blockquote>\n<h3 id=\"把你的分论点制作成页标题\"><a href=\"#把你的分论点制作成页标题\" class=\"headerlink\" title=\"把你的分论点制作成页标题\"></a>把你的分论点制作成页标题</h3><p>如果把概述比作脊梁，那么分论点就是构建骨架的肋骨。把章节信息和本页观点有机结合起来，让章节的信息来统一结构，让页标题表达观点，使用双重标题的形式，也就是要起一个简短的章节标题，再用一句简单完整句来总结这一页的观点。一动一静，动的是整句话的观点，静的是这一章的标志，保持结构上的协调和统一。</p>\n<h3 id=\"第二个总：总结\"><a href=\"#第二个总：总结\" class=\"headerlink\" title=\"第二个总：总结\"></a>第二个总：总结</h3><p>总结是得到反馈的关键时刻，在总结时，主要要达到以下一个目的：</p>\n<ul>\n<li>回顾内容（recap）：把前面的内容扼要地梳理一边，要格外强调观点，多用”首先“、”然后“、”接下来“等表示逻辑顺序的词</li>\n<li>整理逻辑（logic）：要吧观点之间的联系给听众梳理出来，从而把之前灌输到听众脑子里的信息系统化、逻辑化，例如我们首先运用鱼骨法分析了项目的风险，评估了它们发生的可能性和一旦发生后果的严重性，接下来，基于上面的分时，我们选出了几个最主要的风险，做出了应急预案</li>\n<li>提出最终的结论（conclusion）：明确的用一句话表明观点和立场</li>\n<li>计划下一步工作（next step）:把汇报的东西落实转换在下一步的行动中</li>\n<li>寻求反馈（feedback）：如果需要老板、队友的支持和其他部门信息的输入，就要在总结的时候提出问题并获得反馈</li>\n</ul>\n<blockquote>\n<p>职场感悟：报上去的预算，用不同的颜色注明了哪些是固定价格改变不了的，哪些是我们自己的估值，而估值的依据和来源又是什么，同时还注明是保守估计还是乐观估计。这样老板即使把预算狠砍一刀也会有的放矢，关注估算值，以及数量级比较大的项目。</p>\n</blockquote>\n<h2 id=\"随手拈来的创意线索\"><a href=\"#随手拈来的创意线索\" class=\"headerlink\" title=\"随手拈来的创意线索\"></a>随手拈来的创意线索</h2><h3 id=\"魅力线索——被遗忘的法宝\"><a href=\"#魅力线索——被遗忘的法宝\" class=\"headerlink\" title=\"魅力线索——被遗忘的法宝\"></a>魅力线索——被遗忘的法宝</h3><p>有了线索的PPT可以让人过目不忘，例如北京奥运会开幕式上的那副巨大的画卷，作为主线贯穿了整个开幕式。通过形象的比喻来对比两种灵活性（芭比娃娃和弹力女超人），抉择的过程就像让父母决定购买哪种娃娃的过程。</p>\n<ul>\n<li>容易理解，且这种理解是大家默认的共识：特征非常突出，约定俗称。降低理解的难度而不是提高，增强趣味性。考虑听众的背景，如果需要超过1分钟介绍线索就说明选错了</li>\n<li>线索给PPT足够的拓展空间：就像一个比较大的舞台能够承载，这个线索可以承载整个PPT的内容。对于PPT主线的选择，也要考虑这个平台是否能够让内容结构更合理，表达更充分</li>\n<li>线索要能表现自己的特色：比如利用公司的主题色、logo以及logo的变形</li>\n</ul>\n<h3 id=\"线索就要这样挖\"><a href=\"#线索就要这样挖\" class=\"headerlink\" title=\"线索就要这样挖\"></a>线索就要这样挖</h3><h4 id=\"比喻法\"><a href=\"#比喻法\" class=\"headerlink\" title=\"比喻法\"></a>比喻法</h4><p>把你不懂的东西堪称一种你熟悉的东西，找到他们的共同点，帮你认识新的东西。例如 H.O.T（Healthy Oil Team）通过google法抓准题目，再基于这个点拓展开来，跟项目的内容关联组织PPT的表现形式<br>一些线索的例子：</p>\n<ul>\n<li>积木：用来强调基础和结构相互支撑、组合，可以用来说明项目中哪些是接触环节，哪些是在此基础上进一步开发的</li>\n<li>多米诺：强调连锁反映，在分析造成一个事故的原因时可以表示一系列的连锁反应</li>\n<li>拼图：强调部分和整体之间的关系。如果一个新产品由几个部分组成，比如包括产品、包装、价格、市场定位等部分</li>\n<li>F1：F1赛车手之所以能够驾驶赛车在赛道上驰骋，就是因为在他的身后有一个强有力的维修团队，表现团队合作</li>\n<li>蝴蝶：蝴蝶的蜕变是自然界最美丽的神话之一。一个新产品的升级上市、一个员工到资深经理的历程可以用这个来诠释</li>\n<li>三足鼎力：偌大美丽的铜鼎由3只坚实的足支撑，比如项目的三重约束时间、范围和资金</li>\n<li>千手观音：很好体现出所做的各项工作和自己的众多长处</li>\n<li>龙舟：强调步调一致和团队精神，也突出舵手的作用不能忽视，可以将团队如何服从命令听指挥、团结一致战胜竞争对手</li>\n</ul>\n<h4 id=\"吉祥物法\"><a href=\"#吉祥物法\" class=\"headerlink\" title=\"吉祥物法\"></a>吉祥物法</h4><p>经典的动画形象已经深入人心，减少了心智理解的难度。这些小动物一方面串起故事的一个线索，另一方面有一些内容也可以用可爱的宠物语气来表达。快乐和幽默是大家都不排斥的，听众痛恨的是没有内容绣花枕头式的PPT。只要有了充实的内容，活泼新颖的形式只会锦上添花。例如通过《冰河世纪》中的小松鼠表达爱业、敬业、永不放弃追求的精神。</p>\n<blockquote>\n<p>职场感悟：新人的建议逐步递进的三步是 1. 学习专业知识; 2. 分享信息; 3. 带领别人和你一起干。通过工作上的相互支持和信息的沟通，在需要帮助的时候得到有效的支持。</p>\n</blockquote>\n<h1 id=\"让你的模板与众不同\"><a href=\"#让你的模板与众不同\" class=\"headerlink\" title=\"让你的模板与众不同\"></a>让你的模板与众不同</h1><h2 id=\"模板里的小细节与大学问\"><a href=\"#模板里的小细节与大学问\" class=\"headerlink\" title=\"模板里的小细节与大学问\"></a>模板里的小细节与大学问</h2><h3 id=\"页面布局，功能来分类\"><a href=\"#页面布局，功能来分类\" class=\"headerlink\" title=\"页面布局，功能来分类\"></a>页面布局，功能来分类</h3><p>模板主要分为页面布局（标题、内容等文本框在一页中所占的位置），背景，细节（字体，字号，配色）。页面布局从功能上分为5种：首页（显示题目和作者）、概述页（全局观）、章节页（篇幅长的PPT中间加过渡，引导听众到下一部分的内容）、内容页（使用简单完整句表达明确观点和听众最关心的内容）和结束页（致谢）。</p>\n<h4 id=\"首页尽显个人修养\"><a href=\"#首页尽显个人修养\" class=\"headerlink\" title=\"首页尽显个人修养\"></a>首页尽显个人修养</h4><ul>\n<li>大标题抓住听众眼球：生动活泼</li>\n<li>副标题说明具体内容：清楚明确</li>\n<li>一系列人名彰显团队精神：工作是谁做的，PPT是谁写的，最后口头陈述是谁做的。署名时还需要区分承担项目责任的轻重，甚至具体到谁是项目经历，谁是核心成员，谁是辅助成员等等。</li>\n<li>及时修改日期和添加公司标志，表达对听众的尊重：修改成演讲的日期，添加公司的标志保护知识产权</li>\n<li>添加保密级别保护商业机密：保护只是产权，严守商业机密，添加必要的保密级别，把PPT转成Pdf不可修改，删去核心机密的关键信息，加签保密协议</li>\n</ul>\n<h3 id=\"结构变活，要靠概述页和章节过度页\"><a href=\"#结构变活，要靠概述页和章节过度页\" class=\"headerlink\" title=\"结构变活，要靠概述页和章节过度页\"></a>结构变活，要靠概述页和章节过度页</h3><ul>\n<li>目录页标题或章节页标题：用最简练的话概括内容，提示听众进入下一部分</li>\n<li>内容简介：用简单完整句吧整个PPT或者一章的各个分观点说清楚。</li>\n<li>进程指示标志：过渡的地方通过动画或者高亮体现当前进度（背景色，进度条，高亮概述中的章节标题，列车，step组件）</li>\n<li>时间分配：可选，在概要部分直接写出来</li>\n</ul>\n<h3 id=\"让内容页清晰完整\"><a href=\"#让内容页清晰完整\" class=\"headerlink\" title=\"让内容页清晰完整\"></a>让内容页清晰完整</h3><h4 id=\"章节标志和本页观点\"><a href=\"#章节标志和本页观点\" class=\"headerlink\" title=\"章节标志和本页观点\"></a>章节标志和本页观点</h4><ul>\n<li>缩小标题的字号：20-28的字号</li>\n<li>用图片代表主标题：在标题部分的右侧放背景剪影</li>\n</ul>\n<h4 id=\"核心内容\"><a href=\"#核心内容\" class=\"headerlink\" title=\"核心内容\"></a>核心内容</h4><ul>\n<li>观点一定要单一：每页只说一个观点，并且信息量适中</li>\n<li>各个要素一定要一致：1.字体、字号、颜色的一致; 2. 页边距一致; 3. 提示符一致; 4. 语言风格一致（可以使用CSS统一）</li>\n</ul>\n<h4 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h4><p>PPT的内容引用到别人观点或者工作一定要注明出处，表达对原作者的尊敬，同时也是有据可查</p>\n<h4 id=\"页码\"><a href=\"#页码\" class=\"headerlink\" title=\"页码\"></a>页码</h4><p>主要用于电话会议，说明白让大家看哪一页</p>\n<h3 id=\"结束页要表达一颗感恩的心\"><a href=\"#结束页要表达一颗感恩的心\" class=\"headerlink\" title=\"结束页要表达一颗感恩的心\"></a>结束页要表达一颗感恩的心</h3><ul>\n<li>感谢支持者</li>\n<li>感谢观众参与并引导观众提问</li>\n</ul>\n<h2 id=\"省心型模板简单不“撞衫”\"><a href=\"#省心型模板简单不“撞衫”\" class=\"headerlink\" title=\"省心型模板简单不“撞衫”\"></a>省心型模板简单不“撞衫”</h2><h3 id=\"给现成的模板做个整容小手术\"><a href=\"#给现成的模板做个整容小手术\" class=\"headerlink\" title=\"给现成的模板做个整容小手术\"></a>给现成的模板做个整容小手术</h3><p>技巧是为了内容服务的，调整布局的工作要先做。作为背景，主要有三大功能：分割页面布局、烘托内容主题和展现作者个性。</p>\n<ul>\n<li>调整头和身体的比例，把标题所占的地方缩小到整个版面的 1/7</li>\n<li>缩小标题的字号，用 24~32 字号</li>\n</ul>\n<h3 id=\"让模板有些新变化\"><a href=\"#让模板有些新变化\" class=\"headerlink\" title=\"让模板有些新变化\"></a>让模板有些新变化</h3><p>先解剖一下模板，看看由哪些元素组成，体会别人模板的设计思路，通过改变配色和字体个性化。跨界使用颠覆性模板制造轰动，例如使用 goodle（套用google的搜索页面和结果页面，调整内容变为自己的内容）</p>\n<h1 id=\"让你的-PPT-3分钟能看懂\"><a href=\"#让你的-PPT-3分钟能看懂\" class=\"headerlink\" title=\"让你的 PPT 3分钟能看懂\"></a>让你的 PPT 3分钟能看懂</h1><h2 id=\"清晰表达你的信息\"><a href=\"#清晰表达你的信息\" class=\"headerlink\" title=\"清晰表达你的信息\"></a>清晰表达你的信息</h2><h3 id=\"PPT清晰表达信息的三个层次\"><a href=\"#PPT清晰表达信息的三个层次\" class=\"headerlink\" title=\"PPT清晰表达信息的三个层次\"></a>PPT清晰表达信息的三个层次</h3><ul>\n<li>清晰可见</li>\n<li>容易理解</li>\n<li>体现个性</li>\n</ul>\n<h3 id=\"PPT清晰表达信息的三个原则\"><a href=\"#PPT清晰表达信息的三个原则\" class=\"headerlink\" title=\"PPT清晰表达信息的三个原则\"></a>PPT清晰表达信息的三个原则</h3><ul>\n<li>学会站在别人的鞋里想问题</li>\n<li>别学周杰伦含糊不清</li>\n<li>信息不能模棱两可</li>\n</ul>\n<h2 id=\"中规中矩使用字体字号\"><a href=\"#中规中矩使用字体字号\" class=\"headerlink\" title=\"中规中矩使用字体字号\"></a>中规中矩使用字体字号</h2><h3 id=\"不同字体对号入座\"><a href=\"#不同字体对号入座\" class=\"headerlink\" title=\"不同字体对号入座\"></a>不同字体对号入座</h3><p>使用笔画粗细一样的非艺术字，比如，雅黑、黑体、幼圆等</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:right\">正文</th>\n<th>标题</th>\n<th>装饰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:right\">微软雅黑</td>\n<td>魏碑</td>\n<td>琥珀</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">黑体</td>\n<td>行楷</td>\n<td>彩云</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">幼圆</td>\n<td>舒体</td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:right\">（宋体）</td>\n<td>隶书</td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:right\">（仿宋）</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:right\">（楷体）</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>英语则使用 Arial 和 Calibri</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:right\">正文</th>\n<th>标题</th>\n<th>装饰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:right\">Arial</td>\n<td>Forte</td>\n<td>Chiller</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">Calibri</td>\n<td>Cooper black</td>\n<td>Efackadder</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">Corbel</td>\n<td>Arial black</td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:right\">Time New Roman</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"字体的混搭要混而不杂\"><a href=\"#字体的混搭要混而不杂\" class=\"headerlink\" title=\"字体的混搭要混而不杂\"></a>字体的混搭要混而不杂</h3><p>把黑体和一般字体进行组合，个别地方可以使用手写体和打印体</p>\n<h3 id=\"字号的中庸原则\"><a href=\"#字号的中庸原则\" class=\"headerlink\" title=\"字号的中庸原则\"></a>字号的中庸原则</h3><p>同样类型内容使用同样大小的字号</p>\n<ul>\n<li>超大号：40</li>\n<li>中等：中文 20~30 英文 18~28</li>\n<li>太小: 14~16</li>\n</ul>\n<h3 id=\"线条粗细有讲究\"><a href=\"#线条粗细有讲究\" class=\"headerlink\" title=\"线条粗细有讲究\"></a>线条粗细有讲究</h3><p>推荐的线条粗细是 2.25p</p>\n<h2 id=\"和谐不张扬的颜色搭配\"><a href=\"#和谐不张扬的颜色搭配\" class=\"headerlink\" title=\"和谐不张扬的颜色搭配\"></a>和谐不张扬的颜色搭配</h2><h3 id=\"色彩的哆来咪\"><a href=\"#色彩的哆来咪\" class=\"headerlink\" title=\"色彩的哆来咪\"></a>色彩的哆来咪</h3><ul>\n<li>180度的互补很扎眼</li>\n<li>对比色关系：135度，适合文字和背景的色彩对比</li>\n<li>临近色关系：90度，能够给人一种明显的感情特性</li>\n<li>同类色关系：45度，用于底色来调整主题颜色</li>\n</ul>\n<h3 id=\"留心颜色的意义\"><a href=\"#留心颜色的意义\" class=\"headerlink\" title=\"留心颜色的意义\"></a>留心颜色的意义</h3><p>看看《色彩心理学》</p>\n<h1 id=\"玩转-PPT-的-5-种武器\"><a href=\"#玩转-PPT-的-5-种武器\" class=\"headerlink\" title=\"玩转 PPT 的 5 种武器\"></a>玩转 PPT 的 5 种武器</h1><p>一般而言，PPT需要表达的内容可以归纳为7个C:</p>\n<ul>\n<li>Conclusion（结论）</li>\n<li>Comments（意见）:Pros &amp; Cons 和 SWOT</li>\n<li>Count（数量）：填进表格或者做成图表</li>\n<li>Comparision（比较）：趋势图</li>\n<li>Course（过程）：step by step</li>\n<li>Creature（物品）：新产品的样子或者在系统中的位置</li>\n<li>Concept（概念）：抽象</li>\n</ul>\n<h2 id=\"与众不同的PPT文字风格\"><a href=\"#与众不同的PPT文字风格\" class=\"headerlink\" title=\"与众不同的PPT文字风格\"></a>与众不同的PPT文字风格</h2><h3 id=\"PPT行文就像课堂笔记\"><a href=\"#PPT行文就像课堂笔记\" class=\"headerlink\" title=\"PPT行文就像课堂笔记\"></a>PPT行文就像课堂笔记</h3><p>记录关键点，并且让关键点powerful</p>\n<h3 id=\"两个小窍门让文字更好用\"><a href=\"#两个小窍门让文字更好用\" class=\"headerlink\" title=\"两个小窍门让文字更好用\"></a>两个小窍门让文字更好用</h3><ol>\n<li>备注栏客服简短词的缺点</li>\n<li>突出关键字让完整句更好读</li>\n</ol>\n<h3 id=\"小心文字里的5宗罪\"><a href=\"#小心文字里的5宗罪\" class=\"headerlink\" title=\"小心文字里的5宗罪\"></a>小心文字里的5宗罪</h3><ul>\n<li>错别字</li>\n<li>语法错误</li>\n<li>缩写词</li>\n<li>画蛇添足</li>\n<li>复杂句型</li>\n</ul>\n<h2 id=\"横竖有理的表格表达\"><a href=\"#横竖有理的表格表达\" class=\"headerlink\" title=\"横竖有理的表格表达\"></a>横竖有理的表格表达</h2><h3 id=\"表格是PPT的天敌\"><a href=\"#表格是PPT的天敌\" class=\"headerlink\" title=\"表格是PPT的天敌\"></a>表格是PPT的天敌</h3><p>表格的优势在于对比，这两种情况适合：绝对数字是关键信息，简单明了的分类信息</p>\n<h3 id=\"别把Excel原样贴过来\"><a href=\"#别把Excel原样贴过来\" class=\"headerlink\" title=\"别把Excel原样贴过来\"></a>别把Excel原样贴过来</h3><h3 id=\"循规蹈矩地做表格\"><a href=\"#循规蹈矩地做表格\" class=\"headerlink\" title=\"循规蹈矩地做表格\"></a>循规蹈矩地做表格</h3><p>数量有单位，一行一列表达一种内容，表头没有编号，没有画线，单位缺失</p>\n<h3 id=\"表格不能过度图形化\"><a href=\"#表格不能过度图形化\" class=\"headerlink\" title=\"表格不能过度图形化\"></a>表格不能过度图形化</h3><h3 id=\"讲述表格的4步套路\"><a href=\"#讲述表格的4步套路\" class=\"headerlink\" title=\"讲述表格的4步套路\"></a>讲述表格的4步套路</h3><ul>\n<li>先说明表格的目的和名称：您现在看到的表X是一个关于XX的研究</li>\n<li>介绍表头和单位：表中的行表示XX，单位是XX，列表示XX，单位是XX</li>\n<li>介绍主要数字或内容：从表中我们可以看出XXX</li>\n<li>给出主要结论：所以，根据这些数据，我认为XXX</li>\n</ul>\n<h3 id=\"表格里的变形金刚\"><a href=\"#表格里的变形金刚\" class=\"headerlink\" title=\"表格里的变形金刚\"></a>表格里的变形金刚</h3><p>Office中的smart art，快速表达一些逻辑关系</p>\n<h2 id=\"一目了然的趋势图\"><a href=\"#一目了然的趋势图\" class=\"headerlink\" title=\"一目了然的趋势图\"></a>一目了然的趋势图</h2><h3 id=\"分清图中的”虚“和”实“\"><a href=\"#分清图中的”虚“和”实“\" class=\"headerlink\" title=\"分清图中的”虚“和”实“\"></a>分清图中的”虚“和”实“</h3><p>数据趋势只是表象，在关键节点自圆其说的解说让趋势图有意义</p>\n<h3 id=\"选对图的类型\"><a href=\"#选对图的类型\" class=\"headerlink\" title=\"选对图的类型\"></a>选对图的类型</h3><ul>\n<li>火力要集中：每张图只说一个问题</li>\n<li>别拽奇怪的火星图：专业不通用的图（三角图、雷达图、气泡图等）</li>\n<li>选对基本图</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:right\">图的种类</th>\n<th>表达内容</th>\n<th>应用举例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:right\">柱状图</td>\n<td>比较数值</td>\n<td>不同城市平均收入比较</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">饼状图</td>\n<td>关注份额</td>\n<td>市场份额</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">散点图</td>\n<td>独立测试数值</td>\n<td>科学测试（往往会添加拟合曲线）</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">曲线图</td>\n<td>趋势</td>\n<td>销售额</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"跟着国画学画图\"><a href=\"#跟着国画学画图\" class=\"headerlink\" title=\"跟着国画学画图\"></a>跟着国画学画图</h3><p>用简洁体现生动，用特征代表事物。中国画在构图里也强调留白和层次。注意落款和题诗。</p>\n<h3 id=\"关注细节\"><a href=\"#关注细节\" class=\"headerlink\" title=\"关注细节\"></a>关注细节</h3><ul>\n<li>调整字号、字体、标志符的大小</li>\n<li>调整线条粗细</li>\n<li>修改颜色</li>\n<li>考虑一致性原则</li>\n<li>调整横、纵坐标的范围，使图的主要内容位于图的核心区域</li>\n<li>适当运用一些形状来强调趋势图中的要点</li>\n</ul>\n<h3 id=\"讲述趋势图的6步\"><a href=\"#讲述趋势图的6步\" class=\"headerlink\" title=\"讲述趋势图的6步\"></a>讲述趋势图的6步</h3><ul>\n<li>介绍这个图的目的和名称：您接下来看到的这幅图是XXX</li>\n<li>介绍横、纵坐标及单位：它的横坐标是XXX，单位是XXX，纵坐标是XXX，单位是XXX</li>\n<li>介绍图例：在这幅图里，黑色的圆圈代表XXX，红色的方块代表XXX</li>\n<li>介绍趋势：我们可以看到，在过去的一年里，A的销售额的变化趋势是XXX，B的销售额的变化趋势是XXX</li>\n<li>强调要点：这些变化中，峰值出现在XXX，而谷底出现在XXX</li>\n<li>得出结论：据我们分析，这种变化趋势说明了XXX，那么我们下一步可以XXX</li>\n</ul>\n<h2 id=\"画龙必点睛的图片\"><a href=\"#画龙必点睛的图片\" class=\"headerlink\" title=\"画龙必点睛的图片\"></a>画龙必点睛的图片</h2><h3 id=\"一图值千言\"><a href=\"#一图值千言\" class=\"headerlink\" title=\"一图值千言\"></a>一图值千言</h3><p>能用图片的地方就不用文字。</p>\n<h3 id=\"图片分类有讲究\"><a href=\"#图片分类有讲究\" class=\"headerlink\" title=\"图片分类有讲究\"></a>图片分类有讲究</h3><ul>\n<li>人像：表达对于伟人的尊重和怀念</li>\n<li>漫画：对事物的变形和夸张，能够突出事物的特点，提高听众的兴趣、调节气氛</li>\n<li>剪贴画：矢量图</li>\n<li>摄影图片：要用自己独特的视角来表达更深刻的意义</li>\n<li>相片：非专业人士拍摄，例如团队合照，或者生活剪影</li>\n<li>壁纸、贺卡：模板的背景，主题突出，色彩亮丽</li>\n<li>期刊封面：热点问题的权威</li>\n<li>平面广告、电影海报：表达一些特别的感觉</li>\n</ul>\n<h3 id=\"图片是信息的好助手\"><a href=\"#图片是信息的好助手\" class=\"headerlink\" title=\"图片是信息的好助手\"></a>图片是信息的好助手</h3><ul>\n<li>可以形象化的东西不单是东西还可以是某种感情：幸福来敲门海报</li>\n<li>配上图不是说全部图片化：每页都还是有完整简单句</li>\n<li>点题和美观：图片的作用是烘托，要强调意境</li>\n<li>提高听众的兴趣：最好是冷幽默，点到为止，强调简单明确和趣味性强</li>\n<li>说明一些高深的问题和概念：解释抽象的技术概念</li>\n<li>解释结论：在最终一句话结论之前的铺垫</li>\n</ul>\n<h3 id=\"让图片各就各位\"><a href=\"#让图片各就各位\" class=\"headerlink\" title=\"让图片各就各位\"></a>让图片各就各位</h3><ul>\n<li>图片要有的放矢</li>\n<li>图片要大小合适</li>\n<li>图片位置因作用而异</li>\n</ul>\n<h2 id=\"存在必精彩的动画\"><a href=\"#存在必精彩的动画\" class=\"headerlink\" title=\"存在必精彩的动画\"></a>存在必精彩的动画</h2><h3 id=\"爱恨动画功能多\"><a href=\"#爱恨动画功能多\" class=\"headerlink\" title=\"爱恨动画功能多\"></a>爱恨动画功能多</h3><ul>\n<li>强调要点</li>\n<li>展示过程</li>\n</ul>\n<h3 id=\"使用动画有讲究\"><a href=\"#使用动画有讲究\" class=\"headerlink\" title=\"使用动画有讲究\"></a>使用动画有讲究</h3><ul>\n<li>选择合适的动画类型：出现、消失和移动</li>\n<li>选择如何排列</li>\n</ul>\n<p><strong>Tip:</strong> 什么时候用翻页，章节之间的过渡，插入说明或故事</p>\n<h1 id=\"大胆-show-出-PPT\"><a href=\"#大胆-show-出-PPT\" class=\"headerlink\" title=\"大胆 show 出 PPT\"></a>大胆 show 出 PPT</h1><h2 id=\"良好的开场白是成功演讲的一半\"><a href=\"#良好的开场白是成功演讲的一半\" class=\"headerlink\" title=\"良好的开场白是成功演讲的一半\"></a>良好的开场白是成功演讲的一半</h2><h3 id=\"小变化让开场白更精彩\"><a href=\"#小变化让开场白更精彩\" class=\"headerlink\" title=\"小变化让开场白更精彩\"></a>小变化让开场白更精彩</h3><p>先卖个关子，介绍题目，然后再自我介绍</p>\n<h3 id=\"开场白有诀窍\"><a href=\"#开场白有诀窍\" class=\"headerlink\" title=\"开场白有诀窍\"></a>开场白有诀窍</h3><ul>\n<li>提问下套法：用问题引发大家的思考，然后引出主题</li>\n<li>挖坑灌水法：开场的时用一定的方法让观众摸不着头脑</li>\n<li>套近乎法：拉近跟听众的距离感</li>\n<li>双关法：参考标题的方法</li>\n<li>笑话法：多听一些相声</li>\n<li>感谢法：真诚表达感激，打心眼里说出来</li>\n</ul>\n<h2 id=\"虎头更虎尾的完美结束\"><a href=\"#虎头更虎尾的完美结束\" class=\"headerlink\" title=\"虎头更虎尾的完美结束\"></a>虎头更虎尾的完美结束</h2><h3 id=\"拥抱各种问题\"><a href=\"#拥抱各种问题\" class=\"headerlink\" title=\"拥抱各种问题\"></a>拥抱各种问题</h3><ul>\n<li>压住问题的技巧：不给观众提问题的时间（说因为时间关系blabla）</li>\n<li>拖延时间的技巧：先那话垫上，给自己思考的时间（先说 Good question）</li>\n<li>咨询研究法：就是跟人家说不知道，后面回复</li>\n</ul>\n<h3 id=\"回答问题别玩外交辞令\"><a href=\"#回答问题别玩外交辞令\" class=\"headerlink\" title=\"回答问题别玩外交辞令\"></a>回答问题别玩外交辞令</h3><p>要么不答，要答就正面回答，严谨对待</p>\n<blockquote>\n<p>职场感悟：做正确的事，正确地做事，立即做。应该把精力更多凡在回答我们不能回答的问题上，而不是花时间研究低级的生存技巧。</p>\n</blockquote>\n<h2 id=\"让紧张情绪见鬼去吧\"><a href=\"#让紧张情绪见鬼去吧\" class=\"headerlink\" title=\"让紧张情绪见鬼去吧\"></a>让紧张情绪见鬼去吧</h2><h3 id=\"消除紧张不能单靠小窍门\"><a href=\"#消除紧张不能单靠小窍门\" class=\"headerlink\" title=\"消除紧张不能单靠小窍门\"></a>消除紧张不能单靠小窍门</h3><p>紧张是外场和内心共鸣后的放大。如果外部紧张，但你自己心静如水，也不会紧张。如果改变不了外部环境，就要把心放大，让它去包容。突破自己的心理舒适区，拓展自己的边界。</p>\n<h3 id=\"最好的办法是适应舞台\"><a href=\"#最好的办法是适应舞台\" class=\"headerlink\" title=\"最好的办法是适应舞台\"></a>最好的办法是适应舞台</h3><p>如果有机会，在正式开始前站在讲台上，好好感受那个气场。</p>\n","categories":[],"tags":["blog","reading","softskill"]},{"title":"h5页面动效开发案例","url":"https://vincenthou.github.io/2017/09/07/h5页面动效开发案例/","content":"<h1 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h1><ul>\n<li><a href=\"https://isux.tencent.com/html5-animation-performance-analysis.html\" target=\"_blank\" rel=\"noopener\">打造H5动感影集的爱恨情仇(动画性能篇)</a></li>\n</ul>\n","categories":[],"tags":["frontend","collection","todo"]},{"title":"《编写可维护的JavaScript》重读","url":"https://vincenthou.github.io/2017/09/06/《编写可维护的JavaScript》重读/","content":"<p>原书豆瓣地址: <a href=\"https://book.douban.com/subject/21792530/\" target=\"_blank\" rel=\"noopener\">https://book.douban.com/subject/21792530/</a></p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/30109878-97c0dd7c-933a-11e7-80b3-58fd485e989e.png\" alt=\"image\"></p>\n<p>根据原书目录结构组织，带有自己的理解和解读。</p>\n<h1 id=\"编程风格\"><a href=\"#编程风格\" class=\"headerlink\" title=\"编程风格\"></a>编程风格</h1><p>这部分内容适用于所有的变成语言，推荐一本<a href=\"https://book.douban.com/subject/5442024/\" target=\"_blank\" rel=\"noopener\">代码的整洁之道</a>，虽然内容是面向Java的，但是里面的代码书写思想是具有普遍实用性的。本书主要是对于一些定义规范或者作者总结最佳实践的解释，说明意义和价值，最后展示了一整套工具链，将对于规范的检查整合到开发流程当中。<br>本书的作者也是著名<a href=\"https://book.douban.com/subject/10546125/\" target=\"_blank\" rel=\"noopener\">红包书</a>的作者<a href=\"https://github.com/nzakas\" target=\"_blank\" rel=\"noopener\">Nicholas C. Zakas</a>，本书的思想和实践最后汇聚成了著名的开源工具<a href=\"https://github.com/eslint/eslint\" target=\"_blank\" rel=\"noopener\">ESLint</a>。</p>\n<h2 id=\"基本的格式化\"><a href=\"#基本的格式化\" class=\"headerlink\" title=\"基本的格式化\"></a>基本的格式化</h2><p>主要集中在代码的排版，命名，和变量声明方式上。有意思的点在于 <code>null 和 undefined的区别</code>。<code>undefined</code> 变量未定义或者没有初始化（可能是任意类型），而 <code>null</code>显示指定了当前变量是一个object只是值为null</p>\n<h2 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h2><p>主要是单行注释和多行注释的写法，还有就是什么时候应该有注释，毕竟我们的目标是代码自解释。有关于注释的标准写法，主要可以参考<a href=\"https://github.com/jsdoc3/jsdoc\" target=\"_blank\" rel=\"noopener\">JSDoc</a>的写法，特别是在写给第三方使用的SDK时，通过使用这种标准的注释写法可以自动生成SDK的文档。这些注释就变成了接口的元信息，个人感觉这也是注解（在JS中叫decorator）的想法来源。</p>\n<p>作者认为在以下三种情况下需要使用注释:</p>\n<ol>\n<li>难以理解的代码</li>\n<li>可能被误认为错误的代码</li>\n<li>特殊的hack</li>\n</ol>\n<p>整理起来其实就是容易让人产生 <strong>二义性</strong> 而导致错误的地方就需要加注释。</p>\n<h2 id=\"语句和表达式\"><a href=\"#语句和表达式\" class=\"headerlink\" title=\"语句和表达式\"></a>语句和表达式</h2><p>主要是所有语言都有的，还是JS特有的语句块排版方式定义。作者描述了针对特定语句块或者表达式的多种排版方式，也给出了自己的倾向。其实这种事情，没有绝对正确，但是所有人应该保持统一（这个就要工具来实现了）。</p>\n<h2 id=\"变量、函数和运算符\"><a href=\"#变量、函数和运算符\" class=\"headerlink\" title=\"变量、函数和运算符\"></a>变量、函数和运算符</h2><p>主要说明了变量、函数的声明方式，JS中的相等判断大坑。这里面比较有意思的地方在于提到了 <strong>严格模式</strong>。</p>\n<p>严格模式是在 <strong>ES5</strong> 中引入的，目的在于通过这种方式告诉解析引擎谨慎解析和执行JS，以减少错误．”ｕse strict”可以用于全局和局部，一个好的方式是通过IIFE包裹严格模式指令．</p>\n<h1 id=\"编程实践\"><a href=\"#编程实践\" class=\"headerlink\" title=\"编程实践\"></a>编程实践</h1><h2 id=\"UI层的松耦合\"><a href=\"#UI层的松耦合\" class=\"headerlink\" title=\"UI层的松耦合\"></a>UI层的松耦合</h2><p>前端的代码一直有这样的职能划分：HTML负责页面或者组件的骨架，CSS 负责页面或者组件的表现，JS 负责页面或者组件的行为．我们也一直是这样践行着这一信条的，直到<a href=\"https://github.com/facebook/react\" target=\"_blank\" rel=\"noopener\">React</a>的出现．我觉得这种原教旨主义的打破也体现了优雅性向实用性的妥协，这是另一个话题，我们单从我们的宗教信仰来说．</p>\n<p>所谓松耦合，其实就是在我们需要做出改动或者调整的时候，影响面能够足够小，最好的情况就是改动只会影响到需要被改变的部分，也是最少知识原则的体现．作者提到了一些范式，整理如下:</p>\n<ol>\n<li>将 JS 从 CSS 中抽离：禁止 CSS 表达式（这个的确很神奇，至今也没有用过），例如 <code>expression(document.body.offsetWidth + &#39;px&#39;)</code></li>\n<li>将 CSS 从 JS 中抽离：不要直接通过style来操作元素的样式，而是通过样式切换，使用 <code>className += &#39;  foo&#39;</code>，或者 <code>classList.add(&#39;foo&#39;)</code>，还有其他DOM库提供的 <code>addClass</code> 方法</li>\n<li>将 JS 从 HTML 中抽离：不要直接在HTML里面使用onxxx，而是在 JS 文件中通过API选择 DOM 元素，在元素上通过 <code>addEventListener</code> 来绑定事件，这里作者主要是从作为外部文件，onxx 的回调方法可能还没有加载过来</li>\n<li>将 HTML 从 JS 中抽离：不要在 JS 中直接通过字符串拼接来生成模板然后再用 innerHTML 设置进去（之前就这么干过…），通过异步加载再通过 innerHTML 设置或者通过客户端模板来实现，例如<a href=\"https://github.com/wycats/handlebars.js/\" target=\"_blank\" rel=\"noopener\">handlebars</a>, <a href=\"https://github.com/janl/mustache.js\" target=\"_blank\" rel=\"noopener\">mustache</a>, <a href=\"https://github.com/lhywork/artTemplate\" target=\"_blank\" rel=\"noopener\">artTemplate</a></li>\n</ol>\n<h2 id=\"避免使用全局变量\"><a href=\"#避免使用全局变量\" class=\"headerlink\" title=\"避免使用全局变量\"></a>避免使用全局变量</h2><p>全局变量最大的问题就是带来了应用状态的不确定性，这个点在于程序逻辑任何的部分都可以任意修改全局的变量，互相的依赖关系就会造成程序运行状态的混乱．所以可以通过单全局变量或者零全局变量．React+Redux 在于虽然共享了同一个store，但是是通过每个reducer产生新的子状态，再通过reduce将子状态合并更新．</p>\n<ul>\n<li>单全局变量：使用命名空间，或者AMD（曾经也有过CMD，现在是CommonJS或者ESM）</li>\n<li>零全局变量：使用IIFE包裹实现隔离（在ES6有了let和const，也不再只有函数级作用域，跟标准的块级作用域接上了轨）</li>\n</ul>\n<h2 id=\"事件处理\"><a href=\"#事件处理\" class=\"headerlink\" title=\"事件处理\"></a>事件处理</h2><p>这里作者主要想说应该将应用逻辑和事件处理逻辑拆分开，这点在现在vue, react, angular盛行的时代也是有价值的．其实就是业务逻辑只处理数据，而事件处理这种依赖于环境的东西（event是什么结果，有哪些属性啊这种问题）是要拆分开的．在业务层只关心业务数据，而不需要把环境依赖的参数层层传递（例如event）</p>\n<h2 id=\"避免空比较\"><a href=\"#避免空比较\" class=\"headerlink\" title=\"避免空比较\"></a>避免空比较</h2><p>其实这个坑在于 JS 的弱类型特性，针对不同的类型有不同的判断方式：</p>\n<ul>\n<li>对于原始值类型，你做比较的时候首先需要明确被判断的变量类型（通过 typeof）,这个判断是显著有效的（字符串，数字，布尔值还有undefined）</li>\n<li>对于引用类型的变量就需要借助 instanceof 运算符了</li>\n<li>针对内置的类（Object, Array, Function, Error, Date, RegExp）直接运算构造器字面量，这个运算符对于通过原型链继承的子类判断也是有效的（每个对象 instanceof Ojbect都是true）</li>\n<li>对于数组的检测，可以根据实例上的sort方式是否是一个function判断，更保险的是通过toString方法跟 “[object Array]”判等，现在ES5的支持度可以放心使用 <code>Array.isArray</code> 方法（哪怕是老的浏览器，也推荐先特性检测一下，再用老方法）</li>\n<li>对于对象的属性判断，最好的方法是是哟个 <code>in</code> 运算符，除了本身实例上的属性，这个运算符还会判断继承自对象原型的属性，针对实例本身属性的判断就使用 <code>hasOwnProperty</code> 方法</li>\n</ul>\n<h2 id=\"将配置数据从代码中分离出来\"><a href=\"#将配置数据从代码中分离出来\" class=\"headerlink\" title=\"将配置数据从代码中分离出来\"></a>将配置数据从代码中分离出来</h2><p>配置信息就是全局引用的常量值，通过分离保存为独立文件可以统一维护（single source of data），配置的信息不一定要以程序直接可以使用的形式存储（例如 JS 对象或者 JSON 数据），可以通过构建工具来转换．例如使用<a href=\"https://github.com/nzakas/props2js\" target=\"_blank\" rel=\"noopener\">props2js</a></p>\n<h2 id=\"抛出自定义错误\"><a href=\"#抛出自定义错误\" class=\"headerlink\" title=\"抛出自定义错误\"></a>抛出自定义错误</h2><p>应用程序中存在一定的约束规则，在运行中当出现了偏离这些约束规则时就会导致错误．除了内置的错误类型（Error, EvalError, RangeError, ReferenceError, SyntaxError, TypeError, URIError），可以通过原型继承的方式扩展 Error 类，通过 instanceof 运算符判断 catch 到的 Error 类型</p>\n<h2 id=\"不是你的对象不要动\"><a href=\"#不是你的对象不要动\" class=\"headerlink\" title=\"不是你的对象不要动\"></a>不是你的对象不要动</h2><p>由于 JS 在运行环境中没有对内置类型或者已存在的 JS 对象做任何默认的 readonly 的限制，例如：</p>\n<ul>\n<li>原生对象（Object、Array等等）</li>\n<li>DOM对象（例如 document）</li>\n<li>浏览器对象模型（BOM）对象（例如 window）</li>\n<li>类库的对象</li>\n</ul>\n<p>针对这些对象，遵循下面的原则：</p>\n<ul>\n<li>不覆盖方法</li>\n<li>不新增方法（Prototype的反例）</li>\n<li>不删除方法</li>\n</ul>\n<p>更好的扩展方式：</p>\n<ul>\n<li>基于对象的继承（使用Object.create(obj. {prop: value}) 实现extend的效果，不过这个是浅拷贝）</li>\n<li>基于类型的继承（通过构造函数实现而不是对象，所以需要访问被继承对象的构造函数）</li>\n<li>门面模式（例如jQuery）</li>\n</ul>\n<p>通过使用 polyfill 可以在当下使用未来标准定义但是浏览器尚未实现的功能。为了弥补对于对象修改没有默认限制的特性，ES5中引入了一个方法防止对于对象的修改，每个级别都存在两种方法，一个方法用来实施操作，一个方式用来检测操作是否应用。</p>\n<ul>\n<li>防止扩展：禁止为对象添加属性和方法，但是已存在的属性和方法是可以被修改或者删除的，<code>Object.preventExtension</code>，<code>Object.isExtensible</code></li>\n<li>密封：类似“防止扩展”，同时禁止了对对象中已存在的属性和方法的删除，<code>Object.seal</code>，<code>Object.isSealed</code></li>\n<li>冻结：类似“密封”，同时禁止了对对象中已存在的属性和方法的修改（所有字段均只读），<code>Object.freeze</code>，<code>Object.isFrozen</code></li>\n</ul>\n<h2 id=\"浏览器嗅探\"><a href=\"#浏览器嗅探\" class=\"headerlink\" title=\"浏览器嗅探\"></a>浏览器嗅探</h2><p>浏览器的兼容性永远是个绕不开的大坑，针对不同的浏览器，我们需要在代码中检测运行环境对于标准定义API的支持情况就需要一些运行环境的检测手段，主要有两个：</p>\n<ul>\n<li>UA检测：可以使用<a href=\"https://github.com/fex-team/userAgent\" target=\"_blank\" rel=\"noopener\">userAgent</a></li>\n<li>特性检测：可以使用<a href=\"https://github.com/Modernizr/Modernizr\" target=\"_blank\" rel=\"noopener\">Modernizr</a></li>\n</ul>\n<p>有时候为了方便，我们很容易会去利用特性推断（运行环境支持A接口，就一定会支持B接口）和浏览器推断（运行环境支持某个接口就认为当前是在某种浏览器中）</p>\n<h1 id=\"自动化\"><a href=\"#自动化\" class=\"headerlink\" title=\"自动化\"></a>自动化</h1><p>作者列举了一些利弊，但是现在看来那些弊端已经不存在了，前端自动化作为工程化的一部分，基本已经变成了标配。</p>\n<h2 id=\"文件和目录接口\"><a href=\"#文件和目录接口\" class=\"headerlink\" title=\"文件和目录接口\"></a>文件和目录接口</h2><p>作者总结了一些最佳实践的原则</p>\n<ul>\n<li>一个文件只包含一个对象：单一责任，让修改的粒度足够小</li>\n<li>相关文件用目录分组：基于模块来划分（一个模块中可以同时包含模板，样式和行为）</li>\n<li>保证第三方代码的独立：例如独立放在一个<code>vendor</code>或者<code>lib</code>目录，现在有了npm的包管理机制都是放在<code>node_modules</code>中（曾经前端项目也有bower_components的阶段）</li>\n<li>确定build文件目录：这个目录一般是<code>.gitkeep</code>或者是直接不提交上去的（使用.gitignore忽略）</li>\n<li>保持测试代码的完整性：保留一个<code>test</code>目录存放测试用例代码（包含单元测试，E2E测试）</li>\n</ul>\n<p>作者i列举了几个知名项目的项目结构（现在也大大不一样了），包括<a href=\"https://github.com/jquery/jquery\" target=\"_blank\" rel=\"noopener\">jquery</a>，<a href=\"https://github.com/dojo/dojo\" target=\"_blank\" rel=\"noopener\">dojo</a>，<a href=\"https://github.com/yui/yui3\" target=\"_blank\" rel=\"noopener\">yui3</a>。下面是我总结的一个前端项目的目录结构</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── build\t\t\t\t\t//构建工具（grunt, gulp, webpack脚本）</span><br><span class=\"line\">├── ci\t\t\t\t\t\t//CI执行用到的脚本</span><br><span class=\"line\">│   └── lint.sh</span><br><span class=\"line\">├── config\t\t\t\t\t//应用运行时的全局配置文件（如果里面分模块，也会存在模块内的配置）</span><br><span class=\"line\">├── dist\t\t\t\t\t//通过构建工具生成的静态部署文件</span><br><span class=\"line\">├── doc\t\t\t\t\t//代码，开发规范，组件文档定义，说明性文档（测试，构建过程，开发流程，API文档），作为SDK的JSDoc文档</span><br><span class=\"line\">├── docker\t\t\t\t\t//作为docker实例部署时候的nginx配置和dockerfile定义</span><br><span class=\"line\">│   └── nginx</span><br><span class=\"line\">│       ├── conf</span><br><span class=\"line\">│       │   └── site.conf</span><br><span class=\"line\">│       ├── Dockerfile</span><br><span class=\"line\">│       └── start.sh</span><br><span class=\"line\">├── node_modules\t\t\t//第三方依赖管理（也可以手工维护vendor，现代化项目都是用npm管理）</span><br><span class=\"line\">├── package.json\t\t\t//包含项目元信息，包管理信息，脚本信息（npm scripts）</span><br><span class=\"line\">├── README.md\t\t\t//项目介绍文档，包含sceencast，在线演示地址，本地运行步骤，技术栈说明</span><br><span class=\"line\">├── src\t\t\t\t\t\t//程序源代码目录（几乎所有的主要项目代码）</span><br><span class=\"line\">│   ├── component\t\t\t//自定义组件库</span><br><span class=\"line\">│   ├── index.html\t\t\t//入口页</span><br><span class=\"line\">│   ├── main.js\t\t\t\t//入口脚本</span><br><span class=\"line\">│   ├── module\t\t\t\t//基于模块划分的结构</span><br><span class=\"line\">│   │   └── account</span><br><span class=\"line\">│   ├── page\t\t\t\t//第一层级页面</span><br><span class=\"line\">│   │   └── home\t\t\t//某个页面（包含模版，样式和行为）</span><br><span class=\"line\">│   │       ├── home.css</span><br><span class=\"line\">│   │       ├── home.html</span><br><span class=\"line\">│   │       └── home.js</span><br><span class=\"line\">│   ├── router.js\t\t\t//前端路由定义</span><br><span class=\"line\">│   ├── store\t\t\t\t//前端状态管理（可选，react一般是redux，vue一般是vuex）</span><br><span class=\"line\">│   │   ├── action.js</span><br><span class=\"line\">│   │   ├── index.js</span><br><span class=\"line\">│   │   └── reducer.js</span><br><span class=\"line\">│   └── util\t\t\t\t\t//自定义可复用工具库</span><br><span class=\"line\">├── static\t\t\t\t\t//静态资源文件（数据，图片，字体）</span><br><span class=\"line\">│   ├── data</span><br><span class=\"line\">│   ├── font</span><br><span class=\"line\">│   └── image</span><br><span class=\"line\">└── test\t\t\t\t\t//测试相关（单元测试，E2E测试）</span><br></pre></td></tr></table></figure>\n<h2 id=\"Ant\"><a href=\"#Ant\" class=\"headerlink\" title=\"Ant\"></a>Ant</h2><p>我自己最开始接触前端构建的时候也是用的这个，因为有Java开发的经验，当时还没有现在那么多概念，就是觉得像压缩打包这种事情正好可以通过这个任务管理器完成就用起来了。随着 nodejs 的发展，前端有了自己的武器，跟 Ant 对标的就是 grunt, gulp（不是webpack，因为他是个bundler，而<a href=\"https://github.com/fex-team/fis3\" target=\"_blank\" rel=\"noopener\">fis3</a>是前端工程解决方案）这样的task runner。</p>\n<h2 id=\"校验\"><a href=\"#校验\" class=\"headerlink\" title=\"校验\"></a>校验</h2><p>原书主要是 Ant 中如何配置使用 JSHint，现在可以换成在 webpack 里面用 ESLint 了</p>\n<h2 id=\"文件合并和加工\"><a href=\"#文件合并和加工\" class=\"headerlink\" title=\"文件合并和加工\"></a>文件合并和加工</h2><p>grunt 和 gulp 有很多这样的 task，当然也可以直接使用 npm scripts。</p>\n<h2 id=\"文件精简和压缩\"><a href=\"#文件精简和压缩\" class=\"headerlink\" title=\"文件精简和压缩\"></a>文件精简和压缩</h2><p>原文介绍了 <a href=\"https://github.com/yui/yuicompressor\" target=\"_blank\" rel=\"noopener\">YUI Compressor</a>，<a href=\"https://developers.google.com/closure/compiler/\" target=\"_blank\" rel=\"noopener\">Closure Complier</a>以及 <a href=\"https://github.com/mishoo/UglifyJS\" target=\"_blank\" rel=\"noopener\">UglifyJS</a>这些代码 <strong>精简工具</strong>，现在主要就是用最后一个了。对于代码的压缩主要使用 gzip 压缩，而 gzip 压缩分为构建时压缩和运行时压缩。构建时压缩用<a href=\"https://github.com/beatgammit/gzip-js\" target=\"_blank\" rel=\"noopener\">gzip-js</a>或者gup task: <a href=\"https://github.com/jstuckey/gulp-gzip\" target=\"_blank\" rel=\"noopener\">gulp-gzip</a>。运行时压缩在web容器（nginx, apache）中配置HTTP的响应 <code>Content-Encoding: gzip</code>（首先客户端 request 要包含 <code>Accept-Encoding: gzip, deflate</code>）</p>\n<h2 id=\"文档化\"><a href=\"#文档化\" class=\"headerlink\" title=\"文档化\"></a>文档化</h2><p>现在主流就是使用<a href=\"https://github.com/jsdoc3/jsdoc\" target=\"_blank\" rel=\"noopener\">JSDoc</a>，原书作者也介绍了雅虎的<a href=\"https://github.com/yui/yuidoc\" target=\"_blank\" rel=\"noopener\">YUI Doc</a>（话说作者作为雅虎的架构师，本书很多工具都是YUI体系的）</p>\n<h2 id=\"自动化测试\"><a href=\"#自动化测试\" class=\"headerlink\" title=\"自动化测试\"></a>自动化测试</h2><p>原书作者提到的YUI Test Selenium，<a href=\"https://github.com/yui/yeti\" target=\"_blank\" rel=\"noopener\">Yeti</a>，JsTestDriver都已经很久未更了，<a href=\"https://github.com/ariya/phantomjs\" target=\"_blank\" rel=\"noopener\">PhantomJS</a>也因为 Chrome Headless 的官方支持也停止维护了，现在可以玩这个<a href=\"https://github.com/GoogleChrome/puppeteer\" target=\"_blank\" rel=\"noopener\">puppeteer</a>。</p>\n<h2 id=\"组装到一起\"><a href=\"#组装到一起\" class=\"headerlink\" title=\"组装到一起\"></a>组装到一起</h2><p>这里主要是在说整个代码的上线流程通过 Ant 自动化，包含了开发，集成和部署，通过CI工具的整合，现在这个流程的集成变得更加轻松自然。代码在本地开发完成之后push到远端，经过一系列的CI任务（一般是Jenkins，开源领域有<a href=\"https://www.travis-ci.org/\" target=\"_blank\" rel=\"noopener\">TravisCI</a>和<a href=\"https://circleci.com/\" target=\"_blank\" rel=\"noopener\">CircleCI</a>）之后生成一个构建的版本，这个构建可以是周期性的（集成版本），也可以是按需的（发布版本）。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>随着nodejs的兴起，很多的前端工具如雨后春笋般涌现出来，之前依赖于其他语言或者平台的工具用 JS 又重写了一遍，很多之前无法实现的需求随着技术的演进也逐渐变成了可能，但是本书仍然有很多借鉴意义，作为一本经典书籍，书中不仅介绍了可维护的代码应该怎么写，其实也蕴含了一些早期的前端工程化思想，文中的一些概念仍然有现实指导意义。<br>提炼一下，好的 JS 代码遵循下面几个原则</p>\n<ul>\n<li>可预见性(Predictability)</li>\n<li>隔离性(Isolation)</li>\n<li>松耦合性(Loose Coupling)</li>\n</ul>\n<p>这些原则也是可以通过lint工具进一步约束，这也就产生了大名鼎鼎的<a href=\"https://github.com/eslint/eslint\" target=\"_blank\" rel=\"noopener\">ESLint</a></p>\n","categories":[],"tags":["blog","javascript","reading"]},{"title":"对AMP的理解和实践","url":"https://vincenthou.github.io/2017/09/06/对AMP的理解和实践/","content":"<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&amp;mid=2247486302&amp;idx=1&amp;sn=b033170be33a991c09f84501a0dd6269&amp;chksm=ea0d41a4dd7ac8b26c0374c87882927392497a96695757298b811edfef7e4a1503fb57821b45&amp;mpshare=1&amp;scene=1&amp;srcid=0909A2Kc9XhWyDlOlpMaTLN4&amp;pass_ticket=IPgFTUN5MeHk4fwJDraqFucXrVzUmzx1RswI9OSUxdd2vojT%2BgPORRCa2cgEpcjZ#rd\" target=\"_blank\" rel=\"noopener\">AMP 初探</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzIwNjQwMzUwMQ==&amp;mid=2247485407&amp;idx=1&amp;sn=996798261b02d77426da3905bd2172a2&amp;chksm=9723651da054ec0b7bccef384c3dce0be7bebfc1115cade7d819b03924d54f6fc32bcd7d42aa&amp;mpshare=1&amp;scene=1&amp;srcid=0906NBZSJSvXUjYZggxpj2wY&amp;pass_ticket=16oGqoMkM%2BD6nV3li%2BJxe8x20FlODiBx5b2XPSykwOImQg4e8z%2BqS0VWbf%2F%2FpgYg#rd\" target=\"_blank\" rel=\"noopener\">澄清对AMP的十个误解</a></li>\n<li><a href=\"https://github.com/ampproject/amphtml\" target=\"_blank\" rel=\"noopener\">amphtml项目</a></li>\n<li><a href=\"https://www.ampproject.org/zh_cn/\" target=\"_blank\" rel=\"noopener\">AMP官网</a></li>\n</ul>\n","categories":[],"tags":["frontend","todo","pefermance"]},{"title":"Python学习指南","url":"https://vincenthou.github.io/2017/09/04/Python学习指南/","content":"<h1 id=\"入门\"><a href=\"#入门\" class=\"headerlink\" title=\"入门\"></a>入门</h1><ul>\n<li><a href=\"https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000\" target=\"_blank\" rel=\"noopener\">廖雪峰python教程</a></li>\n</ul>\n<h1 id=\"进阶\"><a href=\"#进阶\" class=\"headerlink\" title=\"进阶\"></a>进阶</h1><ul>\n<li><a href=\"http://ialloc.org/posts/2017/09/03/fluentpython-notes/\" target=\"_blank\" rel=\"noopener\">&lt;流畅的 Python&gt; 摘录</a></li>\n</ul>\n","categories":[],"tags":["todo","backend","python"]},{"title":"Node学习指南","url":"https://vincenthou.github.io/2017/09/01/Node学习指南/","content":"<h1 id=\"基础入门\"><a href=\"#基础入门\" class=\"headerlink\" title=\"基础入门\"></a>基础入门</h1><h2 id=\"教程\"><a href=\"#教程\" class=\"headerlink\" title=\"教程\"></a>教程</h2><ul>\n<li><strong>七天学会NodeJS:</strong> <a href=\"http://nqdeng.github.io/7-days-nodejs\" target=\"_blank\" rel=\"noopener\">http://nqdeng.github.io/7-days-nodejs</a></li>\n<li><strong>Node.js 包教不包会:</strong> <a href=\"https://github.com/alsotang/node-lessons\" target=\"_blank\" rel=\"noopener\">https://github.com/alsotang/node-lessons</a></li>\n<li><strong>ECMAScript 6入门:</strong> <a href=\"http://es6.ruanyifeng.com/\" target=\"_blank\" rel=\"noopener\">http://es6.ruanyifeng.com/</a></li>\n<li><strong>Practical Node.js:</strong> <a href=\"https://github.com/azat-co/practicalnode\" target=\"_blank\" rel=\"noopener\">https://github.com/azat-co/practicalnode</a></li>\n<li><strong>Node的哲学:</strong> <a href=\"https://github.com/maxogden/art-of-node\" target=\"_blank\" rel=\"noopener\">https://github.com/maxogden/art-of-node</a></li>\n</ul>\n<h1 id=\"进阶\"><a href=\"#进阶\" class=\"headerlink\" title=\"进阶\"></a>进阶</h1><ul>\n<li><strong>Node Stream:</strong> <a href=\"https://github.com/substack/stream-handbook\" target=\"_blank\" rel=\"noopener\">https://github.com/substack/stream-handbook</a></li>\n<li><strong>deep-into-node:</strong> <a href=\"https://github.com/yjhjstz/deep-into-node\" target=\"_blank\" rel=\"noopener\">https://github.com/yjhjstz/deep-into-node</a></li>\n<li><strong>streamify your node program:</strong> <a href=\"https://github.com/zoubin/streamify-your-node-program\" target=\"_blank\" rel=\"noopener\">https://github.com/zoubin/streamify-your-node-program</a></li>\n</ul>\n<h1 id=\"订阅\"><a href=\"#订阅\" class=\"headerlink\" title=\"订阅\"></a>订阅</h1><ul>\n<li><strong>Node Weekly:</strong> <a href=\"https://nodeweekly.com/issues/203\" target=\"_blank\" rel=\"noopener\">https://nodeweekly.com/issues/203</a></li>\n</ul>\n<h1 id=\"面试\"><a href=\"#面试\" class=\"headerlink\" title=\"面试\"></a>面试</h1><ul>\n<li><strong>Node.js面试题，侧重后端应用与对Node核心的理解:</strong> <a href=\"https://github.com/jimuyouyou/node-interview-questions\" target=\"_blank\" rel=\"noopener\">https://github.com/jimuyouyou/node-interview-questions</a></li>\n<li><strong>Eleme Node Interview:</strong> <a href=\"https://github.com/ElemeFE/node-interview\" target=\"_blank\" rel=\"noopener\">https://github.com/ElemeFE/node-interview</a></li>\n</ul>\n<h1 id=\"收集\"><a href=\"#收集\" class=\"headerlink\" title=\"收集\"></a>收集</h1><ul>\n<li><strong>node.js中文资料导航:</strong> <a href=\"https://github.com/youyudehexie/node123\" target=\"_blank\" rel=\"noopener\">https://github.com/youyudehexie/node123</a></li>\n</ul>\n","categories":[],"tags":["todo","backend","node.js"]},{"title":"认识WebAssembly","url":"https://vincenthou.github.io/2017/09/01/认识WebAssembly/","content":"<ul>\n<li><a href=\"https://fanmingfei.com/posts/WebAssembly_Cartoon_Introduce.html\" target=\"_blank\" rel=\"noopener\">图说 WebAssembly</a></li>\n<li><a href=\"https://fanmingfei.com/posts/WebAssembly_Memory.html\" target=\"_blank\" rel=\"noopener\">WebAssembly 中的 Memory</a></li>\n<li><a href=\"https://fanmingfei.com/posts/WebAssembly_Table.html\" target=\"_blank\" rel=\"noopener\">什么是 WebAssembly table imports？</a></li>\n<li><a href=\"https://fanmingfei.com/posts/WebAssembly_Instance.html\" target=\"_blank\" rel=\"noopener\">使用JavaScript创建一个WebAssembly模块的实例</a></li>\n<li><a href=\"https://ppt.baomitu.com/d/248b9864#/\" target=\"_blank\" rel=\"noopener\">浅谈操作系统&amp;编译系统</a></li>\n<li><a href=\"https://ppt.baomitu.com/d/fbaac088#/\" target=\"_blank\" rel=\"noopener\">WebAssembly 实操（实验操作）</a></li>\n</ul>\n","categories":[],"tags":["frontend","collection","javascript","pefermance"]},{"title":"敏捷开发实践","url":"https://vincenthou.github.io/2017/08/29/敏捷开发实践/","content":"<ul>\n<li><a href=\"http://www.epubit.com.cn/article/1320\" target=\"_blank\" rel=\"noopener\">我在ThoughtWorks中的敏捷实践</a></li>\n</ul>\n","categories":[],"tags":["blog","todo","process"]},{"title":"区块链技术","url":"https://vincenthou.github.io/2017/08/29/区块链技术/","content":"<ul>\n<li><a href=\"https://mp.weixin.qq.com/s/kuNtNekdsBYxoTtP6xxQqw\" target=\"_blank\" rel=\"noopener\">白话区块链技术栈与应用</a></li>\n</ul>\n","categories":[],"tags":["collection","architecture","todo"]},{"title":"我眼中的架构","url":"https://vincenthou.github.io/2017/08/29/我眼中的架构/","content":"<ul>\n<li><a href=\"http://www.rowkey.me/blog/2017/08/24/arch/\" target=\"_blank\" rel=\"noopener\">谈谈架构</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s/kb32_Z6lESRuSblQNXhhjA\" target=\"_blank\" rel=\"noopener\">从架构到重构</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s/qCs_IiTB7n0oiugtXxOZcA\" target=\"_blank\" rel=\"noopener\">京东资深架构师代码评审歪诗</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s/-GRwJl_n4iMIn7o8WF-zBA\" target=\"_blank\" rel=\"noopener\">前端小团队如何培养技术积累？</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzIwNjQwMzUwMQ==&amp;mid=2247485403&amp;idx=1&amp;sn=c0e12775f6a3828441bb528c0e5b1cc9\" target=\"_blank\" rel=\"noopener\">SparkUI：FreeWheel的React开发实践</a></li>\n<li><a href=\"https://hanxv.cn/archives/81.html\" target=\"_blank\" rel=\"noopener\">项目架构设计总结</a></li>\n<li><a href=\"https://hanxv.cn/archives/8.html\" target=\"_blank\" rel=\"noopener\">各大互联网公司架构演进之路汇总</a></li>\n</ul>\n","categories":[],"tags":["blog","architecture","todo"]},{"title":"规则流引擎","url":"https://vincenthou.github.io/2017/08/29/规则流引擎/","content":"<ul>\n<li><a href=\"https://github.com/noolsjs/nools\" target=\"_blank\" rel=\"noopener\">nools</a>: Rete based rules engine written in javascript</li>\n<li><a href=\"https://www.ibm.com/developerworks/cn/opensource/os-drools/\" target=\"_blank\" rel=\"noopener\">开源规则流引擎实践</a></li>\n</ul>\n","categories":[],"tags":["blog","todo","system"]},{"title":"深入理解PostCSS","url":"https://vincenthou.github.io/2017/08/22/深入理解PostCSS/","content":"<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://github.com/postcss/postcss\" target=\"_blank\" rel=\"noopener\">PostCSS</a></li>\n<li><a href=\"https://www.zhihu.com/question/46312839\" target=\"_blank\" rel=\"noopener\">各位前端大神能不能通俗的说一下PostCSS到底能做什么？对于手写css的优势在哪？</a></li>\n<li><a href=\"http://www.w3cplus.com/preprocessor/postcss-book.html\" target=\"_blank\" rel=\"noopener\">深入PostCSS Web设计</a></li>\n<li><a href=\"http://www.w3cplus.com/preprocessor/postcss-and-crazy-things-you-can-do-with-it.html\" target=\"_blank\" rel=\"noopener\">PostCSS和一些有兴趣的东西</a></li>\n</ul>\n","categories":[],"tags":["css","frontend","todo","build"]},{"title":"深入企业级Node应用框架egg","url":"https://vincenthou.github.io/2017/08/22/深入企业级Node应用框架egg/","content":"<h1 id=\"定位\"><a href=\"#定位\" class=\"headerlink\" title=\"定位\"></a>定位</h1><p><code>nodejs</code> 社区从来不缺活跃的开发者和炫酷的开发框架，各种开发框架也是层出不穷。对于框架我一般分两类：全栈式（MVC全有），领域式（结合特定的业务场景提供限制功能让框架很轻量）。比如 <code>nodejs</code><br> 社区中</p>\n<ul>\n<li>全栈式: <a href=\"https://github.com/expressjs/express\" target=\"_blank\" rel=\"noopener\">express</a>, <a href=\"https://github.com/balderdashy/sails\" target=\"_blank\" rel=\"noopener\">sails</a>, <a href=\"https://github.com/meteor/meteor\" target=\"_blank\" rel=\"noopener\">meteor</a>, <a href=\"https://github.com/thinkjs/thinkjs\" target=\"_blank\" rel=\"noopener\">thinkjs</a></li>\n<li>领域式: <a href=\"https://github.com/koajs/koa\" target=\"_blank\" rel=\"noopener\">koa</a>, <a href=\"https://github.com/strongloop/loopback/\" target=\"_blank\" rel=\"noopener\">loopback</a>, <a href=\"https://github.com/restify/node-restify\" target=\"_blank\" rel=\"noopener\">restify</a></li>\n</ul>\n<p>那为什么要造这个轮子呢？从官方文档可以看到<a href=\"https://eggjs.org/zh-cn/intro/egg-and-koa.html\" target=\"_blank\" rel=\"noopener\">egg是基于koa</a>的，<code>koa</code> 本身从设计理念上就很清晰，主要是通过 <code>middleware</code> 实现AOP编程，框架代码简洁而专注。从<a href=\"https://github.com/koajs/koa/blob/master/docs/koa-vs-express.md\" target=\"_blank\" rel=\"noopener\">官方文档</a>的下表也可以看出来</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:right\">Feature</th>\n<th>Koa</th>\n<th>Express</th>\n<th>Connect</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:right\">Middleware Kernel</td>\n<td>✓</td>\n<td>✓</td>\n<td>✓</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">Routing</td>\n<td></td>\n<td>✓</td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:right\">Templating</td>\n<td></td>\n<td>✓</td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:right\">Sending Files</td>\n<td></td>\n<td>✓</td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:right\">JSONP</td>\n<td></td>\n<td>✓</td>\n</tr>\n</tbody>\n</table>\n<p>之前有用过ruby，用过 <code>rails</code> 也了解过 <code>sinatra</code>，其实 <code>koa</code> 和 <code>express</code> 的关系可以类比，<code>express</code> 是基于 <code>nodejs</code> 的特性实现的全栈web开发框架，而 <code>koa</code> 是web应用开发的领域DSL，通过简洁清晰的方式弥补 <code>nodejs</code> 不尽如人意的地方。这样也可以看出来 <code>koa</code> 是很自由灵活的，但是在企业应用开发中很追求整个团队的开发效率和代码的维护成本，所以必要的约束是不二法门，这个我在<a href=\"https://github.com/vincenthou/vincenthou.github.io/issues/73\" target=\"_blank\" rel=\"noopener\">我眼中的架构</a>中有描述，其实一个好的架构就是要设定规则和约束，让所有人的产出一致，达到综效的最优。</p>\n<p>回到 <code>egg</code> 的场景，这个框架是阿里跨团队共建的产物，就是为了之前分散在各个BU中不同团队自建轮子，自选框架的问题，让跨团队甚至BU的合作更加方便，Glossary和开发模式一致之后沟通和流转成本都会降低。同时为了平衡业务特性和公共复用的矛盾，不说<a href=\"https://eggjs.org/zh-cn/advanced/plugin.html\" target=\"_blank\" rel=\"noopener\">插件机制</a>，<a href=\"https://eggjs.org/zh-cn/advanced/framework.html\" target=\"_blank\" rel=\"noopener\">定制上层框架</a>是这个平衡性的最好体现。统一的<a href=\"https://eggjs.org/zh-cn/advanced/cluster-client.html\" target=\"_blank\" rel=\"noopener\">进程模型</a>也有利于实现一致性的部署方案。<a href=\"https://eggjs.org/zh-cn/tutorials/progressive.html\" target=\"_blank\" rel=\"noopener\">渐进式开发</a>思想更是让公共业务的迭代下沉变得更加无痛。</p>\n<h1 id=\"设计思想\"><a href=\"#设计思想\" class=\"headerlink\" title=\"设计思想\"></a>设计思想</h1><ul>\n<li>不做强制的技术选型（非大集市模式）</li>\n<li>依赖插件机制提供高可扩展性（一个插件只做一件事）</li>\n<li>约定优于配置（制定统一的开发规则）</li>\n<li>渐进式开发（extend -&gt; plugin -&gt; framework 支持功能的逐步升级沉淀）</li>\n<li>内置轻量且高效的<a href=\"https://eggjs.org/zh-cn/core/cluster-and-ipc.html\" target=\"_blank\" rel=\"noopener\">进程管理方案</a>（让开发更关注业务层，透明化运行时，也保证了统一性）</li>\n</ul>\n<p><strong>Tip:</strong> 个人认为的轻量是相对于主流的 <code>node.js</code> 进程管理方案<a href=\"https://github.com/Unitech/pm2\" target=\"_blank\" rel=\"noopener\">PM2</a>来说的</p>\n<h1 id=\"框架结构\"><a href=\"#框架结构\" class=\"headerlink\" title=\"框架结构\"></a>框架结构</h1><ul>\n<li>在开发框架之上的应用层框架（开发框架使用koa）</li>\n</ul>\n<h1 id=\"插件开发和社区\"><a href=\"#插件开发和社区\" class=\"headerlink\" title=\"插件开发和社区\"></a>插件开发和社区</h1><p>TODO</p>\n<h1 id=\"代码库组织结构\"><a href=\"#代码库组织结构\" class=\"headerlink\" title=\"代码库组织结构\"></a>代码库组织结构</h1><p>TODO</p>\n<h1 id=\"最佳实践\"><a href=\"#最佳实践\" class=\"headerlink\" title=\"最佳实践\"></a>最佳实践</h1><p>TODO</p>\n<h1 id=\"部署上线\"><a href=\"#部署上线\" class=\"headerlink\" title=\"部署上线\"></a>部署上线</h1><p>TODO</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://github.com/koajs/koa\" target=\"_blank\" rel=\"noopener\">Koa</a></li>\n<li><a href=\"https://github.com/eggjs/egg\" target=\"_blank\" rel=\"noopener\">Egg</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/29102746\" target=\"_blank\" rel=\"noopener\">结合源码解密 egg 运行原理</a></li>\n</ul>\n","categories":[],"tags":["architecture","todo","backend","node.js"]},{"title":"深入React技术栈","url":"https://vincenthou.github.io/2017/08/21/深入React技术栈/","content":"<h1 id=\"React学习总结\"><a href=\"#React学习总结\" class=\"headerlink\" title=\"React学习总结\"></a>React学习总结</h1><h2 id=\"设计思想\"><a href=\"#设计思想\" class=\"headerlink\" title=\"设计思想\"></a>设计思想</h2><p>专注于实现用户的UI层（这也是跨端的基础），react提供了对于界面描述方式的抽象，定义了一套界面实现方式的领域DSL（这里主要指的是JSX）实现了”学习一次，到处编写“的目标。react的特色总结起来主要有这几个点</p>\n<ul>\n<li>声明式编程</li>\n<li>从头到脚的组件化</li>\n<li>有限状态机模型</li>\n</ul>\n<h3 id=\"声明式编程\"><a href=\"#声明式编程\" class=\"headerlink\" title=\"声明式编程\"></a>声明式编程</h3><p>之前我们编程基本是命令式的（不准确的说是类似jQuery时代），我们需要实现一个什么功能或者效果需要编码实现step1, step2, step3。声明式编程就不是这样，一个实用的例子，比如 ES5 开始支持的很多 Array 上的原型方法，比如 map, reduce, some, filter<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array\" target=\"_blank\" rel=\"noopener\">等等</a>。你不需要知道这个数组是怎么索引迭代的，只需要知道你想要在这个迭代过程中做什么事情，很多标准化的过程就隐藏起来了。React 就是通过把 JSX 的语法 transpiling 成 DOM 结构的构造，通过生命周期的 hook 在 state 变更的时候触发界面的 DOM 更新。</p>\n<h3 id=\"从头到脚的组件化\"><a href=\"#从头到脚的组件化\" class=\"headerlink\" title=\"从头到脚的组件化\"></a>从头到脚的组件化</h3><p>组件化的思想不是 React 最新提出来的，但是个人认为 React 是做的最彻底的，在实现一个页面的时候，你被强迫按照组件化的思维解构页面，根据层级和适当的复用粒度定义出不同的组件。结合前端的状态管理机制，组件又可以分为 dump component （纯靠prop驱动渲染，完全无状态），smart component（有自己的业务状态），你对界面的描述自然而然转变为层级组件的描述，并且层层驱动渲染。</p>\n<h3 id=\"有限状态机模型FSM\"><a href=\"#有限状态机模型FSM\" class=\"headerlink\" title=\"有限状态机模型FSM\"></a>有限状态机模型FSM</h3><p>个人认为上面两点还只是特色或者表现形式，这点才是React的本质或者说是内核。这个概念可以通过公式 <code>UI = f(data)</code> 描述，也就是说界面的表现形式是完全由数据驱动的。这个数据从哪里来，两个来源：一个是组件构造时传入的外部数据（props），另一个是组件内部维护的当前界面的数据模型（state）。<code>state</code>在props传入的时候创建，之后在事件发生的时候驱动这个内部状态的更新。界面的状态是可以穷举的，界面总是处于某个状态下，在特定条件触发下（action发生）会从一种状态迁移到另一种状态。某个特定的状态也就对应了一个特定的界面展现（界面快照）。</p>\n<h2 id=\"生命周期hook\"><a href=\"#生命周期hook\" class=\"headerlink\" title=\"生命周期hook\"></a>生命周期hook</h2><p>如果仅仅是提供了 JSX 的语法来描述界面就只有 <strong>静态</strong> 的行为，为了让开发者灵活地定制组件的 <strong>动态</strong> 行为，一方面是通过绑定事件完成回调逻辑的方式，另一方面React 提供了丰富的生命周期钩子，大体上是这三个阶段</p>\n<ul>\n<li><strong>Mount:</strong> 组件实例被创建并且插入DOM中会调用的一组方法</li>\n<li><strong>Update:</strong> 组件被重绘的时候调用的一组方法，这个分为因为父组件想要render这个组件引发的和state change引发的渲染</li>\n<li><strong>Unmount:</strong> 组件被从DOM中移除的时候调用的一组方法</li>\n</ul>\n<p>使用图片更清楚，先看整体的状态流</p>\n<p><img src=\"http://mmbiz.qpic.cn/mmbiz_png/TCHicQEF6XKCR2kSZWUbbeYXU3e1uJbNQ3a3mQricuVVmJ7oSjOS9MgSDOE2N5WAkibdQNm1nj3J8AiaKiceBVUl5Fw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1\" alt=\"state-flow\"></p>\n<p>再根据几个case来看</p>\n<h3 id=\"首次渲染（组件装载）\"><a href=\"#首次渲染（组件装载）\" class=\"headerlink\" title=\"首次渲染（组件装载）\"></a>首次渲染（组件装载）</h3><p><strong>Tip:</strong> 这里图中有点出入，最新的React官网上没有了 <code>getDefaultProps</code> 和 <code>getInitialState</code> 的周期函数，而是合并为 <code>contructor</code> 方法</p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/30149578-b5aab8c6-93da-11e7-893c-83fbf7f48a5d.png\" alt=\"image\"></p>\n<p><img src=\"https://camo.githubusercontent.com/461765618c95d7d3d0941d767a95855cb5698195/687474703a2f2f7279616e73756b616c652e636f6d2f76697a2f74682f6a732f72656163746a735f636f6d706f6e656e745f6c6966656379636c652f696e697469616c5f72656e6465722e706e67\" alt=\"Initial Render\"></p>\n<h3 id=\"Props改变（其实是因为父组件想要render这个组件引发的）\"><a href=\"#Props改变（其实是因为父组件想要render这个组件引发的）\" class=\"headerlink\" title=\"Props改变（其实是因为父组件想要render这个组件引发的）\"></a>Props改变（其实是因为父组件想要render这个组件引发的）</h3><p><img src=\"https://camo.githubusercontent.com/89a1b3c9ec4282045c095b5e74c296de7165955a/687474703a2f2f7279616e73756b616c652e636f6d2f76697a2f74682f6a732f72656163746a735f636f6d706f6e656e745f6c6966656379636c652f70726f70735f6368616e67652e706e67\" alt=\"Props Change\"></p>\n<h3 id=\"State改变\"><a href=\"#State改变\" class=\"headerlink\" title=\"State改变\"></a>State改变</h3><p><img src=\"https://camo.githubusercontent.com/10de2955e68ca334679daf4cf821b18b5364f029/687474703a2f2f7279616e73756b616c652e636f6d2f76697a2f74682f6a732f72656163746a735f636f6d706f6e656e745f6c6966656379636c652f73746174655f6368616e67652e706e67\" alt=\"States Change\"></p>\n<h3 id=\"组件卸载\"><a href=\"#组件卸载\" class=\"headerlink\" title=\"组件卸载\"></a>组件卸载</h3><p><img src=\"https://camo.githubusercontent.com/c0390065e7dcd4e75ad6a146db705f8a23826716/687474703a2f2f7279616e73756b616c652e636f6d2f76697a2f74682f6a732f72656163746a735f636f6d706f6e656e745f6c6966656379636c652f756e6d6f756e742e706e67\" alt=\"Component Unmount\"></p>\n<h3 id=\"主要状态说明\"><a href=\"#主要状态说明\" class=\"headerlink\" title=\"主要状态说明\"></a>主要状态说明</h3><p><img src=\"https://user-images.githubusercontent.com/1998742/30149716-4bf369e0-93db-11e7-969a-9701a9737ebd.png\" alt=\"image\"></p>\n<h2 id=\"组件间通信方式\"><a href=\"#组件间通信方式\" class=\"headerlink\" title=\"组件间通信方式\"></a>组件间通信方式</h2><p>组件之间通信的方式根据复杂度和层级深度无外乎下面几种</p>\n<ul>\n<li>父子组件</li>\n<li>同父平级子组件</li>\n<li>任意层级组件</li>\n</ul>\n<h3 id=\"父子组件\"><a href=\"#父子组件\" class=\"headerlink\" title=\"父子组件\"></a>父子组件</h3><p>最简单的关系，父级可以直接通过props在组件初始化或者更新的时候将数据带下去，子组件可以通过父级传入的回调方法，将子组件的数据反馈给父级。</p>\n<h3 id=\"同父平级子组件\"><a href=\"#同父平级子组件\" class=\"headerlink\" title=\"同父平级子组件\"></a>同父平级子组件</h3><p>由于是共享同一个父级，借助 <strong>父子组件</strong> 的思想，两个子组件是都可以个跟父级通信的，所以可以通过父级做一个桥接，打通两个子组件的通信链路。</p>\n<h3 id=\"任意层级组件\"><a href=\"#任意层级组件\" class=\"headerlink\" title=\"任意层级组件\"></a>任意层级组件</h3><p>由于React生态贯彻的单向数据流思想，这种形式的通信方式如果通过上面递进的思路继续做是很困难的，在这种情况下就需要借助于外部的通信机制了，简单的可以用个<a href=\"https://github.com/developit/mitt\" target=\"_blank\" rel=\"noopener\">PubSub MITT</a>，复杂的就是用<a href=\"https://github.com/reactjs/redux\" target=\"_blank\" rel=\"noopener\">Redux</a>了（结合着Redux的核心设计理念，又是一整套的生态系统）</p>\n<h2 id=\"最佳实践\"><a href=\"#最佳实践\" class=\"headerlink\" title=\"最佳实践\"></a>最佳实践</h2><ul>\n<li><a href=\"https://github.com/vasanthk/react-bits\" target=\"_blank\" rel=\"noopener\">react-bits</a>：涉及React开发各个方面的模式或者原则</li>\n<li><a href=\"https://github.com/krasimir/react-in-patterns\" target=\"_blank\" rel=\"noopener\">react-in-patterns</a>：宏观上的一些设计思想</li>\n<li><a href=\"https://github.com/planningcenter/react-patterns\" target=\"_blank\" rel=\"noopener\">react-patterns</a>：很多细节原则的集合</li>\n<li><a href=\"https://github.com/chantastic/reactpatterns.com\" target=\"_blank\" rel=\"noopener\">reactpatterns.com</a>：各种组件的可扩展性写法</li>\n<li><a href=\"https://github.com/piotrwitek/react-redux-typescript-guide\" target=\"_blank\" rel=\"noopener\">react-redux-typescript-guide</a>：使用Typescript为大型的 React + Redux 项目提供静态类型支持</li>\n</ul>\n<h1 id=\"React-全家筒参考\"><a href=\"#React-全家筒参考\" class=\"headerlink\" title=\"React 全家筒参考\"></a>React 全家筒参考</h1><h2 id=\"脚手架\"><a href=\"#脚手架\" class=\"headerlink\" title=\"脚手架\"></a>脚手架</h2><ul>\n<li><a href=\"https://github.com/facebookincubator/create-react-app\" target=\"_blank\" rel=\"noopener\">Create React App</a>: 命令行工具</li>\n<li><a href=\"https://github.com/coryhouse/react-slingshot\" target=\"_blank\" rel=\"noopener\">React Slingshot</a>: 定义好的目录结构和配置，包含redux</li>\n<li><a href=\"https://github.com/kriasoft/react-starter-kit\" target=\"_blank\" rel=\"noopener\">React Starter Kit</a>: 定义好的目录结构和配置，使用express和graphQL做同构渲染</li>\n<li><a href=\"https://github.com/react-boilerplate/react-boilerplate\" target=\"_blank\" rel=\"noopener\">React Boilerplate</a>: 定义好的目录结构和配置，关注运行效率和最佳实践，完善的生产环境代码，包含redux生态</li>\n</ul>\n<h2 id=\"基础库\"><a href=\"#基础库\" class=\"headerlink\" title=\"基础库\"></a>基础库</h2><ul>\n<li><a href=\"https://github.com/facebook/react\" target=\"_blank\" rel=\"noopener\">React</a>: UI状态机（UI = f (data)）</li>\n<li><a href=\"https://github.com/ReactTraining/react-router\" target=\"_blank\" rel=\"noopener\">React Router</a>: 结合React的生命式路由</li>\n<li><a href=\"https://github.com/matthew-andrews/isomorphic-fetch\" target=\"_blank\" rel=\"noopener\">Isomorphic Fetch</a>: 只是promise的跨端 fetch API接口</li>\n</ul>\n<h2 id=\"UI组件库\"><a href=\"#UI组件库\" class=\"headerlink\" title=\"UI组件库\"></a>UI组件库</h2><ul>\n<li><a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">Ant Design</a></li>\n</ul>\n<h2 id=\"React-Lite\"><a href=\"#React-Lite\" class=\"headerlink\" title=\"React Lite\"></a>React Lite</h2><ul>\n<li><a href=\"https://github.com/developit/preact\" target=\"_blank\" rel=\"noopener\">Preact</a></li>\n<li><a href=\"https://github.com/infernojs/inferno\" target=\"_blank\" rel=\"noopener\">Inferno</a></li>\n</ul>\n<h2 id=\"终端扩展\"><a href=\"#终端扩展\" class=\"headerlink\" title=\"终端扩展\"></a>终端扩展</h2><ul>\n<li><a href=\"https://github.com/facebook/react-native\" target=\"_blank\" rel=\"noopener\">React Native</a>: 跨手机端</li>\n<li><a href=\"https://github.com/Flipboard/react-canvas\" target=\"_blank\" rel=\"noopener\">React Canvas</a>: 图形渲染</li>\n<li><a href=\"https://github.com/facebook/react-vr\" target=\"_blank\" rel=\"noopener\">React VR</a>: 虚拟现实</li>\n<li><a href=\"https://github.com/gatsbyjs/gatsby\" target=\"_blank\" rel=\"noopener\">Gatsby</a>: 静态站点生成</li>\n<li><a href=\"https://github.com/zeit/next.js\" target=\"_blank\" rel=\"noopener\">Next</a>: React SSR</li>\n</ul>\n<h2 id=\"构建工具\"><a href=\"#构建工具\" class=\"headerlink\" title=\"构建工具\"></a>构建工具</h2><ul>\n<li><a href=\"https://github.com/eslint/eslint\" target=\"_blank\" rel=\"noopener\">Eslint</a>: 代码规范</li>\n<li><a href=\"https://github.com/webpack/webpack\" target=\"_blank\" rel=\"noopener\">Webpack</a>: 模块构建打包</li>\n<li><a href=\"https://github.com/webpack/webpack-dev-server\" target=\"_blank\" rel=\"noopener\">Webpack Dev Server</a>: 配合webpack的本地开发服务器</li>\n<li><a href=\"https://github.com/babel/babel\" target=\"_blank\" rel=\"noopener\">Babel</a>: ES next transpiler</li>\n<li><a href=\"https://github.com/postcss/postcss\" target=\"_blank\" rel=\"noopener\">Postcss</a>: CSS next transpiler</li>\n</ul>\n<h2 id=\"开发工具\"><a href=\"#开发工具\" class=\"headerlink\" title=\"开发工具\"></a>开发工具</h2><ul>\n<li><a href=\"https://github.com/storybooks/storybook\" target=\"_blank\" rel=\"noopener\">Storybook</a>: 可视化组件开发工具</li>\n<li><a href=\"https://github.com/react-cosmos/react-cosmos\" target=\"_blank\" rel=\"noopener\">React Cosmos</a>: 可复用组件开发工具</li>\n<li><a href=\"https://github.com/ipselon/structor\" target=\"_blank\" rel=\"noopener\">Structor</a>:  理想化React应用生成工具</li>\n<li><a href=\"https://github.com/facebook/react-devtools\" target=\"_blank\" rel=\"noopener\">React Devtools</a>: 浏览器开发工具</li>\n<li><a href=\"https://github.com/garbles/why-did-you-update\" target=\"_blank\" rel=\"noopener\">Why did you update</a>: 在控制台中对不必要的渲染报错</li>\n</ul>\n<h2 id=\"样式方案\"><a href=\"#样式方案\" class=\"headerlink\" title=\"样式方案\"></a>样式方案</h2><ul>\n<li><a href=\"https://github.com/css-modules/css-modules\" target=\"_blank\" rel=\"noopener\">CSS Modules</a></li>\n<li><a href=\"https://github.com/styled-components/styled-components\" target=\"_blank\" rel=\"noopener\">Styled Components</a></li>\n</ul>\n<h2 id=\"状态管理\"><a href=\"#状态管理\" class=\"headerlink\" title=\"状态管理\"></a>状态管理</h2><ul>\n<li><a href=\"https://github.com/reactjs/redux\" target=\"_blank\" rel=\"noopener\">Redux</a>: 改良的Flux，可预测的状态容器，基于 <code>immutable</code></li>\n<li><a href=\"https://github.com/reactjs/react-redux\" target=\"_blank\" rel=\"noopener\">React Redux</a>: Redux 基于 react 的绑定（TODO）</li>\n<li><a href=\"https://github.com/mobxjs/mobx\" target=\"_blank\" rel=\"noopener\">Mobx</a>: 面向对象的思路，简易可扩展的状态管理，基于 <code>observable</code></li>\n<li><a href=\"https://github.com/mobxjs/mobx-react\" target=\"_blank\" rel=\"noopener\">Mobx React</a>: Mobx 基于 react 的绑定（TODO）</li>\n</ul>\n<h2 id=\"最佳实践整合方案\"><a href=\"#最佳实践整合方案\" class=\"headerlink\" title=\"最佳实践整合方案\"></a>最佳实践整合方案</h2><ul>\n<li><a href=\"https://github.com/dvajs/dva\" target=\"_blank\" rel=\"noopener\">Dva</a></li>\n<li><a href=\"https://github.com/mirrorjs/mirror\" target=\"_blank\" rel=\"noopener\">Mirror</a></li>\n<li><a href=\"https://github.com/keajs/kea\" target=\"_blank\" rel=\"noopener\">Kea</a></li>\n</ul>\n<h2 id=\"测试工具\"><a href=\"#测试工具\" class=\"headerlink\" title=\"测试工具\"></a>测试工具</h2><ul>\n<li><a href=\"https://github.com/facebook/jest\" target=\"_blank\" rel=\"noopener\">Jest</a></li>\n<li><a href=\"https://github.com/airbnb/enzyme\" target=\"_blank\" rel=\"noopener\">Enzyme</a></li>\n</ul>\n<h2 id=\"Awesome\"><a href=\"#Awesome\" class=\"headerlink\" title=\"Awesome\"></a>Awesome</h2><ul>\n<li><a href=\"https://github.com/enaqx/awesome-react\" target=\"_blank\" rel=\"noopener\">Awesome React</a></li>\n<li><a href=\"https://github.com/brillout/awesome-react-components\" target=\"_blank\" rel=\"noopener\">Awesome React Components</a></li>\n</ul>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><ul>\n<li><a href=\"http://ricostacruz.com/cheatsheets/react.html\" target=\"_blank\" rel=\"noopener\">React小抄</a></li>\n<li><a href=\"https://github.com/dwqs/react-style-guide\" target=\"_blank\" rel=\"noopener\">React样式规范</a></li>\n<li><a href=\"https://fakefish.github.io/react-webpack-cookbook/\" target=\"_blank\" rel=\"noopener\">React Webpack 菜谱</a></li>\n</ul>\n<h2 id=\"源码赏析\"><a href=\"#源码赏析\" class=\"headerlink\" title=\"源码赏析\"></a>源码赏析</h2><ul>\n<li><a href=\"https://www.kisnows.com/2017/08/17/redux-source-code-read/\" target=\"_blank\" rel=\"noopener\">Redux 源码解读（长文慎入）</a></li>\n</ul>\n<h1 id=\"练习教程\"><a href=\"#练习教程\" class=\"headerlink\" title=\"练习教程\"></a>练习教程</h1><ul>\n<li><a href=\"https://github.com/workshopper/learnyoureact\" target=\"_blank\" rel=\"noopener\">learnyoureact</a></li>\n<li><a href=\"https://github.com/asbjornenge/thinking-in-react\" target=\"_blank\" rel=\"noopener\">Thinking in React</a></li>\n<li><a href=\"http://huziketang.com/books/react/\" target=\"_blank\" rel=\"noopener\">React.js 小书</a></li>\n<li><a href=\"https://github.com/mocheng/react-and-redux\" target=\"_blank\" rel=\"noopener\">《深入浅出React和Redux》代码</a></li>\n<li><a href=\"https://github.com/ReactTraining/react-workshop\" target=\"_blank\" rel=\"noopener\">React Workshop</a></li>\n</ul>\n<h1 id=\"文章\"><a href=\"#文章\" class=\"headerlink\" title=\"文章\"></a>文章</h1><ul>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzIyMjYyMzg3MA==&amp;mid=2247484454&amp;idx=5&amp;sn=68bbbf8b21df682c254f65ef1e3f3e5f&amp;chksm=e82be537df5c6c21dc1b0109760594c08f5ed7885c13a2e0195afc9aa10d6ddb11ae39f42d33&amp;mpshare=1&amp;scene=1&amp;srcid=0915LHM6ouldLCQgvnVaupRv&amp;pass_ticket=1LdIqJ7%2Fs%2B%2Fzr%2Br5kvhglclFHVk3ODibbTVOjmzC3%2BNoYP5JxzwtVs93XaaGZv3e#rd\" target=\"_blank\" rel=\"noopener\">React 生态系统：从小白到大神</a></li>\n</ul>\n<h1 id=\"专栏\"><a href=\"#专栏\" class=\"headerlink\" title=\"专栏\"></a>专栏</h1><ul>\n<li><a href=\"https://zhuanlan.zhihu.com/purerender\" target=\"_blank\" rel=\"noopener\">pure render</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/leanreact\" target=\"_blank\" rel=\"noopener\">LeanReact</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/advancing-react\" target=\"_blank\" rel=\"noopener\">进击的React</a></li>\n</ul>\n<h1 id=\"好书\"><a href=\"#好书\" class=\"headerlink\" title=\"好书\"></a>好书</h1><ul>\n<li><p><a href=\"https://book.douban.com/subject/26918038/\" target=\"_blank\" rel=\"noopener\">深入浅出React和Redux</a><br><img src=\"https://user-images.githubusercontent.com/1998742/29517303-0f8f2890-86a7-11e7-8ddf-c59c1696d0de.png\" alt=\"image\"></p>\n</li>\n<li><p><a href=\"https://book.douban.com/subject/26918038/\" target=\"_blank\" rel=\"noopener\">深入react 技术栈</a><br><img src=\"https://user-images.githubusercontent.com/1998742/29517366-5c26363a-86a7-11e7-9b0f-952c42c96359.png\" alt=\"image\"></p>\n</li>\n</ul>\n","categories":[],"tags":["frontend","javascript"]},{"title":"深入理解webpack","url":"https://vincenthou.github.io/2017/08/10/深入理解webpack/","content":"<ul>\n<li><a href=\"https://github.com/vikingmute/webpack-for-fools\" target=\"_blank\" rel=\"noopener\">webpack-for-fools</a></li>\n<li><a href=\"https://survivejs.com/webpack/introduction/\" target=\"_blank\" rel=\"noopener\">webpack使用教程</a></li>\n<li><a href=\"https://fengmiaosen.github.io/2017/03/21/webpack-core-code/\" target=\"_blank\" rel=\"noopener\">webpack之plugin内部运行机制</a></li>\n<li><a href=\"https://juejin.im/post/5980752ef265da3e2e56e82e\" target=\"_blank\" rel=\"noopener\">webpack 之 loader 和 plugin 简介</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000005614604\" target=\"_blank\" rel=\"noopener\">手把手深入理解 webpack dev middleware 原理與相關 plugins</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/20933749\" target=\"_blank\" rel=\"noopener\">前端构建工具漫谈，fis3、webpack、rollup.js</a></li>\n</ul>\n","categories":[],"tags":["frontend","javascript","todo","build"]},{"title":"深入理解babel","url":"https://vincenthou.github.io/2017/08/10/深入理解babel/","content":"<ul>\n<li><a href=\"https://javascript.unicorn.tv/articles/javascript-compiling-and-transpiling\" target=\"_blank\" rel=\"noopener\">JavaScript Compiling and Transpiling</a></li>\n<li><a href=\"https://github.com/thejameskyle/babel-handbook\" target=\"_blank\" rel=\"noopener\">Babel Handbook</a></li>\n<li><a href=\"http://www.octman.com/blog/2016-08-27-babel-notes/\" target=\"_blank\" rel=\"noopener\">Babel 内部原理分析</a></li>\n<li><a href=\"http://ryerh.com/javascript/2016/03/27/babel-module-implementation.html\" target=\"_blank\" rel=\"noopener\">分析 Babel 转换 ES6 module 的原理</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/27289600\" target=\"_blank\" rel=\"noopener\">Babel是如何读懂JS代码的</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/27305941\" target=\"_blank\" rel=\"noopener\">探究Babel生态</a></li>\n<li><a href=\"http://astexplorer.net/\" target=\"_blank\" rel=\"noopener\">AST explorer</a></li>\n</ul>\n","categories":[],"tags":["frontend","javascript","todo","build"]},{"title":"PHP学习指南","url":"https://vincenthou.github.io/2017/08/10/PHP学习指南/","content":"<h1 id=\"基础入门\"><a href=\"#基础入门\" class=\"headerlink\" title=\"基础入门\"></a>基础入门</h1><h2 id=\"书籍和文档\"><a href=\"#书籍和文档\" class=\"headerlink\" title=\"书籍和文档\"></a>书籍和文档</h2><ul>\n<li><strong>PHP The Rright Way:</strong> <a href=\"http://laravel-china.github.io/php-the-right-way/\" target=\"_blank\" rel=\"noopener\">http://laravel-china.github.io/php-the-right-way/</a></li>\n<li><strong>Modern PHP(中文版):</strong> <a href=\"https://book.douban.com/subject/26635862/\" target=\"_blank\" rel=\"noopener\">https://book.douban.com/subject/26635862/</a></li>\n<li><strong>PHP和MySQL Web开发(原书第4版):</strong> <a href=\"https://book.douban.com/subject/3549421/\" target=\"_blank\" rel=\"noopener\">https://book.douban.com/subject/3549421/</a></li>\n</ul>\n<p>上面的书籍根据精力逐步学习，<strong>如果能不看视频教程学习，就不要跟随网上的视频教程学习</strong></p>\n<p><strong>Tip:</strong> 强调一点，实际工作中书的作用是<strong>致用</strong>，不是用来考试的，不要在乎一城一地的得失，观其大略，一时看不懂就跳过，掌握知识体系和思维脉络，多动手实践，在实践中再反复的回来看书指导实践，如此迭代</p>\n<h2 id=\"拓展知识\"><a href=\"#拓展知识\" class=\"headerlink\" title=\"拓展知识\"></a>拓展知识</h2><ul>\n<li>作为通用技能的SQL使用就不在这里写出，主要是SQL语法本身还是特定关系型数据库，一般PHP跟MySQL结合更加紧密（随便找本入门的书籍熟悉基本使用就可以）．</li>\n<li>PHP的web程序都是在特定的web容器中运行，最早常用的是apache（很多较早的项目还会使用），现在更常用的是<a href=\"http://nginx.org/\" target=\"_blank\" rel=\"noopener\">nginx</a>，在网上找个基本的文章先了解基本的使用和简单的配置就可以了．</li>\n<li>学习使用Linux的shell命令，使用命令速查命令行工具<a href=\"https://github.com/tldr-pages/tldr\" target=\"_blank\" rel=\"noopener\">TLDR</a>，边用边学，不会了就现查一下</li>\n<li>开阔下视野，看下PHP社区的全貌: <a href=\"https://github.com/ziadoz/awesome-php\" target=\"_blank\" rel=\"noopener\">https://github.com/ziadoz/awesome-php</a></li>\n</ul>\n<h2 id=\"周边工具\"><a href=\"#周边工具\" class=\"headerlink\" title=\"周边工具\"></a>周边工具</h2><ul>\n<li><strong>文本编辑器sublime:</strong> <a href=\"http://www.sublimetext.com/\" target=\"_blank\" rel=\"noopener\">http://www.sublimetext.com/</a></li>\n<li><strong>IDE: PhpStorm:</strong> <a href=\"https://www.jetbrains.com/phpstorm/\" target=\"_blank\" rel=\"noopener\">https://www.jetbrains.com/phpstorm/</a> 不过初学者推荐使用文本编辑器</li>\n<li><strong>Git的使用:</strong> <a href=\"http://rogerdudler.github.io/git-guide/\" target=\"_blank\" rel=\"noopener\">http://rogerdudler.github.io/git-guide/</a></li>\n<li><strong>Composer的使用:</strong> <a href=\"http://www.phpcomposer.com/\" target=\"_blank\" rel=\"noopener\">http://www.phpcomposer.com/</a></li>\n</ul>\n<h2 id=\"能力目标\"><a href=\"#能力目标\" class=\"headerlink\" title=\"能力目标\"></a>能力目标</h2><ul>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 掌握基本的语法</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 自己搭建基本的LAMP/LNMP环境</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 会使用基本的Linux命令行操作</li>\n</ul>\n<p><strong>Tip:</strong> 可以通过腾讯实验室以做实验的方式学习环境搭建</p>\n<ul>\n<li><a href=\"https://www.qcloud.com/developer/labs/lab/10084\" target=\"_blank\" rel=\"noopener\">搭建 LAMP + CodeIgniter 开发环境</a></li>\n<li><a href=\"https://www.qcloud.com/developer/labs/lab/10087\" target=\"_blank\" rel=\"noopener\">搭建 LNMP + CodeIgniter 开发环境</a></li>\n</ul>\n<ol start=\"5\">\n<li>给自己定一个小目标</li>\n</ol>\n<p>设定时间，安排进度，自己搭建一个简单的博客系统</p>\n<h1 id=\"进阶开发\"><a href=\"#进阶开发\" class=\"headerlink\" title=\"进阶开发\"></a>进阶开发</h1><h2 id=\"书籍和文档-1\"><a href=\"#书籍和文档-1\" class=\"headerlink\" title=\"书籍和文档\"></a>书籍和文档</h2><ul>\n<li><strong>PHP核心技术与最佳实践:</strong> <a href=\"https://book.douban.com/subject/3549421/\" target=\"_blank\" rel=\"noopener\">https://book.douban.com/subject/3549421/</a></li>\n<li><strong>DesignPatterns PHP:</strong> <a href=\"https://github.com/domnikl/DesignPatternsPHP\" target=\"_blank\" rel=\"noopener\">https://github.com/domnikl/DesignPatternsPHP</a></li>\n<li><strong>Clean Code:</strong> <a href=\"https://book.douban.com/subject/3032825/\" target=\"_blank\" rel=\"noopener\">https://book.douban.com/subject/3032825/</a></li>\n</ul>\n<p>PHP经典的 <code>LAMP/LNMP</code> 架构，线上PHP服务基本全部是部署在Linux系统上的，所以学习常用的linx命令是必须的，这里推荐两个学习资料:</p>\n<ul>\n<li><strong>Linux大棚命令百篇（上）:</strong> <a href=\"https://book.douban.com/subject/26849802/\" target=\"_blank\" rel=\"noopener\">https://book.douban.com/subject/26849802/</a></li>\n<li><strong>Linux大棚命令百篇（下）:</strong> <a href=\"https://book.douban.com/subject/26849844/\" target=\"_blank\" rel=\"noopener\">https://book.douban.com/subject/26849844/</a></li>\n</ul>\n<p><strong>Tip:</strong> shell命令更是用到了学什么效果更好，当然如果你时间充裕，可以把上面介绍的两本书好好学习和实践一下，语言通俗幽默，案例也有一定的深度，平常用到完了怎么用就执行下 tldr 的命令（不光是基本的shell命令），反复几次就记住了，不要死记硬背．</p>\n<h2 id=\"能力目标-1\"><a href=\"#能力目标-1\" class=\"headerlink\" title=\"能力目标\"></a>能力目标</h2><ul>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 熟练掌握一个PHP web框架，对原理有基本的认识</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 使用PHP框架限定时间，安排任务，自己实现一个博客管理系统（不是基于wordpress）</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 有书写简洁代码的习惯，养成代码”洁癖”</li>\n</ul>\n<h2 id=\"拓展知识-1\"><a href=\"#拓展知识-1\" class=\"headerlink\" title=\"拓展知识\"></a>拓展知识</h2><ul>\n<li>熟练掌握一个PHP web框架的使用，不要纠结与框架的选择，选择一个主流的学习即可**．很多框架的设计思路是相似的，很多后续也会慢慢融合和相互借鉴．个人推荐初学者学习Yii2框架（难度，复杂度和代码封装性适中）</li>\n<li>在了解和熟悉框架之后，多思考框架的设计理念，结合 <code>DesignPatterns PHP</code> 去发现框架是如何很好的应用设计模式组织代码的</li>\n<li>了解 <a href=\"https://github.com/jupeter/clean-code-php\" target=\"_blank\" rel=\"noopener\">clean code</a> 的原则，并且有意识用于平常代码的编写，适时重构自己的代码</li>\n</ul>\n","categories":[],"tags":["collection","backend","php"]},{"title":"后端系统问题排查案例","url":"https://vincenthou.github.io/2017/07/28/后端系统问题排查案例/","content":"<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://mp.weixin.qq.com/s/ZZp0H5vIBNu47KsiJOju2Q\" target=\"_blank\" rel=\"noopener\">线上操作与线上问题排查实战</a></li>\n<li><a href=\"http://www.cnblogs.com/succour/p/6305574.html\" target=\"_blank\" rel=\"noopener\">记一次线上由nginx upstream keepalive与http协议”协作”引起的接口报错率飙高事件</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s/7jfBdiZf2-NQJRfQdbUw2A\" target=\"_blank\" rel=\"noopener\">两步搞定PHP-FPM优化，让服务器更平稳</a></li>\n<li><a href=\"http://www.importnew.com/26413.html\" target=\"_blank\" rel=\"noopener\">线上服务 CPU 100%？一键定位 so easy！</a></li>\n<li><a href=\"http://fordba.com/optimize-an-amazing-mysql-slowlog.html\" target=\"_blank\" rel=\"noopener\">一个不可思议的MySQL慢查分析与解决</a></li>\n</ul>\n","categories":[],"tags":["backend","debug"]},{"title":"后端系统设计方案","url":"https://vincenthou.github.io/2017/07/27/后端系统设计方案/","content":"<h1 id=\"综合\"><a href=\"#综合\" class=\"headerlink\" title=\"综合\"></a>综合</h1><ul>\n<li><a href=\"https://github.com/donnemartin/system-design-primer\" target=\"_blank\" rel=\"noopener\">系统设计入门</a></li>\n<li><a href=\"http://jxy.me/2017/06/03/distributed-mess/\" target=\"_blank\" rel=\"noopener\">分布式大杂烩</a></li>\n</ul>\n<h1 id=\"微服务\"><a href=\"#微服务\" class=\"headerlink\" title=\"微服务\"></a>微服务</h1><p><img src=\"https://user-images.githubusercontent.com/1998742/30190596-d4aeeca4-946d-11e7-8283-4e2342dc0414.png\" alt=\"3-3\"></p>\n<ul>\n<li><a href=\"http://jm.taobao.org/2017/08/07/20170807/\" target=\"_blank\" rel=\"noopener\">中间件技术峰会分享 | 微服务架构上云最佳实践</a></li>\n<li><a href=\"https://martinfowler.com/articles/microservices.html\" target=\"_blank\" rel=\"noopener\">martinfowler microservices article</a></li>\n</ul>\n<h1 id=\"消息队列\"><a href=\"#消息队列\" class=\"headerlink\" title=\"消息队列\"></a>消息队列</h1><ul>\n<li><a href=\"http://www.linkedkeeper.com/detail/blog.action?bid=1016\" target=\"_blank\" rel=\"noopener\">浅谈分布式消息技术 Kafka</a></li>\n</ul>\n<h1 id=\"数据库\"><a href=\"#数据库\" class=\"headerlink\" title=\"数据库\"></a>数据库</h1><ul>\n<li><a href=\"https://mp.weixin.qq.com/s/ad4tpM6cdi9r6vgfbaTzxg\" target=\"_blank\" rel=\"noopener\">无限容量数据库架构设计</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s/0frrH09-zFjdFYZalatb8A\" target=\"_blank\" rel=\"noopener\">MySQL架构设计谈：从开发规范、选型、拆分到减压</a></li>\n</ul>\n<h1 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h1><ul>\n<li><a href=\"http://xiecode.cn/post/cn_05_handling_1m_requests_per_minute_with_golang/\" target=\"_blank\" rel=\"noopener\">用Golang处理每分钟百万级请求</a></li>\n</ul>\n","categories":[],"tags":["collection","architecture","backend"]},{"title":"grpc协议和工具","url":"https://vincenthou.github.io/2017/07/27/grpc协议和工具/","content":"<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://github.com/grpc-ecosystem/go-grpc-middleware\" target=\"_blank\" rel=\"noopener\">grpc常用中间件实现</a></li>\n<li><a href=\"https://github.com/grpc-ecosystem/grpc-gateway\" target=\"_blank\" rel=\"noopener\">grpc的restful API反向代理代码生成器</a></li>\n<li><a href=\"https://github.com/njpatel/grpcc\" target=\"_blank\" rel=\"noopener\">grpcc 命令行尝试工具</a></li>\n<li><a href=\"https://pingcap.com/blog-grpc-zh\" target=\"_blank\" rel=\"noopener\">深入了解 gRPC：协议</a></li>\n</ul>\n","categories":[],"tags":["backend"]},{"title":"动态追踪技术","url":"https://vincenthou.github.io/2017/07/27/动态追踪技术/","content":"<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://pingcap.com/blog-tangliu-tool-%7C-zh\" target=\"_blank\" rel=\"noopener\">工欲性能调优，必先利其器(1) - 定位追踪工具</a></li>\n<li><a href=\"https://pingcap.com/blog-tangliu-tool-%7C%7C-zh\" target=\"_blank\" rel=\"noopener\">工欲性能调优，必先利其器(2) - 火焰图</a></li>\n<li><a href=\"https://openresty.org/posts/dynamic-tracing/\" target=\"_blank\" rel=\"noopener\">动态追踪技术漫谈 - 章亦春</a></li>\n</ul>\n","categories":[],"tags":["collection","backend","pefermance"]},{"title":"整理性能优化的方案和思路","url":"https://vincenthou.github.io/2017/07/22/整理性能优化的方案和思路/","content":"","categories":[],"tags":["blog","architecture","todo","pefermance"]},{"title":"【JS之美】异步和回调","url":"https://vincenthou.github.io/2017/06/27/【JS之美】异步和回调/","content":"<p>林林总总接触了不少语言，慢慢发现其实没有所谓最好的语言，每种语言都有自己的诞生背景和适用场景，结合工程的实践最适用的语言才是最好的。也正因为这样其实对于语言的偏执也渐渐淡了许多，但是总还有几个语言是比较偏好的，JS便是一个。既然提到应用场景或者说语言特色，想来想去，虽然近几年的ES标准的普及和推进，JS也渐渐吸收了很多其他语言的特性，变得不那么 <code>JS</code> 了，但总还有些特性是骨子里面能够跟其他语言区分开来的，异步就是最有代表性的一点。</p>\n<h1 id=\"缘起\"><a href=\"#缘起\" class=\"headerlink\" title=\"缘起\"></a>缘起</h1><h1 id=\"事件循环\"><a href=\"#事件循环\" class=\"headerlink\" title=\"事件循环\"></a>事件循环</h1><h1 id=\"回调梦魇\"><a href=\"#回调梦魇\" class=\"headerlink\" title=\"回调梦魇\"></a>回调梦魇</h1><h1 id=\"Promise\"><a href=\"#Promise\" class=\"headerlink\" title=\"Promise\"></a>Promise</h1><h1 id=\"Generator\"><a href=\"#Generator\" class=\"headerlink\" title=\"Generator\"></a>Generator</h1><h1 id=\"Asyc-Await\"><a href=\"#Asyc-Await\" class=\"headerlink\" title=\"Asyc/Await\"></a>Asyc/Await</h1><h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://www.jianshu.com/p/78dfb38ac3d7\" target=\"_blank\" rel=\"noopener\">Callback Promise Generator Async-Await 和异常处理的演进</a></li>\n<li><a href=\"https://github.com/getify/You-Dont-Know-JS\" target=\"_blank\" rel=\"noopener\">You-Dont-Know-JS</a></li>\n<li><a href=\"https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/\" target=\"_blank\" rel=\"noopener\">The Node.js Event Loop, Timers, and process.nextTick()</a></li>\n<li><a href=\"https://i5ting.github.io/asynchronous-flow-control\" target=\"_blank\" rel=\"noopener\">深入浅出js（Node.js）异步流程控制</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/19750470\" target=\"_blank\" rel=\"noopener\">Node.js回调黑洞全解：Async、Promise 和 Generator</a></li>\n<li><a href=\"https://vimeo.com/96425312\" target=\"_blank\" rel=\"noopener\">Help, I’m stuck in an event-loop</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/20794401\" target=\"_blank\" rel=\"noopener\">生成器（Generator）——《实战 ES2015》章节试读</a></li>\n</ul>\n","categories":[],"tags":["blog","javascript","todo"]},{"title":"高并发系统设计思路","url":"https://vincenthou.github.io/2017/06/23/高并发系统设计思路/","content":"<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://wetest.qq.com/lab/view/316.html\" target=\"_blank\" rel=\"noopener\">多“维”优化——前端高并发策略的更深层思考</a></li>\n<li><a href=\"http://wetest.qq.com/lab/view/80.html\" target=\"_blank\" rel=\"noopener\">高性能服务器架构思路</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?src=3&amp;timestamp=1498231642&amp;ver=1&amp;signature=FHY4wL84qIJCB2wujEFzOe3wp*ah1dBnHxaWazOT4c4Lis*gafSrZm2Nsc4fJAB9WUz65VuB*O8Z4xvsbWz6GFFhbbLciiK0InEy3fPJRhWT0ZxN6AU8NfVNNMhZnHaEnQHrlRsXM5o0GHmFTz*3am88BPB950sJqvWj3XV4tpk=\" target=\"_blank\" rel=\"noopener\">去哪儿网机票搜索系统的高并发架构设计</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?src=3&amp;timestamp=1498231642&amp;ver=1&amp;signature=wz0C0rOE4hyEHQTWtOplUTyZH1CHKoIewuP9cgQC2EF2VaiUX5UpIDXUjAu5qRefPPLm9XDtSNNemCJrosryNcsnC4Cjl3uFSvU8vAPvEFmcSpDJ5GJ8xL9szkCw*Z426cR*bxcNgI6fL-qkwjpvKDJUhREU17C5RuvmIuVBtbM=\" target=\"_blank\" rel=\"noopener\">微信高并发资金交易系统设计方案——百亿红包背后的技术支撑</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?src=3&amp;timestamp=1498231642&amp;ver=1&amp;signature=ifj0PRCsXKHVPiVcl-dNxhSlKKKcX6hwO1rz-hbipIqYvRJcuTZvBp-aaLfpBP4sN3YHf7Fx6nt686NDwdMitb6Z9KBWkbni1bTsz-LI*NazsswYjwBQVL8BJvrLIbvuA2ARXrcmI1W3inKiSeFAt*Wtb*l1P9MKhZ8yD5BxKsE=\" target=\"_blank\" rel=\"noopener\">架构学习之路——高可用高并发系统设计原则</a></li>\n</ul>\n","categories":[],"tags":["architecture","pefermance"]},{"title":"基于containerpilot的服务注册与发现","url":"https://vincenthou.github.io/2017/06/19/基于containerpilot的服务注册与发现/","content":"<p>本文是针对项目中使用的一些总结，不过如果要说清楚应用场景，还是要简单说明白几个概念的。</p>\n<h1 id=\"微服务\"><a href=\"#微服务\" class=\"headerlink\" title=\"微服务\"></a>微服务</h1><p>不管是前端还是后端服务，项目开始的时候追求短平快，所有的代码会放在一个代码库中，基于同一个框架和语言开发，顶多根据文件或者文件夹做一下模块化。前端和后端服务做一下分离（或者也没有做），放在一个SLB后面，作为无状态的应用服务器也能实现基本的水平扩容。然而，随着业务的快速发展，这样的简单结构会逐渐变成障碍。微服务的实践其实应该由来已久，只是最近几年被炒的火热，而微服务的核心思想还是设计模式中经典的思想：<strong>单一责任</strong>。基于这个思想，微服务的其他便利才有了落脚点。</p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/28850755-17ab5de2-7751-11e7-9491-212e1243f966.png\" alt=\"image\"></p>\n<p>更多内容可以参考这里: <a href=\"http://dockone.io/article/394\" target=\"_blank\" rel=\"noopener\">微服务架构的优势与不足</a></p>\n<h1 id=\"服务的注册与发现\"><a href=\"#服务的注册与发现\" class=\"headerlink\" title=\"服务的注册与发现\"></a>服务的注册与发现</h1><p>既然我们的目标是把一个服务打散，也就是从单进程要放到多进程中去，就需要涉及到进程间通信。经典的操作系统理论理论里面提到的IPC方法有: 管道，有名管道（无父子关系约束），信号量（计数锁），消息队列，信号，共享内存，套接字。这些方法大多是基于单机器中进程通信的方式。我们利用微服务在部署的时候另外一个原则: <strong>消除单点</strong>，所以肯定是需要能够跨机器进程的方式通信了，那套接字就是重要的选择，实际应用中因为开发更多在应用层实现，所以Restful和RPC的方式是常用的手段。这里就存在一个问题，服务因为彼此隔离，彼此通信的时候怎么知道彼此的存在，同时在需要调用依赖的服务时，如何能够调用到<strong>合适的机器</strong>（这里指的是机器的IP和端口号），这就是服务的注册与发现问题了。同时服务的注册和发现也存在两种模式: 客户端模式和服务端模式。</p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/28851314-47753266-7754-11e7-98cd-2cc781f2daff.png\" alt=\"image\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/28851324-508d1d82-7754-11e7-90b4-19c7338f4cda.png\" alt=\"image\"></p>\n<p>可以看到这里的差别主要在于是否将注册中心暴露出去，我们后面的讨论基于<strong>客户端模式</strong>。</p>\n<p>可能你直接看上面的架构，感觉不到这个注册中心的好处，让我们再放几张图，看看我们原来是怎么做的</p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/28851464-33fee758-7755-11e7-918c-0e6a3553b7e6.png\" alt=\"image\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/28851453-21839038-7755-11e7-9bb0-47f961a3de8c.png\" alt=\"image\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/28851431-f128f338-7754-11e7-97de-a9778756ca77.png\" alt=\"image\"></p>\n<p>当然实际场景有可能比这还要复杂，可能中间用的还有F5或者haproxy，这里只是个示意。刚开始简单实现就档个nginx，对upstream有个基本的healthcheck，通过反向代理就请求到后端服务就可以了。当访问量上升，单个nginx扛不住就再在前端档个LVS，通过四层协议转发IP包，第二层对nginx分组讲负载进一步分流。但是这样LVS变成了单点，而且配置变得更加复杂。最后又不得不把这个单点消除，由客户端智能判断合适的分组，请求后端的服务。这里nginx在所有情况下既担当了负载均衡的角色，又担当了服务发现的角色（如果服务分组的时候根据访问量来分，会把访问量差不多的放在一个分组，通过nginx重写路由映射到多个后端服务）。这里很明显配置都是需要人工干预的，任何一台后端实际服务的机器IP变化都需要运维手动维护，繁琐而且容易出错。这样大家就可以感受到上面注册中心的好处了把，所有的服务列表可以集中在一个地方管理。</p>\n<h2 id=\"服务注册中心\"><a href=\"#服务注册中心\" class=\"headerlink\" title=\"服务注册中心\"></a>服务注册中心</h2><p>所有服务都集中存在一个地方管理，现在的主流方案主要是这三个</p>\n<ul>\n<li><a href=\"https://github.com/hashicorp/consul\" target=\"_blank\" rel=\"noopener\">consul</a>: 提供了一站式的解决方案，健康检查，DNS解析一应俱全，甚至提供了个简单的UI工具</li>\n<li><a href=\"https://github.com/coreos/etcd\" target=\"_blank\" rel=\"noopener\">etcd</a>: 仅提供基本的kv分布式存储</li>\n<li><a href=\"https://github.com/apache/zookeeper\" target=\"_blank\" rel=\"noopener\">zookeeper</a>: 一些老的系统还在使用，配置管理都相对麻烦</li>\n</ul>\n<p>因为只用过 <code>consul</code>，下面都是以它为依据展开，但是作为服务注册中心的概念上是相似的．作为注册中心基本的功能就是kv的存储，服务的配置信息还有应用的配置信息都可以放在这里，<code>consul</code> 提供了 <code>agent</code> 运行的模式，也就是 <code>client</code> 和 <code>server</code> 模式，看下图</p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/29553622-89b18f3a-874e-11e7-9ce9-a5472339aca2.png\" alt=\"image\"></p>\n<p><code>server</code> 模式的 <code>agent</code> 互相通信构成一个集群，主要负责参与选出集群的主节点和实现信息同步, <code>client</code> 模式的 <code>agent</code> 只是同步集群的数据，或者在自己接受到数据变更请求的时候将变化广播出去．<code>server</code> 模式的 <code>agent</code> 组成的集群可以放在多个数据中心来保证高可用，通过 <code>gossip</code> 协议实现分布式的数据一致性．这里从简化概念考虑，你可以把 <code>consul</code> 的整个集群当成一个”哈希表”，服务都是注册到这个”哈希表”中，然后其他的服务通过查找这个”哈希表”来获取实际调用的下游服务．实际情况并不是这么简单，因为不是本文的重点，这里略过了，有兴趣的同学可以自己看下<a href=\"https://www.consul.io/docs/index.html\" target=\"_blank\" rel=\"noopener\">官方文档</a>．</p>\n<p><strong>Tip:</strong> 基于应用的配置信息提供了<a href=\"https://github.com/hashicorp/consul-template\" target=\"_blank\" rel=\"noopener\">consul-template</a>实现动态的配置更新，结合服务注册在一起使用可以实现自动的依赖服务配置信息更新．本来这样是很酸爽，只是这样有个缺点，也是在实践中发现的，就是配置的变更管理如果用consul来管就没有办法track变更的历史记录了，在加上SRE限制了 <code>consul UI</code> 的访问权限，很多时候上线因为开发不能直接通过UI修改，这个便利性就大打折扣了．经常会出现有新的配置没有即使同步到生产环境的情况，人工管理的成本很高，所以在系统中尝试使用后就退化成普通的文件配置（也可以track变更，因为有git的提交记录）.</p>\n<h2 id=\"手工注册和查询的痛苦\"><a href=\"#手工注册和查询的痛苦\" class=\"headerlink\" title=\"手工注册和查询的痛苦\"></a>手工注册和查询的痛苦</h2><p>因为上面提到的 <code>consul</code> 基本的功能是提供了服务信息的存储，通过它的<a href=\"https://www.consul.io/api/health.html\" target=\"_blank\" rel=\"noopener\">resulful API</a>可以很容易的将一个服务注册到 <code>consul</code> 里面，同时 <code>consul</code> 也会自动对他执行健康检查，在服务挂掉的时候从可用服务列表中可以过滤掉（一般一个服务会对应一个 <code>SLB</code> 和后面一堆的实际应用服务器）有问题的机器，保证服务的高可用．同时我们也需要在对服务进程接受到特殊信号量，比如 <code>SIGKILL</code> 的时候将服务从 <code>consul</code> 中移除，这就也需要调用API实现．虽然可以通过将注册和解注册的行为通过公共库的方式在一个地方维护，但毕竟不是那么优雅．</p>\n<p>对应的，因为是使用查询注册中心的方式来做服务发现（其实就是客户端的服务发现 smart client）,需要客户端通过调用 <code>consul</code> 的 restful API 来查询，虽然可以通过在每个服务实例上启动一个在 <code>client</code> 模式下的 <code>agent</code> 缓解集群的并发访问压力，但是还是需要客户端主动查询的，有没有更好的方式呢？</p>\n<h2 id=\"独立出注册和查询为独立服务\"><a href=\"#独立出注册和查询为独立服务\" class=\"headerlink\" title=\"独立出注册和查询为独立服务\"></a>独立出注册和查询为独立服务</h2><p>终于主角登场了，<a href=\"https://github.com/joyent/containerpilot\" target=\"_blank\" rel=\"noopener\">containerpilot</a>是大名鼎鼎的 <code>joyent</code> 公司（最早开发nodejs的公司）开源出来的一款针对容器内服务做自动注册和发现的好工具．之前我们提到，原始的服务注册和发现依赖于程序通过restful API的调用实现，这样就需要在代码中实现调用的逻辑．现在用了 <code>containerpilot</code> 再加上一些封装之后，就可以实现程序对于服务注册中心的无感知．具体情况是这样的，所有 <code>containerpilot</code> 相关的配置放在一个固定的目录下面，例如 <code>/etc/containerpilot</code>，在容器启动的时候会执行脚本从依赖关系文件（例如 <code>serviceDependencies.json</code>）中读取出下游服务列表，删除socker文件（例如 <code>/var/run/containerpilot.socket</code>），执行 <code>containerpilot</code> 的可执行文件．<code>containerpilot</code> 读取配置文件 <code>config.json5</code>，通过模板语法，在不同的条件下根据环境变量激活不同的job．这里面最重要的部分是这几个:</p>\n<ul>\n<li>启动 <code>consul</code> 的agent或者直接连接 <code>consul</code> 的cluster，将当前服务注册进去，第一次生成依赖服务的地址 <code>services.json</code></li>\n<li>在 <code>containerpilot</code> 可以跟consul的agent或者cluster通信之后，获取依赖服务的列表，通过 <code>consul-template</code> 将服务的信息渲染到预定义好的模板文件中</li>\n<li>watch在consul中依赖的服务，当检测到更新的时候给服务发送 <code>SIGHUP</code> 的信号提示服务重新读取依赖服务的最新地址 <code>services.json</code></li>\n<li>通过调用 <code>ping</code> 命令对服务进行健康检查，在服务不健康甚至是容器异常退出的时候会将 <code>consul</code> 中服务的状态标记为不可用（不会解注册）</li>\n</ul>\n<p>一个服务跟 <code>containerpilot</code> 集成的结构是这样的</p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/29651399-2dc2efc6-88d3-11e7-8f61-7b3ea551a544.png\" alt=\"untitled diagram 4\"></p>\n<h2 id=\"使用-containerpilot\"><a href=\"#使用-containerpilot\" class=\"headerlink\" title=\"使用 containerpilot\"></a>使用 containerpilot</h2><h3 id=\"概要\"><a href=\"#概要\" class=\"headerlink\" title=\"概要\"></a>概要</h3><p>首先明确两个概念：</p>\n<ul>\n<li>被托管服务，即运行在本容器内的主要进程，对外提供某种功能。</li>\n<li>依赖服务，即被托管服务所依赖的服务，通常运行在其它容器内。</li>\n</ul>\n<p>containerpilot 基于 consul 实现了如下两个功能：</p>\n<ul>\n<li>将被托管服务注册到 consul 内，并维持健康检查心跳，在容器停止时自动解注册该服务。</li>\n<li>获取依赖服务的实例地址。</li>\n</ul>\n<p>这两个功能即服务的注册和发现，可同时使用，也可只使用其中任意一个。</p>\n<p>使用服务注册功能时，或者使用服务发现功能且需要接收依赖服务实例更新信号时，被托管服务需由 containerpilot 管理，即最终服务管理结构如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- runit</span><br><span class=\"line\">    - containerpilot</span><br><span class=\"line\">        - your service</span><br></pre></td></tr></table></figure>\n<p>只使用服务发现功能且不需要接收依赖服务实例更新信号时，被托管服务可直接由 runit 管理，即最终服务管理结构如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- runit</span><br><span class=\"line\">    - containerpilot</span><br><span class=\"line\">    - your service</span><br></pre></td></tr></table></figure>\n<h3 id=\"环境变量\"><a href=\"#环境变量\" class=\"headerlink\" title=\"环境变量\"></a>环境变量</h3><p>使用 containerpilot 请按需设置以下环境变量：</p>\n<ul>\n<li><code>CONSUL_ADDR</code> ：容器内可使用该值调用 consul API ，默认值为 <code>127.0.0.1:8500</code> 。使用默认值时，会在容器内部起一个 consul client ，并根据 <code>CONSUL_JOIN_ADDR</code> 和 <code>CONSUL_ADVERTISE</code> 加入已有集群。</li>\n<li><code>CONSUL_JOIN_ADDR</code> ：已有 consul 集群中任意一个节点的 IP 地址，consul client 加入集群时使用。</li>\n<li><code>CONSUL_ADVERTISE</code> ：consul client 加入集群时使用哪个 IP 通信，需用 k8s pod IP 或 container host IP。</li>\n<li><code>SERVICE_NAME</code> ：注册到 consul 中被托管服务名称，ID 会自动设置为 <code>${SERVICE_NAME}-${CONTAINER_HOSTNAME}</code> 。可以从外部传入或内部写死。此外，如果存在环境变量 <code>CONSUL_PREFIX</code> ，其值将会被拼到服务名称和 ID 前面。默认值为 <code>main</code> 。</li>\n<li><code>SERVICE_PORT</code> ：注册到 consul 中被托管服务端口。不传则不注册服务到 consul 。</li>\n<li><code>SERVICE_COMMAND</code> ：启动被托管服务的命令和参数，不传递则不启动。</li>\n<li><code>SERVICE_INTERFACE</code> ：注册到 consul 中被托管服务地址，可选网卡名如 <code>eth0</code> 或静态地址 <code>static:192.168.1.100</code> ，默认值为 <code>eth0</code> 。</li>\n<li><code>SERVICE_SIGNAL_CHANGED</code> ：当依赖服务实例发生变化时，是否给被托管服务发送 <code>SIGHUP</code> ，传值代表发送。</li>\n</ul>\n<h3 id=\"获取依赖服务的实例地址\"><a href=\"#获取依赖服务的实例地址\" class=\"headerlink\" title=\"获取依赖服务的实例地址\"></a>获取依赖服务的实例地址</h3><p>被托管服务如果依赖于其他服务，需在项目中添加 <code>serviceDependencies.json</code> 文件，构建 docker 镜像时把这个文件复制到 WORKDIR 下，示例如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"service1\"</span>: [<span class=\"string\">\"service2\"</span>, <span class=\"string\">\"service3\"</span>],</span><br><span class=\"line\">  <span class=\"attr\">\"service2\"</span>: [<span class=\"string\">\"service4\"</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>表示 <code>service1</code> 依赖于 <code>service2</code> 和 <code>service3</code> ，而 <code>service2</code> 依赖于 <code>service4</code> ，即 key 为被托管的服务名，value 为该服务的依赖列表。</p>\n<p>对于不使用服务注册，只需要服务发现的情况，可以使用 <code>SERVICE_NAME</code> 的默认值 <code>main</code> 作为 key，示例如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"main\"</span>: [<span class=\"string\">\"service2\"</span>, <span class=\"string\">\"service3\"</span>],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>containerpilot 会根据 <code>SERVICE_NAME</code> 选取需要监控的依赖服务，比如设置 <code>SERVICE_NAME</code> 为 <code>service1</code> ，则将监控 <code>service2</code> 和 <code>service3</code>，当依赖服务实例发生变化时，会更新 <code>/etc/containerpilot/services.json</code> ，生成的内容示例如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"service2\"</span>: [</span><br><span class=\"line\">    <span class=\"string\">\"1.1.1.1:80\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"2.2.2.2:80\"</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">\"service3\"</span>: [</span><br><span class=\"line\">    <span class=\"string\">\"3.3.3.3:80\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"4.4.4.4:80\"</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中 key 为依赖的服务名，value 为该服务的实例地址数组。</p>\n<p>被托管服务要获取该文件的更新可通过如下方式：</p>\n<ul>\n<li>golang 、java 这种 long running 的，需要托管于 containerpilot ，然后设置环境变量 <code>SERVICES_SIGNAL_CHANGED</code> ，然后代码中处理 <code>SIGHUP</code> 信号，收到信号时重新读取该文件。</li>\n<li>php 这种不好处理信号的，可以每次处理请求时都重新读取该文件。</li>\n</ul>\n<h3 id=\"启动-containerpilot\"><a href=\"#启动-containerpilot\" class=\"headerlink\" title=\"启动 containerpilot\"></a>启动 containerpilot</h3><p>containerpilot 应作为 runit service 启动，示例 <code>run</code> 脚本如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 假设外部已传入 CONSUL_JOIN_ADDR 环境变量</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 假设运行在 k8s 上，则 CONSUL_ADVERTISE 使用默认值即可</span></span><br><span class=\"line\">export SERVICE_NAME=\"test\"</span><br><span class=\"line\">export SERVICE_PORT=80</span><br><span class=\"line\">export SERVICE_COMMAND=\"myservice args\"</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> containerpilot 默认使用健康检查命令 ./ping ，即需要把 ping 文件放在  WORKDIR 下，并在启动 containerpilot 前切换到 WORKDIR</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> WORKDIR 默认为 /</span></span><br><span class=\"line\">cd /</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 启动 containerpilot</span></span><br><span class=\"line\">exec /etc/containerpilot/containerpilot.sh</span><br></pre></td></tr></table></figure>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://github.com/joyent/containerpilot\" target=\"_blank\" rel=\"noopener\">https://github.com/joyent/containerpilot</a></li>\n<li><a href=\"https://www.joyent.com/blog/applications-on-autopilot\" target=\"_blank\" rel=\"noopener\">https://www.joyent.com/blog/applications-on-autopilot</a></li>\n<li><a href=\"http://www.jianshu.com/p/c144a577f3d1\" target=\"_blank\" rel=\"noopener\">http://www.jianshu.com/p/c144a577f3d1</a></li>\n</ul>\n","categories":[],"tags":["architecture","backend","microservice"]},{"title":"前端的数据和状态管理","url":"https://vincenthou.github.io/2017/06/18/前端的数据和状态管理/","content":"<h1 id=\"两个方向\"><a href=\"#两个方向\" class=\"headerlink\" title=\"两个方向\"></a>两个方向</h1><ul>\n<li>Immutable</li>\n<li>Observable</li>\n</ul>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://blog.daocloud.io/edu170831\" target=\"_blank\" rel=\"noopener\">基于 RxJs 的前端数据层实践</a></li>\n<li><a href=\"http://www.alloyteam.com/2016/12/learn-rxjs/\" target=\"_blank\" rel=\"noopener\">构建流式应用—RxJS详解</a></li>\n<li><a href=\"https://fanmingfei.com/posts/What_is_Transducer.html\" target=\"_blank\" rel=\"noopener\">什么是 Transducer</a></li>\n</ul>\n","categories":[],"tags":["blog","frontend","architecture","todo"]},{"title":"【翻译】有帮助的柯里化","url":"https://vincenthou.github.io/2017/06/17/【翻译】有帮助的柯里化/","content":"<p>原文<a href=\"http://fr.umio.us/favoring-curry/\" target=\"_blank\" rel=\"noopener\">地址</a>，译文如下</p>\n<h1 id=\"有帮助的curry\"><a href=\"#有帮助的curry\" class=\"headerlink\" title=\"有帮助的curry\"></a>有帮助的curry</h1><p>我最近使用<a href=\"https://github.com/ramda/ramda\" target=\"_blank\" rel=\"noopener\">Ramda</a>实现函数式组合的<a href=\"http://fr.umio.us/why-ramda/\" target=\"_blank\" rel=\"noopener\">文章</a>涉及到一个重要的主题。为了使用Ramda的方式做某种组合，我们需要这些方法被柯里化。</p>\n<p>柯里化是啥，能吃吗？</p>\n<p>实际上，<code>柯里化</code> 是从 Haskell 来的。Haskell是第一个研究这种技术的。（是的，他们用自己的名字命名了一个函数式编程语言。不仅如此，Curry的中间初始是<code>B</code>，或者当然代表的是<a href=\"http://en.wikipedia.org/wiki/Brainfuck\" target=\"_blank\" rel=\"noopener\">Brainf*ck</a>）</p>\n<p>柯里化是这么一个过程，它一个本来需要多个参数的方法转化为这样一种方法，这个方法在传递更少参数之后，返回一个新方法，返回的这个新方法会等待获取余下的参数。</p>\n<p>基本的例子看起来像这样，这是一个普通的函数:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 没有柯里化的版本</span><br><span class=\"line\"></span><br><span class=\"line\">var formatName1 = function(first, middle, last) &#123;</span><br><span class=\"line\">  return first + middle + &apos; &apos; + last;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">formatName1(&apos;John&apos;, &apos;Paul&apos;, &apos;Jones&apos;);</span><br><span class=\"line\">// =&gt; &apos;John Paul Jones&apos; // (呃, 是音乐家或者海军上将?)</span><br><span class=\"line\"></span><br><span class=\"line\">formatName1(&apos;John&apos;, &apos;Paul&apos;)</span><br><span class=\"line\"></span><br><span class=\"line\">// =&gt; &apos;John Paul undefined&apos;</span><br></pre></td></tr></table></figure>\n<p>但是一个柯里化的版本就更加有用了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 柯里化的版本</span><br><span class=\"line\">var formatName2 = R.curry(function(first, middle, last) &#123;</span><br><span class=\"line\">  return first + &apos; &apos; + middel + &apos; &apos; + last;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">formatName2(&apos;John&apos;, &apos;Paul&apos;, &apos;Jones&apos;);</span><br><span class=\"line\">// =&gt; &apos;John Paul Jones&apos; (肯定是个音乐家)</span><br><span class=\"line\"></span><br><span class=\"line\">var jp = formatName2(&apos;John&apos;, &apos;Paul&apos;);</span><br><span class=\"line\">// =&gt; 返回一个方法</span><br><span class=\"line\"></span><br><span class=\"line\">jp(&apos;Jones&apos;);</span><br><span class=\"line\">// =&gt; &apos;John Paul Jones&apos; (maybe this one&apos;s the admiral)</span><br><span class=\"line\"></span><br><span class=\"line\">jp(&apos;Stevens&apos;);</span><br><span class=\"line\">//=&gt; &apos;John Paul Stevens&apos; (the Supreme Court Justice)</span><br><span class=\"line\"></span><br><span class=\"line\">jp(&apos;Pontiff&apos;);</span><br><span class=\"line\">//=&gt; &apos;John Paul Pontiff&apos; (ok, so I cheated.)</span><br><span class=\"line\"></span><br><span class=\"line\">jp(&apos;Ziller&apos;);</span><br><span class=\"line\">//=&gt; &apos;John Paul Ziller&apos; (magician, a wee bit fictional)</span><br><span class=\"line\"></span><br><span class=\"line\">jp(&apos;Georgeandringo&apos;);</span><br><span class=\"line\">//=&gt; &apos;John Paul Georgeandringo&apos; (rockers)</span><br></pre></td></tr></table></figure>\n<p>或者</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&apos;Jones&apos;, &apos;Stevens&apos;, &apos;Eiller&apos;].map(jp);</span><br><span class=\"line\">//=&gt; [&apos;John Paul Jones&apos;, &apos;John Paul Stevens&apos;, &apos;John Paul Ziller&apos;]</span><br></pre></td></tr></table></figure>\n<p>你也可以在多次这样传递</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var james = formatName2(&apos;James&apos;);</span><br><span class=\"line\">// =&gt; return a function</span><br><span class=\"line\"></span><br><span class=\"line\">james(&apos;Byron&apos;, &apos;Dean&apos;);</span><br><span class=\"line\">// =&gt; &apos;James Byron Dean&apos;(rebel)</span><br><span class=\"line\"></span><br><span class=\"line\">var je = james(&apos;Earl&apos;);</span><br><span class=\"line\">// 也会返回一个方法</span><br><span class=\"line\">je(&apos;Carter&apos;);</span><br><span class=\"line\">// =&gt; &apos;James Earl Carter&apos;(president)</span><br><span class=\"line\">je(&apos;Jones&apos;);</span><br><span class=\"line\">// =&gt; &apos;James Earl Jones&apos; (actor, Vader)</span><br></pre></td></tr></table></figure>\n<p>有些人会认为我们在做的应该叫”部分应用”更加合适，并且”柯里化”应该只是用在这种情况：返回的方法只接收一个参数，其他每个参数都使用一个独立的新方法处理直到所有必须的参数都被提供。这些人可以继续这样迷信（意译）。</p>\n<p><strong>补充:</strong> 其实这里就是使用闭包给方法绑定了数据，通过返回的函数在之后的调用中复用之前绑定的数据。这里使用的例子是一个经典的场景，叫做 <code>惰性求值</code>。</p>\n<h1 id=\"无聊-对我有什么帮助吗？\"><a href=\"#无聊-对我有什么帮助吗？\" class=\"headerlink\" title=\"无聊!对我有什么帮助吗？\"></a>无聊!对我有什么帮助吗？</h1><p>下面是个更有意义的例子。如果你想求一个数字集合的和，你可以这么做：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 普通JS</span><br><span class=\"line\">var add = function(a, b) &#123;return a + b;&#125;;</span><br><span class=\"line\">var numbers = [1, 2, 3, 4, 5];</span><br><span class=\"line\">var sum = numbers.reduce(add, 0); // =&gt; 15</span><br></pre></td></tr></table></figure>\n<p>如果你想写一个通用的函数来计算数字列表的总数，你可能会这么写：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var total = function(list) &#123;</span><br><span class=\"line\">  return list.reduce(add, 0);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">var sum = total(numbers); // =&gt; 15</span><br></pre></td></tr></table></figure>\n<p>在 Ramda里面, <code>total</code> 和 <code>sum</code> 非常相似。亦可以这样定义 <code>sum</code>:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var sum = R.reduce(add, 0, numbers); // =&gt; 15</span><br></pre></td></tr></table></figure>\n<p>但是因为 <code>reduce</code> 是一个柯里化过的方法，但你不传最后一个参数的时候，就像在上面你自己定义的 <code>total</code> 函数一样:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 在 Ramda 里</span><br><span class=\"line\">var total = R.reduce(add, 0); // 返回一个柯里化之后的方法</span><br></pre></td></tr></table></figure>\n<p>你仅仅拿到一个方法你可以这样调用:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var sum = total(numbers); // =&gt; 15</span><br></pre></td></tr></table></figure>\n<p>再次注意方法的定义和方法应用于数据上是多么相似</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var total = R.reduce(add, 0); // =&gt; function</span><br><span class=\"line\">var sum = R.reduce(add, 0, numbers); // =&gt; 15</span><br></pre></td></tr></table></figure>\n<h1 id=\"不在乎：我又不是个数学极客\"><a href=\"#不在乎：我又不是个数学极客\" class=\"headerlink\" title=\"不在乎：我又不是个数学极客\"></a>不在乎：我又不是个数学极客</h1><p>所以你是一个web开发，是吧？你需要发一个AJAX请求到服务器？你需要使用 <a href=\"http://promises-aplus.github.io/promises-spec/\" target=\"_blank\" rel=\"noopener\">Promise</a>？（起码我希望是这样）你需要操作返回的数据，过滤它，取得子集？或者你做服务器端开发？你异步查询SQL数据库，并且操作这些结果？</p>\n<p>我能建议你做的最好的事情是你可以看看前端开发专家Jackson的精彩文章 <a href=\"http://hughfdjackson.com/javascript/why-curry-helps/\" target=\"_blank\" rel=\"noopener\">为什么柯里化有帮助？</a>。这是我看过最精彩的文章。如果你是个通过视频学习者，花半个小时看下Dr. Boolean的视频 <a href=\"http://www.youtube.com/watch?v=m3svKOdZijA\" target=\"_blank\" rel=\"noopener\">Underscore，你做错了</a>（不要在意标题，他没有花费他多时间实际吐槽工具库）。</p>\n<p>真的去做。看看这些，它们解释得比我好，你已经看出来我多啰嗦了，巴拉巴拉。如果你已经看过这些，你可以跳过余下的章节。他们已经比我说得更好了。</p>\n<p>该说的我都说了。</p>\n<hr>\n<p>想象我们要获取像下面这样的数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var data = &#123;</span><br><span class=\"line\">    result: &quot;SUCCESS&quot;,</span><br><span class=\"line\">    interfaceVersion: &quot;1.0.3&quot;,</span><br><span class=\"line\">    requested: &quot;10/17/2013 15:31:20&quot;,</span><br><span class=\"line\">    lastUpdated: &quot;10/16/2013 10:52:39&quot;,</span><br><span class=\"line\">    tasks: [</span><br><span class=\"line\">        &#123;id: 104, complete: false,            priority: &quot;high&quot;,</span><br><span class=\"line\">                  dueDate: &quot;2013-11-29&quot;,      username: &quot;Scott&quot;,</span><br><span class=\"line\">                  title: &quot;Do something&quot;,      created: &quot;9/22/2013&quot;&#125;,</span><br><span class=\"line\">        &#123;id: 105, complete: false,            priority: &quot;medium&quot;,</span><br><span class=\"line\">                  dueDate: &quot;2013-11-22&quot;,      username: &quot;Lena&quot;,</span><br><span class=\"line\">                  title: &quot;Do something else&quot;, created: &quot;9/22/2013&quot;&#125;,</span><br><span class=\"line\">        &#123;id: 107, complete: true,             priority: &quot;high&quot;,</span><br><span class=\"line\">                  dueDate: &quot;2013-11-22&quot;,      username: &quot;Mike&quot;,</span><br><span class=\"line\">                  title: &quot;Fix the foo&quot;,       created: &quot;9/22/2013&quot;&#125;,</span><br><span class=\"line\">        &#123;id: 108, complete: false,            priority: &quot;low&quot;,</span><br><span class=\"line\">                  dueDate: &quot;2013-11-15&quot;,      username: &quot;Punam&quot;,</span><br><span class=\"line\">                  title: &quot;Adjust the bar&quot;,    created: &quot;9/25/2013&quot;&#125;,</span><br><span class=\"line\">        &#123;id: 110, complete: false,            priority: &quot;medium&quot;,</span><br><span class=\"line\">                  dueDate: &quot;2013-11-15&quot;,      username: &quot;Scott&quot;,</span><br><span class=\"line\">                  title: &quot;Rename everything&quot;, created: &quot;10/2/2013&quot;&#125;,</span><br><span class=\"line\">        &#123;id: 112, complete: true,             priority: &quot;high&quot;,</span><br><span class=\"line\">                  dueDate: &quot;2013-11-27&quot;,      username: &quot;Lena&quot;,</span><br><span class=\"line\">                  title: &quot;Alter all quuxes&quot;,  created: &quot;10/5/2013&quot;&#125;</span><br><span class=\"line\">        // , ...</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>并且我们需要一个方法 <code>getIncompleteTaskSummaries</code> 接收一个 <code>membername</code> 参数，然后从服务器（后者其他地方）获取数据，选择没有完成的会员，返回他们的ids，priorities, titles和due dates，根据due date排序。实际上，它返回一个应该在排序列表里面resolve的Promise。</p>\n<p>如果你传递 “Scott” 给 <code>getIncompleteTaskSummaries</code>，它可能会返回</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;id: 110, title: &quot;Rename everything&quot;,</span><br><span class=\"line\">        dueDate: &quot;2013-11-15&quot;, priority: &quot;medium&quot;&#125;,</span><br><span class=\"line\">    &#123;id: 104, title: &quot;Do something&quot;,</span><br><span class=\"line\">        dueDate: &quot;2013-11-29&quot;, priority: &quot;high&quot;&#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>好啦，我们开始，下面的code看起来熟悉吗？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getIncompleteTaskSummaries = function(membername) &#123;</span><br><span class=\"line\">    return fetchData()</span><br><span class=\"line\">        .then(function(data) &#123;</span><br><span class=\"line\">            return data.tasks;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .then(function(tasks) &#123;</span><br><span class=\"line\">            var results = [];</span><br><span class=\"line\">            for (var i = 0, len = tasks.length; i &lt; len; i++) &#123;</span><br><span class=\"line\">                if (tasks[i].username == membername) &#123;</span><br><span class=\"line\">                    results.push(tasks[i]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            return results;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .then(function(tasks) &#123;</span><br><span class=\"line\">            var results = [];</span><br><span class=\"line\">            for (var i = 0, len = tasks.length; i &lt; len; i++) &#123;</span><br><span class=\"line\">                if (!tasks[i].complete) &#123;</span><br><span class=\"line\">                    results.push(tasks[i]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            return results;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .then(function(tasks) &#123;</span><br><span class=\"line\">            var results = [], task;</span><br><span class=\"line\">            for (var i = 0, len = tasks.length; i &lt; len; i++) &#123;</span><br><span class=\"line\">                task = tasks[i];</span><br><span class=\"line\">                results.push(&#123;</span><br><span class=\"line\">                    id: task.id,</span><br><span class=\"line\">                    dueDate: task.dueDate,</span><br><span class=\"line\">                    title: task.title,</span><br><span class=\"line\">                    priority: task.priority</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            return results;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .then(function(tasks) &#123;</span><br><span class=\"line\">            tasks.sort(function(first, second) &#123;</span><br><span class=\"line\">                var a = first.dueDate, b = second.dueDate;</span><br><span class=\"line\">                return a &lt; b ? -1 : a &gt; b ? 1 : 0;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            return tasks;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>如果代码看起来像下面这样是不是更美妙？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var getIncompleteTaskSummaries = function(membername) &#123;</span><br><span class=\"line\">    return fetchData()</span><br><span class=\"line\">        .then(R.get(&apos;tasks&apos;))</span><br><span class=\"line\">        .then(R.filter(R.propEq(&apos;username&apos;, membername)))</span><br><span class=\"line\">        .then(R.reject(R.propEq(&apos;complete&apos;, true)))</span><br><span class=\"line\">        .then(R.map(R.pick([&apos;id&apos;, &apos;dueDate&apos;, &apos;title&apos;, &apos;priority&apos;])))</span><br><span class=\"line\">        .then(R.sortBy(R.get(&apos;dueDate&apos;)));</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>如果这样，那么柯里化会很适合你 。所有在这个代码块中提到的Ramda方法都被柯里化了。（实际上，所有超过一个参数的Ramda方法都被柯里化了，只有一些必要的例外。）在所有的情况下，柯里化让组合这些方法到一个优雅的块中变得简单。</p>\n<p>让我们看看发生了什么。</p>\n<p><code>get</code> （也用 <code>prop</code>）是这样定义的:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ramda.get = curry(function(name, obj) &#123;</span><br><span class=\"line\">  return obj[name];</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>但是当我们像上面一样调用它，我们只是给了第一个参数 <code>name</code>，正如我们讨论的，这意味着我们会得到一个等待通过第一个then方法传递obj参数的方法，就是下面这样</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.then(R.get(&apos;tasks&apos;))</span><br></pre></td></tr></table></figure>\n<p>可以认为是下面的简化写法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.then(function(data) &#123;</span><br><span class=\"line\">  return data.tasks;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>下面是 <code>propEq</code>，被定义为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ramda.propEq = curry(function(name, val, obj) &#123;</span><br><span class=\"line\">  return obj[name] === val;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>所以当我们通过 <code>username</code> 和 <code>membername</code> 调用它的时候（后面的参数被作为参数传递给我们的方法），柯里化给我们返回了一个新方法，等价于</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">funciton(obj) &#123;</span><br><span class=\"line\">  return obj[&apos;username&apos;] === membername;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>membername</code>的值被绑定为传给我们的值。</p>\n<p>这个方法之后被传给 <code>filter</code>。</p>\n<p>Ramda的 <code>filter</code> 方法就像在 <code>Array.prototype</code> 上的原生filter方法，但是函数签名是</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ramda.filter = curry(function(predicate, list) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>所以我们已经柯里化过了，只需要传递 <code>predicate</code> 参数，并且前一步的tasks列表不需要。（我告诉过你所有的东西已经被柯里化了，没有吗？）</p>\n<p>我们对于 <code>propEq(&#39;complete&#39;, true) -&gt; reject</code> 跟 <code>propEq(&#39;username&#39;, membername) -&gt;</code> 做了同样的事情。<code>filter.Reject</code> 跟 <code>filter</code> 是一样的，除了它会反转语义。它只保留哪些 <code>predicate</code> 返回 <code>false</code>的值。</p>\n<p>好了，你还在读吗？我们手指都累了。（真的要学学touch-type了）你真的不需要我来解释最后两行了，对吧？真的？你确定？好吧，好吧！是的！…是的，我说过我会的！</p>\n<p>所以接下来我们看</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">R.pick([&apos;id&apos;, &apos;dueDate&apos;, &apos;title&apos;, &apos;priority&apos;])</span><br></pre></td></tr></table></figure>\n<p><code>pick</code> 接收一个属性名数组和一个对象，并且返回一个新的对象，这个对象会把原来的属性拷贝过来。因为我们只传递了属性名，我们只要给它传递一个对象，就能得到一个会返回新对象的方法。这个方法被传递给 <code>R.map</code> 函数。跟 <code>filter</code> 一样，跟原生方法的版本工作方式相同，但是函数签名不同：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ramda.map = curry(function(fn, list) &#123; /* ... */ &#125;);</span><br></pre></td></tr></table></figure>\n<p>这里再多嘴一下 – 我已经说过我很乏味 – 这个方法已经柯里化过了，因为我们只是传递了 <code>pick</code> 函数（柯里化后）的输出，而不是列表，<code>then</code> 会调用使用tasks列表调用这个方法。</p>\n<p>好啦，记得坐在学校教室等待下课？钟表上的分针卡住了，秒针像是被糖蜜粘住了吗？老师成天唠叨一遍又一遍同样的事情。还记得吗？然后也许就是两分钟要结束前那一刻，结束尽在眼前：哈利路亚！我想这个例子完了之后我们就到了，就剩这个了：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.then(R.sortBy(R.get(&apos;dueDate&apos;)));</span><br></pre></td></tr></table></figure>\n<p>我们已经说过 <code>get</code> 方法了．就像这样柯里化之后，它返回一个方法，这个方法接受一个对象并且返回 <code>dueDate</code> 属性．我们把它传递给 <code>sortBy</code> 方法，这个方法接收一个列表并且基于方法返回值对这个列表元素排序．但是，等等，我们没有列表，对吧？当然没有，我们又柯里化了．但是当我们被 <code>.then()</code> 方法调用的时候，它会接收这个列表，把每个对象传递给 <code>get</code> 方法并且基于结果排序．</p>\n<h1 id=\"所以柯里化有多重要？\"><a href=\"#所以柯里化有多重要？\" class=\"headerlink\" title=\"所以柯里化有多重要？\"></a>所以柯里化有多重要？</h1><p>这个例子展示了 <code>Ramda</code> 的工具方法跟 <code>Ramda</code> 柯里化版本．也许柯里化并没有那么重要．让我们来在没有柯里化的情况下重写:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var getIncompleteTaskSummaries = function(membername) &#123;</span><br><span class=\"line\">    return fetchData()</span><br><span class=\"line\">        .then(function(data) &#123;</span><br><span class=\"line\">            return R.get(&apos;tasks&apos;, data)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .then(function(tasks) &#123;</span><br><span class=\"line\">            return R.filter(function(task) &#123;</span><br><span class=\"line\">                return R.propEq(&apos;username&apos;, membername, task)</span><br><span class=\"line\">            &#125;, tasks)</span><br><span class=\"line\">         &#125;)</span><br><span class=\"line\">        .then(function(tasks) &#123;</span><br><span class=\"line\">            return R.reject(function(task) &#123;</span><br><span class=\"line\">                return R.propEq(&apos;complete&apos;, true, task);</span><br><span class=\"line\">            &#125;, tasks)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .then(function(tasks) &#123;</span><br><span class=\"line\">            return R.map(function(task) &#123;</span><br><span class=\"line\">                return R.pick([&apos;id&apos;, &apos;dueDate&apos;, &apos;title&apos;, &apos;priority&apos;], task);</span><br><span class=\"line\">            &#125;, tasks);</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .then(function(abbreviatedTasks) &#123;</span><br><span class=\"line\">            return R.sortBy(function(abbrTask) &#123;</span><br><span class=\"line\">                return R.get(&apos;dueDate&apos;, abbrTask);</span><br><span class=\"line\">            &#125;, abbreviatedTasks);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>我想其实是等价的．它也比原始的代码要好．<code>Ramda</code> 的工具方法有些，额，功用，甚至在柯里化的版本中．但是我不认为它比下面的版本可读性更好:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var getIncompleteTaskSummaries = function(membername) &#123;</span><br><span class=\"line\">    return fetchData()</span><br><span class=\"line\">        .then(R.get(&apos;tasks&apos;))</span><br><span class=\"line\">        .then(R.filter(R.propEq(&apos;username&apos;, membername)))</span><br><span class=\"line\">        .then(R.reject(R.propEq(&apos;complete&apos;, true)))</span><br><span class=\"line\">        .then(R.map(R.pick([&apos;id&apos;, &apos;dueDate&apos;, &apos;title&apos;, &apos;priority&apos;])))</span><br><span class=\"line\">        .then(R.sortBy(R.get(&apos;dueDate&apos;)));</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>所以这就是我们柯里化的原因．</p>\n<hr>\n<p>到这里课程结束了．</p>\n<p>我确实警告过你．</p>\n<p>下次，当我告诉你读其他人的文章而不是我的的时候，你要注意了，对吧？跟我写的比这些都有些过时了，但是他们仍然写得很好，并且你可以看看:</p>\n<ul>\n<li><a href=\"http://hughfdjackson.com/javascript/why-curry-helps/\" target=\"_blank\" rel=\"noopener\">为什么柯里化有帮助</a>, Hugh FD Jackson</li>\n<li><a href=\"http://www.youtube.com/watch?v=m3svKOdZijA\" target=\"_blank\" rel=\"noopener\">Underscore，你做错了</a>, Dr. Boolean, aka Brian Lonsdorf</li>\n</ul>\n<p>有个新的，我今天才看到．我们会看到它是否能够经受起时间的检验，但是当下它值得一读:</p>\n<ul>\n<li><a href=\"https://glebbahmutov.com/blog/put-callback-first-for-elegance/\" target=\"_blank\" rel=\"noopener\">为了优雅重视回调</a>, Gleb Bahmutov</li>\n</ul>\n<h1 id=\"一个小秘密\"><a href=\"#一个小秘密\" class=\"headerlink\" title=\"一个小秘密\"></a>一个小秘密</h1><p>柯里化的确很强大，但是不足以让你的代码优雅．</p>\n<p>有三个重要的元素:</p>\n<ul>\n<li><a href=\"http://fr.umio.us/why-ramda/\" target=\"_blank\" rel=\"noopener\">之前</a>我谈过函数组合．这在你把所有美妙的想法组装在一起而不想写丑陋的胶水代码时非常必要．</li>\n<li><strong>柯里化</strong> 很有用，既因为它需要支持组合，同时因为它把大量的样板代码去除了，正如你上面看到的．</li>\n<li>一组工具方法操作有用的数据结构，例如对象列表．</li>\n</ul>\n<p><a href=\"https://github.com/ramda/ramda\" target=\"_blank\" rel=\"noopener\">Ramda</a> 其中一个目标就是要通过方便的包装来提供所有这些．</p>\n","categories":[],"tags":["javascript","translation"]},{"title":"ES6编程cheat sheet","url":"https://vincenthou.github.io/2017/01/24/ES6编程cheat-sheet/","content":"<p>原文查看<a href=\"https://github.com/DrkSephy/es6-cheatsheet/blob/master/README_zhCn.md\" target=\"_blank\" rel=\"noopener\">这里</a>，根据最近的使用在原文基础上扩展了一些有用的技巧。</p>\n<h1 id=\"es6-cheatsheet\"><a href=\"#es6-cheatsheet\" class=\"headerlink\" title=\"es6-cheatsheet\"></a>es6-cheatsheet</h1><p>这是一个 ES2015(ES6) 的Cheatsheet，其中包括提示、小技巧、最佳实践和一些代码片段，帮助你<br>完成日复一日的开发工作。</p>\n<h2 id=\"Table-of-Contents\"><a href=\"#Table-of-Contents\" class=\"headerlink\" title=\"Table of Contents\"></a>Table of Contents</h2><ul>\n<li><a href=\"#var-versus-let--const\">var 与 let / const 声明</a></li>\n<li><a href=\"#replacing-iifes-with-blocks\">代码执行块替换立即执行函数</a></li>\n<li><a href=\"#arrow-functions\">箭头函数</a></li>\n<li><a href=\"#strings\">字符串</a></li>\n<li><a href=\"#destructuring\">解构</a></li>\n<li><a href=\"#modules\">模块</a></li>\n<li><a href=\"#parameters\">参数</a></li>\n<li><a href=\"#classes\">类</a></li>\n<li><a href=\"#symbols\">Symbols</a></li>\n<li><a href=\"#maps\">Maps</a></li>\n<li><a href=\"#weakmaps\">WeakMaps</a></li>\n<li><a href=\"#promises\">Promises</a></li>\n<li><a href=\"#generators\">Generators</a></li>\n<li><a href=\"#async-await\">Async Await</a></li>\n</ul>\n<h2 id=\"var-versus-let-const\"><a href=\"#var-versus-let-const\" class=\"headerlink\" title=\"var versus let / const\"></a>var versus let / const</h2><blockquote>\n<p>除了 <code>var</code> 以外，我们现在多了两个新的标识符来声明变量的存储，它们就是 <code>let</code> 和 <code>const</code>。<br>不同于 <code>var</code> ，<code>let</code> 和 <code>const</code> 语句不会造成声明提升。</p>\n</blockquote>\n<p>一个 <code>var</code> 的例子:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> snack = <span class=\"string\">'Meow Mix'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFood</span>(<span class=\"params\">food</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (food) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> snack = <span class=\"string\">'Friskies'</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> snack;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> snack;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">getFood(<span class=\"literal\">false</span>); <span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure>\n<p>让我们再观察下面语句中，使用 <code>let</code> 替换了 <code>var</code> 后的表现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> snack = <span class=\"string\">'Meow Mix'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFood</span>(<span class=\"params\">food</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (food) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> snack = <span class=\"string\">'Friskies'</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> snack;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> snack;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">getFood(<span class=\"literal\">false</span>); <span class=\"comment\">// 'Meow Mix'</span></span><br></pre></td></tr></table></figure>\n<p>当我们重构使用 <code>var</code> 的老代码时，一定要注意这种变化。盲目使用 <code>let</code> 替换 <code>var</code> 后可能会导致预期意外的结果。</p>\n<blockquote>\n<p><strong>注意</strong>：<code>let</code> 和 <code>const</code> 是块级作用域语句。所以在语句块以外引用这些变量时，会造成引用错误 <code>ReferenceError</code>。</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(x);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> x = <span class=\"string\">'hi'</span>; <span class=\"comment\">// ReferenceError: x is not defined</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>最佳实践</strong>: 在重构老代码时，<code>var</code> 声明需要格外的注意。在创建一个新项目时，使用 <code>let</code> 声明一个变量，使用 <code>const</code> 来声明一个不可改变的常量。</p>\n</blockquote>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Replacing-IIFEs-with-Blocks\"><a href=\"#Replacing-IIFEs-with-Blocks\" class=\"headerlink\" title=\"Replacing IIFEs with Blocks\"></a>Replacing IIFEs with Blocks</h2><p>我们以往创建一个 <strong>立即执行函数</strong> 时，一般是在函数最外层包裹一层括号。<br>ES6支持块级作用域（更贴近其他语言），我们现在可以通过创建一个代码块（Block）来实现，不必通过创建一个函数来实现，</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> food = <span class=\"string\">'Meow Mix'</span>;</span><br><span class=\"line\">&#125;());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(food); <span class=\"comment\">// Reference Error</span></span><br></pre></td></tr></table></figure>\n<p>使用支持块级作用域的ES6的版本：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> food = <span class=\"string\">'Meow Mix'</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(food); <span class=\"comment\">// Reference Error</span></span><br></pre></td></tr></table></figure>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Arrow-Functions\"><a href=\"#Arrow-Functions\" class=\"headerlink\" title=\"Arrow Functions\"></a>Arrow Functions</h2><p>一些时候，我们在函数嵌套中需要访问上下文中的 <code>this</code>。比如下面的例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Person.prototype.prefixName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">character</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.name + character; <span class=\"comment\">// Cannot read property 'name' of undefined</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>一种通用的方式是把上下文中的 <code>this</code> 保存在一个变量里：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Person.prototype.prefixName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// Store the context of this</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">character</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> that.name + character;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>我们也可以把 <code>this</code> 通过属性传进去：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Person.prototype.prefixName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">character</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.name + character;</span><br><span class=\"line\">    &#125;, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>还可以直接使用 <code>bind</code>：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Person.prototype.prefixName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">character</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.name + character;</span><br><span class=\"line\">    &#125;.bind(<span class=\"keyword\">this</span>));</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>使用 <strong>箭头函数</strong>，<code>this</code> 的值不用我们再做如上几段代码的特殊处理，直接使用即可。<br>上面的代码可以重写为下面这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Person.prototype.prefixName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.map(<span class=\"function\"><span class=\"params\">character</span> =&gt;</span> <span class=\"keyword\">this</span>.name + character);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>最佳实践</strong>：使用箭头函数，再也不用考虑 <code>this</code> 的问题了。</p>\n</blockquote>\n<p>当我们编写只返回一个表达式值的简单函数时，也可以使用箭头函数，如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> squares = arr.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x</span>) </span>&#123; <span class=\"keyword\">return</span> x * x &#125;); <span class=\"comment\">// Function Expression</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">const</span> squares = arr.map(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> x * x); <span class=\"comment\">// Arrow Function for terser implementation</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>最佳实践</strong>：尽可能地多使用 <strong>箭头函数</strong>。</p>\n</blockquote>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Strings\"><a href=\"#Strings\" class=\"headerlink\" title=\"Strings\"></a>Strings</h2><p>在ES6中，标准库也被同样增强了，像字符串对象就新增了 <code>.includes()</code> 和 <code>.repeat()</code> 方法。</p>\n<h3 id=\"includes\"><a href=\"#includes\" class=\"headerlink\" title=\".includes( )\"></a>.includes( )</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> string = <span class=\"string\">'food'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> substring = <span class=\"string\">'foo'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(string.indexOf(substring) &gt; <span class=\"number\">-1</span>);</span><br></pre></td></tr></table></figure>\n<p>现在，我们可以使用 <code>.inclues()</code> 方法，替代以往判断内容 <code>&gt; -1</code> 的方式。<br><code>.includes()</code> 方法会极简地返回一个布尔值结果。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> string = <span class=\"string\">'food'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> substring = <span class=\"string\">'foo'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(string.includes(substring)); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"repeat\"><a href=\"#repeat\" class=\"headerlink\" title=\".repeat( )\"></a>.repeat( )</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">repeat</span>(<span class=\"params\">string, count</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> strings = [];</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(strings.length &lt; count) &#123;</span><br><span class=\"line\">        strings.push(string);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strings.join(<span class=\"string\">''</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在ES6中，我们可以使用一个极简的方法来实现重复字符：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// String.repeat(numberOfRepetitions)</span></span><br><span class=\"line\"><span class=\"string\">'meow'</span>.repeat(<span class=\"number\">3</span>); <span class=\"comment\">// 'meowmeowmeow'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Template-Literals\"><a href=\"#Template-Literals\" class=\"headerlink\" title=\"Template Literals\"></a>Template Literals</h3><p>使用 <strong>字符串模板字面量</strong>，我可以在字符串中直接使用特殊字符，而不用转义。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> text = <span class=\"string\">\"This string contains \\\"double quotes\\\" which are escaped.\"</span>;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> text = <span class=\"string\">`This string contains \"double quotes\" which don't need to be escaped anymore.`</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>字符串模板字面量</strong> 还支持直接插入变量，可以实现字符串与变量的直接连接输出。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'Tiger'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> age = <span class=\"number\">13</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'My cat is named '</span> + name + <span class=\"string\">' and is '</span> + age + <span class=\"string\">' years old.'</span>);</span><br></pre></td></tr></table></figure>\n<p>更简单的版本：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">'Tiger'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> age = <span class=\"number\">13</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">`My cat is named <span class=\"subst\">$&#123;name&#125;</span> and is <span class=\"subst\">$&#123;age&#125;</span> years old.`</span>);</span><br></pre></td></tr></table></figure>\n<p>ES5中，我们要这样生成多行文本：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> text = (</span><br><span class=\"line\">    <span class=\"string\">'cat\\n'</span> +</span><br><span class=\"line\">    <span class=\"string\">'dog\\n'</span> +</span><br><span class=\"line\">    <span class=\"string\">'nickelodeon'</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<p>或者：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> text = [</span><br><span class=\"line\">    <span class=\"string\">'cat'</span>,</span><br><span class=\"line\">    <span class=\"string\">'dog'</span>,</span><br><span class=\"line\">    <span class=\"string\">'nickelodeon'</span></span><br><span class=\"line\">].join(<span class=\"string\">'\\n'</span>);</span><br></pre></td></tr></table></figure>\n<p><strong>字符串模板字面量</strong> 让我们不必特别关注多行字符串中的换行转义符号，直接换行即可：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> text = ( <span class=\"string\">`cat</span></span><br><span class=\"line\"><span class=\"string\">dog</span></span><br><span class=\"line\"><span class=\"string\">nickelodeon`</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<p><strong>字符串模板字面量</strong> 内部可以使用表达式，像这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> today = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"><span class=\"keyword\">let</span> text = <span class=\"string\">`The time and date is <span class=\"subst\">$&#123;today.toLocaleString()&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Destructuring\"><a href=\"#Destructuring\" class=\"headerlink\" title=\"Destructuring\"></a>Destructuring</h2><p>解构让我们可以使用非常便捷的语法，直接将数组或者对象中的值直接分别导出到多个变量中，</p>\n<h3 id=\"Destructuring-Arrays\"><a href=\"#Destructuring-Arrays\" class=\"headerlink\" title=\"Destructuring Arrays\"></a>Destructuring Arrays</h3><p><strong>解构数组</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = arr[<span class=\"number\">0</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = arr[<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = arr[<span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> d = arr[<span class=\"number\">3</span>];</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> [a, b, c, d] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a); <span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Destructuring-Objects\"><a href=\"#Destructuring-Objects\" class=\"headerlink\" title=\"Destructuring Objects\"></a>Destructuring Objects</h3><p><strong>解构对象</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> luke = &#123; <span class=\"attr\">occupation</span>: <span class=\"string\">'jedi'</span>, <span class=\"attr\">father</span>: <span class=\"string\">'anakin'</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> occupation = luke.occupation; <span class=\"comment\">// 'jedi'</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> father = luke.father; <span class=\"comment\">// 'anakin'</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> luke = &#123; <span class=\"attr\">occupation</span>: <span class=\"string\">'jedi'</span>, <span class=\"attr\">father</span>: <span class=\"string\">'anakin'</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> &#123;occupation, father&#125; = luke;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(occupation); <span class=\"comment\">// 'jedi'</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(father); <span class=\"comment\">// 'anakin'</span></span><br></pre></td></tr></table></figure>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Modules\"><a href=\"#Modules\" class=\"headerlink\" title=\"Modules\"></a>Modules</h2><p>ES6之前，浏览器端的模块化代码，我们使用像<a href=\"http://browserify.org/\" target=\"_blank\" rel=\"noopener\">Browserify</a>这样的库，<br>在 <strong>Node.js</strong> 中，我们则使用 <a href=\"https://nodejs.org/api/modules.html#modules_module_require_id\" target=\"_blank\" rel=\"noopener\">require</a>。<br>在ES6中，我们现在可以直接使用AMD 和 CommonJS这些模块了。</p>\n<h3 id=\"Exporting-in-CommonJS\"><a href=\"#Exporting-in-CommonJS\" class=\"headerlink\" title=\"Exporting in CommonJS\"></a>Exporting in CommonJS</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123; <span class=\"attr\">foo</span>: <span class=\"string\">'bar'</span> &#125;;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = [<span class=\"string\">'foo'</span>, <span class=\"string\">'bar'</span>];</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span> (<span class=\"params\"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Exporting-in-ES6\"><a href=\"#Exporting-in-ES6\" class=\"headerlink\" title=\"Exporting in ES6\"></a>Exporting in ES6</h3><p>在ES6中，提供了多种设置模块出口的方式，比如我们要导出一个变量，那么使用 <strong>变量名</strong> ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> name = <span class=\"string\">'David'</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> age  = <span class=\"number\">25</span>;​​</span><br></pre></td></tr></table></figure>\n<p>还可以为对象 <strong>导出一个列表</strong>：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sumTwo</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sumThree</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b + c;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; sumTwo, sumThree &#125;;</span><br></pre></td></tr></table></figure>\n<p>我们也可以使用简单的一个 <code>export</code> 关键字来导出一个结果值：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sumTwo</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sumThree</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b + c;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>最后，我们可以 <strong>导出一个默认出口</strong>：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sumTwo</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sumThree</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b + c;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> api = &#123;</span><br><span class=\"line\">    sumTwo,</span><br><span class=\"line\">    sumThree</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> api;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * 与以下的语句是对等的:</span></span><br><span class=\"line\"><span class=\"comment\"> * export &#123; api as default &#125;;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>最佳实践</strong>：总是在模块的 <strong>最后</strong> 使用 <code>export default</code> 方法。<br>它让模块的出口更清晰明了，节省了阅读整个模块来寻找出口的时间。<br>更多的是，在大量CommonJS模块中，通用的习惯是设置一个出口值或者出口对象。<br>坚持这个规则，可以让我们的代码更易读，且更方便的联合使用CommonJS和ES6模块。</p>\n</blockquote>\n<h3 id=\"Importing-in-ES6\"><a href=\"#Importing-in-ES6\" class=\"headerlink\" title=\"Importing in ES6\"></a>Importing in ES6</h3><p>ES6提供了好几种模块的导入方式。我们可以单独引入一个文件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'underscore'</span>;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>这里需要注意的是， <strong>整个文件的引入方式会执行该文件内的最上层代码</strong>。</p>\n</blockquote>\n<p>就像Python一样，我们还可以命名引用：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; sumTwo, sumThree &#125; <span class=\"keyword\">from</span> <span class=\"string\">'math/addition'</span>;</span><br></pre></td></tr></table></figure>\n<p>我们甚至可以使用 <code>as</code> 给这些模块重命名：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">    sumTwo <span class=\"keyword\">as</span> addTwoNumbers,</span><br><span class=\"line\">    sumThree <span class=\"keyword\">as</span> sumThreeNumbers</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">'math/addition'</span>;</span><br></pre></td></tr></table></figure>\n<p>另外，我们能 <strong>引入所有的东西（原文：import all the things）</strong> （也称为命名空间引入）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> util <span class=\"keyword\">from</span> <span class=\"string\">'math/addition'</span>;</span><br></pre></td></tr></table></figure>\n<p>最后，我们能可以从一个模块的众多值中引入一个列表：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> additionUtil <span class=\"keyword\">from</span> <span class=\"string\">'math/addtion'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; sumTwo, sumThree &#125; = additionUtil;</span><br></pre></td></tr></table></figure>\n<p>像这样引用默认对象：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> api <span class=\"keyword\">from</span> <span class=\"string\">'math/addition'</span>;</span><br><span class=\"line\"><span class=\"comment\">// Same as: import &#123; default as api &#125; from 'math/addition';</span></span><br></pre></td></tr></table></figure>\n<p>我们建议一个模块导出的值应该越简洁越好，不过有时候有必要的话命名引用和默认引用可以混着用。如果一个模块是这样导出的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// foos.js</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; foo <span class=\"keyword\">as</span> <span class=\"keyword\">default</span>, foo1, foo2 &#125;;</span><br></pre></td></tr></table></figure>\n<p>那我们可以如此导入这个模块的值：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import foo, &#123; foo1, foo2 &#125; from &apos;foos&apos;;</span><br></pre></td></tr></table></figure>\n<p>我们还可以导入commonjs模块，例如React：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; Component, PropTypes &#125; = React;</span><br></pre></td></tr></table></figure>\n<p>更简化版本：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component, PropTypes &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>注意</strong>：被导出的值是被 <strong>绑定的（原文：bingdings）</strong>，而不是引用。<br>所以，改变一个模块中的值的话，会影响其他引用本模块的代码，一定要避免此种改动发生。</p>\n</blockquote>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Parameters\"><a href=\"#Parameters\" class=\"headerlink\" title=\"Parameters\"></a>Parameters</h2><p>在ES5中，许多种方法来处理函数的 <strong>参数默认值（default values）</strong>，<strong>参数数量（indefinite arguments）</strong>，<strong>参数命名（named parameters）</strong>。<br>ES6中，我们可以使用非常简洁的语法来处理上面提到的集中情况。</p>\n<h3 id=\"Default-Parameters\"><a href=\"#Default-Parameters\" class=\"headerlink\" title=\"Default Parameters\"></a>Default Parameters</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTwoNumbers</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    x = x || <span class=\"number\">0</span>;</span><br><span class=\"line\">    y = y || <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ES6中，我们可以简单为函数参数启用默认值：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTwoNumbers</span>(<span class=\"params\">x=<span class=\"number\">0</span>, y=<span class=\"number\">0</span></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addTwoNumbers(<span class=\"number\">2</span>, <span class=\"number\">4</span>); <span class=\"comment\">// 6</span></span><br><span class=\"line\">addTwoNumbers(<span class=\"number\">2</span>); <span class=\"comment\">// 2</span></span><br><span class=\"line\">addTwoNumbers(); <span class=\"comment\">// 0</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Rest-Parameters\"><a href=\"#Rest-Parameters\" class=\"headerlink\" title=\"Rest Parameters\"></a>Rest Parameters</h3><p>ES5中，遇到参数数量不确定时，我们只能如此处理：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">logArguments</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i &lt; <span class=\"built_in\">arguments</span>.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">arguments</span>[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用 <strong>rest</strong> 操作符，我们可以给函数传入一个不确定数量的参数列表：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">logArguments</span>(<span class=\"params\">...args</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> arg <span class=\"keyword\">of</span> args) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(arg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Named-Parameters\"><a href=\"#Named-Parameters\" class=\"headerlink\" title=\"Named Parameters\"></a>Named Parameters</h3><p>命名函数<br>ES5中，当我们要处理多个 <strong>命名参数</strong> 时，通常会传入一个 <strong>选项对象</strong> 的方式，这种方式被jQuery采用。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initializeCanvas</span>(<span class=\"params\">options</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> height = options.height || <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> width  = options.width  || <span class=\"number\">400</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> lineStroke = options.lineStroke || <span class=\"string\">'black'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们可以利用上面提到的新特性 <strong>解构</strong> ，来完成与上面同样功能的函数：<br>We can achieve the same functionality using destructuring as a formal parameter<br>to a function:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initializeCanvas</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    &#123; height=<span class=\"number\">600</span>, width=<span class=\"number\">400</span>, lineStroke=<span class=\"string\">'black'</span>&#125;</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// Use variables height, width, lineStroke here</span></span><br></pre></td></tr></table></figure>\n<p>如果我们需要把这个参数变为可选的，那么只要把该参数解构为一个空对象就好了：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initializeCanvas</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    &#123; height=<span class=\"number\">600</span>, width=<span class=\"number\">400</span>, lineStroke=<span class=\"string\">'black'</span>&#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Spread-Operator\"><a href=\"#Spread-Operator\" class=\"headerlink\" title=\"Spread Operator\"></a>Spread Operator</h3><p>我们可以利用展开操作符（Spread Operator）来把一组数组的值，当作参数传入：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Math</span>.max(...[<span class=\"number\">-1</span>, <span class=\"number\">100</span>, <span class=\"number\">9001</span>, <span class=\"number\">-32</span>]); <span class=\"comment\">// 9001</span></span><br></pre></td></tr></table></figure>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Classes\"><a href=\"#Classes\" class=\"headerlink\" title=\"Classes\"></a>Classes</h2><p>在ES6以前，我们实现一个类的功能的话，需要首先创建一个构造函数，然后扩展这个函数的原型方法，就像这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age, gender</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name   = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age    = age;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.gender = gender;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Person.prototype.incrementAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.age += <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>继承父类的子类需要这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Personal</span>(<span class=\"params\">name, age, gender, occupation, hobby</span>) </span>&#123;</span><br><span class=\"line\">    Person.call(<span class=\"keyword\">this</span>, name, age, gender);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.occupation = occupation;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.hobby = hobby;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Personal.prototype = <span class=\"built_in\">Object</span>.create(Person.prototype);</span><br><span class=\"line\">Personal.prototype.constructor = Personal;</span><br><span class=\"line\">Personal.prototype.incrementAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Person.prototype.incrementAge.call(<span class=\"keyword\">this</span>) += <span class=\"number\">20</span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>ES6提供了一些语法糖来实现上面的功能，我们可以直接创建一个类：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(name, age, gender) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name   = name;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.age    = age;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.gender = gender;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    incrementAge() &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.age += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>继承父类的子类只要简单的使用 <code>extends</code> 关键字就可以了：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Personal</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(name, age, gender, occupation, hobby) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(name, age, gender);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.occupation = occupation;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hobby = hobby;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    incrementAge() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.incrementAge();</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.age += <span class=\"number\">20</span>;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.age);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>最佳实践</strong>：ES6新的类语法把我们从晦涩难懂的实现和原型操作中解救出来，这是个非常适合初学者的功能，而且能让我们写出更干净整洁的代码。</p>\n</blockquote>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Symbols\"><a href=\"#Symbols\" class=\"headerlink\" title=\"Symbols\"></a>Symbols</h2><p>Symbols在ES6版本之前就已经存在了，但现在我们拥有一个公共的接口来直接使用它们。<br>Symbols是不可更改的（immutable）并且唯一的（unique），它可用作任何hash数据类型中的键。</p>\n<h3 id=\"Symbol\"><a href=\"#Symbol\" class=\"headerlink\" title=\"Symbol( )\"></a>Symbol( )</h3><p>调用 <code>Symbol()</code> 或者 <code>Symbol(描述文本)</code> 会创建一个唯一的、在全局中不可以访问的Symbol对象。<br>一个 <code>Symbol()</code> 的应用场景是：在自己的项目中使用第三方代码库，且你需要给他们的对象或者命名空间打补丁代码，又不想改动或升级第三方原有代码的时候。<br>例如，如果你想给 <code>React.Component</code> 这个类添加一个 <code>refreshComponent</code> 方法，但又确定不了这个方法会不会在下个版本中加入，你可以这么做：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> refreshComponent = <span class=\"built_in\">Symbol</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">React.Component.prototype[refreshComponent] = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Symbol-for-key\"><a href=\"#Symbol-for-key\" class=\"headerlink\" title=\"Symbol.for(key)\"></a>Symbol.for(key)</h3><p>使用 <code>Symbol.for(key)</code> 也是会创建一个不可改变的Symbol对象，但区别于上面的创建方法，这个对象是在全局中可以被访问到的。<br>两次相同的 <code>Symbol.for(key)</code> 调用会返回相同的Symbol实例。</p>\n<p><strong>提示</strong>：这并不同于 <code>Symbol(description)</code>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Symbol</span>(<span class=\"string\">'foo'</span>) === <span class=\"built_in\">Symbol</span>(<span class=\"string\">'foo'</span>) <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"built_in\">Symbol</span>.for(<span class=\"string\">'foo'</span>) === <span class=\"built_in\">Symbol</span>(<span class=\"string\">'foo'</span>) <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"built_in\">Symbol</span>.for(<span class=\"string\">'foo'</span>) === <span class=\"built_in\">Symbol</span>.for(<span class=\"string\">'foo'</span>) <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<p>Symbols常用的一个使用场景，尤其是使用 <code>Symbol.for(key)</code> 方法，是用于实现代码间的互操作。<br>在你的代码中，通过在包含一些已知接口的第三方库的对象参数中查找Symbol成员，你可以实现这种互操作。<br>例如：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reader</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> specialRead = <span class=\"built_in\">Symbol</span>.for(<span class=\"string\">'specialRead'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj[specialRead]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> reader = obj[specialRead]();</span><br><span class=\"line\">        <span class=\"comment\">// do something with reader</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'object cannot be read'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>之后在另一个库中：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> specialRead = <span class=\"built_in\">Symbol</span>.for(<span class=\"string\">'specialRead'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SomeReadableType</span> </span>&#123;</span><br><span class=\"line\">    [specialRead]() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> reader = createSomeReaderFrom(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> reader;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>注意</strong>：关于Symbol互操作的使用，一个值得一提的例子是<code>Symbol.iterable</code> 。<code>Symbol.iterable</code>存在ES6的所有可枚举对象中：数组（Arrays）、<br>字符串（strings）、生成器（Generators）等等。当它作为一个方法被调用时，它将会返回一个带有枚举接口的对象。</p>\n</blockquote>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Maps\"><a href=\"#Maps\" class=\"headerlink\" title=\"Maps\"></a>Maps</h2><p><strong>Maps</strong> 是一个JavaScript中很重要（迫切需要）的数据结构。<br>在ES6之前，我们创建一个 <strong>hash</strong> 通常是使用一个对象：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> map = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>();</span><br><span class=\"line\">map[key1] = <span class=\"string\">'value1'</span>;</span><br><span class=\"line\">map[key2] = <span class=\"string\">'value2'</span>;</span><br></pre></td></tr></table></figure>\n<p>但是，这样的代码无法避免函数被特别的属性名覆盖的意外情况：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; getOwnProperty(&#123; <span class=\"attr\">hasOwnProperty</span>: <span class=\"string\">'Hah, overwritten'</span>&#125;, <span class=\"string\">'Pwned'</span>);</span><br><span class=\"line\">&gt; <span class=\"built_in\">TypeError</span>: Property <span class=\"string\">'hasOwnProperty'</span> is not a <span class=\"function\"><span class=\"keyword\">function</span></span></span><br></pre></td></tr></table></figure>\n<p><strong>Maps</strong> 让我们使用 <code>set</code>，<code>get</code> 和 <code>search</code> 操作数据。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> map = <span class=\"keyword\">new</span> <span class=\"built_in\">Map</span>();</span><br><span class=\"line\">&gt; map.set(<span class=\"string\">'name'</span>, <span class=\"string\">'david'</span>);</span><br><span class=\"line\">&gt; map.get(<span class=\"string\">'name'</span>); <span class=\"comment\">// david</span></span><br><span class=\"line\">&gt; map.has(<span class=\"string\">'name'</span>); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<p>Maps最强大的地方在于我们不必只能使用字符串来做key了，现在可以使用任何类型来当作key，而且key不会被强制类型转换为字符串。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> map = <span class=\"keyword\">new</span> <span class=\"built_in\">Map</span>([</span><br><span class=\"line\">    [<span class=\"string\">'name'</span>, <span class=\"string\">'david'</span>],</span><br><span class=\"line\">    [<span class=\"literal\">true</span>, <span class=\"string\">'false'</span>],</span><br><span class=\"line\">    [<span class=\"number\">1</span>, <span class=\"string\">'one'</span>],</span><br><span class=\"line\">    [&#123;&#125;, <span class=\"string\">'object'</span>],</span><br><span class=\"line\">    [<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;, <span class=\"string\">'function'</span>]</span><br><span class=\"line\">]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">of</span> map.keys()) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> key);</span><br><span class=\"line\">    <span class=\"comment\">// &gt; string, boolean, number, object, function</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>提示</strong>：当使用 <code>map.get()</code> 判断值是否相等时，非基础类型比如一个函数或者对象，将不会正常工作。<br>有鉴于此，还是建议使用字符串，布尔和数字类型的数据类型。</p>\n</blockquote>\n<p>我们还可以使用 <code>.entries()</code> 方法来遍历整个map对象：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> [key, value] <span class=\"keyword\">of</span> map.entries()) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(key, value);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"WeakMaps\"><a href=\"#WeakMaps\" class=\"headerlink\" title=\"WeakMaps\"></a>WeakMaps</h2><p>在ES5之前的版本，我们为了存储私有数据，有好几种方法。像使用这种下划线命名约定：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(age) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    _incrementAge() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._age += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在一个开源项目中，命名规则很难维持得一直很好，这样经常会造成一些困扰。<br>此时，我们可以选择使用WeakMaps来替代Maps来存储我们的数据：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> _age = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>();</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(age) &#123;</span><br><span class=\"line\">        _age.set(<span class=\"keyword\">this</span>, age);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    incrementAge() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> age = _age.get(<span class=\"keyword\">this</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">        _age.set(<span class=\"keyword\">this</span>, age);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (age &gt; <span class=\"number\">50</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Midlife crisis'</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用WeakMaps来保存我们私有数据的理由之一是不会暴露出属性名，就像下面的例子中的 <code>Reflect.ownKeys()</code>：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; <span class=\"keyword\">const</span> person = <span class=\"keyword\">new</span> Person(<span class=\"number\">50</span>);</span><br><span class=\"line\">&gt; person.incrementAge(); <span class=\"comment\">// 'Midlife crisis'</span></span><br><span class=\"line\">&gt; <span class=\"built_in\">Reflect</span>.ownKeys(person); <span class=\"comment\">// []</span></span><br></pre></td></tr></table></figure>\n<p>一个使用WeakMaps存储数据更实际的例子，是存储与DOM元素相关联的数据，而这不会对DOM元素本身产生污染：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> map = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>();</span><br><span class=\"line\"><span class=\"keyword\">let</span> el  = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'someElement'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Store a weak reference to the element with a key</span></span><br><span class=\"line\">map.set(el, <span class=\"string\">'reference'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Access the value of the element</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> value = map.get(el); <span class=\"comment\">// 'reference'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Remove the reference</span></span><br><span class=\"line\">el.parentNode.removeChild(el);</span><br><span class=\"line\">el = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">value = map.get(el); <span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure>\n<p>上面的例子中，一旦对象被垃圾回收器给销毁了，WeakMaps会自动的把这个对象所对应的键值对数据同时销毁。</p>\n<blockquote>\n<p><strong>提示</strong>：结合这个例子，再考虑下jQuery是如何实现缓存带有引用的DOM元素这个功能的。使用WeakMaps的话，当被缓存的DOM元素被移除的时，jQuery可以自动释放相应元素的内存。<br>通常情况下，在涉及DOM元素存储和缓存的情况下，使用WeakMaps是非常有效的。</p>\n</blockquote>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Promises\"><a href=\"#Promises\" class=\"headerlink\" title=\"Promises\"></a>Promises</h2><p>Promises让我们把多缩进难看的代码（回调地狱）：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">func1(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value1</span>) </span>&#123;</span><br><span class=\"line\">    func2(value1, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value2</span>) </span>&#123;</span><br><span class=\"line\">        func3(value2, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value3</span>) </span>&#123;</span><br><span class=\"line\">            func4(value3, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value4</span>) </span>&#123;</span><br><span class=\"line\">                func5(value4, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value5</span>) </span>&#123;</span><br><span class=\"line\">                    <span class=\"comment\">// Do something with value 5</span></span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>写成这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">func1(value1)</span><br><span class=\"line\">    .then(func2)</span><br><span class=\"line\">    .then(func3)</span><br><span class=\"line\">    .then(func4)</span><br><span class=\"line\">    .then(func5, value5 =&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Do something with value 5</span></span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n<p>在ES6之前，我们使用<a href=\"https://github.com/petkaantonov/bluebird\" target=\"_blank\" rel=\"noopener\">bluebird</a> 或者<br><a href=\"https://github.com/kriskowal/q\" target=\"_blank\" rel=\"noopener\">Q</a>。现在我们有了原生版本的 Promises：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span></span><br><span class=\"line\">    reject(<span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Failed to fulfill Promise'</span>)))</span><br><span class=\"line\">        .catch(<span class=\"function\"><span class=\"params\">reason</span> =&gt;</span> <span class=\"built_in\">console</span>.log(reason));</span><br></pre></td></tr></table></figure>\n<p>这里有两个处理函数，<strong>resolve</strong>（当Promise执行成功完毕时调用的回调函数） 和 <strong>reject</strong> （当Promise执行不接受时调用的回调函数）</p>\n<blockquote>\n<p><strong>Promises的好处</strong>：大量嵌套错误处理回调函数会使代码变得难以阅读理解。<br>使用Promises，我们可以通过清晰的路径将错误事件让上传递，并且适当地处理它们。<br>此外，Promise处理后的值，无论是解决（resolved）还是拒绝（rejected）的结果值，都是不可改变的。</p>\n</blockquote>\n<p>下面是一些使用Promises的实际例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> request = <span class=\"built_in\">require</span>(<span class=\"string\">'request'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  request.get(url, (error, response, body) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (body) &#123;</span><br><span class=\"line\">        resolve(<span class=\"built_in\">JSON</span>.parse(body));</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        resolve(&#123;&#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>我们还可以使用 <code>Promise.all()</code> 来 <strong>并行化</strong> 的处理一组异步的操作。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> urls = [</span><br><span class=\"line\">  <span class=\"string\">'/api/commits'</span>,</span><br><span class=\"line\">  <span class=\"string\">'/api/issues/opened'</span>,</span><br><span class=\"line\">  <span class=\"string\">'/api/issues/assigned'</span>,</span><br><span class=\"line\">  <span class=\"string\">'/api/issues/completed'</span>,</span><br><span class=\"line\">  <span class=\"string\">'/api/issues/comments'</span>,</span><br><span class=\"line\">  <span class=\"string\">'/api/pullrequests'</span></span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> promises = urls.map(<span class=\"function\">(<span class=\"params\">url</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    $.ajax(&#123; <span class=\"attr\">url</span>: url &#125;)</span><br><span class=\"line\">      .done(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        resolve(data);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.all(promises)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">results</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Do something with results of all our promises</span></span><br><span class=\"line\"> &#125;);</span><br></pre></td></tr></table></figure>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Generators\"><a href=\"#Generators\" class=\"headerlink\" title=\"Generators\"></a>Generators</h2><p>就像<a href=\"https://github.com/DrkSephy/es6-cheatsheet#promises\" target=\"_blank\" rel=\"noopener\">Promises</a>如何让我们避免<a href=\"http://callbackhell.com/\" target=\"_blank\" rel=\"noopener\">回调地狱</a>一样，Generators也可以使我们的代码扁平化，同时给予我们开发者像开发同步代码一样的感觉来写异步代码。Generators本质上是一种支持的函数，随后返回表达式的值。<br>Generators实际上是支持<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/yield\" target=\"_blank\" rel=\"noopener\">暂停运行</a>，随后根据上一步的返回值再继续运行的一种函数。</p>\n<p>下面代码是一个使用generators函数的简单例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">sillyGenerator</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"number\">4</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> generator = sillyGenerator();</span><br><span class=\"line\">&gt; <span class=\"built_in\">console</span>.log(generator.next()); <span class=\"comment\">// &#123; value: 1, done: false &#125;</span></span><br><span class=\"line\">&gt; <span class=\"built_in\">console</span>.log(generator.next()); <span class=\"comment\">// &#123; value: 2, done: false &#125;</span></span><br><span class=\"line\">&gt; <span class=\"built_in\">console</span>.log(generator.next()); <span class=\"comment\">// &#123; value: 3, done: false &#125;</span></span><br><span class=\"line\">&gt; <span class=\"built_in\">console</span>.log(generator.next()); <span class=\"comment\">// &#123; value: 4, done: false &#125;</span></span><br></pre></td></tr></table></figure>\n<p>就像上面的例子，当<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator/next\" target=\"_blank\" rel=\"noopener\">next</a>运行时，它会把我们的generator向前“推动”，同时执行新的表达式。<br>我们能利用Generators来像书写同步代码一样书写异步代码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Hiding asynchronousity with Generators</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">request</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">    getJSON(url, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">        generator.next(response);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里我们写个generator函数将要返回我们的数据：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">getData</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> entry1 = <span class=\"keyword\">yield</span> request(<span class=\"string\">'http://some_api/item1'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> data1  = <span class=\"built_in\">JSON</span>.parse(entry1);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> entry2 = <span class=\"keyword\">yield</span> request(<span class=\"string\">'http://some_api/item2'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> data2  = <span class=\"built_in\">JSON</span>.parse(entry2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>借助于 <code>yield</code>，我们可以保证 <code>entry1</code> 确实拿到数据并转换后再赋值给 <code>data1</code>。</p>\n<p>当我们使用generators来像书写同步代码一样书写我们的异步代码逻辑时，没有一种清晰简单的方式来处理期间可能会产生的错误或者异常。在这种情况下，我们可以在我们的generator中引入Promises来处理，就像下面这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">request</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        getJSON(url, resolve);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们再写一个函数，其中使用 <code>next</code> 来步进我们的generator的同事，再利用我们上面的 <code>request</code> 方法来产生（yield）一个Promise。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">iterateGenerator</span>(<span class=\"params\">gen</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> generator = gen();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">iterate</span>(<span class=\"params\">val</span>) </span>&#123;</span><br><span class=\"line\">        ret = generator.next();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!ret.done) &#123;</span><br><span class=\"line\">            ret.value.then(iterate);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在Generator中引入了Promises后，我们就可以通过Promise的 <code>.catch</code> 和 <code>reject</code> 来捕捉和处理错误了。<br>使用了我们新版的Generator后，新版的调用就像老版本一样简单可读（译者注：有微调）：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iterateGenerator(<span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">getData</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> entry1 = <span class=\"keyword\">yield</span> request(<span class=\"string\">'http://some_api/item1'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> data1  = <span class=\"built_in\">JSON</span>.parse(entry1);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> entry2 = <span class=\"keyword\">yield</span> request(<span class=\"string\">'http://some_api/item2'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> data2  = <span class=\"built_in\">JSON</span>.parse(entry2);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>在使用Generator后，我们可以重用我们的老版本代码实现，以此展示了Generator的力量。<br>当使用Generators和Promises后，我们可以像书写同步代码一样书写异步代码的同时优雅地解决了错误处理问题。<br>此后，我们实际上可以开始利用更简单的一种方式了，它就是<a href=\"https://github.com/DrkSephy/es6-cheatsheet#async-await\" target=\"_blank\" rel=\"noopener\">async-await</a>。</p>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n<h2 id=\"Async-Await\"><a href=\"#Async-Await\" class=\"headerlink\" title=\"Async Await\"></a>Async Await</h2><p><code>async await</code> 随着ES2016版本就要发布了，它给我们提供了一种更轻松的、更简单的可以替代的实现上面 Generators 配合 Promises 组合代码的一种编码方式，让我们来看看例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> request = <span class=\"built_in\">require</span>(<span class=\"string\">'request'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getJSON</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    request(url, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error, response, body</span>) </span>&#123;</span><br><span class=\"line\">      resolve(body);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">main</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> data = <span class=\"keyword\">await</span> getJSON();</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(data); <span class=\"comment\">// NOT undefined!</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">main();</span><br></pre></td></tr></table></figure>\n<p>它们看上去和Generators很像。我（作者）强烈推荐使用 <code>async await</code> 来替代Generators + Promises的写法。<br><a href=\"http://masnun.com/2015/11/11/using-es7-asyncawait-today-with-babel.html\" target=\"_blank\" rel=\"noopener\">这里</a>是个很好的学习资源，让我们学习和使用这项ES7中的新功能。</p>\n<p><sup><a href=\"#table-of-contents\">(回到目录)</a></sup></p>\n","categories":[],"tags":["collection","javascript"]},{"title":"Shell编程cheat sheet","url":"https://vincenthou.github.io/2016/11/24/Shell编程cheat-sheet/","content":"<p>原文查看<a href=\"https://github.com/adambard/learnxinyminutes-docs/blob/master/zh-cn/bash-cn.html.markdown\" target=\"_blank\" rel=\"noopener\">这里</a>，根据最近的使用在原文基础上扩展了一些有用的技巧。</p>\n<p><strong>补充资料:</strong> </p>\n<ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/28674639\" target=\"_blank\" rel=\"noopener\">写代码怎能不会这些Linux命令？</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzIxNzg5ODE0OA==&amp;mid=2247483711&amp;idx=1&amp;sn=8032240ae21f3d0db5cf86dbe5b6f37a&amp;chksm=97f38cf4a08405e258ced51dfc2a6ed720331ffafcf584b4992d6f562ac64011844f0d5ef89e#rd\" target=\"_blank\" rel=\"noopener\">Linux下容易被忽视的那些命令用法</a></li>\n</ul>\n<h1 id=\"语言基础\"><a href=\"#语言基础\" class=\"headerlink\" title=\"语言基础\"></a>语言基础</h1><p>Bash 是一个为 GNU 计划编写的 Unix shell，是 Linux 和 Mac OS X 下的默认 shell。<br>以下大多数例子可以作为脚本的一部分运行，也可直接在 shell 下交互执行。</p>\n<p><a href=\"http://www.gnu.org/software/bash/manual/bashref.html\" target=\"_blank\" rel=\"noopener\">更多信息</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># 脚本的第一行叫 shebang，用来告知系统如何执行该脚本:</span></span><br><span class=\"line\"><span class=\"comment\"># 参见： http://en.wikipedia.org/wiki/Shebang_(Unix)</span></span><br><span class=\"line\"><span class=\"comment\"># 如你所见，注释以 # 开头，shebang 也是注释。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 出错就退出</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -e <span class=\"comment\"># Or `trap exit ERR`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示 “Hello world!”</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> Hello world!</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 每一句指令以换行或分号隔开：</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'This is the first line'</span>; <span class=\"built_in\">echo</span> <span class=\"string\">'This is the second line'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 声明一个变量：</span></span><br><span class=\"line\">Variable=<span class=\"string\">\"Some string\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 下面是错误的做法：</span></span><br><span class=\"line\">Variable = <span class=\"string\">\"Some string\"</span></span><br><span class=\"line\"><span class=\"comment\"># Bash 会把 Variable 当做一个指令，由于找不到该指令，因此这里会报错。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 也不可以这样：</span></span><br><span class=\"line\">Variable= <span class=\"string\">'Some string'</span></span><br><span class=\"line\"><span class=\"comment\"># Bash 会认为 'Some string' 是一条指令，由于找不到该指令，这里再次报错。</span></span><br><span class=\"line\"><span class=\"comment\"># （这个例子中 'Variable=' 这部分会被当作仅对 'Some string' 起作用的赋值。）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用变量：</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$Variable</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$Variable</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'$Variable'</span></span><br><span class=\"line\"><span class=\"comment\"># 当你赋值 (assign) 、导出 (export)，或者以其他方式使用变量时，变量名前不加 $。</span></span><br><span class=\"line\"><span class=\"comment\"># 如果要使用变量的值， 则要加 $。</span></span><br><span class=\"line\"><span class=\"comment\"># 注意： ' (单引号) 不会展开变量（即会屏蔽掉变量）。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在变量内部进行字符串代换</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;Variable/Some/A&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># 会把 Variable 中首次出现的 \"some\" 替换成 “A”。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 变量的截取</span></span><br><span class=\"line\">Length=7</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;Variable:0:Length&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># 这样会仅返回变量值的前7个字符</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 变量的默认值</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;Foo:-\"DefaultValueIfFooIsMissingOrEmpty\"&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># 对 null (Foo=) 和空串 (Foo=\"\") 起作用； 零（Foo=0）时返回0</span></span><br><span class=\"line\"><span class=\"comment\"># 注意这仅返回默认值而不是改变变量的值</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 内置变量：</span></span><br><span class=\"line\"><span class=\"comment\"># 下面的内置变量很有用</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"Last program return value: $?\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"Script's PID: $$\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"Number of arguments: <span class=\"variable\">$#</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"Scripts arguments: <span class=\"variable\">$@</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"Scripts arguments separated in different variables: <span class=\"variable\">$1</span> <span class=\"variable\">$2</span>...\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取输入：</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"What's your name?\"</span></span><br><span class=\"line\"><span class=\"built_in\">read</span> Name <span class=\"comment\"># 这里不需要声明新变量</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> Hello, <span class=\"variable\">$Name</span>!</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 通常的 if 结构看起来像这样：</span></span><br><span class=\"line\"><span class=\"comment\"># 'man test' 可查看更多的信息</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$Name</span> -ne <span class=\"variable\">$USER</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"Your name isn't your username\"</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"Your name is your username\"</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 根据上一个指令执行结果决定是否执行下一个指令</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"Always executed\"</span> || <span class=\"built_in\">echo</span> <span class=\"string\">\"Only executed if first command fails\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"Always executed\"</span> &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"Only executed if first command does NOT fail\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在 if 语句中使用 &amp;&amp; 和 || 需要多对方括号</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$Name</span> == <span class=\"string\">\"Steve\"</span> ] &amp;&amp; [ <span class=\"variable\">$Age</span> -eq 15 ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"This will run if <span class=\"variable\">$Name</span> is Steve AND <span class=\"variable\">$Age</span> is 15.\"</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$Name</span> == <span class=\"string\">\"Daniya\"</span> ] || [ <span class=\"variable\">$Name</span> == <span class=\"string\">\"Zach\"</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"This will run if <span class=\"variable\">$Name</span> is Daniya OR Zach.\"</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 表达式的格式如下:</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> $(( 10 + 5 ))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 与其他编程语言不同的是，bash 运行时依赖上下文。比如，使用 ls 时，列出当前目录。</span></span><br><span class=\"line\">ls</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指令可以带有选项：</span></span><br><span class=\"line\">ls -l <span class=\"comment\"># 列出文件和目录的详细信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 前一个指令的输出可以当作后一个指令的输入。grep 用来匹配字符串。</span></span><br><span class=\"line\"><span class=\"comment\"># 用下面的指令列出当前目录下所有的 txt 文件：</span></span><br><span class=\"line\">ls -l | grep <span class=\"string\">\"\\.txt\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重定向输入和输出（标准输入，标准输出，标准错误）。</span></span><br><span class=\"line\"><span class=\"comment\"># 以 ^EOF$ 作为结束标记从标准输入读取数据并覆盖 hello.py :</span></span><br><span class=\"line\">cat &gt; hello.py &lt;&lt; EOF</span><br><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\">from __future__ import print_function</span><br><span class=\"line\">import sys</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">\"#stdout\"</span>, file=sys.stdout)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">\"#stderr\"</span>, file=sys.stderr)</span><br><span class=\"line\"><span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> sys.stdin:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(line, file=sys.stdout)</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重定向可以到输出，输入和错误输出。</span></span><br><span class=\"line\">python hello.py &lt; <span class=\"string\">\"input.in\"</span></span><br><span class=\"line\">python hello.py &gt; <span class=\"string\">\"output.out\"</span></span><br><span class=\"line\">python hello.py 2&gt; <span class=\"string\">\"error.err\"</span></span><br><span class=\"line\">python hello.py &gt; <span class=\"string\">\"output-and-error.log\"</span> 2&gt;&amp;1</span><br><span class=\"line\">python hello.py &gt; /dev/null 2&gt;&amp;1</span><br><span class=\"line\"><span class=\"comment\"># &gt; 会覆盖已存在的文件， &gt;&gt; 会以累加的方式输出文件中。</span></span><br><span class=\"line\">python hello.py &gt;&gt; <span class=\"string\">\"output.out\"</span> 2&gt;&gt; <span class=\"string\">\"error.err\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 丢弃错误和标准输出，0 stdin, 1 stdout, 2 stderr</span></span><br><span class=\"line\">python hello.py &gt; /dev/null &gt; 2&gt;&amp;1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 覆盖 output.out , 追加 error.err 并统计行数</span></span><br><span class=\"line\">info bash <span class=\"string\">'Basic Shell Features'</span> <span class=\"string\">'Redirections'</span> &gt; output.out 2&gt;&gt; error.err</span><br><span class=\"line\">wc -l output.out error.err</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行指令并打印文件描述符 （比如 /dev/fd/123）</span></span><br><span class=\"line\"><span class=\"comment\"># 具体可查看： man fd</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &lt;(<span class=\"built_in\">echo</span> <span class=\"string\">\"#helloworld\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以 \"#helloworld\" 覆盖 output.out:</span></span><br><span class=\"line\">cat &gt; output.out &lt;(<span class=\"built_in\">echo</span> <span class=\"string\">\"#helloworld\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"#helloworld\"</span> &gt; output.out</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"#helloworld\"</span> | cat &gt; output.out</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"#helloworld\"</span> | tee output.out &gt;/dev/null</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 清理临时文件并显示详情（增加 '-i' 选项启用交互模式）</span></span><br><span class=\"line\">rm -v output.out error.err output-and-error.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 一个指令可用 $( ) 嵌套在另一个指令内部：</span></span><br><span class=\"line\"><span class=\"comment\"># 以下的指令会打印当前目录下的目录和文件总数</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"There are <span class=\"variable\">$(ls | wc -l)</span> items here.\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 反引号 `` 起相同作用，但不允许嵌套</span></span><br><span class=\"line\"><span class=\"comment\"># 优先使用 $(  ).</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"There are `ls | wc -l` items here.\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Bash 的 case 语句与 Java 和 C++ 中的 switch 语句类似:</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">\"<span class=\"variable\">$Variable</span>\"</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">    <span class=\"comment\"># 列出需要匹配的字符串</span></span><br><span class=\"line\">    0) <span class=\"built_in\">echo</span> <span class=\"string\">\"There is a zero.\"</span>;;</span><br><span class=\"line\">    1) <span class=\"built_in\">echo</span> <span class=\"string\">\"There is a one.\"</span>;;</span><br><span class=\"line\">    *) <span class=\"built_in\">echo</span> <span class=\"string\">\"It is not null.\"</span>;;</span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 循环遍历数组元素</span></span><br><span class=\"line\">Arr=(1 2 3)</span><br><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;Arr[*]&#125;</span> <span class=\"comment\">#或者是 Arr[@]</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"variable\">$item</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 判断包含数组中元素</span></span><br><span class=\"line\">Arr=(1 2 3)</span><br><span class=\"line\">[[ <span class=\"variable\">$Arr</span>[@] =~ 2 ]] &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"2 is in the array\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 你也可以遍历用空格分割的字符串列表</span></span><br><span class=\"line\">Str=<span class=\"string\">'name1 name2 name3'</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;Str[*]&#125;</span> <span class=\"comment\">#或者是 Str[@]</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"variable\">$item</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 循环遍历给定的参数序列:</span></span><br><span class=\"line\"><span class=\"comment\"># 变量$Variable 的值会被打印 3 次。</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> Variable <span class=\"keyword\">in</span> &#123;1..3&#125;</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$Variable</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或传统的 “for循环” ：</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> ((a=1; a &lt;= 3; a++))</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"variable\">$a</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 也可以用于文件</span></span><br><span class=\"line\"><span class=\"comment\"># 用 cat 输出 file1 和 file2 内容</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> Variable <span class=\"keyword\">in</span> file1 file2</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">    cat <span class=\"string\">\"<span class=\"variable\">$Variable</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或作用于其他命令的输出</span></span><br><span class=\"line\"><span class=\"comment\"># 对 ls 输出的文件执行 cat 指令。</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> Output <span class=\"keyword\">in</span> $(ls)</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">    cat <span class=\"string\">\"<span class=\"variable\">$Output</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># while 循环：</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> [ <span class=\"literal\">true</span> ]</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"loop body here...\"</span></span><br><span class=\"line\">    <span class=\"built_in\">break</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 你也可以使用函数</span></span><br><span class=\"line\"><span class=\"comment\"># 定义函数：</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> foo ()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"Arguments work just like script arguments: <span class=\"variable\">$@</span>\"</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"And: <span class=\"variable\">$1</span> <span class=\"variable\">$2</span>...\"</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"This is a function\"</span></span><br><span class=\"line\">    <span class=\"built_in\">return</span> 0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 更简单的方法</span></span><br><span class=\"line\">bar ()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"Another way to declare functions!\"</span></span><br><span class=\"line\">    <span class=\"built_in\">return</span> 0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 调用函数</span></span><br><span class=\"line\">foo <span class=\"string\">\"My name is\"</span> <span class=\"variable\">$Name</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 有很多有用的指令需要学习:</span></span><br><span class=\"line\"><span class=\"comment\"># 打印 file.txt 的最后 10 行</span></span><br><span class=\"line\">tail -n 10 file.txt</span><br><span class=\"line\"><span class=\"comment\"># 打印 file.txt 的前 10 行</span></span><br><span class=\"line\">head -n 10 file.txt</span><br><span class=\"line\"><span class=\"comment\"># 将 file.txt 按行排序</span></span><br><span class=\"line\">sort file.txt</span><br><span class=\"line\"><span class=\"comment\"># 报告或忽略重复的行，用选项 -d 打印重复的行</span></span><br><span class=\"line\">uniq -d file.txt</span><br><span class=\"line\"><span class=\"comment\"># 打印每行中 ',' 之前内容</span></span><br><span class=\"line\">cut -d <span class=\"string\">','</span> -f 1 file.txt</span><br><span class=\"line\"><span class=\"comment\"># 将 file.txt 文件所有 'okay' 替换为 'great', （兼容正则表达式）</span></span><br><span class=\"line\">sed -i <span class=\"string\">'s/okay/great/g'</span> file.txt</span><br><span class=\"line\"><span class=\"comment\"># 将 file.txt 中匹配正则的行打印到标准输出</span></span><br><span class=\"line\"><span class=\"comment\"># 这里打印以 \"foo\" 开头, \"bar\" 结尾的行</span></span><br><span class=\"line\">grep <span class=\"string\">\"^foo.*bar$\"</span> file.txt</span><br><span class=\"line\"><span class=\"comment\"># 使用选项 \"-c\" 统计行数</span></span><br><span class=\"line\">grep -c <span class=\"string\">\"^foo.*bar$\"</span> file.txt</span><br><span class=\"line\"><span class=\"comment\"># 如果只是要按字面形式搜索字符串而不是按正则表达式，使用 fgrep (或 grep -F)</span></span><br><span class=\"line\">fgrep <span class=\"string\">\"^foo.*bar$\"</span> file.txt </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以 bash 内建的 'help' 指令阅读 Bash 自带文档：</span></span><br><span class=\"line\"><span class=\"built_in\">help</span></span><br><span class=\"line\"><span class=\"built_in\">help</span> <span class=\"built_in\">help</span></span><br><span class=\"line\"><span class=\"built_in\">help</span> <span class=\"keyword\">for</span></span><br><span class=\"line\"><span class=\"built_in\">help</span> <span class=\"built_in\">return</span></span><br><span class=\"line\"><span class=\"built_in\">help</span> <span class=\"built_in\">source</span></span><br><span class=\"line\"><span class=\"built_in\">help</span> .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 用 man 指令阅读相关的 Bash 手册</span></span><br><span class=\"line\">apropos bash</span><br><span class=\"line\">man 1 bash</span><br><span class=\"line\">man bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 用 info 指令查阅命令的 info 文档 （info 中按 ? 显示帮助信息）</span></span><br><span class=\"line\">apropos info | grep <span class=\"string\">'^info.*('</span></span><br><span class=\"line\">man info</span><br><span class=\"line\">info info</span><br><span class=\"line\">info 5 info</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 阅读 Bash 的 info 文档：</span></span><br><span class=\"line\">info bash</span><br><span class=\"line\">info bash <span class=\"string\">'Bash Features'</span></span><br><span class=\"line\">info bash 6</span><br><span class=\"line\">info --apropos bash</span><br></pre></td></tr></table></figure>\n<h1 id=\"调试技巧\"><a href=\"#调试技巧\" class=\"headerlink\" title=\"调试技巧\"></a>调试技巧</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用xtrace选项在运行中打印执行命令（命令前面带+更清楚）</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -x</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'see me'</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> +x</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'command is not printed'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 捕获调试信号量</span></span><br><span class=\"line\"><span class=\"built_in\">trap</span> <span class=\"string\">'echo \"[CMD] $BASH_COMMAND\"'</span> DEBUG</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 甚至可以单步调试</span></span><br><span class=\"line\"><span class=\"built_in\">trap</span> <span class=\"string\">'(read -p \"[$0 : $LINENO] $BASH_COMMAND ?\")'</span> DEBUG</span><br></pre></td></tr></table></figure>","categories":[],"tags":["collection","linux"]},{"title":"前端知识体系梳理","url":"https://vincenthou.github.io/2016/11/13/前端知识体系梳理/","content":"<p>最近决定立下了个目标，看能坚持周更文章多久，上周回家就搁置了一周，这周接上，感觉写文章有人看，还能给点个赞还是件蛮有成就感的事情，感谢 @CraryPrimitiveMan 同学 :smile: 。其实对自己所了解知识也是很好的反刍过程。恢复单身狗之后有更多的时间思考和学习，开始学习摄影，捡起来绘画，感觉其实也是一件满惬意的事情。毕竟生活是自己的，你选择把她过成什么样子，她就会是什么样子。最近做后端的事情比较多，觉得梳理自己对前端的认知和思考，也是对自己之前积累的阶段性总结吧。当然第一篇就先水一下，主要是定一个大纲出来，主要是这几个方面吧:</p>\n<ul>\n<li>我整理的开发书单</li>\n<li>主流构建工具</li>\n<li>主流开发框架</li>\n<li>开发规范的思考</li>\n<li>模块化开发</li>\n<li>常用模式</li>\n<li>脸蛋和用户体验</li>\n<li>前端的图形开发能力</li>\n<li>绚丽的动画</li>\n<li>手机页面开发</li>\n<li>跨端开发的手段</li>\n<li>开发调试的思路和技巧</li>\n<li>自动化测试</li>\n<li>安全概念和防范</li>\n<li>性能优化</li>\n<li>监控系统</li>\n<li>SEO和语义化</li>\n<li>持续集成的方案</li>\n<li>前后端集成解决方案</li>\n<li>nodejs和所谓全栈</li>\n<li>前端团队的管理</li>\n</ul>\n<p>这里说明下，没感觉自己在前端方面有多么厉害，其实上面的每一点单独拿出来都能长篇大论，但这不是我的初衷，只是希望通过这样的方式，整理一些资料也梳理下自己的思路，如果你不巧看到这些文章，我自知总有挂一漏万之处，但请勿喷，如果只言片语能激荡出你的一些思考和讨论，我会感觉荣幸之至～</p>\n<p>刚进公司大概半年接触到前端的概念，也知道了有FE这种方向，当时还是很新的理念（大概4年多前），前端这个职位在大公司刚刚形成，在其他公司里还没有那么明确的划分。当时最火的算是AJAX的概念，google的gmail是被拿出来说的最典型的案例了，当时还是jquery为王的时代，用它你可以把DOM把玩的666，前端的工作被大家包括很多开发理解为切页面的简单工作（现在这种误解尚存），上海还是有一万一平米的房子的… :sweat_smile: </p>\n<p>由于大学是学电信的，用的最多的是C, C++，觉得hello world真的蛮简单的，简单的几行代码感觉就解锁了一个全新的世界，后来工作原因也接触了其他语言，但感觉只有前端的hello worl是简单的。你只需要打开一个文本编辑器，写下hello world，然后存为<code>.html</code>后缀的文件，双击打开就看到那句咒语一样的文字。当然后来你会慢慢知道，应该写<code>html</code>,<code>head</code>,<code>body</code>，现代浏览器帮你加上这些才让你那鲁莽的问候展示出来。你可以在不刷新浏览器的情况下，通过开发者工具把百度首页给改成个人主页，满足下自己的虚荣心 :joy:。你也可以用JS操纵个方块飞来飞去就感觉自己棒棒嗒。</p>\n<p>前端是离用户最近的一层，它的所见即所得的体验把不少大好青年坑进来，他们有的是工作需要，他们有的是兴趣使然，很庆幸自己是兼而有之。所谓一入侯门深似海，进去了才知道水有多深，其实在当时前端的工作不被重视也是情有可原的，当时的前端工作主要集中在做静态页面，页面特效，表单提交，兼容各个浏览器特性，很多时候需求都是由开发工程师直接实现的，不存在什么前端的工作。我觉的<strong>社会分工的形成意味着一个职业方向的专业化</strong>，随着这几年前端的快速发展，前端的内涵和外延都在惊人的发生着变革。很多人都感慨几个月不做前端就感觉自己不会做前端了，前一段比较火的<a href=\"http://www.tuicool.com/articles/R3uEJ3r\" target=\"_blank\" rel=\"noopener\">这篇文章</a>，把这种体验描绘得淋漓尽致。其实这是生态繁荣的一种表现，所谓天下大势分久必合，合久必分，百家争鸣最终会让标准化落地，但是想我为这个系列想的题目一样，前端真的是一个积极的社区（不折腾会死），各种框架和工具层出不穷，大家喜欢重复的造轮子和弃轮子，总是有新的东西出来，总是有更好的思路和方法为我们的开发带来便利。</p>\n<p>前端工作地位的提升有一部分也要感谢后端开发的复杂性提升，为什么这么说呢？现在很多前端做的事情原来是由后端来做的，所以在jquery时代之后出现了backbone这样的MVC框架就是从后端思路的借鉴，也是说后端复杂度的提升，让他们放权给前端包揽了所有展示层的工作，后端只是提供数据接口，他们跑去研究CAP, ACID, BASE…等等来保证数据接口的稳定和快速响应。由于前端最主要的编程语言是JS，这些年端能力的拓展给了JS实现各种平台开发的可能性，记得那句话是</p>\n<blockquote>\n<p>所有能用JS完成的程序最终都会用JS重写</p>\n</blockquote>\n<p>世界上最好的语言已经不是PHP咯 :grimacing: 你如果能够熟练掌握JS，再加上平台开发工具的掌握，就可以自诩为一个所谓的<code>全栈工程师</code>了。最近用知乎比较多，总会被人问一些诸如<code>怎样快速速成前端</code>,<code>前端工作是不是已经饱和</code>,<code>前端为什么不受重视</code>这些问题，每次想吐槽都压了压还是耐心得解答一番。其实感觉我们很多时候产生的迷茫来源于不自知，我们自己的定位局限了自己的眼界和思路。一个优秀的前端工程师首先还是应该把自己定位为一个合格的工程师，没有谁应该无条件的仰视你，所谓尊重都是自己给的，你能快速高效解决问题，自然别人会高看一眼，你掌握解决问题的方法和能力越纯熟，饱和的市场永远有你的一席之地。</p>\n<p>前端是个欣欣向荣的行业，很多思想流进来，因为这个行业还年轻，大量的借鉴传统的开发经验裁剪变通都汇流入海变成了看到前端现在的样子，什么时候我们这个职业有大量的思想流出去，才是前端真正成熟的时候。很荣幸在这个最好的时代也是最坏的时代，见证了前端的潮起潮落，也让我遇见一样热爱前端的你们。最后当然希望这个系列不会无疾而终吧，加油!</p>\n","categories":[],"tags":["blog","frontend"]},{"title":"yarn尝鲜和一些想法","url":"https://vincenthou.github.io/2016/10/23/yarn尝鲜和一些想法/","content":"<p>最近前端圈最火的事情莫过于yarn的横空出世了，从10.11号知道了这个事情看着事情升温和<a href=\"https://github.com/yarnpkg/yarn\" target=\"_blank\" rel=\"noopener\">这个库</a>的star被刷上万，不得不说yarn产品做的好，不如FB广告做的好，有这么一个亲爹背书，这关注度和流行度真的是妥妥的。</p>\n<h1 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h1><p>言归正传，这么一个新东西出来肯定是要解决问题的，从官网上宣传上来看，主要集中在这三点:</p>\n<ul>\n<li><strong>超快:</strong> 下过的包直接从本地拷贝</li>\n<li><strong>超安全:</strong> 安装一个包之前会先用 checksums 来验证</li>\n<li><strong>超可靠:</strong> 默认的lock机制，实现一次lock到处安装</li>\n</ul>\n<p>其实最有吸引力和解决工程痛点的莫过于速度和可靠性了。一般工程开发都会把node_modules忽略提交(当然出于加速部署的角度，会做出妥协)，每次部署会重新从网络安装所有的包。这些依赖的包由于可能使用了宽泛的版本控制声明(大多数情况还都是这样)，每次重新安装都可能会生成不一样的结果，这种不一样的结果可能是好的结果(修复bug或者引入新特性)，也可能是不好的结果(新的bug或者不向前兼容的改动)。这两点在工程实施中是大家都会遇到的头疼问题，也衍生出来各自的解决方案。</p>\n<ul>\n<li>我们会把node_modules提交，只有加入新的包或者版本更新的时候才会增量下载，之前安装过的包直接使用版本控制系统中的包。</li>\n<li>使用个淘宝镜像，使用npm shrinkwrap或者<a href=\"https://github.com/uber/npm-shrinkwrap\" target=\"_blank\" rel=\"noopener\">uber npm-shrinkwrap</a>锁定版本。</li>\n<li>因为cnpm不支持shrinkwrap，所以不适用于一致性的思路，安装真的很快，但是也有不锁包的观点下面有提到</li>\n</ul>\n<p>个人觉得之所以yarn这么收到推崇，从纯工具意义上来说是因为它集中解决了这两个痛点，提供出来简单易用的命令，不用你操心这些细节。同时这个工具带来的意义我感觉可以用函数式编程中的纯函数的概念来表达，就是同样的输入可以高效的产生一致性的输出。看起来一切都很好，可是真的是这样吗？</p>\n<h1 id=\"不一样的声音\"><a href=\"#不一样的声音\" class=\"headerlink\" title=\"不一样的声音\"></a>不一样的声音</h1><p>首先从快这个角度来看，单纯比较yarn和npm，yarn是真的块，没有开发上的历史包袱，利用缓存的效用没得说。然而，有个叫<a href=\"https://github.com/cnpm/cnpm\" target=\"_blank\" rel=\"noopener\">cnpm</a>的工具被默默的忽略了，yarn跟cnpm的安装包速度不论算不算缓存，cnpm都略胜一筹，可以参考下面贺老在知乎上的回答，本地亲测带有编译行为的项目，稳定性上cnpm还更强一点，换了淘宝镜像yarn重新安装几次重试才能成功，而cnpm每次都可以稳定安装而且速度较快。</p>\n<p>其次从一致性的角度来看，诚然使用npm shrinkwrap强制要求开发每次加包都同步是不靠谱的，但是我们真的需要完全的强一致性吗？给我们带来问题的其实是非一致性的负面，其实我们有时候也是需要其正面的部分，比如小版本bug修复和新功能增加，这样也不至于我们在需要大版本号升级的时候更加痛苦。消除其负面部分死马提出的观点是加强人工干预，也就是提高依赖包的审核力度，保证依赖链的健康性，当然实际落地需要所有开发者有比较高的素养和判断力，在跨团队情况下也有其局限性和实际操作的尴尬。</p>\n<h1 id=\"实际体验\"><a href=\"#实际体验\" class=\"headerlink\" title=\"实际体验\"></a>实际体验</h1><h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>从npm迁移成使用yarn，直接用npm安装(保证你的nodejs是较新的版本)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g yarn</span><br><span class=\"line\">yarn --version</span><br></pre></td></tr></table></figure>\n<p>如果连npm都没有，yarn也提供了各种平台直接的<a href=\"https://yarnpkg.com/en/docs/install\" target=\"_blank\" rel=\"noopener\">安装方式</a></p>\n<h2 id=\"设置镜像\"><a href=\"#设置镜像\" class=\"headerlink\" title=\"设置镜像\"></a>设置镜像</h2><p>在国内没代理就必须要靠镜像了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn config set registry &apos;https://registry.npm.taobao.org&apos;</span><br></pre></td></tr></table></figure>\n<h2 id=\"常用命令对应关系\"><a href=\"#常用命令对应关系\" class=\"headerlink\" title=\"常用命令对应关系\"></a>常用命令对应关系</h2><ul>\n<li>yarn / yarn install -&gt; npm install</li>\n<li>yarn add -&gt; npm install –save</li>\n<li>yarn remove -&gt; npm uninstall –save</li>\n<li>yarn add –dev -&gt; npm install –save-dev</li>\n<li>yarn upgrade -&gt; npm update –save</li>\n<li>yarn global add -&gt; npm install -g<h2 id=\"一些小优化\"><a href=\"#一些小优化\" class=\"headerlink\" title=\"一些小优化\"></a>一些小优化</h2></li>\n<li>交互界面更加清新友好，加了很多emoji的icon，报错信息更加清楚</li>\n<li>提供了yarn why命令查看某个模块被依赖的关系和占用空间信息</li>\n<li>yarn run命令提供了交互式命令方式，在没有指定run哪条命令的时候列出可运行命令让你选择</li>\n<li>yarn ls可以清晰列出项目的依赖关系树<h1 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h1></li>\n</ul>\n<p>yarn结合工程痛点重写了npm的功能并根据实际需要做了扩展，所谓不破不立，积重难返，作为一致性思路的工具真的解决了很多npm的问题，作为不代理环境的安装只是改变了registry，对于依赖于国外源包的编译需求不能很好的解决(也许淘宝会fork一个跟cnpm一样的思路加上各种镜像源)。所以要使用一方面是接受一致性的思路和这种思路下的负面: 忽略小版本优化和bug修复，一方面最好是有代理。由于构建的加速依赖于缓存，如果使用docker部署需要设置好共享的volume。个人项目使用cnpm更方便，结合一些特殊方案消除版本失控影响也可以用于生产环境(提交node_modules或者提高一级依赖包质量)。yarn还处于初期，还有各种问题需要解决，这几天issue就上300多了，还有待发展，只能说前途是光明的，道路是曲折的，在前进中有曲折，在曲折中向前进，前端会越来越好！</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/22892675\" target=\"_blank\" rel=\"noopener\">yarn, 不是又一个 npm 第三方客户端</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzA4NjE3MDg4OQ==&amp;mid=2650963709&amp;idx=1&amp;sn=db49ef1793610c178792785bd7d5241f&amp;chksm=843a129bb34d9b8d3316343c60e9b3fd0f6da3d5c36da639d3d3b9f98362497689b413a5211a&amp;mpshare=1&amp;scene=1&amp;srcid=1022htBPlVk3boobjgWA3HZ6&amp;key=c3acc508db720376541159bb6b3a5280a5d4ece0269dd592d76564d31639a178c48858c75c334bb04639b31a5df33cac&amp;ascene=0&amp;uin=MjQ4MjAyNTY0MQ%3D%3D&amp;devicetype=iMac+MacBookAir6%2C2+OSX+OSX+10.10.5+build%2814F27%29&amp;version=11020012&amp;pass_ticket=s2NY74QF%2ByBCzsX7cAwZKBL3Usgfs6BoJilNyFpO7iKndv%2BOjsOS%2BpnRYUfJwpCa\" target=\"_blank\" rel=\"noopener\">Facebook推出新的JavaScript模块管理器：Yarn</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/22967139\" target=\"_blank\" rel=\"noopener\">新的 js 包管理工具 yarn 解决了什么问题？</a></li>\n<li><a href=\"http://www.zhihu.com/question/51502849/answer/126133407\" target=\"_blank\" rel=\"noopener\">如何评价Facebook推出的JavaScript模块管理器yarn - 贺师俊的回答</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/22934066\" target=\"_blank\" rel=\"noopener\">为什么我不使用 shrinkwrap（lock）</a></li>\n</ul>\n","categories":[],"tags":["blog","frontend","build"]},{"title":"docker 常用命令收集","url":"https://vincenthou.github.io/2016/09/12/docker-常用命令收集/","content":"<ul>\n<li>列出所有container (包括运行中和停止的)</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps -a</span><br></pre></td></tr></table></figure>\n<ul>\n<li>进入一个运行中容器的bash</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it container bash</span><br></pre></td></tr></table></figure>\n<ul>\n<li>直接启动或者停止一个container</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker start container</span><br><span class=\"line\">docker stop container</span><br></pre></td></tr></table></figure>\n<ul>\n<li>加载docker image实例化一个container并且打开一个container的交互式命令行</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it image bash</span><br></pre></td></tr></table></figure>\n<ul>\n<li>加载docker image实例化一个container映射宿主机8081端口到container的80端口</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 8081:80 image</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在运行中的container里面执行命令</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec container command</span><br></pre></td></tr></table></figure>\n<ul>\n<li>依附到一个通过 -d 参数运行的容器上</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker attach container</span><br></pre></td></tr></table></figure>\n<ul>\n<li>查询docker内部端口号对应的host端口号</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker port container inner_port_number</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用尾部追加的方式查看docker在daemon模式下控制台输出的日志</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker logs -f container</span><br></pre></td></tr></table></figure>\n<ul>\n<li>查看容器中运行的进程信息</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker top container</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用template展示容器和镜像的配置信息和运行状态信息</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker inspect -f &apos;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&apos; container</span><br></pre></td></tr></table></figure>\n<ul>\n<li>之前启动过的容器会根据名字留下记录，可以重新启动（重新实例化容器的时候如果指定了名称参数，因此会因为同名而报错，需要手动rm）</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker start old_container</span><br></pre></td></tr></table></figure>\n<ul>\n<li>强制删除运行中的容器，相当于先stop再remove</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rm -f container</span><br></pre></td></tr></table></figure>\n<ul>\n<li>通过当前文件夹下Dockerfile构建image并且打上一个tag</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t tag_name .</span><br></pre></td></tr></table></figure>\n<ul>\n<li>拉取某个digest的image</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull image/name@sha256:cbbf2f9a99b47fc460d422812b6a5adff7dfee951d8fa2e4a98caa0382cfbdbf</span><br></pre></td></tr></table></figure>\n<ul>\n<li>为一个运行中的容器添加新的网络连接（可以把一个容器连接到多个自定义网络，默认是default的bridge模式）</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker network connect my-bridge-network container</span><br></pre></td></tr></table></figure>\n<ul>\n<li>从主机上文件系统路径映射到容器中文件系统中（通过覆盖不删除的方式仿mount的行为）</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py</span><br></pre></td></tr></table></figure>\n<ul>\n<li>查看由于删除的容器的时候没有指定 -v 参数导致悬挂的volume</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker volume ls -f dangling=true</span><br></pre></td></tr></table></figure>\n<ul>\n<li>删除悬挂的容器volume</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker volume rm valume_name</span><br></pre></td></tr></table></figure>\n<ul>\n<li>挂载dbstore镜像，将/dbdata的数据打包放在backup目录下面（也就是当前目录下面），完成后删除镜像</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker create -v /dbdata --name dbstore training/postgres /bin/true</span><br><span class=\"line\">docker run --rm --volumes-from dbstore -v $(pwd):/backup ubuntu tar cvf /backup/backup.tar /dbdata</span><br></pre></td></tr></table></figure>\n<ul>\n<li>解压到新的dbstore2对应的volume容器中</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --rm --volumes-from dbstore2 -v $(pwd):/backup ubuntu bash -c &quot;cd /dbdata &amp;&amp; tar xvf /backup/backup.tar --strip 1&quot;</span><br></pre></td></tr></table></figure>\n","categories":[],"tags":["collection","linux","docker"]},{"title":"前后台集成开发方案的一些思考","url":"https://vincenthou.github.io/2015/12/22/前后台集成开发方案的一些思考/","content":"<p>首先自我检讨一下，最近一直忙于业务开发（都是借口 :no_good: ）已经有好长时间没有写文章了，现在团队里面为了提高开发的效率，也是提高大家技术深度上的积累，采用了前后端分离的开发方式。这本不是什么新鲜的模式：前端使用AJAX异步跟服务器进行数据交互，后端开发专注于业务逻辑的实现，负责产生业务model，前后端的集成通过RESTful API实现。在实践开发中遇到了些问题，通过搜索找到些通用的解决方案，再此整理下。</p>\n<h1 id=\"前后端集成的石器时代\"><a href=\"#前后端集成的石器时代\" class=\"headerlink\" title=\"前后端集成的石器时代\"></a>前后端集成的石器时代</h1><p>现在项目里面开发的一般流程会是这样，在拿到产品团队给出的story，我会拆分成可实现的细粒度前后端任务，根据情况分配给前后端开发的同事实现。在开发实际功能时，会要求后端开发的同事提供API定义的文档（无文档不编程），前端的同事在这个间隙后去拆解页面结构，实现静态页面的实现。在后端开发的同事完成API文档之后，前端的同事根据文档自己在开发页面的时候在代码里mock静态的JSON对象，同时后端的同事开始实现实际的业务代码。如果没有变化一切看上去都还很美好，但是这个世界上唯一不变的东西就是变化了~</p>\n<h1 id=\"前端开发的痛点\"><a href=\"#前端开发的痛点\" class=\"headerlink\" title=\"前端开发的痛点\"></a>前端开发的痛点</h1><ol>\n<li>在后端开发完成API文档定义之后需要手动mock实际生产环境不需要的假数据</li>\n<li>如果后端开发尚未基本完成前，如果后端有字段结构的调整，前端开发都需要重新更改mock的数据</li>\n<li>在后端开发完成后，如果有需求上的变动，前端开发都需要很被动的等待后端业务代码实际调整后（或者口头约定后）才能集成调试业务调整后的前端数据结构<h1 id=\"后端开发的痛点\"><a href=\"#后端开发的痛点\" class=\"headerlink\" title=\"后端开发的痛点\"></a>后端开发的痛点</h1></li>\n<li>需要认真主动维护代码和文档的同步，经常由于两者的不同步又没有及时通知给前端，会导致功能挂掉而负担责任</li>\n<li>对于自己开发的业务代码没有把控，需要在自己的postman工具中收集一堆的接口调试用例，完成后通过人工测试的方式容易出错</li>\n<li>一些通用的测试用例仍然需要自己手动编写测试脚本，复杂的业务测试不好实施（现在这块做的不好，测试完全靠人工 :disappointed: ）<h1 id=\"理想的集成方案\"><a href=\"#理想的集成方案\" class=\"headerlink\" title=\"理想的集成方案\"></a>理想的集成方案</h1></li>\n</ol>\n<p>后端开发只需要维护一份文档（markdown, yml或者JSON），这份文档的作用跟之前写的文档没有差别，可能只是格式或者语义上的转换，但这份文档应该是对前端开发和后端开发都有额外产出的：</p>\n<ul>\n<li>前端开发：应该能够使用命令行工具打开一个本地的mock服务器，在前端统一的AJAX请求拦截器里面能够根据临时配置（例如一个debug的bool值）切换对接服务器的域名（本地就是localhost, 线上就是实际的域名），数据接口的路径不变。</li>\n<li>后端开发：应该能够使用命令行工具根据文档自动生成通用的自动化测试用例，差异化的自动化测试用例支持手工编写（更好的是能集成进git的pre-commit，test不过不能提交或者合并），工具可以在实际部署的时候生成在线文档并且能够在线调试（省的还要自己维护一堆的postman接口）。<h1 id=\"一些开源技术方案的收集\"><a href=\"#一些开源技术方案的收集\" class=\"headerlink\" title=\"一些开源技术方案的收集\"></a>一些开源技术方案的收集</h1><h2 id=\"API-设计\"><a href=\"#API-设计\" class=\"headerlink\" title=\"API 设计\"></a>API 设计</h2></li>\n<li><a href=\"https://github.com/interagent/http-api-design\" target=\"_blank\" rel=\"noopener\">HTTP API design</a></li>\n<li><a href=\"https://github.com/ZhangBohan/http-api-design-ZH_CN\" target=\"_blank\" rel=\"noopener\">HTTP API design chinese</a></li>\n<li><a href=\"https://github.com/bolasblack/http-api-guide\" target=\"_blank\" rel=\"noopener\">HTTP API guide</a><h2 id=\"规范\"><a href=\"#规范\" class=\"headerlink\" title=\"规范\"></a>规范</h2></li>\n<li><a href=\"https://github.com/json-api/json-api\" target=\"_blank\" rel=\"noopener\">JSON API</a></li>\n<li><a href=\"https://github.com/mikekelly/hal_specification\" target=\"_blank\" rel=\"noopener\">HAL spec</a><h2 id=\"文档定义\"><a href=\"#文档定义\" class=\"headerlink\" title=\"文档定义\"></a>文档定义</h2></li>\n<li><a href=\"https://github.com/apiaryio/api-blueprint\" target=\"_blank\" rel=\"noopener\">api-blueprint</a></li>\n<li><a href=\"https://github.com/apidoc/apidoc\" target=\"_blank\" rel=\"noopener\">apidoc</a></li>\n<li><a href=\"https://github.com/interagent/prmd\" target=\"_blank\" rel=\"noopener\">prmd</a><h2 id=\"Mock-数据\"><a href=\"#Mock-数据\" class=\"headerlink\" title=\"Mock 数据\"></a>Mock 数据</h2></li>\n<li><a href=\"https://github.com/nuysoft/Mock\" target=\"_blank\" rel=\"noopener\">Mock</a></li>\n<li><a href=\"https://github.com/Marak/faker.js\" target=\"_blank\" rel=\"noopener\">fake.js</a><h2 id=\"JSON-server\"><a href=\"#JSON-server\" class=\"headerlink\" title=\"JSON server\"></a>JSON server</h2></li>\n<li><a href=\"https://github.com/typicode/jsonplaceholder\" target=\"_blank\" rel=\"noopener\">jsonplaceholder</a></li>\n<li><a href=\"https://github.com/typicode/json-server\" target=\"_blank\" rel=\"noopener\">JSON server</a><h2 id=\"现成的集成方案\"><a href=\"#现成的集成方案\" class=\"headerlink\" title=\"现成的集成方案\"></a>现成的集成方案</h2></li>\n<li><a href=\"https://github.com/swagger-api\" target=\"_blank\" rel=\"noopener\">swagger</a></li>\n<li><a href=\"https://github.com/thx/RAP\" target=\"_blank\" rel=\"noopener\">RAP</a></li>\n<li><a href=\"http://nordicapis.com/top-specification-formats-for-rest-apis/\" target=\"_blank\" rel=\"noopener\">几种主流API定义方式对比</a><h2 id=\"基于文档的测试框架\"><a href=\"#基于文档的测试框架\" class=\"headerlink\" title=\"基于文档的测试框架\"></a>基于文档的测试框架</h2></li>\n<li><a href=\"https://github.com/apiaryio/dredd\" target=\"_blank\" rel=\"noopener\">dredd 配合 api-blueprint</a><h2 id=\"性能测试框架\"><a href=\"#性能测试框架\" class=\"headerlink\" title=\"性能测试框架\"></a>性能测试框架</h2></li>\n<li><a href=\"https://github.com/jeffbski/bench-rest\" target=\"_blank\" rel=\"noopener\">Bench REST</a></li>\n<li><a href=\"https://github.com/tsenart/vegeta\" target=\"_blank\" rel=\"noopener\">Go vegeta</a><h1 id=\"几种流行的API定义方式\"><a href=\"#几种流行的API定义方式\" class=\"headerlink\" title=\"几种流行的API定义方式\"></a>几种流行的API定义方式</h1><h2 id=\"RAML-0-8-1-0\"><a href=\"#RAML-0-8-1-0\" class=\"headerlink\" title=\"RAML (0.8, 1.0)\"></a>RAML (0.8, 1.0)</h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3></li>\n</ul>\n<p>最早的RAML项目开发开始于2013年9月，规范是由多家公司共同提议出来的，还成立了工作组，其中包括Box, Paypal, Cisco等公司的技术负责人。有意思的是，在github上基于RAML比较活跃的组织Mulesoft，最开始的时候是使用swagger的，但是觉得swagger更适合从头定义新的API，不适合定义现有的API就放弃了swagger。</p>\n<h3 id=\"定义方式\"><a href=\"#定义方式\" class=\"headerlink\" title=\"定义方式\"></a>定义方式</h3><ul>\n<li>语言支持：支持YAML定义</li>\n<li>授权方式：使用securitySchemes定义授权方式，在securedBy属性中添加需要的权限类型数组，再通过把securedBy属性全局添加或者添加到资源上来控制API的授权方式</li>\n<li>有用的特性：高度的抽象能力和复用能力是RAML定义的最大特色了</li>\n<li>抽象方式：通过层级化的定义方式来对资源进行分组，顶级的资源名称作为分组名称（影响到文档生成的展现），提供了对于模型定义的抽象机制，包括resourceTypes和traits, 文档中定义的很多实体支持拆分成独立的文件（docs, examples, resourceTypes, schemas, securitySchemes, traits），在主文档中通过include引入，方便抽象重复的行为， <strong>适合于大型工程的API定义</strong><h3 id=\"工具集\"><a href=\"#工具集\" class=\"headerlink\" title=\"工具集\"></a>工具集</h3></li>\n<li>文档编辑工具：<a href=\"http://apiworkbench.com/\" target=\"_blank\" rel=\"noopener\">API Workbench</a> <a href=\"https://atom.io/\" target=\"_blank\" rel=\"noopener\">ATOM</a>插件，支持0.8和1.0版本，支持生成脚手架，语法高亮，自动补全，错误提示（外链文档会产生不必要的错误提示，应该是都当成单一文档定义方式处理了），离线预览API Console（文档工具）。<a href=\"https://github.com/mulesoft/api-designer\" target=\"_blank\" rel=\"noopener\">API designer</a>在本地运行一个web based的文档编辑器，仅支持0.8版本的语法。</li>\n<li>文档生成工具：<a href=\"https://github.com/mulesoft/api-console\" target=\"_blank\" rel=\"noopener\">API Console</a>能够生成在线可交互的文档，使用angluar框架实现，支持作为directive引用，也支持作为iframe内嵌，可以直接调用线上服务测试（类swagger-ui的try it）。<a href=\"https://github.com/raml2html/raml2html\" target=\"_blank\" rel=\"noopener\">raml2html</a> 简洁清新，但是功能略简单，仅仅支持文档的查看，但是可以自己定义模板</li>\n<li>代码生成工具：貌似暂时没有官方统一的代码生成工具，找到写社区的，例如<a href=\"https://github.com/EconomistDigitalSolutions/ramlapi\" target=\"_blank\" rel=\"noopener\">go</a>，还可以使用<a href=\"https://github.com/mulesoft/osprey\" target=\"_blank\" rel=\"noopener\">osprey</a>这种工具把RAML定义的规则作为中间件引入</li>\n<li>接口验证工具：<a href=\"https://github.com/cybertk/abao/\" target=\"_blank\" rel=\"noopener\">abao</a>基于在文档中定义的schema部分来验证待测试API的有效性，在单个请求前后的有hook，在全部测试的前后也有hook，支持指定运行若干满足文件名定义规则的hook</li>\n<li>接口模拟工具：<a href=\"https://github.com/RePoChO/raml-mocker\" target=\"_blank\" rel=\"noopener\">raml-mocker</a>支持正常基于定义的mock，同时也支持使用format定义自定义类型（有点像swagger文档定义的类型扩展，但更灵活些）<h3 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h3></li>\n<li><a href=\"http://raml.org/\" target=\"_blank\" rel=\"noopener\">官网</a></li>\n<li><a href=\"https://github.com/raml-org/raml-spec/blob/master/raml-0.8.md\" target=\"_blank\" rel=\"noopener\">0.8 定义规范</a></li>\n<li><a href=\"http://docs.raml.org/specs/1.0/\" target=\"_blank\" rel=\"noopener\">1.0 定义规范</a> 刚出，工具链支持不完善</li>\n<li><a href=\"https://github.com/raml-apis\" target=\"_blank\" rel=\"noopener\">Raml APIs samples</a></li>\n<li><a href=\"http://raml.org/projects/projects\" target=\"_blank\" rel=\"noopener\">社区工具集</a></li>\n<li><a href=\"https://github.com/mulesoft\" target=\"_blank\" rel=\"noopener\">主要参与贡献组织 mulesoft</a><h2 id=\"Swagger-1-0-1-2-2-0\"><a href=\"#Swagger-1-0-1-2-2-0\" class=\"headerlink\" title=\"Swagger (1.0 - 1.2, 2.0)\"></a>Swagger (1.0 - 1.2, 2.0)</h2><h3 id=\"简介-1\"><a href=\"#简介-1\" class=\"headerlink\" title=\"简介\"></a>简介</h3></li>\n</ul>\n<p>最早的swagger项目开发开始于2011年7月，规范和框架的实现来自于Wordnik自己的使用场景，后来变成了完全的开源项目，2016年初已经捐给了<a href=\"https://openapis.org/\" target=\"_blank\" rel=\"noopener\">Open API Initiative (OAI)</a>，改名叫OpenAPI Sepcification，有了更官方的组织，github上的关注度<a href=\"https://github.com/search?utf8=%E2%9C%93&amp;q=swagger&amp;type=Repositories&amp;ref=searchresults\" target=\"_blank\" rel=\"noopener\">相对比较高</a></p>\n<h3 id=\"定义方式-1\"><a href=\"#定义方式-1\" class=\"headerlink\" title=\"定义方式\"></a>定义方式</h3><ul>\n<li>语言支持：支持JSON和YAML定义</li>\n<li>授权方式：使用securityDefinitions定义授权方式，在编辑文档和渲染出的文档中应用，支持对于API级别使用security定义更细粒度的权限</li>\n<li>有用的特性：字段类型定义中除了正常支持JSON-schema之外还提供了format的修饰符表示<a href=\"http://swagger.io/specification/#dataTypeFormat\" target=\"_blank\" rel=\"noopener\">更具体的类型信息</a></li>\n<li>抽象方式：可以使用tag对operation对象进行分组（影响到文档生成的展现），支持通过在response里面使用$ref引用definitions里面定义的模型（#/definitions/Model），definition需要定义在JSON的root层级上才能使用这里说到$ref的语法引用到，在 <strong>测试和校验</strong> 的时候这点很重要。<h3 id=\"工具集-1\"><a href=\"#工具集-1\" class=\"headerlink\" title=\"工具集\"></a>工具集</h3></li>\n<li>文档编辑工具：<a href=\"http://editor.swagger.io/\" target=\"_blank\" rel=\"noopener\">Online Editor</a> 左侧编辑文档，右侧预览效果，还能直接根据文档中定义的线上地址发送请求测试线上实际返回效果，提供在线的client和server端口模板代码生成</li>\n<li>文档生成工具：<a href=\"https://github.com/swagger-api/swagger-ui\" target=\"_blank\" rel=\"noopener\">Swagger UI</a>能够生成在线可交互的文档，生成的效果看这里<a href=\"http://petstore.swagger.io/\" target=\"_blank\" rel=\"noopener\">Online Preview Demo</a></li>\n<li>代码生成工具：<a href=\"https://github.com/swagger-api/swagger-codegen\" target=\"_blank\" rel=\"noopener\">Swagger Codegen</a>依赖于java的环境，根据你定义的规范生成模板代码，值得一提的是server端的模板代码支持在开发环境下mock服务数据。</li>\n<li>接口验证工具：没有完全自动化的工具，因为自动的代码生成是swagger的核心特色，自动生成代码对于参数的校验，在filter，middlewire或者hook层都做掉了，但是找到基于mocha的生成自动化测试模板文件的工具 <a href=\"https://github.com/apigee-127/swagger-test-templates\" target=\"_blank\" rel=\"noopener\">swagger-test-templates</a>，这里有个坑就是生成的模板文件使用z-schema校验json，但不支持format参数；<a href=\"https://github.com/Maks3w/SwaggerAssertions\" target=\"_blank\" rel=\"noopener\">另外一个</a>基本的CRUD都需要人工写很多的测试代码</li>\n<li>接口模拟工具：API如果是基于express的，可以用<a href=\"https://github.com/BigstickCarpet/swagger-express-middleware\" target=\"_blank\" rel=\"noopener\">swagger-express-middleware</a>，不仅仅是mock还包括在请求参数中带上元信息，自动的参数类型转换，参数的校验等；如果用了grunt和静态文件任务connect，用<a href=\"https://github.com/dzdrazil/swagger-mock-api\" target=\"_blank\" rel=\"noopener\">swagger-mock-api</a>会很方便。<h3 id=\"参考文档-1\"><a href=\"#参考文档-1\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h3></li>\n<li><a href=\"http://swagger.io/\" target=\"_blank\" rel=\"noopener\">官网</a></li>\n<li><a href=\"http://swagger.io/specification/\" target=\"_blank\" rel=\"noopener\">定义规范</a> 实际就是2.0的规范</li>\n<li><a href=\"https://github.com/raml-apis\" target=\"_blank\" rel=\"noopener\">Raml APIs samples</a></li>\n<li><a href=\"http://swagger.io/tools/\" target=\"_blank\" rel=\"noopener\">社区工具集</a></li>\n<li><a href=\"https://github.com/swagger-api\" target=\"_blank\" rel=\"noopener\">主要参与贡献组织 swagger-api</a><h2 id=\"API-Blueprint-1A\"><a href=\"#API-Blueprint-1A\" class=\"headerlink\" title=\"API-Blueprint(1A)\"></a>API-Blueprint(1A)</h2><h3 id=\"定义方式-2\"><a href=\"#定义方式-2\" class=\"headerlink\" title=\"定义方式\"></a>定义方式</h3></li>\n<li>语言支持：基于markdown的规范扩展了自定义的语法</li>\n<li>授权方式：通过使用+ Authenticated定义一个区块来实现，但仍然处于<a href=\"https://github.com/apiaryio/api-blueprint-rfcs/blob/master/draft/0002-authentication.md\" target=\"_blank\" rel=\"noopener\">草案阶段</a></li>\n<li>有用的特性：可以在标题项中通过Group关键字来对资源分组，可以通过符号加占位符定义URI的模板</li>\n<li>抽象方式：可以在Data Structures部分定义model并且在Attributes里面引用<h3 id=\"工具集-2\"><a href=\"#工具集-2\" class=\"headerlink\" title=\"工具集\"></a>工具集</h3></li>\n</ul>\n<p>API blueprint的工具链主要依托于<a href=\"https://apiary.io/\" target=\"_blank\" rel=\"noopener\">apiary</a>提供的在线SAAS服务，可以很方便跟github的仓库集成，主要的工具说明官网说的<a href=\"https://docs.apiary.io/tools/\" target=\"_blank\" rel=\"noopener\">很详细</a>了。</p>\n<ul>\n<li>文档编辑工具：登录后使用在线的editor工具编辑，左侧编辑文档，右侧预览效果，直接调用在线的mock服务。</li>\n<li>文档生成工具：文档是在发布之后生成的，支持控制访问权限。</li>\n<li>代码生成工具：<a href=\"https://github.com/swagger-api/swagger-codegen\" target=\"_blank\" rel=\"noopener\">Swagger Codegen</a>依赖于java的环境，根据你定义的规范生成模板代码，值得一提的是server端的模板代码支持在开发环境下mock服务数据。</li>\n<li>接口验证工具：<a href=\"https://github.com/apiaryio/dredd\" target=\"_blank\" rel=\"noopener\">dredd</a>，初始化的时候通过指定key，拉取你在apiary上定义的文档来进行测试。</li>\n<li>接口模拟工具：在文档发布后会生成一个mock地址，直接就是一个线上的mock服务，还可以通过inspector查看mock服务被调用的情况。<h3 id=\"参考文档-2\"><a href=\"#参考文档-2\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h3></li>\n<li><a href=\"https://apiblueprint.org/\" target=\"_blank\" rel=\"noopener\">官网</a></li>\n<li><a href=\"https://github.com/apiaryio/api-blueprint/blob/master/API%20Blueprint%20Specification.md\" target=\"_blank\" rel=\"noopener\">定义规范</a></li>\n<li><a href=\"https://github.com/apiaryio\" target=\"_blank\" rel=\"noopener\">主要参与贡献组织 apiary</a><h2 id=\"文档定义转化工具\"><a href=\"#文档定义转化工具\" class=\"headerlink\" title=\"文档定义转化工具\"></a>文档定义转化工具</h2></li>\n<li><a href=\"https://apitransformer.com\" target=\"_blank\" rel=\"noopener\">apitransformer</a></li>\n<li><a href=\"https://github.com/lucybot/api-spec-converter\" target=\"_blank\" rel=\"noopener\">api-sepc-converter</a> 暂时主要支持将各种定义方式转化为swagger2.0</li>\n</ul>\n<p><strong>这里先占个坑，等方案梳理落地后再进一步完善本文~~</strong></p>\n","categories":[],"tags":["blog","frontend"]},{"title":"【翻译】Go语言中的HTTP中间件","url":"https://vincenthou.github.io/2015/10/07/【翻译】Go语言中的HTTP中间件/","content":"<p>在web开发领域，“中间件”代表的是使用应用的一部分来包装原有应用程序，添加额外的功能。这个概念通常未收到充分的赏识，但是我认为还是很棒的。</p>\n<p>我认为一个好的中间件有单一的责任，它是可插拔的并且是自包含的。这意味着你可以把它在借口层次嵌入并且马上能用。它不会影响你的编码风格，它也不是一个框架，而仅仅是你请求处理流中的另外一层。没有必要重写你的代码，你决定用中间件，只需要把它加到公式里面，如果你反悔了，就去掉它，就是这么简单。</p>\n<p>反观Go语言中，HTTP中间件即使是在标准库里也是很普遍的。尽管开始看起来不是很明显，<code>net/http</code>包里面，像<a href=\"http://golang.org/pkg/net/http/#StripPrefix\" target=\"_blank\" rel=\"noopener\">StripPrefix</a>或者<a href=\"http://golang.org/pkg/net/http/#TimeoutHandler\" target=\"_blank\" rel=\"noopener\">TimeoutHandler</a>这些方法，就是我们期待中中间件的样子。它们包装了你的处理器，在处理请求和响应的时候加额外的步骤。</p>\n<p>我最近的Go包<a href=\"https://github.com/justinas/nosurf\" target=\"_blank\" rel=\"noopener\">nosurf</a>也是个中间价。我有意从最开始设计这个包。大部分情况，你不需要在应用程序层面注意到CSRF的检查：nosurf像其他合格的中间件一样，它是独立于系统的并且能够跟其他使用标准<code>net/http</code>接口的工具很好的协作。</p>\n<p>你也可以用中间件来：</p>\n<ul>\n<li>通过长度隐藏来减轻<a href=\"http://netsecurity.51cto.com/art/201308/406091.htm\" target=\"_blank\" rel=\"noopener\">BREACH 攻击</a></li>\n<li>请求速率控制</li>\n<li>抵挡恶意木马</li>\n<li>提供调试信息</li>\n<li>添加<a href=\"https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security\" target=\"_blank\" rel=\"noopener\">HSTS</a>, <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/X-Frame-Options\" target=\"_blank\" rel=\"noopener\">X-Frame-Options</a> 报头</li>\n<li>优雅地从panic中恢复</li>\n<li>…还有其他可能的功能<h1 id=\"写一个简单的中间件\"><a href=\"#写一个简单的中间件\" class=\"headerlink\" title=\"写一个简单的中间件\"></a>写一个简单的中间件</h1></li>\n</ul>\n<p>第一个例子我们来写个只允许用户在单一域名（在HTTP协议的Host报头中指定）下访问我们的网站的中间件。这样的中间件可以保护web应用免受<a href=\"http://www.skeletonscribe.net/2013/05/practical-http-host-header-attacks.html\" target=\"_blank\" rel=\"noopener\">host欺骗</a>的攻击。</p>\n<h2 id=\"构造类型\"><a href=\"#构造类型\" class=\"headerlink\" title=\"构造类型\"></a>构造类型</h2><p>首先让我们来位这个中间件来定义一种类型，我们姑且叫它 <code>SingleHost</code>。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> SingleHost <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    handler     http.Handler</span><br><span class=\"line\">    allowedHost <span class=\"keyword\">string</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>它只包含了两个字段：</p>\n<ul>\n<li>被包装的处理器，我们会让带有合法Host的请求调用它</li>\n<li>被允许访问的host的值</li>\n</ul>\n<p>因为我们使用小写来定义字段名，让这些字段对于在我们的包里面是私有的，我们还需要给我们的类型定义一个构造器。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewSingleHost</span><span class=\"params\">(handler http.Handler, allowedHost <span class=\"keyword\">string</span>)</span> *<span class=\"title\">SingleHost</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;SingleHost&#123;handler: handler, allowedHost: allowedHost&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"处理请求\"><a href=\"#处理请求\" class=\"headerlink\" title=\"处理请求\"></a>处理请求</h2><p>现在是实际的逻辑代码。为了实现 <code>http.Handler</code> 接口，我们的类型只需要有一个方法：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Handler <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">        ServeHTTP(ResponseWriter, *Request)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>实现如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *SingleHost)</span> <span class=\"title\">ServeHTTP</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">    host := r.Host</span><br><span class=\"line\">    <span class=\"keyword\">if</span> host == s.allowedHost &#123;</span><br><span class=\"line\">        s.handler.ServeHTTP(w, r)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        w.WriteHeader(<span class=\"number\">403</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>ServeHTTP</code> 方法仅仅检查请求中的Host报头：</p>\n<ul>\n<li>如果请求匹配构造函数中设置的<code>allowedHost</code>值，它就会调用被包装处理器上的<code>ServeHTTP</code>方法，这样处理请求的责任就传递下去了。</li>\n<li>如果不匹配，请求返回403（未授权）状态码，请求处理到此为止。</li>\n</ul>\n<p>在后面一种情况，原来处理器中的<code>ServeHTTP</code>方法永远不会被调用到，处理器甚至不知道有这么一个请求发出过。</p>\n<p>现在我们的中间件已经写完了。我们只需要把它嵌入应用。我们在中间件里包裹处理器，而不是直接把我们原来的处理器传递给<code>net/http</code>服务器。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">singleHosted = NewSingleHost(myHandler, <span class=\"string\">\"example.com\"</span>)</span><br><span class=\"line\">http.ListenAndServe(<span class=\"string\">\":8080\"</span>, singleHosted)</span><br></pre></td></tr></table></figure>\n<h2 id=\"另外一种方式\"><a href=\"#另外一种方式\" class=\"headerlink\" title=\"另外一种方式\"></a>另外一种方式</h2><p>我们上面实现的中间件真的很简单：它只有15行代码。写这种中间件，有一个用更少代码量模板来实现的方法。由于Go语言对于函数一等公民和闭包的支持，以及有简洁的<code>http.HandlerFunc</code>包装器，我们可以把这些逻辑作为一个简单的方法来实现而不是一个独立的结构体类型。下面是我们中间价的函数式版本完整实现。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">SingleHost</span><span class=\"params\">(handler http.Handler, allowedHost <span class=\"keyword\">string</span>)</span> <span class=\"title\">http</span>.<span class=\"title\">Handler</span></span> &#123;</span><br><span class=\"line\">    ourFunc := <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">        host := r.Host</span><br><span class=\"line\">        <span class=\"keyword\">if</span> host == allowedHost &#123;</span><br><span class=\"line\">            handler.ServeHTTP(w, r)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            w.WriteHeader(<span class=\"number\">403</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> http.HandlerFunc(ourFunc)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里我们定义了一个简单的函数叫做<code>SingleHost</code>，这个函数可以接受一个需要被包装的处理器和被允许的Host名称。在方法里我们构造了一个和之前版本中<code>ServeHTTP</code>相似的方法。我们内部的方法实际是一个闭包，所以它能够访问外部的变量。最终，<code>HandlerFunc</code>让我们能够把这个方法作为一个<code>http.Handler</code>来使用。</p>\n<p>是使用<code>HandlerFunc</code>还是使用你自己的<code>http.Handler</code>类型最终是由你来决定的。对于基本的情况，一个方法就够了，如果你发现你的中间件越来越臃肿，你就会想要定义自己的结构体类型并且分离逻辑到多个方法中去。</p>\n<p>同时，标准库实际会用到上面两种方法来创造中间件。<code>StripPrefix</code>是一个返回<code>HandlerFunc</code>的方法，而<code>TimeoutHandler</code>虽然是个方法，但是返回的是个处理请求的自定义结构体类型。</p>\n<h1 id=\"一个更复杂的情况\"><a href=\"#一个更复杂的情况\" class=\"headerlink\" title=\"一个更复杂的情况\"></a>一个更复杂的情况</h1><p>我们的<code>SingleHost</code>中间件没啥实用价值：我们只是检查了请求中的某个属性然后把请求传递给原始的处理器，既没有再关注它也没有返回一个我们自己的响应，并且让原始的处理器获取到它。更不用说，有些情况是不光要基于请求来做出动作，我们的中间件还可能需要在原来的处理器写入响应之后再进一步通过某种方式处理返回给客户端的响应。</p>\n<h2 id=\"添加数据很简单\"><a href=\"#添加数据很简单\" class=\"headerlink\" title=\"添加数据很简单\"></a>添加数据很简单</h2><p>如果你想要在被包装的处理器已经写入响应之后再添加数据，你只需要在完成的时候调用<code>Write()</code>方法：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> AppendMiddleware <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    handler http.Handler</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">func (a *AppendMiddleware) ServeHTTP(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class=\"line\">    a.handler.ServeHTTP(w, r)</span><br><span class=\"line\">    w.Write([]byte(&quot;Middleware says hello.&quot;))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>现在响应会在原有处理器输出的任何内容之后添加中间件输出的hello。</p>\n<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><p>处理其他类型的响应就有点麻烦了。假如我们想要在数据添加在放回响应的头里面。如果我们在原始的处理器前调用<code>Write()</code>方法就会对状态码和报头失去控制，因为第一次<code>Write()</code>调用立即将它们写入。</p>\n<p>通过其他任何方式（比如，替换字符串），改变某个响应的报头或者设置一个不同的状态码不会起作用，这是因为一个相似的原因：当被包装的处理器返回之后，上面这些内容已经被返回给客户端了。</p>\n<p>为了应对这种情况，我们需要一种特殊的<code>ResponseWriter</code>能够像缓冲区一样工作，手机响应并且为了之后使用保存数据（以及修改）。我们之后会把<code>ResponseWriter</code>缓存传递给原始的处理器而不是给它真实的RW，这样可以防止它直接讲响应返回。</p>\n<p>幸运的是，在Go的标准库中有这样的工具。<code>net/http/httptest</code>包中的<code>ResponseRecorder</code>做了所有我们需要的：它保存响应状态码，报头的映射表并且把报文积攒到缓冲流中。尽管它本来是用于测试的（就像包名表达的一样），但是正好也满足了我们的情况。</p>\n<p>为了内容的完整性，让我们来看个使用<code>ResponseRecorder</code>修改响应中东西的例子。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> ModifierMiddleware <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    handler http.Handler</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *ModifierMiddleware)</span> <span class=\"title\">ServeHTTP</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">    rec := httptest.NewRecorder()</span><br><span class=\"line\">    <span class=\"comment\">// passing a ResponseRecorder instead of the original RW</span></span><br><span class=\"line\">    m.handler.ServeHTTP(rec, r)</span><br><span class=\"line\">    <span class=\"comment\">// after this finishes, we have the response recorded</span></span><br><span class=\"line\">    <span class=\"comment\">// and can modify it before copying it to the original RW</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// we copy the original headers first</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> k, v := <span class=\"keyword\">range</span> rec.Header() &#123;</span><br><span class=\"line\">        w.Header()[k] = v</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// and set an additional one</span></span><br><span class=\"line\">    w.Header().Set(<span class=\"string\">\"X-We-Modified-This\"</span>, <span class=\"string\">\"Yup\"</span>)</span><br><span class=\"line\">    <span class=\"comment\">// only then the status code, as this call writes out the headers </span></span><br><span class=\"line\">    w.WriteHeader(<span class=\"number\">418</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// The body hasn't been written (to the real RW) yet,</span></span><br><span class=\"line\">    <span class=\"comment\">// so we can prepend some data.</span></span><br><span class=\"line\">    data := []<span class=\"keyword\">byte</span>(<span class=\"string\">\"Middleware says hello again. \"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// But the Content-Length might have been set already,</span></span><br><span class=\"line\">    <span class=\"comment\">// we should modify it by adding the length</span></span><br><span class=\"line\">    <span class=\"comment\">// of our own data.</span></span><br><span class=\"line\">    <span class=\"comment\">// Ignoring the error is fine here:</span></span><br><span class=\"line\">    <span class=\"comment\">// if Content-Length is empty or otherwise invalid,</span></span><br><span class=\"line\">    <span class=\"comment\">// Atoi() will return zero,</span></span><br><span class=\"line\">    <span class=\"comment\">// which is just what we'd want in that case.</span></span><br><span class=\"line\">    clen, _ := strconv.Atoi(r.Header.Get(<span class=\"string\">\"Content-Length\"</span>))</span><br><span class=\"line\">    clen += <span class=\"built_in\">len</span>(data)</span><br><span class=\"line\">    r.Header.Set(<span class=\"string\">\"Content-Length\"</span>, strconv.Itoa(clen))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// finally, write out our data</span></span><br><span class=\"line\">    w.Write(data)</span><br><span class=\"line\">    <span class=\"comment\">// then write out the original body</span></span><br><span class=\"line\">    w.Write(rec.Body.Bytes())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>下面是我们通过中间件返回”Success!”包装过的处理器响应。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 418 I<span class=\"string\">'m a teapot</span></span><br><span class=\"line\"><span class=\"string\">X-We-Modified-This: Yup</span></span><br><span class=\"line\"><span class=\"string\">Content-Type: text/plain; charset=utf-8</span></span><br><span class=\"line\"><span class=\"string\">Content-Length: 37</span></span><br><span class=\"line\"><span class=\"string\">Date: Tue, 03 Sep 2013 18:41:39 GMT</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Middleware says hello again. Success!</span></span><br></pre></td></tr></table></figure>\n<p>这为我们开启了新的可能性。被包装的处理器完全掌握在我们手里：即使是在请求被处理完之后，我们也能以任何我们想要的方式操纵响应。</p>\n<h2 id=\"跟其他处理器共享数据\"><a href=\"#跟其他处理器共享数据\" class=\"headerlink\" title=\"跟其他处理器共享数据\"></a>跟其他处理器共享数据</h2><p>在很多情况下，你的中间件需要暴露某些信息给其他的中间件或者你自己的应用。举个例子，nosurf需要给用户提供访问CSRF token的方法和失败的理由（如果有的话）。</p>\n<p>一种优雅的方式是使用映射表，通常是存在一个隐藏在包内的全局变量里，用来映射<code>http.Request</code>指针和需要的数据片段，同时暴露包级别（或者处理器级别）的方法来访问数据。</p>\n<p>我在nosurf中也使用了这种模式。这里，我创建了一个全局的映射表。注意到这里需要一个互斥锁，因为Go语言的映射表默认不是线程安全的，参考<a href=\"http://blog.golang.org/go-maps-in-action#TOC_6.\" target=\"_blank\" rel=\"noopener\">这里</a>。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> csrfContext <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    token <span class=\"keyword\">string</span></span><br><span class=\"line\">    reason error</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">    contextMap = <span class=\"built_in\">make</span>(<span class=\"keyword\">map</span>[*http.Request]*csrfContext)</span><br><span class=\"line\">    cmMutex    = <span class=\"built_in\">new</span>(sync.RWMutex)</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>数据在处理器中被设置进去，通过包导出的<code>Token()</code>方法把数据暴露出来。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Token</span><span class=\"params\">(req *http.Request)</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">    cmMutex.RLock()</span><br><span class=\"line\">    <span class=\"keyword\">defer</span> cmMutex.RUnlock()</span><br><span class=\"line\"></span><br><span class=\"line\">    ctx, ok := contextMap[req]</span><br><span class=\"line\">    <span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ctx.token</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>你可以在nosurf库的<a href=\"https://github.com/justinas/nosurf/blob/master/context.go\" target=\"_blank\" rel=\"noopener\">context.go</a>中找到完成的实现代码。</p>\n<p>相比于我选择自己位nosurf自己造轮子，有个<a href=\"http://www.gorillatoolkit.org/pkg/context\" target=\"_blank\" rel=\"noopener\">gorilla/context</a>的包实现了一个通用的映射表来保存请求的信息。在大部分情况下，它能够满足你的需要，让你不需要自己实现一个共享的存储结构以及踩人家踩过的坑。它甚至提供在处理完之后清除请求数据的<a href=\"http://www.gorillatoolkit.org/pkg/context#ClearHandler\" target=\"_blank\" rel=\"noopener\">中间件</a>。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>这篇文章的目的是是给Go语言开发者描述中间件的概念并且展示一些基本的Go语言里面实现中间件的方式。作为一个相对年轻的语言，Go语言提供了非常好的标准HTTP接口。这也是让编写Go的中间件更加方便甚至有趣的因素。</p>\n<p>然而，仍然缺乏高质量的Go语言的HTTP工具。大部分但不是所有上面我提到关于Go的中间件的想法还没有实现。现在你知道怎么在Go语言中实现中间件了，为什么不自己整个呢？:-)</p>\n<p>P.S. 你可以在github的<a href=\"https://gist.github.com/justinas/7059324\" target=\"_blank\" rel=\"noopener\">gist</a>找到文中相关的实现代码。</p>\n<h1 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h1><p>对于中间件的实现最常见的思路是使用<code>责任链</code>的方式，很多框架实现中都是以filter的概念提供，一级的事情做完传给下一级。最原始Go语言中使用<code>装饰器</code>来实现同样的效果，通过预先定义包装顺序来控制处理流程的顺序。通过在内存中提供公共内存区域来在不同的中间件之间共享数据。其实这种方法中间件逐渐增多之后会难以维护，你会看到这样的code：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Middleware1(Middleware2(Middleware3(App)))</span><br></pre></td></tr></table></figure>\n<p>本文的作者实现了一个简单的责任链式的<a href=\"https://github.com/justinas/alice\" target=\"_blank\" rel=\"noopener\">库</a>，也写<a href=\"https://justinas.org/alice-painless-middleware-chaining-for-go/\" target=\"_blank\" rel=\"noopener\">文章</a>讲解了下用例，将上面的代码转化为</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alice.New(Middleware1, Middleware2, Middleware3).Then(App).</span><br></pre></td></tr></table></figure>\n<p>本文只能说是简单介绍了Go语言中中间件实现的思路，未必是最好的实现，这个见仁见智把，最后，本文的英文原文看这里：<a href=\"https://justinas.org/writing-http-middleware-in-go/\" target=\"_blank\" rel=\"noopener\">传送门</a></p>\n","categories":[],"tags":["go","backend","translation"]},{"title":"几款h5应用生成工具技术方案对比","url":"https://vincenthou.github.io/2015/10/01/几款h5应用生成工具技术方案对比/","content":"<p>再留个坑</p>\n","categories":[],"tags":["blog","frontend","todo"]},{"title":"javascript中的函数式编程","url":"https://vincenthou.github.io/2015/09/30/javascript中的函数式编程/","content":"<p>又欠一笔账</p>\n","categories":[],"tags":["blog","javascript","todo"]},{"title":"Nginx配置中一个斜杠引发的血案","url":"https://vincenthou.github.io/2015/09/21/Nginx配置中一个斜杠引发的血案/","content":"<p>Nginx经常被用来做前端的代理服务器，代理相关配置好之后，需要配置proxy_pass，最近因为一个”/“引发了一系列的问题，记录一下．</p>\n<p>proxy_pass用来配置代理后端的服务器地址，可以带上端口号，有两种写法</p>\n<ul>\n<li><strong>不带 <code>/</code> :</strong> 根路径<code>/</code>会被保留，也就是 <a href=\"http://localhost/test/page\" target=\"_blank\" rel=\"noopener\">http://localhost/test/page</a>, 后端获取到的是完整的路径<code>/test/page</code></li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location /<span class=\"built_in\">test</span> &#123;</span><br><span class=\"line\">    proxy_pass http://127.0.0.1:81</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><strong>带 <code>/</code> :</strong> 根路径<code>/</code>会被吃掉，也就是 <a href=\"http://localhost/test/page\" target=\"_blank\" rel=\"noopener\">http://localhost/test/page</a>, 后端获取到的是完整的路径<code>/page</code></li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location /<span class=\"built_in\">test</span> &#123;</span><br><span class=\"line\">    proxy_pass http://127.0.0.1:81/</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>大部分情况代理或者仅仅是做子站隔离的时候都是需要保留根路径的（特别是子站隔离很多时候就是用根路径的不同来区分的），所以第一种情况用的会更多一点，配置proxy_pass后根路径会被保留．</p>\n<h1 id=\"顺便一记\"><a href=\"#顺便一记\" class=\"headerlink\" title=\"顺便一记\"></a>顺便一记</h1><p>发现该问题是在使用Yii2.0项目开发出现的．一般我们都会配置urlManager, 正常配置一些rules，如下所示</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">'components'</span> =&gt; [</span><br><span class=\"line\">       ...</span><br><span class=\"line\">        <span class=\"string\">'urlManager'</span> =&gt; [</span><br><span class=\"line\">            <span class=\"string\">'enablePrettyUrl'</span> =&gt; <span class=\"keyword\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">'enableStrictParsing'</span> =&gt; <span class=\"keyword\">true</span>, <span class=\"comment\">//注意这里</span></span><br><span class=\"line\">            <span class=\"string\">'showScriptName'</span> =&gt; <span class=\"keyword\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">'rules'</span> =&gt; [</span><br><span class=\"line\">                <span class=\"string\">'webapp/&lt;module:\\w+&gt;/&lt;controller:[\\w-]+&gt;/&lt;action:[\\w-]+&gt;/&lt;id:[\\w\\d,]&#123;24&#125;(,[\\w\\d]&#123;24&#125;)*&gt;'</span>       =&gt; <span class=\"string\">'&lt;module&gt;/&lt;controller&gt;/&lt;action&gt;'</span>,</span><br><span class=\"line\">                <span class=\"string\">'webapp/&lt;module:\\w+&gt;/&lt;submodule:\\w+&gt;/&lt;controller:[\\w-]+&gt;/&lt;action:[\\w-]+&gt;/&lt;id:[\\w\\d,]&#123;24&#125;&gt;'</span>     =&gt; <span class=\"string\">'&lt;module&gt;/&lt;submodule&gt;/&lt;controller&gt;/&lt;action&gt;'</span>,</span><br><span class=\"line\">                <span class=\"string\">'webapp/&lt;module:\\w+&gt;/&lt;controller:[\\w-]+&gt;/&lt;action:[\\w-]+&gt;'</span>                                      =&gt; <span class=\"string\">'&lt;module&gt;/&lt;controller&gt;/&lt;action&gt;'</span>,</span><br><span class=\"line\">                <span class=\"string\">'webapp/&lt;module:\\w+&gt;/&lt;submodule:\\w+&gt;/&lt;controller:[\\w-]+&gt;/&lt;action:[\\w-]+&gt;'</span>                      =&gt; <span class=\"string\">'&lt;module&gt;/&lt;submodule&gt;/&lt;controller&gt;/&lt;action&gt;'</span>,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">        ],</span><br><span class=\"line\">       ...</span><br></pre></td></tr></table></figure>\n<p>这里添加了<code>enableStrictParsing</code>的配置，如果设置为true则表示所有的路由匹配只能在rules的列表里面，这要不是列表中的配置项就返回404（其实也未可厚非），但关键是要能够匹配到啊！</p>\n<p>因为之前配置的问题，使用了上面提到的第二种配置方式，根路径被吃掉了．一个请求过来会先做路由解析，到<code>/yii2/web/Request.php</code>里面的<code>resolve</code>方法</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    $result = Yii::$app-&gt;getUrlManager()-&gt;parseRequest(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($result !== <span class=\"keyword\">false</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">list</span> ($route, $params) = $result;</span><br><span class=\"line\">        $_GET = array_merge($_GET, $params);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> [$route, $_GET];</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NotFoundHttpException(Yii::t(<span class=\"string\">'yii'</span>, <span class=\"string\">'Page not found.'</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在解析路由中会使用我们之前配置的<code>urlManager</code>实例上的<code>parseRequest</code>方法，在<code>/yii2/web/UrlManager.php</code></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseRequest</span><span class=\"params\">($request)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;enablePrettyUrl) &#123;</span><br><span class=\"line\">        $pathInfo = $request-&gt;getPathInfo();</span><br><span class=\"line\">        <span class=\"comment\">/* <span class=\"doctag\">@var</span> $rule UrlRule */</span></span><br><span class=\"line\">       <span class=\"comment\">//这里匹配你自己配置的规则</span></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;rules <span class=\"keyword\">as</span> $rule) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//这里调用了rule对象的parseRequest方法，后面会追到</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (($result = $rule-&gt;parseRequest(<span class=\"keyword\">$this</span>, $request)) !== <span class=\"keyword\">false</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> $result;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">　　<span class=\"comment\">//这里是强制使用你自己配置生效的地方</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;enableStrictParsing) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        Yii::trace(<span class=\"string\">'No matching URL rules. Using default URL parsing logic.'</span>, <span class=\"keyword\">__METHOD__</span>);</span><br><span class=\"line\">　　<span class=\"comment\">//这里是yii自己默认生成的规则</span></span><br><span class=\"line\">        $suffix = (string) <span class=\"keyword\">$this</span>-&gt;suffix;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($suffix !== <span class=\"string\">''</span> &amp;&amp; $pathInfo !== <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">            $n = strlen(<span class=\"keyword\">$this</span>-&gt;suffix);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (substr_compare($pathInfo, <span class=\"keyword\">$this</span>-&gt;suffix, -$n, $n) === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                $pathInfo = substr($pathInfo, <span class=\"number\">0</span>, -$n);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ($pathInfo === <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// suffix alone is not allowed</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// suffix doesn't match</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> [$pathInfo, []];</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        Yii::trace(<span class=\"string\">'Pretty URL not enabled. Using default URL parsing logic.'</span>, <span class=\"keyword\">__METHOD__</span>);</span><br><span class=\"line\">        $route = $request-&gt;getQueryParam(<span class=\"keyword\">$this</span>-&gt;routeParam, <span class=\"string\">''</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (is_array($route)) &#123;</span><br><span class=\"line\">            $route = <span class=\"string\">''</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> [(string) $route, []];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>调试发现就是我们配置的路由规则没有生效，继续往下找，话说这个rule对象是什么鬼？搜索后发现，rule列表是在init的时候生成的</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">parent</span>::init();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;enablePrettyUrl || <span class=\"keyword\">empty</span>(<span class=\"keyword\">$this</span>-&gt;rules)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (is_string(<span class=\"keyword\">$this</span>-&gt;cache)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;cache = Yii::$app-&gt;get(<span class=\"keyword\">$this</span>-&gt;cache, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">　<span class=\"comment\">//根据是否配置了cache在cache里面也放一份</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;cache <span class=\"keyword\">instanceof</span> Cache) &#123;</span><br><span class=\"line\">        $cacheKey = <span class=\"keyword\">__CLASS__</span>;</span><br><span class=\"line\">        $hash = md5(json_encode(<span class=\"keyword\">$this</span>-&gt;rules));</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (($data = <span class=\"keyword\">$this</span>-&gt;cache-&gt;get($cacheKey)) !== <span class=\"keyword\">false</span> &amp;&amp; <span class=\"keyword\">isset</span>($data[<span class=\"number\">1</span>]) &amp;&amp; $data[<span class=\"number\">1</span>] === $hash) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;rules = $data[<span class=\"number\">0</span>];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;rules = <span class=\"keyword\">$this</span>-&gt;buildRules(<span class=\"keyword\">$this</span>-&gt;rules);</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;cache-&gt;set($cacheKey, [<span class=\"keyword\">$this</span>-&gt;rules, $hash]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;rules = <span class=\"keyword\">$this</span>-&gt;buildRules(<span class=\"keyword\">$this</span>-&gt;rules);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>主要逻辑就是调用<code>buildRules</code>生成规则对象，继续看buildRules的实现，发现rule是使用yii的createObject方法，默认用<code>yii\\web\\UrlRule</code>生成规则对象</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">buildRules</span><span class=\"params\">($rules)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    $compiledRules = [];</span><br><span class=\"line\">    $verbs = <span class=\"string\">'GET|HEAD|POST|PUT|PATCH|DELETE|OPTIONS'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> ($rules <span class=\"keyword\">as</span> $key =&gt; $rule) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (is_string($rule)) &#123;</span><br><span class=\"line\">            $rule = [<span class=\"string\">'route'</span> =&gt; $rule];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (preg_match(<span class=\"string\">\"/^((?:($verbs),)*($verbs))\\\\s+(.*)$/\"</span>, $key, $matches)) &#123;</span><br><span class=\"line\">                $rule[<span class=\"string\">'verb'</span>] = explode(<span class=\"string\">','</span>, $matches[<span class=\"number\">1</span>]);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!in_array(<span class=\"string\">'GET'</span>, $rule[<span class=\"string\">'verb'</span>])) &#123;</span><br><span class=\"line\">                    $rule[<span class=\"string\">'mode'</span>] = UrlRule::PARSING_ONLY;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                $key = $matches[<span class=\"number\">4</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $rule[<span class=\"string\">'pattern'</span>] = $key;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (is_array($rule)) &#123;</span><br><span class=\"line\">　　　<span class=\"comment\">// ruleConfig的默认配置如下:</span></span><br><span class=\"line\">　　　<span class=\"comment\">// public $ruleConfig = ['class' =&gt; 'yii\\web\\UrlRule'];</span></span><br><span class=\"line\">            $rule = Yii::createObject(array_merge(<span class=\"keyword\">$this</span>-&gt;ruleConfig, $rule));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!$rule <span class=\"keyword\">instanceof</span> UrlRuleInterface) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InvalidConfigException(<span class=\"string\">'URL rule class must implement UrlRuleInterface.'</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $compiledRules[] = $rule;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $compiledRules;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>再看<code>yii\\web\\UrlRule</code>的<code>parseRequest</code></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseRequest</span><span class=\"params\">($manager, $request)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;mode === <span class=\"keyword\">self</span>::CREATION_ONLY) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>(<span class=\"keyword\">$this</span>-&gt;verb) &amp;&amp; !in_array($request-&gt;getMethod(), <span class=\"keyword\">$this</span>-&gt;verb, <span class=\"keyword\">true</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $pathInfo = $request-&gt;getPathInfo();</span><br><span class=\"line\">    $suffix = (string) (<span class=\"keyword\">$this</span>-&gt;suffix === <span class=\"keyword\">null</span> ? $manager-&gt;suffix : <span class=\"keyword\">$this</span>-&gt;suffix);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($suffix !== <span class=\"string\">''</span> &amp;&amp; $pathInfo !== <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">        $n = strlen($suffix);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (substr_compare($pathInfo, $suffix, -$n, $n) === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            $pathInfo = substr($pathInfo, <span class=\"number\">0</span>, -$n);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($pathInfo === <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// suffix alone is not allowed</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;host !== <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        $pathInfo = strtolower($request-&gt;getHostInfo()) . ($pathInfo === <span class=\"string\">''</span> ? <span class=\"string\">''</span> : <span class=\"string\">'/'</span> . $pathInfo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//主要看这里，将匹配规则和匹配项目打印出来</span></span><br><span class=\"line\">    <span class=\"comment\">// var_dump([$this-&gt;pattern, $pathInfo]); </span></span><br><span class=\"line\">    <span class=\"comment\">// echo '&lt;/br&gt;';</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!preg_match(<span class=\"keyword\">$this</span>-&gt;pattern, $pathInfo, $matches)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;defaults <span class=\"keyword\">as</span> $name =&gt; $value) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>($matches[$name]) || $matches[$name] === <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">            $matches[$name] = $value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $params = <span class=\"keyword\">$this</span>-&gt;defaults;</span><br><span class=\"line\">    $tr = [];</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> ($matches <span class=\"keyword\">as</span> $name =&gt; $value) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;_routeParams[$name])) &#123;</span><br><span class=\"line\">            $tr[<span class=\"keyword\">$this</span>-&gt;_routeParams[$name]] = $value;</span><br><span class=\"line\">            <span class=\"keyword\">unset</span>($params[$name]);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">elseif</span> (<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;_paramRules[$name])) &#123;</span><br><span class=\"line\">            $params[$name] = $value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;_routeRule !== <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        $route = strtr(<span class=\"keyword\">$this</span>-&gt;route, $tr);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        $route = <span class=\"keyword\">$this</span>-&gt;route;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    Yii::trace(<span class=\"string\">\"Request parsed with URL rule: &#123;$this-&gt;name&#125;\"</span>, <span class=\"keyword\">__METHOD__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> [$route, $params];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>将匹配时候的正则表达式和最终匹配结果打印出来</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">array(2) &#123; [0]=&gt; string(103) &quot;#^webapp/(?P\\w+)/(?P[\\w-]+)/(?P[\\w-]+)/(?P[\\w\\d,]&#123;24&#125;(,[\\w\\d]&#123;24&#125;)*)$#u&quot; [1]=&gt; string(25) &quot;/demo/default/index&quot; &#125; </span><br><span class=\"line\">array(2) &#123; [0]=&gt; string(108) &quot;#^webapp/(?P\\w+)/(?P\\w+)/(?P[\\w-]+)/(?P[\\w-]+)/(?P[\\w\\d,]&#123;24&#125;)$#u&quot; [1]=&gt; string(25) &quot;/demo/default/index&quot; &#125; </span><br><span class=\"line\">array(2) &#123; [0]=&gt; string(69) &quot;#^webapp/(?P\\w+)/(?P[\\w-]+)/(?P[\\w-]+)$#u&quot; [1]=&gt; string(25) &quot;/demo/default/index&quot; &#125;</span><br></pre></td></tr></table></figure>\n<p>可以看到<code>/webapp</code>都被吃掉了，这就是之前nginx配置引起的问题了，正则中还有<code>^webapp</code>，所以匹配到才怪了呢～</p>\n","categories":[],"tags":["blog","nginx"]},{"title":"Git项目依赖管理 - submodule和subtree","url":"https://vincenthou.github.io/2015/09/09/Git项目依赖管理-submodule和subtree/","content":"<h1 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令\"></a>命令</h1><h2 id=\"指定目录结构添加子模块\"><a href=\"#指定目录结构添加子模块\" class=\"headerlink\" title=\"指定目录结构添加子模块\"></a>指定目录结构添加子模块</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git submodule add git@git.xxx.xxx:VincentHou/widget-slide.git widgets/slide</span><br></pre></td></tr></table></figure>\n<h2 id=\"根据目录结构删除子模块\"><a href=\"#根据目录结构删除子模块\" class=\"headerlink\" title=\"根据目录结构删除子模块\"></a>根据目录结构删除子模块</h2><ul>\n<li>删除git cache和物理文件夹</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rm -r --cached widget/slide</span><br><span class=\"line\">rm -rf widget/slide</span><br></pre></td></tr></table></figure>\n<ul>\n<li>删除gitsubmodule文件中的内容</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[submodule &quot;widget/slide&quot;]</span><br><span class=\"line\">    url = /home/repo/path/widget/slide.git</span><br></pre></td></tr></table></figure>\n<h2 id=\"忽略-dirty-commit\"><a href=\"#忽略-dirty-commit\" class=\"headerlink\" title=\"忽略 dirty commit\"></a>忽略 dirty commit</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[submodule <span class=\"string\">\"cpp-iniparser\"</span>]</span><br><span class=\"line\">    path = cpp-iniparser</span><br><span class=\"line\">    url = https://github.com/zausiu/cpp-iniparser</span><br><span class=\"line\">    ignore = dirty</span><br></pre></td></tr></table></figure>\n<h2 id=\"更新项目中的所有子模块的commit-ID\"><a href=\"#更新项目中的所有子模块的commit-ID\" class=\"headerlink\" title=\"更新项目中的所有子模块的commit ID\"></a>更新项目中的所有子模块的commit ID</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git submodule foreach git pull</span><br></pre></td></tr></table></figure>\n<h2 id=\"根据子模块远端的最新master分支代码更新子模块\"><a href=\"#根据子模块远端的最新master分支代码更新子模块\" class=\"headerlink\" title=\"根据子模块远端的最新master分支代码更新子模块\"></a>根据子模块远端的最新master分支代码更新子模块</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git submodule init</span><br><span class=\"line\">git submodule update --remote</span><br></pre></td></tr></table></figure>\n<h2 id=\"新拉项目-包括所有的子模块\"><a href=\"#新拉项目-包括所有的子模块\" class=\"headerlink\" title=\"新拉项目(包括所有的子模块)\"></a>新拉项目(包括所有的子模块)</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> --recursive /path/to/repos/foo.git</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用subtree管理项目依赖（不会生成依赖配置文件）\"><a href=\"#使用subtree管理项目依赖（不会生成依赖配置文件）\" class=\"headerlink\" title=\"使用subtree管理项目依赖（不会生成依赖配置文件）\"></a>使用subtree管理项目依赖（不会生成依赖配置文件）</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git subtree add --prefix &lt;path&gt; &lt;repo path&gt; branch --squash</span><br><span class=\"line\">git subtree pull --prefix &lt;path&gt; &lt;repo path&gt; branch --squash</span><br><span class=\"line\">git subtree push --prefix &lt;path&gt; &lt;repo path&gt; branch --squash</span><br></pre></td></tr></table></figure>\n<h1 id=\"Submodule的参考\"><a href=\"#Submodule的参考\" class=\"headerlink\" title=\"Submodule的参考\"></a>Submodule的参考</h1><p><a href=\"http://git-scm.com/book/en/v2/Git-Tools-Submodules\" target=\"_blank\" rel=\"noopener\">Official Guide</a><br><a href=\"http://fiji.sc/Git_submodule_tutorial\" target=\"_blank\" rel=\"noopener\">Submodules in Fiji</a><br><a href=\"https://medium.com/@porteneuve/mastering-git-submodules-34c65e940407\" target=\"_blank\" rel=\"noopener\">Mastering Git submodules</a><br><a href=\"http://www.kafeitu.me/git/2012/03/27/git-submodule.html\" target=\"_blank\" rel=\"noopener\">Git Submodule使用完整教程</a><br><a href=\"http://blog.devtang.com/blog/2013/05/08/git-submodule-issues/\" target=\"_blank\" rel=\"noopener\">Git Submodule的坑</a><br><a href=\"https://github.com/75team/novaUI/blob/master/.gitmodules\" target=\"_blank\" rel=\"noopener\">75team novaUI submodules</a></p>\n<h1 id=\"Subtree的参考\"><a href=\"#Subtree的参考\" class=\"headerlink\" title=\"Subtree的参考\"></a>Subtree的参考</h1><p><a href=\"http://blogs.atlassian.com/2013/05/alternatives-to-git-submodule-git-subtree/\" target=\"_blank\" rel=\"noopener\">Alternatives to Git Submodule Git Subtree</a><br><a href=\"https://developer.atlassian.com/blog/2015/05/the-power-of-git-subtree/\" target=\"_blank\" rel=\"noopener\">the Power of Git Subtree</a></p>\n<h1 id=\"两者的对比\"><a href=\"#两者的对比\" class=\"headerlink\" title=\"两者的对比\"></a>两者的对比</h1><p><a href=\"http://efe.baidu.com/blog/git-submodule-vs-git-subtree/\" target=\"_blank\" rel=\"noopener\">Git Submodule vs Git Subtree</a></p>\n","categories":[],"tags":["collection","git"]},{"title":"峰值系统设计[整理]","url":"https://vincenthou.github.io/2015/05/19/峰值系统设计-整理/","content":"<p><a href=\"http://weibo.com/p/1001603862417250608209\" target=\"_blank\" rel=\"noopener\">微博原文地址</a></p>\n<p>本文一共分析了三个案例，分别介绍并发系统中的共享资源并发访问、计算型密集型任务缓存访问 、单一热点资源峰值流量问题和解决方案。</p>\n<p>Q1：订票系统，某车次只有一张火车票，假定有1w个人同时打开12306网站来订票，如何解决并发问题？</p>\n<p>A1： 首先介绍数据库层面的并发访问，解决的办法主要是乐观锁和悲观锁。</p>\n<h2 id=\"乐观锁\"><a href=\"#乐观锁\" class=\"headerlink\" title=\"乐观锁\"></a>乐观锁</h2><p>假设不会发生并发冲突，只在提交操作时检查是否违反数据完整性。</p>\n<p>乐观锁使用一个自增的字段表示数据的版本号（或者timestamp），更新的时候检查版本号是否一致，比如数据库中版本号为4，更新时版本号使用版本号version=5，与数据库中的版本号version+1=（5）做比较，如果相等，则可以更新，如果不相等，其他程序已更新该记录，返回错误。</p>\n<h2 id=\"悲观锁\"><a href=\"#悲观锁\" class=\"headerlink\" title=\"悲观锁\"></a>悲观锁</h2><p>假定会发生并发冲突，屏蔽一切可能违反数据完整行的操作。</p>\n<p>一般需要使用数据库的锁机制，比如MysqlInnoDB引擎的行级锁。</p>\n<p>结论：在实际生产环境中，如果并发量不大且不允许脏读（原始数据为5，AB两个事务，B其他事务更新数据为2，事务未提交时，A读取到的仍然为5），可以使用悲观锁。并发访问量大时，使用悲观锁有非常大的性能问题，可以选择乐观锁。</p>\n<h2 id=\"其次，介绍一下Memcached的CAS机制\"><a href=\"#其次，介绍一下Memcached的CAS机制\" class=\"headerlink\" title=\"其次，介绍一下Memcached的CAS机制\"></a>其次，介绍一下Memcached的CAS机制</h2><p>CAS，又称Compare-and-Swap，代表一种原子操作。</p>\n<p>Memcached的CAS机制解决的问题及其原理：</p>\n<ol>\n<li>实现了Check-and-Set原子操作功能；</li>\n<li>其使用方式为：首先使用gets指令一个key-value及key对应value的版本号；其次操作产生新的value值；最后使用cas指令重新提交key-value，并附带刚刚获得到的版本号；</li>\n<li>当服务端判断cas操作中的版本号不是最新的时，则认为改key的值已经被修改，本次cas操作失败。程序设计人员通过CAS机制可实现自增和自减的原子操作；</li>\n</ol>\n<p>可以看到MemCache的CAS机制和数据库的乐观锁实现原理非常类似。</p>\n<p>Q2：假设系统中图片存储在TFS（Taobao File System)中，接口提供缩略图服务，首先在缓存中查找是否有缩略图，如果没有，则从TFS加载原图片，然后请求缩略图服务，缩略图计算完成后，设置回缓存服务中。</p>\n<p>遇到的问题：当一张图片分享给100w个人以后，同一时间有1w个并发请求，由于缩略图计算耗时较长（假设1s), 在这1s内，每个请求查询缓存都没有找到然后申请计算缩略图，导致重复的缩略图计算量和资源消耗。</p>\n<p><img src=\"http://ww4.sinaimg.cn/large/77062123jw1etvll319vcj20f50arabd.jpg\" alt=\"image\"></p>\n<p>A2：对于缩略图这种耗时的服务，非常适合使用缓存，不过在使用的时候，对于同一个图片，原则上只需要计算一次缩略图，在缩略图未计算完成时，可以对每张图片做额外的标记表示其正在Processing，并发请求遇到缩略图Processing时，可以等待缩略图计算完成（这是建议的方式）后从缓存直接读取，也可以是直接返回错误，通过客户端重试来解决。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">本案例中，如果缩略图请求在上传图片1分钟后才发生，则可以在后台预先计算缩略图并存储到缓存。另外就是在上传图片的时候计算缩略图，不过会增加上传图片的时间。</span><br></pre></td></tr></table></figure>\n<p>Q3:单点峰值流量，在并发系统中，除了请求整体的并发量高，还常见单一热点资源的并发请求量很高。例如，1万个人每人分享了一张图片，其中9999张图片的缩略图请求在10 QPS以内，剩下的一张图片为新闻热点图片，峰值请求在10万QPS左右， 系统会遇到的容量问题包括：1）接口前端机容量不够；2）缓存资源单实例遇到瓶颈。</p>\n<p>A3:针对单点峰值流量可能遇到的性能瓶颈，解决方案如下。</p>\n<p>1）接口层容量不够：这个问题比较简单，只要接口层设计是无状态的，当容量达到预警线，可以通过快速水平扩容解决。</p>\n<p>2）缓存资源单实例遇到性能瓶颈：如果使用的是分布式缓存，当希望突破单一key的访问瓶颈时（这个瓶颈既有可能是CPU资源紧张，也有可能是单机网络带宽跑满，还有可能是磁盘IO吞吐不够），一个办法是分布式缓存做多副本（x3）冗余设计，这样系统的吞吐量（x3）可以提高3倍，不过成本也提高3倍。另外一个办法是针对极热点数据，除了分布式缓存，同时在前端机上打开localCache，依靠数量众多的前端机来抗极热点请求。</p>\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference:\"></a>Reference:</h2><ul>\n<li><a href=\"http://www.csdn.net/article/2014-11-07/2822545\" target=\"_blank\" rel=\"noopener\">小米网抢购系统开发实践</a></li>\n<li><a href=\"http://www.csdn.net/article/2014-11-11/2822576\" target=\"_blank\" rel=\"noopener\">京东峰值系统设计</a></li>\n<li><a href=\"http://djt.qq.com/article/view/1349\" target=\"_blank\" rel=\"noopener\">微信红包系统设计 &amp; 优化</a></li>\n<li><a href=\"http://www.csdn.net/article/2014-11-28/2822858\" target=\"_blank\" rel=\"noopener\">Web系统大规模并发——电商秒杀与抢购</a></li>\n<li><a href=\"http://www.csdn.net/article/2014-11-04/2822459\" target=\"_blank\" rel=\"noopener\">电商峰值系统架构设计</a></li>\n<li><a href=\"http://www.csdn.net/article/2014-11-11/2822582\" target=\"_blank\" rel=\"noopener\">电商峰值监控经验谈</a></li>\n</ul>\n","categories":[],"tags":["collection","architecture"]},{"title":"Go 语言中的异常处理","url":"https://vincenthou.github.io/2015/05/11/Go-语言中的异常处理/","content":"<p><a href=\"http://studygolang.com/articles/2547\" target=\"_blank\" rel=\"noopener\">Go语言项目的错误和异常管理</a></p>\n","categories":[],"tags":["collection","go"]},{"title":"Go 语言中处理JSON的几种方式","url":"https://vincenthou.github.io/2015/04/12/Go-语言中处理JSON的几种方式/","content":"<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://attilaolah.eu/2013/11/29/json-decoding-in-go/\" target=\"_blank\" rel=\"noopener\">JSON decoding in go</a></li>\n<li><a href=\"http://attilaolah.eu/2014/09/10/json-and-struct-composition-in-go/\" target=\"_blank\" rel=\"noopener\">JSON and struct composition in go</a></li>\n<li><a href=\"https://eager.io/blog/go-and-json/\" target=\"_blank\" rel=\"noopener\">Go and JSON</a></li>\n<li><a href=\"https://github.com/ChimeraCoder/gojson\" target=\"_blank\" rel=\"noopener\">Generate go struct based on JSON</a></li>\n<li><a href=\"https://github.com/bitly/go-simplejson\" target=\"_blank\" rel=\"noopener\">Simple JSON</a></li>\n<li><a href=\"https://github.com/pquerna/ffjson\" target=\"_blank\" rel=\"noopener\">Faster JSON serialization for Go</a></li>\n<li><a href=\"https://github.com/spf13/cast\" target=\"_blank\" rel=\"noopener\">Type casting</a></li>\n</ul>\n","categories":[],"tags":["collection","go"]},{"title":"【翻译】 Angularjs 的一些模式","url":"https://vincenthou.github.io/2015/04/06/【翻译】-Angularjs-的一些模式/","content":"<h1 id=\"Angularjs-的一些模式\"><a href=\"#Angularjs-的一些模式\" class=\"headerlink\" title=\"Angularjs 的一些模式\"></a>Angularjs 的一些模式</h1><p>好久没有整理文章了，这次放个大招 :smile:。使用AngularJS开发应用也有一年的时间，感觉算是比较熟悉了，总想整理些东西出来沉淀一下，但每次想写的时候还是感觉写的深度不够。看了<a href=\"https://github.com/mgechev/angularjs-in-patterns\" target=\"_blank\" rel=\"noopener\">angularjs-in-patterns</a>，感觉正好和自己想整理的东西比较契合，就偷懒翻译一下，只是翻译之余结合项目中的经验，加入了自己的注解。还记得AngularJS的Demo看起来是多么的激动人心，理想很丰满，现实很骨感，真正工程应用起来也是各种的坑啊~~但是AngularJS的很多设计理念和开发思想还是值得借鉴的。也正是这些精心的设计节省了很多的代码，开发效率得到了很大的提升，但有时候原来一些看起来很简单的bug反而变得更加难修。个人感觉AngualrJS还是有他的适用场景的，不是所有项目都适合跟风式地上，CMS在这种模式下可能效果更好些。不过不管怎么说，AngularJS都是组件化的一个很好的思路，DRY在他的核心组件中都有体现。</p>\n<p><strong>Tip:</strong> 如果你有兴趣可以参考 <strong>Build Your Own AngularJS</strong> 这个<a href=\"https://github.com/teropa/build-your-own-angularjs\" target=\"_blank\" rel=\"noopener\">项目</a>实现一个你自己angular框架</p>\n<p>下面闲话少扯，进入正题。</p>\n<!--toc-->\n<h2 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h2><ul>\n<li><a href=\"#abstract\">概要</a></li>\n<li><a href=\"#introduction\">介绍</a></li>\n<li><a href=\"#angularjs-overview\">AngularJS 概述</a><ul>\n<li><a href=\"#partials\">模版</a></li>\n<li><a href=\"#controllers\">控制器</a></li>\n<li><a href=\"#scope\">作用域</a></li>\n<li><a href=\"#directives\">指令</a></li>\n<li><a href=\"#filters\">过滤器</a></li>\n<li><a href=\"#services\">服务</a></li>\n</ul>\n</li>\n<li><a href=\"#angularjs-patterns\">AngularJS 模式</a><ul>\n<li><a href=\"#services-1\">服务</a><ul>\n<li><a href=\"#singleton\">单例</a></li>\n<li><a href=\"#factory-method\">工厂方法</a></li>\n<li><a href=\"#decorator\">装饰器</a></li>\n<li><a href=\"#facade\">门面</a></li>\n<li><a href=\"#proxy\">代理</a></li>\n<li><a href=\"#active-record\">活动记录</a></li>\n<li><a href=\"#intercepting-filters\">拦截过滤器</a></li>\n</ul>\n</li>\n<li><a href=\"#directives-1\">指令</a><ul>\n<li><a href=\"#composite\">组合</a></li>\n</ul>\n</li>\n<li><a href=\"#interpreter\">拦截器</a><ul>\n<li><a href=\"#template-view\">模板视图</a></li>\n</ul>\n</li>\n<li><a href=\"#scope-1\">作用域</a><ul>\n<li><a href=\"#observer\">观察者</a></li>\n<li><a href=\"#chain-of-responsibilities\">责任链</a></li>\n<li><a href=\"#command\">命令</a></li>\n</ul>\n</li>\n<li><a href=\"#controller-1\">控制器</a><ul>\n<li><a href=\"#page-controller\">页面控制器</a></li>\n</ul>\n</li>\n<li><a href=\"#others\">其他</a><ul>\n<li><a href=\"#module-pattern\">模块模式</a></li>\n</ul>\n</li>\n<li><a href=\"#data-mapper\">数据映射</a></li>\n</ul>\n</li>\n<li><a href=\"#references\">参考</a></li>\n</ul>\n<!--endtoc-->\n<h2 id=\"概要\"><a href=\"#概要\" class=\"headerlink\" title=\"概要\"></a>概要</h2><p>学习新玩意最好的方法就是看看你已经烂熟于心的东西是怎么在新玩意里面被应用起来的。这篇文档不是要让读者熟悉设计和架构模式，只是想聊聊基本的OOP概念，设计模式和机构模式。<br>这篇文章的主要是想讲讲不同的软件设计和架构模式是如何在AngularJS和AngularJS的单页应用中应用的。</p>\n<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>本文第一章先从AngularJS框架的简单概要说起。这点概要解释了AngularJS的主要组件 - 指令，过滤器，控制器，服务，作用域。第二章的部分描述了在框架中不同的设计和架构模式的实现。这些模式是按照被应用模式的AngularJS组件进行分组的。如果一些模式被多个组件使用，将会有显示的声明。最后一章包含了一些在大多数AngularJS单页应用中被使用的架构模式。</p>\n<h2 id=\"AngularJS-概述\"><a href=\"#AngularJS-概述\" class=\"headerlink\" title=\"AngularJS 概述\"></a>AngularJS 概述</h2><p>AngularJS是Google开发的Javascript框架。他就是为了开发基于增删改查的单页应用而生的。SPA是一种网页应用，它只会加载一次，在用户对它进行任何进一步的操作时都不需要重新加载整个页面。这就意味着所有的应用资源（数据，模板，脚本，样式）都要在初始请求载入或者更好 - 按需加载。因为大部分的增删改查应用有共同的特性和需求，AngularJS就是要提供开箱即用的优化工具集。一些重要的AngularJS特性是：</p>\n<ul>\n<li>双向数据绑定</li>\n<li>依赖注入</li>\n<li>关注点分离</li>\n<li>可测性</li>\n<li>抽象</li>\n</ul>\n<p>关注点分离是通过将每个AngularJS应用拆分成不同的组件，例如：</p>\n<ul>\n<li>模板</li>\n<li>控制器</li>\n<li>指令</li>\n<li>服务</li>\n<li>过滤器</li>\n</ul>\n<p>这些组件能够在不同的模块内被分组，这样有助于获得更高层次的抽象并且控制复杂度。每个组件封装了应用逻辑的某个特定的逻辑。</p>\n<p><strong>注解：</strong> 单页应用提升了应用的使用体验，但是却提高了开发的复杂度，复杂度过高促使软件可控性下降，bug增多。所以其实单页应用不是银弹，根据需要有针对性的使用才好，控制好可变化的范围和变化时机才能更好利用单页应用的特性。前端应用现在变得越来越复杂，很多原来后端的概念和工作都拿到前端来做，静态资源的管理更多是一个工程问题而不仅仅是个技术问题。对于首次全部加载的方式没有什么特别的，就是对于AMD(requirejs)模块使用R.js压成一个文件，前后端公用CommonJS模块使用browserfiy打包成一个bundle，使用强缓存，数字签名管理性能和部署。这种方式当然是比较简单粗暴的，更合理的方式当然是按需加载，特别是大型项目中尤为重要。现在有很多现成的工具支持lazyload，requirejs原生就支持，当然跟AngularJS也有很好的集成工具，在模块层面，controller层面都能做。这里涉及到更重要的点其实是合理的模块差分，公共模块的分离，复用范围的控制，更合理的划分加载模式才能达到更好的加载性能。AngularJS内置组件的定义很规范，也正是这种关注点分离的思想保证了前端模块的可测性。</p>\n<h3 id=\"模板\"><a href=\"#模板\" class=\"headerlink\" title=\"模板\"></a>模板</h3><p>模板就是HTML字符串，在元素或者属性中定义的AngularJS表达式会包含在模板里，AngularJS和其他框架最大的一个不同点就在于AngularJS的模板不是一种需要被转化为HTML的中间格式（mustache.js和handlerbars就是这种套路）。<br>初始时，每个单页应用加载 <code>index.html</code> 文件。在AngularJS的应用中，这个文件会包含一组标准和自定义的HTML属性，元素和注释，这些东西会配置并且拉起应用。每个后续的用户动作只需要加载另外的模板或者改变应用的状态，例如通过框架提供的数据绑定。</p>\n<p><strong>简单模板</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">ng-app</span>&gt;</span></span><br><span class=\"line\"> <span class=\"comment\">&lt;!-- Body tag augmented with ngController directive  --&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">ng-controller</span>=<span class=\"string\">\"MyController\"</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ng-model</span>=<span class=\"string\">\"foo\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"bar\"</span>&gt;</span></span><br><span class=\"line\">   <span class=\"comment\">&lt;!-- Button tag with ng-click directive, and</span></span><br><span class=\"line\"><span class=\"comment\">          string expression 'buttonText'</span></span><br><span class=\"line\"><span class=\"comment\">          wrapped in \"&#123;&#123; &#125;&#125;\" markup --&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">ng-click</span>=<span class=\"string\">\"changeFoo()\"</span>&gt;</span>&#123;&#123;buttonText&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"angular.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>模板通过AngularJS表达式定义对于什么样的用户操作会触发什么样的动作被执行。在上面的例子中， <code>ng-click</code> 属性表明在当前作用域下的 <code>changeFoo</code> 方法会在用户点击之后执行。</p>\n<p><strong>注解：</strong> AngularJS的模板支持很多声明式语法。为了语义，表现和结构的分离，前端一直推荐非侵入式的JS编程。AnguarJS反其道而行之，支持很多与页面绑定的行为定义，个人感觉完美主义还是要结合现实的，毕竟侵入式的写法真的很方便，而且其实很多行为本身就是是和语义结构绑定的。结合UI-Router可以实现更方便的自状态页面控制，让模板的渲染更加灵活。</p>\n<h3 id=\"控制器\"><a href=\"#控制器\" class=\"headerlink\" title=\"控制器\"></a>控制器</h3><p>AngularJS的控制器就是Javascript的方法，通过在 <em>scope</em> 上面绑定方法来处理用户和应用的交互（例如鼠标事件，键盘事件等等）。对于控制器需要的外部依赖组件都通过AngularJS的依赖注入机制提供。控制器也通过在 <em>scope</em> 上面绑定数据提供模板的 <em>model</em>。我们能把这种数据当作 <em>view model</em>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyController</span>(<span class=\"params\">$scope</span>) </span>&#123;</span><br><span class=\"line\">  $scope.buttonText = <span class=\"string\">'Click me to change foo!'</span>;</span><br><span class=\"line\">  $scope.foo = <span class=\"number\">42</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  $scope.changeFoo = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    $scope.foo += <span class=\"number\">1</span>;</span><br><span class=\"line\">    alert(<span class=\"string\">'Foo changed'</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>举个例子，如果我们把上面的样例控制器绑在前面章节示例的模板上面，用户就能和应用进行一些不同方式的交互。</p>\n<ol>\n<li>通过在文本输入框中输入文字改变 <code>foo</code> 的值。因为双向绑定机制，输入的值将会立即反映到 <code>foo</code> 的值上面。</li>\n<li>通过点击带有 <code>Click me to change foo!</code> 标签的按钮也能改变 <code>foo</code> 的值</li>\n</ol>\n<p>如果之前被定义过，所有的自定义元素，属性，注释或者类都能被识别为AngularJS _指令_。</p>\n<p><strong>注解：</strong> 控制器大都是跟页面绑定的，可复用性相对较差，跟之前用Jquery做页面的思路其实大致相同，都是做一些初始化，数据缓存，事件绑定。就是通过AJAX局部刷新的时候比较方便，双向绑定的机制让我们只需要关心维护视图模型，视图模型变动引起的视图改变通过监听视图模型的指令来完成，很多不复杂并且相同的视图更新操作都能封装起来。MVC在前端也有很多尝试，但个人觉得Controller一层可能有点鸡肋，一般场景下的视图模型和视图的关联都是很固定的，这也是现在MVVM更流行的其中一个原因吧。忍不住赞一下依赖注入特性，真的是开箱即用，只是为了压缩写法上稍微有些不自然，不过现在好像有工具能支持去掉二次声明了。</p>\n<h3 id=\"作用域\"><a href=\"#作用域\" class=\"headerlink\" title=\"作用域\"></a>作用域</h3><p>AngularJS的作用域就是个暴露给模板的Javascript对象。作用域能够包含不同的属性 -内置类型，对象和方法。所有绑定在作用域上面的方法能够通过AngularJS指定作用域的模板里面定义的表达式求值被调用，也能够保留作用域的引用被组件直接调用。通过使用合适的 _指令_，关联到作用域的数据能够被绑定到视图上。每次页面的变动都会反映到作用域属性上，同时每次作用域属性的变动都会反映到页面上。</p>\n<p>作用域通过原型链连接（除了以 <em>isolated</em> 显示开头的作用域）是任何AngularJS应用的另外一个重要作用域特性。因为子作用域的父级属性是它们的直接或者间接原型，这样使得任何的子作用域就能调用父作用域的方法。</p>\n<p>作用域继承通过下面的例子说明：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ng-controller</span>=<span class=\"string\">\"BaseCtrl\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"child\"</span> <span class=\"attr\">ng-controller</span>=<span class=\"string\">\"ChildCtrl\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"parent-method\"</span> <span class=\"attr\">ng-click</span>=<span class=\"string\">\"foo()\"</span>&gt;</span>Parent method<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">ng-click</span>=<span class=\"string\">\"bar()\"</span>&gt;</span>Child method<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">BaseCtrl</span>(<span class=\"params\">$scope</span>) </span>&#123;</span><br><span class=\"line\">  $scope.foo = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'Base foo'</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ChildCtrl</span>(<span class=\"params\">$scope</span>) </span>&#123;</span><br><span class=\"line\">  $scope.bar = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'Child bar'</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>div#child</code> 绑上 <code>ChildCtrl</code> ，但是因为注入到 <code>ChildCtrl</code> 中的作用域原型继承自父作用域 (例如 注入到 <code>BaseCtrl</code> 中的作用域) <code>foo</code> 方法能够被 <code>button#parent-method</code> 访问到。</p>\n<p><strong>注解：</strong> Javascript本身没有继承机制，所有的所谓继承都是通过原型链实现的，AngularJS的作用域也就有了原型链的特性，当前没有向上找，一般情况下不推荐这种依赖继承层级关系的数据传递，父子级别的数据依赖还是通过pub/sub机制比较好，需求变动改动起来也方便。有时候依赖这种层次关系的数据产生的bug调起来真的很头大，通过Controller As的语法能够更好避免类似的问题。</p>\n<h3 id=\"指令\"><a href=\"#指令\" class=\"headerlink\" title=\"指令\"></a>指令</h3><p>所有DOM操作应该被放在指令里面。作为一条经验法则，当你在Controller里面有DOM操作的需要，要么你就弄个新的出来，要么重构已经有的能够处理必要DOM操作的指令。<br>每个指令都会有个名字和相关联的逻辑。最简单的指令示例中仅仅包含了名字和 <em>postLink</em> 方法的定义，所有必要的逻辑都被封装在指令里面。更复杂的指令中可能包含一些属性，例如：</p>\n<ul>\n<li>template</li>\n<li>compile 方法</li>\n<li>link 方法</li>\n<li>等等…</li>\n</ul>\n<p>通过引用指令的名字，指令能够在声明式模板中被使用。</p>\n<p>例子:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myModule.directive(<span class=\"string\">'alertButton'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    template: <span class=\"string\">'&lt;button ng-transclude&gt;&lt;/button&gt;'</span>,</span><br><span class=\"line\">    scope: &#123;</span><br><span class=\"line\">      content: <span class=\"string\">'@'</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    replace: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    restrict: <span class=\"string\">'E'</span>,</span><br><span class=\"line\">    transclude: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    link: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">scope, el</span>) </span>&#123;</span><br><span class=\"line\">      el.click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        alert(scope.content);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">alert-button</span> <span class=\"attr\">content</span>=<span class=\"string\">\"42\"</span>&gt;</span>Click me<span class=\"tag\">&lt;/<span class=\"name\">alert-button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>上面例子中的标签 <code>&lt;alert-button&gt;&lt;/alert-button&gt;</code> 会被按钮元素给替换。当用户点击按钮，字符串 <code>42</code> 会被弹出来。</p>\n<p>因为这篇文章不是要解释AngularJS的复杂API，我们对于指令的描述在这里打住。</p>\n<p><strong>注解：</strong> 指令作为AngularJS对于Web Components的实现，在一定程度上实现了UI的组件化开发，但是基于视图模型的限制，AngularJS能够实现的组件功能相对较弱，因为双向绑定的特性也带来了AngularJS组件的性能瓶颈。有时候一个指令的外部接口输入输出格式是什么样的，哪些要双向绑定，哪些要单向绑定，哪些要有回调方法可能很难一次定义清楚，要不断重构和积累。其实ReactJS在UI组件化上的效果更好，因为只关注视图层，它可以很方便的继承到现有系统中，也有像Angular-react这样的项目可以结合两者的优势。</p>\n<h3 id=\"过滤器\"><a href=\"#过滤器\" class=\"headerlink\" title=\"过滤器\"></a>过滤器</h3><p>AngularJS的过滤器就是用来封装格式化数据的必要逻辑。一般过滤器用在模板里面，但是在控制器，指令， _服务_ 和其他的过滤器里面通过依赖注入也是能够访问到的。</p>\n<p>这里有个样例过滤器的定义，就是把指定的字符串中字母转化为大写。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myModule.filter(<span class=\"string\">'uppercase'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (str || <span class=\"string\">''</span>).toUpperCase();</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>在模板里面这个过滤器能够通过Unix的管道语法来使用：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; name | uppercase &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在控制器里面，过滤器能够像下面一样使用：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyCtrl</span>(<span class=\"params\">uppercaseFilter</span>) </span>&#123;</span><br><span class=\"line\">  $scope.name = uppercaseFilter(<span class=\"string\">'foo'</span>); <span class=\"comment\">//FOO</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>注解：</strong> 大部分情况下，AngularJS的内置过滤器就能满足我们大部分的应用需要了，结合业务需要会有少量的补充，本质上就是对于数据集的重新格式化，结合列表可以实现排序或者预处理的工作，用惯了Linux系统看着这语法还是很亲切的。</p>\n<h3 id=\"服务\"><a href=\"#服务\" class=\"headerlink\" title=\"服务\"></a>服务</h3><p>任何一段不属于上面描述组件的逻辑块应该被放在服务中。通常服务封装领域相关逻辑，持久化逻辑，异步请求，长连接等等。当应用中的控制器变得越来越臃肿，重复的代码应该放到服务中。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myModule.service(<span class=\"string\">'Developer'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = <span class=\"string\">'Foo'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.motherLanguage = <span class=\"string\">'JavaScript'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.live = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.code();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>服务能够被注入到任何支持依赖注入的组件中（控制器，其他服务，过滤器，指令）。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyCtrl</span>(<span class=\"params\">developer</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> developer = <span class=\"keyword\">new</span> Developer();</span><br><span class=\"line\">  developer.live();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>注解：</strong> 服务可以看作我们应用开发中的Util方法集，通过特定功能和应用场景分组，将重复的代码抽取出来，因为需求上一般呈现出的是功能上的一致性，公共需求的改动只需要在单一的地方处理就好了。例如，异步请求的调用，当我们需要统一处理后台异常状态码的时候，改动可以最小化，同时不会对原有业务逻辑产生影响。有些公共服务是能够直接识别出来的，更多时候在业务需求基本稳定之后，Copy&amp;Paste的代码就要通过重构提取成一个服务。</p>\n<h2 id=\"AngularJS-模式\"><a href=\"#AngularJS-模式\" class=\"headerlink\" title=\"AngularJS 模式\"></a>AngularJS 模式</h2><p>下面的章节，我们就要看看传统的设计和架构模式是怎样在AngularJS的组件中组合应用的。</p>\n<p>最后一章我们会看看一些经常在AngularJS单页应用开发（不仅限于此）中使用的架构模式。</p>\n<h3 id=\"服务-1\"><a href=\"#服务-1\" class=\"headerlink\" title=\"服务\"></a>服务</h3><h4 id=\"单例\"><a href=\"#单例\" class=\"headerlink\" title=\"单例\"></a>单例</h4><blockquote>\n<p>单例模式是一种限制类的实例只有一个的设计模式。 当只需要一个对象来协调系统中的操作时，这种设计模式很有用。这种概念有时指代只有一个对象存在会更高效运作或者将初始化限制在一定数量的对象上的系统。</p>\n</blockquote>\n<p>下面的UML图中描绘了单例设计模式。</p>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/singleton.svg\" alt=\"单例\"></p>\n<p>当指定了任何组件需要的依赖之后，AngularJS是遵循下面的算法处理的：</p>\n<ul>\n<li>取得依赖组件的名字并且在定义在词法闭包中的哈希表里查找（所以它具有私有可见性）。</li>\n<li>如果依赖存在，AngularJS将它作为参数传递给需要它的组件。</li>\n<li>如果依赖不存在:<ul>\n<li>AngularJS 通过调用依赖提供者的工厂方法将它实例化（例如 <code>$get</code>）。为了处理所有的依赖需要的必要依赖，初始化依赖可能需要基于相同的算法递归的调用。这个过程可能会造成循环以来。</li>\n<li>AngularJS 在上面提到的哈希表里面缓存它。</li>\n<li>AngularJS 将它作为参数传递给依赖它的组件。</li>\n</ul>\n</li>\n</ul>\n<p>我们能够在AngularJS源码中的 <code>getService</code> 方法里看到清楚的实现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getService</span>(<span class=\"params\">serviceName</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (cache.hasOwnProperty(serviceName)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cache[serviceName] === INSTANTIATING) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> $injectorMinErr(<span class=\"string\">'cdep'</span>, <span class=\"string\">'Circular dependency found: &#123;0&#125;'</span>, path.join(<span class=\"string\">' &lt;- '</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cache[serviceName];</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      path.unshift(serviceName);</span><br><span class=\"line\">      cache[serviceName] = INSTANTIATING;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> cache[serviceName] = factory(serviceName);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (cache[serviceName] === INSTANTIATING) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">delete</span> cache[serviceName];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> err;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">      path.shift();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们能够把所有的服务当作是单例的，因为所有的服务都不会被实例化两次。我们能够把缓存看作单例管理器。这里跟标准的单例有点不一样，我们不是在构造方法中保存对于单例的静态私有引用，而是在单例管理器（在上面的代码片段中定义为 <code>cache</code>）里面直接保留了引用。</p>\n<p>通过这种方式服务实际上都是单例但是不是通过单例模式实现的，这样比标准的实现提供了一些便利：</p>\n<ul>\n<li>它提升了你源代码的可测性</li>\n<li>你能控制单例对象的创建（在我们的例子中IoC容器通过延迟实例化单例为我们控制它）</li>\n</ul>\n<p>对相关主题的讨论可以看 Misko Hevery 在谷歌测试博客上的 <a href=\"http://googletesting.blogspot.com/2008/05/tott-using-dependancy-injection-to.html\" target=\"_blank\" rel=\"noopener\">文章</a> 。</p>\n<h4 id=\"工厂方法\"><a href=\"#工厂方法\" class=\"headerlink\" title=\"工厂方法\"></a>工厂方法</h4><blockquote>\n<p>工厂方法模式是一种创建者模式，工厂方法用来处理对象的创建而不需要指定具体将要被创建对象所对应的类。 这是通过一个工厂方法来创建对象来做到的，可能是在一个实现定义接口（抽象类） 的类（实现类）或者在基类中实现，通过继承类覆盖，而不是通过构造器。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/factory-method.svg\" alt=\"工厂方法\"></p>\n<p>让我们看下面的代码片段:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myModule.config(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$provide</span>) </span>&#123;</span><br><span class=\"line\">  $provide.provider(<span class=\"string\">'foo'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> baz = <span class=\"number\">42</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">//Factory method</span></span><br><span class=\"line\">      $<span class=\"keyword\">get</span>: function (bar) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> baz = bar.baz();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">          baz: baz</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>上面的代码我们使用 <code>config</code> 回调来定义新的 “provider”. Provider 是个新对象, 有个叫 <code>$get</code>的方法。因为在JavaScript里我们不会有接口，并且这种语言是鸭子类型的，对于providers有这么个命名工厂方法的约定。</p>\n<p>每个服务，过滤器，指令和控制器都有一个provider (例如 对象有个叫 <code>$get</code> 的工厂方法), 负责创建组件的实例。</p>\n<p>我们可以深入挖掘下AngularJS的实现</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\">createInternalInjector(instanceCache, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">servicename</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> provider = providerInjector.get(servicename + providerSuffix);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> instanceInjector.invoke(provider.$<span class=\"keyword\">get</span>, provider, undefined, servicename);</span><br><span class=\"line\">&#125;, strictDi));</span><br><span class=\"line\"></span><br><span class=\"line\">//...</span><br><span class=\"line\"></span><br><span class=\"line\">function invoke(fn, self, locals, serviceName)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> locals === <span class=\"string\">'string'</span>) &#123;</span><br><span class=\"line\">    serviceName = locals;</span><br><span class=\"line\">    locals = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = [],</span><br><span class=\"line\">      $inject = annotate(fn, strictDi, serviceName),</span><br><span class=\"line\">      length, i,</span><br><span class=\"line\">      key;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(i = <span class=\"number\">0</span>, length = $inject.length; i &lt; length; i++) &#123;</span><br><span class=\"line\">    key = $inject[i];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> key !== <span class=\"string\">'string'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> $injectorMinErr(<span class=\"string\">'itkn'</span>,</span><br><span class=\"line\">              <span class=\"string\">'Incorrect injection token! Expected service name as string, got &#123;0&#125;'</span>, key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    args.push(</span><br><span class=\"line\">      locals &amp;&amp; locals.hasOwnProperty(key)</span><br><span class=\"line\">      ? locals[key]</span><br><span class=\"line\">      : getService(key)</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!fn.$inject) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// this means that we must be an array.</span></span><br><span class=\"line\">    fn = fn[length];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn.apply(self, args);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>从上面的例子中我们能够看到 <code>$get</code> 方法实际是如何被使用的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">instanceInjector.invoke(provider.$<span class=\"keyword\">get</span>, provider, undefined, servicename)</span><br></pre></td></tr></table></figure>\n<p>上面的代码片段通过调用 <code>instanceInjector</code> 的 <code>invoke</code> 方法将指定服务的工厂方法（例如 <code>$get</code>）作为第一个参数来调用。 在 <code>invoke</code> 方法内工厂方法作为第一个参数被 <code>annotate</code> 调用。注解通过AngularJS的依赖注入机制处理所有的依赖，就像上面考虑到的。当所有的依赖都被处理好之后工厂方法被调用： <code>fn.apply(self, args)</code>。</p>\n<p>如果我们按照UML图来考虑上面的行为，我们能够称这个provider是个 “ConcreteCreator”，而实际的组件是生产出来的”Product”。</p>\n<p>在这种场景下因为不是直接创建对象，使用工厂模式有一些好处。通过这种方式框架能够在新组件实例化的时候处理好样板：</p>\n<ul>\n<li>组件需要被实例化的最佳时机</li>\n<li>处理好组件必要的所有依赖</li>\n<li>指定组件被允许创建的最多实例数量（对于服务和过滤器只有单个，但是对于控制器会有多个）<h4 id=\"装饰器\"><a href=\"#装饰器\" class=\"headerlink\" title=\"装饰器\"></a>装饰器</h4></li>\n</ul>\n<blockquote>\n<p>装饰器模式（配器模式中也被称作包装器）是允许在不影响类创建的其他对象前提下将行为静态地或者动态地添加到独立对象上的一种设计模式。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/decorator.svg\" alt=\"装饰器\"></p>\n<p>AngularJS 提供了开箱即用扩展或者增强已有服务功能的方式。通过使用 <code>$provide</code> 的 <code>decorator</code> 方法，你可以创建任何先前定义服务或者第三方服务的包装器：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myModule.controller(<span class=\"string\">'MainCtrl'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">foo</span>) </span>&#123;</span><br><span class=\"line\">  foo.bar();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">myModule.factory(<span class=\"string\">'foo'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    bar: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">'I\\'m bar'</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    baz: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">'I\\'m baz'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">myModule.config(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$provide</span>) </span>&#123;</span><br><span class=\"line\">  $provide.decorator(<span class=\"string\">'foo'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$delegate</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> barBackup = $delegate.bar;</span><br><span class=\"line\">    $delegate.bar = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">'Decorated'</span>);</span><br><span class=\"line\">      barBackup.apply($delegate, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $delegate;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>上面的例子定义了叫做 <code>foo</code> 的新服务。在 <code>config</code> 的回调中我们想要包装服务的名称 <code>&quot;foo&quot;</code>作为第一个参数被 <code>$provide.decorator</code> 调用，第二个工厂方法参数实现了真正的包装。 <code>$delegate</code> 保存了原始服务 <code>foo</code> 的引用。依赖于AngularJS的依赖注入机制，对于局部依赖的引用被作为构造函数的第一个参数传进去。<br>我们通过覆盖 <code>bar</code> 方法来装饰服务。实际的装饰只是通过额外调用 <code>console.log statement</code> - <code>console.log(&#39;Decorated&#39;);</code> 并且在这之后调用原始的有适当上下文的 <code>bar</code> 方法来扩展服务的 <code>bar</code> 方法。</p>\n<p>这种模式尤其在我们需要修改第三方服务的时候有用。如果需要多个相似的装饰器需要被添加（像对于多个方法的性能评估，授权，日志等等），我们会有很多的重复并且违背DRY原则. 在这种情况下使用<a href=\"http://en.wikipedia.org/wiki/Aspect-oriented_programming\" target=\"_blank\" rel=\"noopener\">面向切面编程</a>会更好. 我所知道AngularJS最好的AOP框架是这个 <a href=\"https://github.com/mgechev/angular-aop\" target=\"_blank\" rel=\"noopener\">github.com/mgechev/angular-aop</a>.</p>\n<h4 id=\"门面\"><a href=\"#门面\" class=\"headerlink\" title=\"门面\"></a>门面</h4><blockquote>\n<p>门面就是个封装了一大坨代码（例如某个类库），仅仅提供最简单接口的对象。门面能够：</p>\n<ol>\n<li>让软件库更好用，理解并且测试，因为门面对于公共的任务有便捷的方法；</li>\n<li>基于同样的原因让软件库可读性更好；</li>\n<li>在库内部减少对于外部代码的依赖，因为大部分代码使用门面，这样允许在系统中有更多的复杂性；</li>\n<li>将定义的很烂的一组API用一个设计良好的API来封装（按照不同任务的需要）。</li>\n</ol>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/facade.svg\" alt=\"门面\"></p>\n<p>在AngularJS中有很多门面. 每次要为给定功能提供更高层次API的时候，你实际上就是在创建一个门面。</p>\n<p>例如，让我们看看我们怎么创建一个 <code>XMLHttpRequest</code> POST 请求：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"keyword\">new</span> XMLHttpRequest(),</span><br><span class=\"line\">    url = <span class=\"string\">'/example/new'</span>,</span><br><span class=\"line\">    params = <span class=\"built_in\">encodeURIComponent</span>(data);</span><br><span class=\"line\">http.open(<span class=\"string\">\"POST\"</span>, url, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">http.setRequestHeader(<span class=\"string\">\"Content-type\"</span>, <span class=\"string\">\"application/x-www-form-urlencoded\"</span>);</span><br><span class=\"line\">http.setRequestHeader(<span class=\"string\">\"Content-length\"</span>, params.length);</span><br><span class=\"line\">http.setRequestHeader(<span class=\"string\">\"Connection\"</span>, <span class=\"string\">\"close\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">http.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(http.readyState == <span class=\"number\">4</span> &amp;&amp; http.status == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">    alert(http.responseText);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">http.send(params);</span><br></pre></td></tr></table></figure>\n<p>但是如果你想要将数据通过AngularJS的 <code>$http</code> 服务来发送，你会这样写:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$http(&#123;</span><br><span class=\"line\">  method: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">  url: <span class=\"string\">'/example/new'</span>,</span><br><span class=\"line\">  data: data</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  alert(response);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>or we can even:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$http.post(<span class=\"string\">'/someUrl'</span>, data)</span><br><span class=\"line\">.then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  alert(response);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>第二种选择提供了预配置的版本，对于指定的URL创建了一个HTTP的POS请求。</p>\n<p>更高程度的抽象通过 <code>$resource</code> 创建,  <code>$resource</code> 是基于 <code>$http</code> 服务的. 我们会在<a href=\"#active-record\">活动记录</a>和<a href=\"#proxy\">代理</a>章节中进一步讨论 <code>$http</code> 服务.</p>\n<h4 id=\"代理\"><a href=\"#代理\" class=\"headerlink\" title=\"代理\"></a>代理</h4><blockquote>\n<p>一个代理，一般化的形式上，是某个类作为其他东西的接口工作。代理能够作为一切的接口： 网络连接，内存中的大对象，文件或者一些其他难以或者不能复制的资源。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/proxy.svg\" alt=\"代理\"></p>\n<p>我们可以分出三种不同类型的代理：</p>\n<ul>\n<li>虚拟代理</li>\n<li>远程代理</li>\n<li>受保护代理</li>\n</ul>\n<p>在这个子章节中我们会看看AngularJS对于虚拟代理的实现。</p>\n<p>在下面的代码片段中，调用了叫 <code>User</code> 的 <code>$resource</code> 实例方法 <code>get</code> ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> User = $resource(<span class=\"string\">'/users/:id'</span>),</span><br><span class=\"line\">    user = User.get(&#123; <span class=\"attr\">id</span>: <span class=\"number\">42</span> &#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(user); <span class=\"comment\">//&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n<p><code>console.log</code> 会打印出来个空对象。因为AJAX请求发生在后台，当 <code>User.get</code> 被调用的时候是异步的，在 <code>console.log</code> 被调用的时候，我们还没有获得实际的user。在 <code>User.get</code> 发送GET请求之后，仅仅返回一个空对象并且保留对于它的引用。我们可以把这个对象当作虚拟代理（一个简单的占位符）。在客户端获取到服务器上实际的数据之后这个占位符才会被填充。</p>\n<p>AngularJS是怎么做到的呢? 好了，让我们看看下面的代码片段：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MainCtrl</span>(<span class=\"params\">$scope, $resource</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> User = $resource(<span class=\"string\">'/users/:id'</span>),</span><br><span class=\"line\">  $scope.user = User.get(&#123; <span class=\"attr\">id</span>: <span class=\"number\">42</span> &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">ng-bind</span>=<span class=\"string\">\"user.name\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>开始的时候，上面的代码片段执行， <code>$scope</code> 对象的 <code>user</code> 属性会被赋予一个空对象 (<code>{}</code>)，这意味着 <code>user.name</code> 将会是未定义，啥也不会渲染。AngularJS内部会保留这个空对象的引用。一旦服务器返回get请求的数据，AngularJS 会用从服务其上获取到的数据填充对象。在下个 <code>$digest</code> 循环中AngularJS会检测到 <code>$scope.user</code>的变化, 进而触发视图的渲染。</p>\n<h4 id=\"活动记录\"><a href=\"#活动记录\" class=\"headerlink\" title=\"活动记录\"></a>活动记录</h4><blockquote>\n<p>活动记录是一种包含了数据和行为的对象。通常这种对象的大部分数据是持久化的。活动记录的职责就是处理好和数据库增删改查的通信。它可能会将这种职责代理给更低级别的对象，但是会调用活动记录的实例或者静态方法来和数据库通信。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/active-record.svg\" alt=\"活动记录\"></p>\n<p>AngularJS 定义了叫 <code>$resource</code> 的服务。在当前的AngularJS版本(1.2+)，它是排除在AngularJS的核心模块之外的.</p>\n<p>依据AngularJS的文档， <code>$resource</code> 是：</p>\n<blockquote>\n<p>一个创建了跟Restful服务器数据源进行交互的资源对象工厂实例<br>资源对象返回的对象有更高层次的方法，这样就不需要直接使用相对底层的$http服务</p>\n</blockquote>\n<p><code>$resource</code> 是这样用的:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> User = $resource(<span class=\"string\">'/users/:id'</span>),</span><br><span class=\"line\">    user = <span class=\"keyword\">new</span> User(&#123;</span><br><span class=\"line\">      name: <span class=\"string\">'foo'</span>,</span><br><span class=\"line\">      age : <span class=\"number\">42</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">user.$save();</span><br></pre></td></tr></table></figure>\n<p>调用 <code>$resource</code> 会为我们的模型实例创建一个构造方法。每个模型示例都有用于CRUD的方法。</p>\n<p>这样我们就能够像下面这样使用构造方法和上面的静态方法:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User.get(&#123; <span class=\"attr\">userid</span>: userid &#125;);</span><br></pre></td></tr></table></figure>\n<p>上面的代码会立刻返回个空对象并且保留它的引用。一旦成功返回并且被解析，AngularJS 会用回去到的数据填充这个对象 (看 <a href=\"#proxy\">代理</a>)。</p>\n<p>你可以找到更多关于 <code>$resource</code> <a href=\"http://blog.mgechev.com/2014/02/05/angularjs-resource-active-record-http/\" target=\"_blank\" rel=\"noopener\">$resource的魔法</a> and <a href=\"https://docs.angularjs.org/api/ngResource/service/$resource\" target=\"_blank\" rel=\"noopener\">AngularJS 的文档</a> 的信息。</p>\n<p>鉴于 Martin Fowler 这样说</p>\n<blockquote>\n<p>活动记录的责任就是为了CRUD跟数据库打交道</p>\n</blockquote>\n<p><code>$resource</code> 没有严格意义上实现活动记录模式，因为它是跟Restful服务而不是数据库打交道。不管怎么样，我们可以把它当作“像活动记录一样的Restful通信”。</p>\n<h4 id=\"拦截过滤器\"><a href=\"#拦截过滤器\" class=\"headerlink\" title=\"拦截过滤器\"></a>拦截过滤器</h4><blockquote>\n<p>在web请求中，为实现公共的预处理和后处理创建一个支持组合的过滤器链。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/intercepting-filters.svg\" alt=\"Composite\"></p>\n<p>有时候你需要对HTTP请求做一些预处理或者后处理。你在HTTP的请求/响应中做预处理或者后处理来包含日志，安全或者其他会被请求头部和消息体影响的东西。基本上拦截过滤器模式包含一个过滤器链，在链上的过滤器都会按照指定的顺序处理数据。每个过滤器的输出都是下个的输入。</p>\n<p>在AngularJS里面 <code>$httpProvider</code> 用了拦截过滤器的模式。 <code>$httpProvider</code> 有个叫 <code>interceptors</code> 的数组, 包含了一堆对象。每个对象都有叫: <code>request</code>, <code>response</code>, <code>requestError</code>, <code>responseError</code> 的属性。</p>\n<p><code>requestError</code> 是个拦截器, 在前面的拦截器抛出错误或者在promise中被拒绝掉的时候会被调用，同样的，<code>responseError</code> 会在前一个 <code>response</code> 拦截器抛出错误之后被调用。</p>\n<p>这有个使用对象语法创建拦截器的基本例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$httpProvider.interceptors.push(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$q, dependency1, dependency2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">   <span class=\"string\">'request'</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">config</span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">// same as above</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">'response'</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">// same as above</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"指令-1\"><a href=\"#指令-1\" class=\"headerlink\" title=\"指令\"></a>指令</h3><h4 id=\"组合\"><a href=\"#组合\" class=\"headerlink\" title=\"组合\"></a>组合</h4><blockquote>\n<p>组合模式是个隔离设计模式。组合模式是说，一组对象按照同样的方式被当作对象的某个实例属性。组合的目的是将对象组合到一个树形结构中来代表局部和整体的层次关系。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/composite.svg\" alt=\"组合\"></p>\n<p>基于经典设计模式理论，MVC就是下面模式的组合：</p>\n<ul>\n<li>策略</li>\n<li>组合</li>\n<li>观察者</li>\n</ul>\n<p>理论中定义视图是组件的组合。在AngularJS中有相似的解决方案。我们的视图由指令和DOM元素的组合来构成，指令解释放在视图上的。</p>\n<p>让我们看看下面的例子：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!doctype <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">zippy</span> <span class=\"attr\">title</span>=<span class=\"string\">\"Zippy\"</span>&gt;</span></span><br><span class=\"line\">      Zippy!</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">zippy</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myModule.directive(<span class=\"string\">'zippy'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    restrict: <span class=\"string\">'E'</span>,</span><br><span class=\"line\">    template: <span class=\"string\">'&lt;div&gt;&lt;div class=\"header\"&gt;&lt;/div&gt;&lt;div class=\"content\" ng-transclude&gt;&lt;/div&gt;&lt;/div&gt;'</span>,</span><br><span class=\"line\">    link: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">scope, el</span>) </span>&#123;</span><br><span class=\"line\">      el.find(<span class=\"string\">'.header'</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        el.find(<span class=\"string\">'.content'</span>).toggle();</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这个例子定义了一个简单的UI组件指令。这个叫zippy的组件有头部和内容。点击头部会触发内容的显示或者隐藏。</p>\n<p>从第一个例子里面我们能注意到整个DOM树是元素的组合。根元素是 <code>html</code> 元素，直接跟着嵌套的 <code>head</code> 和 <code>body</code> 元素等等…</p>\n<p>在第二个Javascript的例子中，我们看到指令的 <code>template</code> 里面包含 <code>ng-transclude</code> 标记。这意味着在指令 <code>zippy</code> 里面我们有另外一个叫 <code>ng-transclude</code> 的指令, 也就是指令的组合。理论上我们能够在到达叶子节点之前一直嵌套组件。</p>\n<h3 id=\"解释器\"><a href=\"#解释器\" class=\"headerlink\" title=\"解释器\"></a>解释器</h3><blockquote>\n<p>在软件编程中，解释器模式是一种指定如何解析语言中句子的设计模式。最基本的思想就是给每个符号（终止符或者非终止符）作为某种语言中的类。语言里句子的语法树就是组合模式中的一个实例并且被用来解析句子。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/interpreter.svg\" alt=\"解释器\"></p>\n<p>在 <code>$parse</code> 服务里AngularJS提供了自己对于领域驱动语言解析器的实现。被使用的DSL是被简化和修改过的Javascript语言。<br>Javascript表达式和AngularJS表达式最大的不同在于AngularJS表达式：</p>\n<ul>\n<li>可能包含像UNIX管道语法的过滤器</li>\n<li>不会抛出任何错误</li>\n<li>没有任何流程控制语句（异常，循环，if声明尽管你能使用三元运算符）</li>\n<li>在指定上下文中被解析（当前 <code>$scope</code> 的上下文）</li>\n</ul>\n<p>在 <code>$parse</code> 服务中有两个主要的组件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Responsible for converting given string into tokens</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Lexer;</span><br><span class=\"line\"><span class=\"comment\">//Responsible for parsing the tokens and evaluating the expression</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Parser;</span><br></pre></td></tr></table></figure>\n<p>一旦指定表达式被标记化，基于性能的考虑就会被内部缓存。</p>\n<p>AngularJS DSL里面终止性的表达式是这样定义的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> OPERATORS = &#123;</span><br><span class=\"line\">  <span class=\"comment\">/* jshint bitwise : false */</span></span><br><span class=\"line\">  <span class=\"string\">'null'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">return</span> <span class=\"literal\">null</span>;&#125;,</span><br><span class=\"line\">  <span class=\"string\">'true'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;&#125;,</span><br><span class=\"line\">  <span class=\"string\">'false'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;&#125;,</span><br><span class=\"line\">  <span class=\"literal\">undefined</span>:noop,</span><br><span class=\"line\">  <span class=\"string\">'+'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//...</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">  <span class=\"string\">'*'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)*b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'/'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)/b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'%'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)%b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'^'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)^b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'='</span>:noop,</span><br><span class=\"line\">  <span class=\"string\">'==='</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a, b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)===b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'!=='</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a, b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)!==b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'=='</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)==b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'!='</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)!=b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'&lt;'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)&lt;b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'&gt;'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)&gt;b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'&lt;='</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)&lt;=b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'&gt;='</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)&gt;=b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'&amp;&amp;'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)&amp;&amp;b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'||'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)||b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'&amp;'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> a(self, locals)&amp;b(self, locals);&#125;,</span><br><span class=\"line\">  <span class=\"string\">'|'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a,b</span>)</span>&#123;<span class=\"keyword\">return</span> b(self, locals)(self, locals, a(self, locals));&#125;,</span><br><span class=\"line\">  <span class=\"string\">'!'</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">self, locals, a</span>)</span>&#123;<span class=\"keyword\">return</span> !a(self, locals);&#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>我们可以认为每个跟终止性表达符关联的方法是对 <code>AbstractExpression</code> 接口的实现。</p>\n<p>每个 <code>Client</code> 在指定上下文中解析特定的AngularJS表达式 - 特定的作用域.</p>\n<p>AngularJS表达式样例如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// toUpperCase filter is applied to the result of the expression</span></span><br><span class=\"line\"><span class=\"comment\">// (foo) ? bar : baz</span></span><br><span class=\"line\">(foo) ? bar : baz | toUpperCase</span><br></pre></td></tr></table></figure>\n<h4 id=\"模板视图\"><a href=\"#模板视图\" class=\"headerlink\" title=\"模板视图\"></a>模板视图</h4><blockquote>\n<p>在页面上通过嵌入的标记语法渲染信息。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/template-view.svg\" alt=\"模板视图\"></p>\n<p>动态页面的渲染不是那么简单的事情。这里面掺和着一大堆的字符串连接，操作，还伴随着挫败感。写你自己的标记语言并且嵌入少量的表达式是创建动态页面更简单的方式，标记语言后续会被在特定的上下文里被解析出来，整个模板最终会被编译成最终的格式，在我们的情况下将会是HTML(或者可能是DOM)。这就是模板引擎做的事情 - 它们使用指定的DSL，在合适的上下文里解析并且将它转为最终的格式。</p>\n<p>模板更广泛用于后端。例如，你可以在HTML里面嵌入PHP代码来创建动态页面，你可以使用Smarty或者你可以为了在静态页面中嵌入Ruby代码使用eRuby。</p>\n<p>对于Javascript有很多的模板引擎，例如mustache.js, handlerbars等等。大部分引擎将模板作为字符串来操作。模板可以放在不同的地方 - 通过AJAX作为静态文件加载，作为 <code>script</code> 嵌入到你的视图中甚至是在Javascript里面。</p>\n<p>例如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"template/mustache\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>Names<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\">  &#123;&#123;#names&#125;&#125;</span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">strong</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">strong</span>&gt;</span></span></span><br><span class=\"line\">  &#123;&#123;/names&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>模板引擎通过在特定上下文里面编译它，将这个字符串转化成DOM元素。所有内嵌在标记语言中的表达式被解析并且替换为实际的值。</p>\n<p>例如如果你要在下面对象 <code>{ names: [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;] }</code> 的上下文里面解析上面的模板，我们就会得到：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>Names<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">strong</span>&gt;</span>foo<span class=\"tag\">&lt;/<span class=\"name\">strong</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">strong</span>&gt;</span>bar<span class=\"tag\">&lt;/<span class=\"name\">strong</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">strong</span>&gt;</span>baz<span class=\"tag\">&lt;/<span class=\"name\">strong</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>AngularJS模板实际就是HTML，而不是如同传统模板一样仅仅是个中间的格式。<br>AngularJS编译器就是在DOM树上遍历并且找到已知的指令（元素，属性，类甚至是注释）。当AngularJS找到任何这些指令的时候，它会调用相关的逻辑，这也会包含在当前作用域下对于其他表达式的解析。</p>\n<p>例如:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">ng-repeat</span>=<span class=\"string\">\"name in names\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在作用域的上下文：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$scope.names = [<span class=\"string\">'foo'</span>, <span class=\"string\">'bar'</span>, <span class=\"string\">'baz'</span>];</span><br></pre></td></tr></table></figure>\n<p>会产生和上面一样的结果。这里主要的不同点在于模板不是包含在 <code>script</code> 标签而是HTMl里面。</p>\n<h3 id=\"作用域-1\"><a href=\"#作用域-1\" class=\"headerlink\" title=\"作用域\"></a>作用域</h3><h4 id=\"观察者\"><a href=\"#观察者\" class=\"headerlink\" title=\"观察者\"></a>观察者</h4><blockquote>\n<p>观察者模式是一种这样的软件设计模式：有个称作主题的对象，维护了它所依赖观察者的列表，在任何状态改变的时候，自动通知所有的观察者，通常就是调用观察者的某个方法。这种模式主要用于实现分布式的时间处理系统。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/observer.svg\" alt=\"观察者\"></p>\n<p>在AngularJS应用中有两种在作用域之间通信的基本方式。第一种方式通过在子作用域中调用父作用域中的方法。能这样做是因为子作用域通过原型继承自父作用域，上面有提到（看<a href=\"#scope\">作用域</a>）。这样允许我们进行单向的通信 - 子作用域到父作用域。有时候这在特定作用域中调用方法是很必要的。AngularJS提供了内置的观察者模式，允许这样做。另一个可能的观察者模式的用例是，当多个作用域对于特定的事件感兴趣的时候，触发事件的作用域并不会察觉到它。这样使得在不同作用域之间解耦成为可能，任何作用域都不应该察觉到其他作用域的存在。</p>\n<p>每个AngularJS的作用域都有共有的方法 <code>$on</code>, <code>$emit</code> 和 <code>$broadcast</code>。方法 <code>$on</code> 接受主题作为第一个参数并且将回调作为第二个。我们可以把回调当成是个观察者 - 一个实现了 <code>Observer</code> 接口的对象（在Javascript中函数是一等公民，所以你只需要实现 <code>notify</code> 方法）：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ExampleCtrl</span>(<span class=\"params\">$scope</span>) </span>&#123;</span><br><span class=\"line\">  $scope.$on(<span class=\"string\">'event-name'</span>, <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handler</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//body</span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>通过这种方式，当前的作用域“订阅”类型为 <code>event-name</code> 的事件. 当 <code>event-name</code> 事件在任何父或者子作用域中被触发的时候， <code>handler</code> 就会被调用。</p>\n<p>方法 <code>$emit</code> 和 <code>$broadcast</code> 在作用域链上分别用来触发向上传递或者向下传递的事件。<br>例如：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ExampleCtrl</span>(<span class=\"params\">$scope</span>) </span>&#123;</span><br><span class=\"line\">  $scope.$emit(<span class=\"string\">'event-name'</span>, &#123; <span class=\"attr\">foo</span>: <span class=\"string\">'bar'</span> &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面例子中的作用域，向上级所有作用域触发 <code>event-name</code> 事件。这意味着所有父作用域上监听了 <code>event-name</code> 事件的作用域会被通知并且上面的回调方法会被调用。</p>\n<p>当 <code>$broadcast</code> 方法被调用的时候也是相似的。唯一不同的地方在于事件是被向下传递的 - 传给所有的子作用域。<br>每个作用域能够订阅任何事件，并且指定多个回调 （也就是说可以对于指定的事件关联多个观察者）。</p>\n<p>在JavaScript社区这一模式作为pus/sub更为人所知。</p>\n<h4 id=\"责任链\"><a href=\"#责任链\" class=\"headerlink\" title=\"责任链\"></a>责任链</h4><blockquote>\n<p>责任链模式是由一堆命令对象和一系列处理对象组成的一种设计模式。每个处理对象包含定义它能够处理的命令对象类型逻辑，它不能处理的命令类型被传递给责任链上下一个处理对象。在责任链尾部添加新的处理对象也是被支持的一种机制。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/chain-of-responsibilities.svg\" alt=\"责任链\"></p>\n<p>像上面说到的，AngularJS应用中的作用域构建了一个层次结构的作用域链。有些作用域是“独立的”，这意味着它们不会原型继承它们的父作用域，而是通过它们的 <code>$parent</code> 属性连接。</p>\n<p>当 <code>$emit</code> 或者 <code>$broadcast</code> 被调用的时候，我们可以把作用域链当作事件巴士，或者更准确地说是责任链。一旦事件被触发，它就会被向上或者向下传递（依赖被调用的方法）。每个子序列的作用域会：</p>\n<ul>\n<li>处理事件并且继续向下一级作用域传递</li>\n<li>处理事件，阻止传递</li>\n<li>直接向下一级作用域传递而不做任何处理</li>\n<li>阻止传递并且不做任何处理</li>\n</ul>\n<p>在下面的例子里面你会看到 <code>ChildCtrl</code> 触发了一个时间，该事件在作用域链上被向下传递。在上面的例子里面每个父作用域（在 <code>ParentCtrl</code> 中用到的和在 <code>MainCtrl</code> 用到的）会通过在控制台里打印 <code>&quot;foo received&quot;</code> 来处理事件。如果任何作用域需要被当作最后的处理目标，它可以调用通过回调传递获得到的事件对象上的 <code>stopPropagation</code> 方法来实现。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myModule.controller(<span class=\"string\">'MainCtrl'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$scope</span>) </span>&#123;</span><br><span class=\"line\">  $scope.$on(<span class=\"string\">'foo'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'foo received'</span>);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">myModule.controller(<span class=\"string\">'ParentCtrl'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$scope</span>) </span>&#123;</span><br><span class=\"line\">  $scope.$on(<span class=\"string\">'foo'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'foo received'</span>);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">myModule.controller(<span class=\"string\">'ChildCtrl'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$scope</span>) </span>&#123;</span><br><span class=\"line\">  $scope.$emit(<span class=\"string\">'foo'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>在上面UML图中的不同处理器就是不同被注入到控制器中的作用域。</p>\n<h4 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令\"></a>命令</h4><blockquote>\n<p>在面向对象编程中，命令模式是一种行为设计模式。说的是使用一个对象来表征和包裹之后需要调用的某个方法所必要的信息。这些信息包括方法名，包含方法和方法调用参数值的对象。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/command.svg\" alt=\"命令\"></p>\n<p>在继续说命令模式的应用之前让我们讲讲AngularJS是如何实现数据绑定的。</p>\n<p>当我们要把模型绑定到视图上的时候，我们使用指令 <code>ng-bind</code> （为了单向的数据绑定）和 <code>ng-model</code> （为了双向的数据绑定）。例如我们想要模型 <code>foo</code> 的每一个改动都放映到视图上，我们可以：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">ng-bind</span>=<span class=\"string\">\"foo\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>现在每次我们改动 <code>foo</code> 的值span内部的文本都会被改变。我们能够能够通过更加复杂的AngularJS表达式来获得同样的效果：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">ng-bind</span>=<span class=\"string\">\"foo + ' ' + bar | uppercase\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在上面的示例中，span的值将会是 <code>foo</code> 和 <code>bar</code> 连接起来并且首字母大写的值。究竟发生了什么呢？</p>\n<p>每个 <code>$scope</code> 都有个叫 <code>$watch</code> 的方法。当AngularJS编译器找到 <code>ng-bind</code> 指令，它会创建一个新的对于 <code>foo + &#39; &#39; + bar | uppercase</code> 表达式的监听器也就是 <code>$scope.$watch(&quot;foo + &#39; &#39; + bar | uppercase&quot;, function () { /* body */ });</code>。回调会在每次表达式的值改变的时候被触发。在这个例子中回调方法会更新span的值。</p>\n<p>下面是 <code>$watch</code> 方法实现的头几行：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$watch: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">watchExp, listener, objectEquality</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> scope = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">      <span class=\"keyword\">get</span> = compileToFn(watchExp, 'watch'),</span><br><span class=\"line\">      array = scope.$$watchers,</span><br><span class=\"line\">      watcher = &#123;</span><br><span class=\"line\">        fn: listener,</span><br><span class=\"line\">        last: initWatchVal,</span><br><span class=\"line\">        <span class=\"keyword\">get</span>: <span class=\"keyword\">get</span>,</span><br><span class=\"line\">        exp: watchExp,</span><br><span class=\"line\">        eq: !!objectEquality</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">//...</span><br></pre></td></tr></table></figure>\n<p>我们可以把 <code>watcher</code> 对象当作一条命令。在每次<a href=\"https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$digest\" target=\"_blank\" rel=\"noopener\"><code>&quot;$digest&quot;</code></a>循环的时候命令表达式都会被解析。一旦AngularJS检测到表达式里面的改动，它调用 <code>listener</code> 方法。 <code>watcher</code> 命令封装了对于特定表达式的监听并且将命令的执行代理到 <code>listener</code> （实际的接受者）。我们可以把 <code>$scope</code> 当作命令的 <code>客户端</code> ，把 <code>$digest</code> 循环当作命令的 <code>调用者</code>.</p>\n<h3 id=\"控制器-1\"><a href=\"#控制器-1\" class=\"headerlink\" title=\"控制器\"></a>控制器</h3><h4 id=\"页面控制器\"><a href=\"#页面控制器\" class=\"headerlink\" title=\"页面控制器\"></a>页面控制器</h4><blockquote>\n<p>一个处理网站上特定页面或者动作请求的对象。 Martin Fowler</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/page-controller.svg\" alt=\"页面控制器\"></p>\n<p>根据 <a href=\"#references\">4</a> 页面控制器是：</p>\n<blockquote>\n<p>页面控制器模式接受页面请求的输入，调用模型上被请求动作，并且决定正确的渲染页面。将分发的逻辑从视图相关的代码中分离出来</p>\n</blockquote>\n<p>因为在不同的页面上有许多重复的行为（像渲染页头，页脚，处理用户的回话等等）页面控制器能够构成层次结构。在AngularJS里我们使用的控制器担负的责任很有限。它们不接受用户请求，因为这时 <code>$route</code> 或者 <code>$state</code> 服务的责任，页面渲染的责任归 <code>ng-view</code>/<code>ui-view</code> 所有。</p>\n<p>跟页面控制器相似的是，AngularJS控制器处理用户的交互，提供和更新模型。当模型绑定到作用域上，它就暴露给了视图，所有由于用户动作被视图调用的方法都是已经绑定在作用域上的。另一个页面控制器和AngularJS控制器的相似点就是它们组成的层次关系。相当于作用于的层次关系，这种层次关系使得公共的动作可以放到基类的控制器里面。</p>\n<p>因为它们的责任几乎重叠，AngularJS里的控制器和ASP.NET的WebForms实现方式很相似。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!doctype <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">ng-controller</span>=<span class=\"string\">\"MainCtrl\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ng-controller</span>=<span class=\"string\">\"ChildCtrl\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123;user.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">ng-click</span>=<span class=\"string\">\"click()\"</span>&gt;</span>Click<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MainCtrl</span>(<span class=\"params\">$scope, $location, User</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!User.isAuthenticated()) &#123;</span><br><span class=\"line\">    $location.path(<span class=\"string\">'/unauthenticated'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ChildCtrl</span>(<span class=\"params\">$scope, User</span>) </span>&#123;</span><br><span class=\"line\">  $scope.click = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'You clicked me!'</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  $scope.user = User.get(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个例子只是要说明如何通过基控制器来复用逻辑的最基本方式。在生产环境无论如何我都不推荐把权限认证的逻辑放在控制器里。对于不同路由的访问可以在更高层次的抽象里来实现。</p>\n<p><code>ChildCtrl</code> 负责处理像点击带有 <code>&quot;Click&quot;</code> 标签的按钮并且通过将它绑定到作用域上将模型暴露给视图。</p>\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><h4 id=\"模块模式\"><a href=\"#模块模式\" class=\"headerlink\" title=\"模块模式\"></a>模块模式</h4><p>其实这不是G4里面的一种设计模式，也不是EAA的P中的一种。这是一种Javascript的 传统模式，主要的目的是提供封装和隐藏。</p>\n<p>通过使用模块模式你可以基于Javascript的函数级作用域获得隐藏性。每个模块可以有一个或者多个隐藏在函数作用域里面的成员属性。这个方法返回一个暴露指定模块公共API的对象：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Page = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> title;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setTitle</span>(<span class=\"params\">t</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.title = t;</span><br><span class=\"line\">    title = t;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getTitle</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> title;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    setTitle: setTitle,</span><br><span class=\"line\">    getTitle: getTitle</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;());</span><br></pre></td></tr></table></figure>\n<p>上面的例子我们创造了一个IIFE（立即执行函数表达式），在被调用后返回一个有两个方法 <code>setTitle</code> 和 <code>getTitle</code> 的对象。返回的对象被赋值给 <code>Page</code> 变量。</p>\n<p>在这个例子里， <code>Page</code> 对象的使用者没有直接访问 <code>title</code> 变量，该变量被定义在立即执行函数产生的作用域里。</p>\n<p>模块模式在定义AngularJS里的服务时非常有用。使用这种模式我们可以模拟（实际获得了）私有性：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.factory(<span class=\"string\">'foo'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">privateMember</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//body...</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">publicMember</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//body...</span></span><br><span class=\"line\">    privateMember();</span><br><span class=\"line\">    <span class=\"comment\">//body</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    publicMember: publicMember</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>一旦我们想要在其他的组件里注入 <code>foo</code> ，我们就只能用共有方法，而无法使用私有方法。这种解决方案在构建一个可以复用库的时候非常好用。</p>\n<h3 id=\"数据映射器\"><a href=\"#数据映射器\" class=\"headerlink\" title=\"数据映射器\"></a>数据映射器</h3><blockquote>\n<p>数据映射器是在数据持久层（通常是关系型数据库）和内存中的数据表征（领域模型层）直接进行双向数据转换的数据访问层。这种模式的目的是保持内层内数据表征和数据持久层以及数据映射器彼此独立。</p>\n</blockquote>\n<p><img src=\"https://rawgit.com/mgechev/angularjs-in-patterns/master/images/data-mapper.svg\" alt=\"数据映射器\"></p>\n<p>像上面描述的一样，数据映射器用来在数据持久层和内存内数据表征之间做数据转换。通常我们的AngularJS应用和服务器端的API服务器通信，服务器接口都是用服务器端语言实现的（Ruby, PHP, Java, Javascript等等）。</p>\n<p>通常如果我们有Restful接口 <code>$resource</code> 会帮我们用活动对象跟服务器通信。尽管在有些应用中服务器反悔的实体不是那么符合我们前端需要的格式。</p>\n<p>举个例子，让我们假定应用中每个用户都有：</p>\n<ul>\n<li>名字</li>\n<li>地址</li>\n<li>朋友列表</li>\n</ul>\n<p>我们的API有这些方法：</p>\n<ul>\n<li><code>GET /user/:id</code> - 返回指定用户的名字和地址</li>\n<li><code>GET /friends/:id</code> - 返回指定用户的朋友列表</li>\n</ul>\n<p>一种解决方案是我们使用不同的服务，其中一个为第一个方法使用，另外一个为第二个使用。可能更加有用的方法会是如果我们有个单独的叫 <code>User</code> 的服务在我们请求用户信息的时候把用户朋友加载进来：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.factory(<span class=\"string\">'User'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$q</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">User</span>(<span class=\"params\">name, address, friends</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.address = address;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.friends = friends;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  User.get = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">params</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> user = $http.get(<span class=\"string\">'/user/'</span> + params.id),</span><br><span class=\"line\">        friends = $http.get(<span class=\"string\">'/friends/'</span> + params.id);</span><br><span class=\"line\">    $q.all([user, friends])</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">user, friends</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> User(user.name, user.address, friends);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> User;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>通过这种方式我们创建了一个伪数据映射器，根据我们单页应用的需要适配我们的API。</p>\n<p>我们可以这样使用 <code>User</code> 服务：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MainCtrl</span>(<span class=\"params\">$scope, User</span>) </span>&#123;</span><br><span class=\"line\">  User.get(&#123; <span class=\"attr\">id</span>: <span class=\"number\">1</span> &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">    $scope.user = data;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>下面的页面模板：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    Name: &#123;&#123;user.name&#125;&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    Address: &#123;&#123;user.address&#125;&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    Friends with ids:</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">ng-repeat</span>=<span class=\"string\">\"friend in user.friends\"</span>&gt;</span>&#123;&#123;friend&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ol>\n<li><a href=\"https://en.wikipedia.org/wiki\" target=\"_blank\" rel=\"noopener\">百科</a>. The source of all brief descriptions of the design patterns is wikipedia.</li>\n<li><a href=\"https://docs.angularjs.org\" target=\"_blank\" rel=\"noopener\">AngularJS官方文档</a></li>\n<li><a href=\"https://github.com/angular/angular.js\" target=\"_blank\" rel=\"noopener\">AngularJS github仓库</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/ff649595.aspx\" target=\"_blank\" rel=\"noopener\">页面控制器</a></li>\n<li><a href=\"http://martinfowler.com/books/eaa.html\" target=\"_blank\" rel=\"noopener\">企业应用架构模式(P of EAA)</a></li>\n<li><a href=\"http://googletesting.blogspot.com/2008/05/tott-using-dependancy-injection-to.html\" target=\"_blank\" rel=\"noopener\">使用依赖注入来减少单例</a></li>\n<li><a href=\"https://stackoverflow.com/questions/13512949/why-would-one-use-the-publish-subscribe-pattern-in-js-jquery\" target=\"_blank\" rel=\"noopener\">为什么要用在JS或者jQuery观察/订阅模式?</a></li>\n</ol>\n","categories":[],"tags":["frontend","javascript","angularjs","translation"]},{"title":"Yii2 快速上手","url":"https://vincenthou.github.io/2014/11/20/Yii2-快速上手/","content":"<h1 id=\"Yii2-快速上手\"><a href=\"#Yii2-快速上手\" class=\"headerlink\" title=\"Yii2 快速上手\"></a>Yii2 快速上手</h1><h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"Composer安装\"><a href=\"#Composer安装\" class=\"headerlink\" title=\"Composer安装\"></a>Composer安装</h3><p>官方出品<a href=\"http://docs.phpcomposer.com/download/\" target=\"_blank\" rel=\"noopener\">详细文档</a>，只要把composer.phar下载就能用(php composer.phar)，不过配置到环境变量中会更方便，直接composer运行命令。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -sS https://getcomposer.org/installer | php</span><br></pre></td></tr></table></figure>\n<p>但是没有镜像怎么能玩得转，其中原因大家懂得，配置国内镜像，具体方法看<a href=\"http://pkg.phpcomposer.com/\" target=\"_blank\" rel=\"noopener\">这里</a>，可以作为全局或者对于项目的配置</p>\n<h3 id=\"Yii2安装\"><a href=\"#Yii2安装\" class=\"headerlink\" title=\"Yii2安装\"></a>Yii2安装</h3><p>官方安装方法看<a href=\"https://github.com/yiisoft/yii2-app-advanced#install-via-composer\" target=\"_blank\" rel=\"noopener\">这里</a>，首先安装依赖的composer-asset。Yii2.0要求Composer必须安装 composer asset 插件。 这个插件使得Composer可以兼容实现NPM和BOWER包管理器的功能。 NPM 和 BOWER 主要用于前端资源（如JS库等）的管理。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php composer.phar global require <span class=\"string\">\"fxp/composer-asset-plugin:1.0.0-beta3\"</span></span><br></pre></td></tr></table></figure>\n<p>接着创建项目</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php composer.phar create-project --prefer-dist --stability=dev yiisoft/yii2-app-advanced advanced</span><br></pre></td></tr></table></figure>\n<p>安装成功后会看到</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Installing yiisoft/yii2-app-advanced (dev-master bc58c0f1b54cf7cfcf9d7b59ab364c8</span><br><span class=\"line\">2daa0b483)</span><br><span class=\"line\">  - Installing yiisoft/yii2-app-advanced (dev-master master)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">Created project <span class=\"keyword\">in</span> advanced</span><br><span class=\"line\">Loading composer repositories with package information</span><br><span class=\"line\">Installing dependencies (including require-dev)</span><br><span class=\"line\">  - Installing yiisoft/yii2-composer (dev-master 0ed315f)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing ezyang/htmlpurifier (v4.6.0)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing swiftmailer/swiftmailer (dev-master d0f361d)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing cebe/markdown (0.9.x-dev 6a3c373)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing yiisoft/jquery (2.1.1)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing yiisoft/jquery-pjax (dev-master f07ce95)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing yiisoft/yii2 (2.0.0-beta)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing phpspec/php-diff (dev-master 30e103d)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing yiisoft/yii2-swiftmailer (dev-master 3b9c27a)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing yiisoft/yii2-codeception (dev-master e4c331f)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing twbs/bootstrap (v3.0.3)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing yiisoft/yii2-bootstrap (2.0.0-beta)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing yiisoft/yii2-debug (dev-master 12fdba8)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing yiisoft/yii2-gii (2.0.0-beta)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing fzaninotto/faker (dev-master 44eae4d)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">  - Installing yiisoft/yii2-faker (dev-master cb109df)</span><br><span class=\"line\">    Loading from cache</span><br><span class=\"line\"></span><br><span class=\"line\">Writing lock file</span><br><span class=\"line\">Generating <span class=\"built_in\">autoload</span> files</span><br></pre></td></tr></table></figure>\n<p>项目就在advanced文件夹下了</p>\n<h3 id=\"Yii2初始化\"><a href=\"#Yii2初始化\" class=\"headerlink\" title=\"Yii2初始化\"></a>Yii2初始化</h3><p>进入项目目录，使用命令行初始化项目</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> advanced</span><br><span class=\"line\">init</span><br></pre></td></tr></table></figure>\n<p>会看到下面的界面</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Yii Application Initialization Tool v1.0</span><br><span class=\"line\"></span><br><span class=\"line\">Which environment <span class=\"keyword\">do</span> you want the application to be initialized <span class=\"keyword\">in</span>?</span><br><span class=\"line\"></span><br><span class=\"line\">  [0] Development</span><br><span class=\"line\">  [1] Production</span><br><span class=\"line\"></span><br><span class=\"line\">  Your choice [0-1, or <span class=\"string\">\"q\"</span> to quit]</span><br></pre></td></tr></table></figure>\n<p>补充更加详细中文<a href=\"http://www.digpage.com/install.html#composeryii\" target=\"_blank\" rel=\"noopener\">安装教程</a></p>\n<p>yii2由于依赖于bower和npm，npm国内有镜像速度较快，但是bower下载很多github上面的依赖，速度较慢（下个jquery要2小时）,需要考虑是否使用。</p>\n<h1 id=\"Overview\"><a href=\"#Overview\" class=\"headerlink\" title=\"Overview\"></a>Overview</h1><ul>\n<li><a href=\"http://www.yiiframework.com/doc-2.0/guide-structure-entry-scripts.html\" target=\"_blank\" rel=\"noopener\">entry scripts</a>: they are PHP scripts that are directly accessible by end users. They are responsible for starting a request handling cycle.</li>\n<li><a href=\"http://www.yiiframework.com/doc-2.0/guide-structure-applications.html\" target=\"_blank\" rel=\"noopener\">applications</a>: they are globally accessible objects that manage application components and coordinate them to fulfill requests.</li>\n<li><a href=\"http://www.yiiframework.com/doc-2.0/guide-structure-application-components.html\" target=\"_blank\" rel=\"noopener\">application components</a>: they are objects registered with applications and provide various services for fulfilling requests.</li>\n<li><a href=\"http://www.yiiframework.com/doc-2.0/guide-structure-modules.html\" target=\"_blank\" rel=\"noopener\">modules</a>: they are self-contained packages that contain complete MVC by themselves. An application can be organized in terms of multiple modules.</li>\n<li><a href=\"http://www.yiiframework.com/doc-2.0/guide-structure-filters.html\" target=\"_blank\" rel=\"noopener\">filters</a>: they represent code that need to be invoked before and after the actual handling of each request by controllers.</li>\n<li><a href=\"http://www.yiiframework.com/doc-2.0/guide-structure-widgets.html\" target=\"_blank\" rel=\"noopener\">widgets</a>: they are objects that can be embedded in views. They may contain controller logic and can be reused in different views.</li>\n</ul>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/29809774-0cc1d7c8-8cd0-11e7-90ac-ece6a4815a39.png\" alt=\"static structure of an application\"></p>\n<h1 id=\"Application-Lifecycle\"><a href=\"#Application-Lifecycle\" class=\"headerlink\" title=\"Application Lifecycle\"></a>Application Lifecycle</h1><p><img src=\"https://user-images.githubusercontent.com/1998742/29809828-433c4c52-8cd0-11e7-99c0-48836a77af51.png\" alt=\"Application Lifecycle\"></p>\n<p>When an entry script is being executed to handle a request, an application will undergo the following lifecycle:</p>\n<ol>\n<li>The entry script loads the application configuration as an array.</li>\n<li>The entry script creates a new instance of the application:<ul>\n<li>preInit() is called, which configures some high priority application properties, such as basePath.</li>\n<li>Register the error handler.</li>\n<li>Configure application properties.</li>\n<li>init() is called which further calls bootstrap() to run bootstrapping components.</li>\n</ul>\n</li>\n<li>The entry script calls yii\\base\\Application::run() to run the application:<ul>\n<li>Trigger the EVENT_BEFORE_REQUEST event.</li>\n<li>Handle the request: resolve the request into a route and the associated parameters; create the module, controller, and action objects as specified by the route; and run the action.</li>\n<li>Trigger the EVENT_AFTER_REQUEST event.</li>\n<li>Send response to the end user.</li>\n</ul>\n</li>\n<li>The entry script receives the exit status from the application and completes the request processing.</li>\n</ol>\n<h1 id=\"Handle-request\"><a href=\"#Handle-request\" class=\"headerlink\" title=\"Handle request\"></a>Handle request</h1><p>Each time when a Yii application handles a request, it undergoes a similar workflow.</p>\n<ol>\n<li>A user makes a request to the entry script web/index.php.</li>\n<li>The entry script loads the application configuration and creates an application instance to handle the request.</li>\n<li>The application resolves the requested route with the help of the request application component.</li>\n<li>The application creates a controller instance to handle the request.</li>\n<li>The controller creates an action instance and performs the filters for the action.</li>\n<li>If any filter fails, the action is cancelled.</li>\n<li>If all filters pass, the action is executed.</li>\n<li>The action loads a data model, possibly from a database.</li>\n<li>The action renders a view, providing it with the data model.</li>\n<li>The rendered result is returned to the response application component.</li>\n<li>The response component sends the rendered result to the user’s browser.</li>\n</ol>\n<p>The following diagram shows how an application handles a request.</p>\n<p><img src=\"https://user-images.githubusercontent.com/1998742/29810129-41f0b65c-8cd1-11e7-967b-103c73ed4b22.png\" alt=\"handles a request\"></p>\n<h1 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h1><ul>\n<li><a href=\"https://github.com/yiisoft/yii2\" target=\"_blank\" rel=\"noopener\">Github Offical Site</a></li>\n<li><a href=\"https://github.com/yiisoft/yii2-app-advanced\" target=\"_blank\" rel=\"noopener\">Yii2 App Advanced Template</a></li>\n<li><a href=\"http://www.yiichina.com/api/\" target=\"_blank\" rel=\"noopener\">API Doc</a></li>\n<li>:+1:  <a href=\"http://www.manks.top/document\" target=\"_blank\" rel=\"noopener\">yii2项目实战</a></li>\n<li><a href=\"http://www.digpage.com/\" target=\"_blank\" rel=\"noopener\">深入理解Yii2.0</a></li>\n<li><a href=\"https://jellybool.com/post/programming-with-yii2-getting-started-with-install-and-hello-world\" target=\"_blank\" rel=\"noopener\">实例教程</a></li>\n<li><a href=\"http://pan.baidu.com/s/1hqswH60\" target=\"_blank\" rel=\"noopener\">直接下载免安装版</a></li>\n<li><a href=\"https://github.com/yiisoft/yii2/issues/5060\" target=\"_blank\" rel=\"noopener\">Calling unknown method: yii\\web\\UrlManager::addRules()</a></li>\n</ul>\n","categories":[],"tags":["blog","php"]},{"title":"MySQL 常用命令","url":"https://vincenthou.github.io/2014/09/04/MySQL-常用命令/","content":"<ul>\n<li>查看数据库表的字段描述</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">desc mysql.user;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>查看数据库用户信息</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> mysql.user\\G;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>添加新用户</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> mysql.user (host, <span class=\"keyword\">user</span>, <span class=\"keyword\">password</span>, select_priv, insert_priv, update_priv) <span class=\"keyword\">VALUES</span> (<span class=\"string\">'localhost'</span>, <span class=\"string\">'vincent'</span>, <span class=\"keyword\">PASSWORD</span>(<span class=\"string\">'test123'</span>), <span class=\"string\">'Y'</span>, <span class=\"string\">'Y'</span>, <span class=\"string\">'Y'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">FLUSH</span> <span class=\"keyword\">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>分配表权限</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">ALL</span> <span class=\"keyword\">PRIVILEGES</span> <span class=\"keyword\">ON</span> table.* <span class=\"keyword\">TO</span> username@<span class=\"string\">\"%\"</span> <span class=\"keyword\">IDENTIFIED</span> <span class=\"keyword\">BY</span> <span class=\"string\">'password'</span>;</span><br></pre></td></tr></table></figure>\n","categories":[],"tags":["collection","database"]},{"title":"面向未来的图标图片精灵","url":"https://vincenthou.github.io/2014/07/24/面向未来的图标图片精灵/","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>图片精灵的概念由来已久，长久以来作为网站性能优化的一条金科玉律，但是在实践过程中一直是一条头痛的事情。<br>我们在网站开发中会使用到各种图片资源，小到一个button的icon，大到整个网站的banner图片，每一个图片资源都需要单独发送请求。图片精灵就是将这些静态的图片资源按照需要合并为一张或者少数几张图片，通过CSS的background-position取得合适图片的技术。</p>\n<h1 id=\"以往的图片精灵做法\"><a href=\"#以往的图片精灵做法\" class=\"headerlink\" title=\"以往的图片精灵做法\"></a>以往的图片精灵做法</h1><p>在迭代开发中，图片资源可能会经常变动，或者图片的总量的不缺定的，这样就无法有效的进行预先合并。往往是设计人员根据开发提出的需求，单个单个地提供需要的图片或者icon，开发拿来就直接使用。最终图片和icon不需要变动的时候，基于开发的自我修养（加载图片真的成为瓶颈），开发会要求设计合并图片，开发拿到新合并的图片文件，苦逼地调CSS。<br>这样反人类的做法怎么能忍，各种工具应运而生。</p>\n<ul>\n<li>手动合并图片，生成对应的CSS代码<br>腾讯的团队搞出来的<a href=\"http://alloyteam.github.io/gopng\" target=\"_blank\" rel=\"noopener\">GoPng</a>，可以自定义图片的位置，在画布上随意拖动位置，能够自定义生成代码的模板，导出元数据（JSON格式）随时恢复原来的工作（个人认为可以用localstorage实现，体验会更好些）。具体特性和使用说明看<a href=\"http://www.alloyteam.com/2012/05/gopng-sprite-figure-synthesis-tool-another-html5-app/\" target=\"_blank\" rel=\"noopener\">这里</a></li>\n<li>自动生成工具</li>\n</ul>\n<ol>\n<li><a href=\"https://github.com/Ensighten/grunt-spritesmith\" target=\"_blank\" rel=\"noopener\">grunt-spritesmith</a>, <a href=\"https://www.npmjs.org/package/gulp.spritesmith/\" target=\"_blank\" rel=\"noopener\">gulp-spritesmith</a>只是把上面手动的流程自动化，指定原始图片的目录，设定图片文件通配符，生成合并图片文件和对应的CSS。还是需要手动更改原有的CSS文件（替换图片引用，添加background-position）</li>\n<li><a href=\"https://github.com/hellometers/grunt-sprite\" target=\"_blank\" rel=\"noopener\">grunt-sprite</a> 会自动从原来的CSS文件中获取到需要合并的图片链接，合并图片，修改原有CSS文件，真正实现自动化的CSS Sprite（国人开发的项目，赞一个）。gulp也有个<a href=\"https://www.npmjs.org/package/gulp-sprite-generator/\" target=\"_blank\" rel=\"noopener\">类似的项目</a><h1 id=\"使用SVG制作图片精灵\"><a href=\"#使用SVG制作图片精灵\" class=\"headerlink\" title=\"使用SVG制作图片精灵\"></a>使用SVG制作图片精灵</h1></li>\n</ol>\n<p>SVG 作为矢量图形的绘制工具价值正在与日俱增，很多SVG的库也如雨后春笋般茁壮成长，<a href=\"http://raphaeljs.com/\" target=\"_blank\" rel=\"noopener\">raphael</a>，<a href=\"http://d3js.org/\" target=\"_blank\" rel=\"noopener\">D3</a>，<a href=\"http://www.hcharts.cn/\" target=\"_blank\" rel=\"noopener\">highcharts中文</a>，<a href=\"http://www.highcharts.com/\" target=\"_blank\" rel=\"noopener\">highcharts官网</a>，还有新近看到的<a href=\"http://www.zhangxinxu.com/wordpress/2014/01/snap-svg-study-demo-docs/\" target=\"_blank\" rel=\"noopener\">snap.svg</a>。SVG的优点就不一一列举了，对应到本主题，SVG可以很方便地帮我们实现简单的icon设计。<br>随着技术的发展，图标的制作产生了几个方向：</p>\n<ol>\n<li>字体文件图标<br>例如<a href=\"http://fontawesome.io/\" target=\"_blank\" rel=\"noopener\">font-awesome</a>已经让我们看到了icon的可能性，如果设计师没有特殊的要求（粗细，比例），我们的大部分需求都能得到满足。国内的<a href=\"http://iconfont.cn/\" target=\"_blank\" rel=\"noopener\">阿里巴巴 Iconfont</a>也提供了丰富的字体图标支持。</li>\n<li>CSS3制作<br>这个部分可以参考<a href=\"http://www.zhangxinxu.com/wordpress/2014/04/css3-icon-%E5%9B%BE%E6%A0%87%E7%94%9F%E6%88%90%E6%8A%80%E6%9C%AF/\" target=\"_blank\" rel=\"noopener\">这篇文章</a>，写得还是很详细的，主要介绍了<a href=\"http://one-div.com/\" target=\"_blank\" rel=\"noopener\">one-div</a>，创意很好，但是个人感觉还是更适合开发玩玩。</li>\n<li>SVG图标文件<br>终于铺垫完了，这里才是 <strong>重点</strong> 。因为SVG文件本质上是用来描述图形的XML文件，可以自定义填充色，阴影和尺寸，给了开发和设计同样的发挥空间。SVG图片精灵的核心思想就是将原来的几个单独icon的SVG文件合并之后，使用symbol标签定义图形，并且给每个symbol定义一个ID，在后续引用中只要使用use标签xlink:href=“#id”就可以引用到合并后SVG中的图片了。发现这里神奇的地方了吗？不需要使用background-position定位图片，而且获取的尺寸绝对精确。参考中的<a href=\"http://www.zhangxinxu.com/wordpress/2014/07/introduce-svg-sprite-technology/\" target=\"_blank\" rel=\"noopener\">文章</a>介绍的更加详细，使用了<a href=\"https://github.com/FWeinb/grunt-svgstore/\" target=\"_blank\" rel=\"noopener\">SVG Grunt合并工具</a>，只是我自己尝试的时候发现配置有点问题，文中的写法是</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grunt.initConfig(&#123;</span><br><span class=\"line\">  svgstore: &#123;</span><br><span class=\"line\">    options: &#123;</span><br><span class=\"line\">      includedemo: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    files: &#123;</span><br><span class=\"line\">        <span class=\"string\">'dist/mytest.svg'</span>: [<span class=\"string\">'mytest/*.svg'</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>实际我试验成功的写法是</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 包装函数</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">grunt</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 任务配置</span></span><br><span class=\"line\">  grunt.initConfig(&#123;</span><br><span class=\"line\">    svgstore: &#123;</span><br><span class=\"line\">      options: &#123;</span><br><span class=\"line\">        includedemo: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        cleanup: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"comment\">//**different here**</span></span><br><span class=\"line\">      <span class=\"keyword\">default</span>: &#123;</span><br><span class=\"line\">        files: &#123;</span><br><span class=\"line\">          <span class=\"string\">'dist/mytest.svg'</span>: [<span class=\"string\">'mytest/*.svg'</span>]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 任务加载</span></span><br><span class=\"line\">  grunt.loadNpmTasks(<span class=\"string\">'grunt-svgstore'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 自定义任务</span></span><br><span class=\"line\">  grunt.registerTask(<span class=\"string\">'default'</span>, [<span class=\"string\">'svgstore'</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>需要加default的key，才能生效，不知道是不是版本升级造成的。还有些类似的工具<a href=\"https://www.npmjs.org/package/svg-sprite\" target=\"_blank\" rel=\"noopener\">svg-sprite</a>，<a href=\"https://www.npmjs.org/package/gulp-svg-sprites/\" target=\"_blank\" rel=\"noopener\">gulp-svg-sprites</a>等等。<a href=\"http://icomoon.io/app/#/select\" target=\"_blank\" rel=\"noopener\">icomoon导出SVG Sprite</a>提供类似的功能，同样很方便，值得一提的是这个网站<strong>还支持font图标的导出</strong> :+1:。后续可以扩展下，把grunt-svgstore加入自动化中，自动生成引用，通过<a href=\"https://github.com/Polymer/HTMLImports\" target=\"_blank\" rel=\"noopener\">HTML Import partials</a>外链SVG文件，而不是在隐藏元素中放置SVG来做。</p>\n<h1 id=\"更好的开发方式\"><a href=\"#更好的开发方式\" class=\"headerlink\" title=\"更好的开发方式\"></a>更好的开发方式</h1><p>在以后的开发中可以和设计师商量，如果对于没有特殊要求的icon可以直接使用<a href=\"http://v3.bootcss.com/components/\" target=\"_blank\" rel=\"noopener\">bootstrap</a>, <a href=\"http://fontawesome.io/\" target=\"_blank\" rel=\"noopener\">font-awesome</a>，打包的<a href=\"http://iconfont.cn\" target=\"_blank\" rel=\"noopener\">iconfont</a>来做字体图标，使用现成的嘛，只是会多出加载字体文件的请求。对于有特殊尺寸、粗细的icon，设计师导出为SVG，通过SVG Sprite进行合并。或者更干脆，直接都使用SVG来做。</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a href=\"http://css-tricks.com/svg-symbol-good-choice-icons/\" target=\"_blank\" rel=\"noopener\">SVG <code>symbol</code> a Good Choice for Icons</a><br><a href=\"http://www.zhangxinxu.com/wordpress/2014/07/introduce-svg-sprite-technology/\" target=\"_blank\" rel=\"noopener\">未来必热：SVG Sprite技术介绍</a><br><a href=\"http://www.alixixi.com/web/a/2010041159648.shtml\" target=\"_blank\" rel=\"noopener\">使用CSS sprite 的好处和坏处</a></p>\n","categories":[],"tags":["blog","css","frontend"]},{"title":"互联网思维","url":"https://vincenthou.github.io/2014/07/13/互联网思维/","content":"<h1 id=\"用户思维\"><a href=\"#用户思维\" class=\"headerlink\" title=\"用户思维\"></a>用户思维</h1><p>谁是你的用户?这是每个做公司的人都要问自己的问题!在中国企业软件市场，谁是你的用户吗?这不废话吗，用户当然是企业。那这些企业主，或者企业的高管们他们又是什么样的呢?他们是一个怎样的群体，他们有什么样的特质，他们喜欢用什么形式的产品呢？抓住典型用户，抓住用户痛点</p>\n<h1 id=\"简约思维\"><a href=\"#简约思维\" class=\"headerlink\" title=\"简约思维\"></a>简约思维</h1><p>大道至简，越简单的东西越容易传播，也就越难做。在今天这个信息爆炸时代，越复杂的东西越让人记不住。所以少就是多，专注就是力量，简约就是注意力。</p>\n<h1 id=\"极致思维\"><a href=\"#极致思维\" class=\"headerlink\" title=\"极致思维\"></a>极致思维</h1><p>极致思维，就是要把产品和服务做到极致。做让用户尖叫的产品。互联网时代，只有第一，没有第二。只有第一能让用户记住，并甩开第二名的追赶。</p>\n<h1 id=\"迭代思维\"><a href=\"#迭代思维\" class=\"headerlink\" title=\"迭代思维\"></a>迭代思维</h1><p>迭代思维有跟最新流行的两个关键词都相关，第一叫微创新，第二是“敏捷开发”。微创新的意思是不要颠覆式创新，而是在用户习惯的基础上做少数创新，让用户逐步接受。“敏捷开发”是说要不断试错，小步快跑。</p>\n<h1 id=\"流量思维\"><a href=\"#流量思维\" class=\"headerlink\" title=\"流量思维\"></a>流量思维</h1><p>在互联网流量为王的时代，流量就是金钱，谁掌握了流量谁就掌握了价值链的上游。所以互联网本质是流量分发生意。无论是QQ，淘宝，百度，都是流量入口，这也就成就了百亿甚至千亿美金级别的上市公司。<br>而流量为王有两个要素，第一是以免费降低门槛;所以360打败了瑞星，淘宝打败了易趣。第二是量变到质变，猪要养肥了再杀，等流量大到具有入口效应，自然不怕赚不到钱。</p>\n<h1 id=\"社会化思维\"><a href=\"#社会化思维\" class=\"headerlink\" title=\"社会化思维\"></a>社会化思维</h1><p>今天社交媒体发达，要善于利用粉丝的口碑传播力量。小米是最典型的例子，所有的营销都是在社交媒体上完成的。连在央视投个广告，也变成了社交媒体上的炒作事件。所谓公关第一，广告第二，说的就是社会化思维。<br>在产品开发中考虑到让用户能自然往外传播的点，最后让用户主动帮你推广，这是社会化思维的结构，无论是微博，微信，小米都是用这样的思维在开发产品。现在大家知道为什么好的产品经理动辄年薪百万了吧!</p>\n<h1 id=\"大数据思维\"><a href=\"#大数据思维\" class=\"headerlink\" title=\"大数据思维\"></a>大数据思维</h1><p>在大数据时代，我们知道所有能产生数据的应用都有价值。也就是数据有价值。人的任何行为都可以被抽象。数据有价值并不是过去所谓把银行，移动等高净值客户资料想办法偷出来然后群发短信这样低俗的做法，而是说根据用户行为从而可以更精准营销甚至产生新的价值。</p>\n<h1 id=\"平台思维\"><a href=\"#平台思维\" class=\"headerlink\" title=\"平台思维\"></a>平台思维</h1><p>互联网的平台思维就是开放、共享、共赢的思维，也就 是打造生态体系的思维。简单而言，平台思维跟传统思维的差异在于，企业经营的产品和生态体系并不直接带来收益，但无心插柳柳成荫，其他地方带来滚滚财源。 比如搜索模式，谷歌并不直接向搜索用户收钱，但搜索用户增加多了以后，就可以向广告主收钱。苹果打造成平台以后，除了硬件收入，AppStore到的分发 收入成为了重要的一块。<br>平台思维的最关键是要打造生态体系，让生态体系众的每个人都赚到钱，自己也就自然赚到钱了。淘宝让淘女郎，摄影师，商家，甚至差评师都能赚到钱，淘宝最后也就赚到钱了。这是为什么阿里是中国最具有平台思维的公司，也自然会成为市值最高的公司。</p>\n<h1 id=\"跨界思维\"><a href=\"#跨界思维\" class=\"headerlink\" title=\"跨界思维\"></a>跨界思维</h1><p>互联网和新科技的发展，产业融合，很多产业的边界变得模糊，新的打劫者不断涌出。不是你打劫我，就是我跨界过去打劫你。互联网企业的跨界颠覆，本质是高效率整合低效率。互联网对传统行业的跨界打劫，本质是瓦解传统行业的人情经济，回扣经济，喝酒经济和各类复杂的代理体系。</p>\n","categories":[],"tags":["blog","collection"]},{"title":"Git 常用命令","url":"https://vincenthou.github.io/2014/06/17/Git-常用命令/","content":"<p>Origin 指向远端git中央仓库</p>\n<ul>\n<li>删除中央仓库中的分支</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin --delete remote_branch_name</span><br></pre></td></tr></table></figure>\n<ul>\n<li>重命名中央仓库分支</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//<span class=\"built_in\">local</span></span><br><span class=\"line\">git branch -m original_branch_name new_branch_name</span><br><span class=\"line\">//remote</span><br><span class=\"line\">git push origin --delete original_branch_name</span><br><span class=\"line\">//<span class=\"built_in\">local</span></span><br><span class=\"line\">git push -u origin new_branch_name</span><br></pre></td></tr></table></figure>\n<ul>\n<li>克隆某个中央仓库分支</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//bare</span><br><span class=\"line\">git <span class=\"built_in\">clone</span> -b remote_branch_name remote_repo_url</span><br><span class=\"line\">//<span class=\"built_in\">local</span> repo</span><br><span class=\"line\">git checkout -b local_branch_name remote_reop_name/remote_branch_name</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在中央仓库中创建新的分支</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b new_branch_name</span><br><span class=\"line\">git push -u origin new_branch_name</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在本地跟踪中央仓库其他人创建的分支</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b remote_branch_name origin/remote_branch_name</span><br></pre></td></tr></table></figure>\n<ul>\n<li>选定merge策略（解决冲突的时候按照当前分支为主，冲突中HEAD部分为ours）</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git merge --strategy-option theirs develop</span><br></pre></td></tr></table></figure>\n<ul>\n<li>选定rebase策略（解决冲突的时候按照当前分支为主，冲突中HEAD部分为ours）</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rebase -s recursive -X theirs master</span><br></pre></td></tr></table></figure>\n<ul>\n<li>单行查看历史</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">log</span> --oneline</span><br></pre></td></tr></table></figure>\n<ul>\n<li>查看自己仓库的当前分支提交ID的树状图</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">log</span> –graph</span><br></pre></td></tr></table></figure>\n<ul>\n<li>查看stash的堆栈</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git stash list</span><br></pre></td></tr></table></figure>\n<ul>\n<li>查看某次stash的改动</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git stash diff stash@&#123;n&#125;^ stash@&#123;n&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>应用某次stash的改动</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git stash pop stash@&#123;n&#125;</span><br><span class=\"line\">git stash apply stash@&#123;n&#125;</span><br></pre></td></tr></table></figure>\n<p>pop会干掉stash list中的存档, apply不会</p>\n<ul>\n<li>切换到某个commit</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout commit</span><br></pre></td></tr></table></figure>\n<ul>\n<li>找回某次commit的一个文件</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout commit-hash filename</span><br></pre></td></tr></table></figure>\n<ul>\n<li>找回某次commit的一个文件</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --hard HEAD~2</span><br></pre></td></tr></table></figure>\n<p>checkout只会移动HEAD指针，reset会改变HEAD的引用值</p>\n<ul>\n<li>查看某次提交影响的文件</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git show --pretty=<span class=\"string\">\"format:\"</span> --name-only commit-hash</span><br></pre></td></tr></table></figure>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://zengrong.net/post/1746.htm\" target=\"_blank\" rel=\"noopener\">GIT查看、删除、重命名远程分支和TAG</a></li>\n<li><a href=\"https://www.atlassian.com/git/tutorials/undoing-changes\" target=\"_blank\" rel=\"noopener\">Undoing changes</a></li>\n<li><a href=\"http://mux.alimama.com/posts/799\" target=\"_blank\" rel=\"noopener\">git寻根——^和~的区别</a></li>\n</ul>\n","categories":[],"tags":["collection","git"]},{"title":"前端面试问题汇总","url":"https://vincenthou.github.io/2014/06/12/前端面试问题汇总/","content":"<p>收集前端面试资料，后续整理完善</p>\n<p>综合考察</p>\n<ul>\n<li><a href=\"https://github.com/darcyclarke/Front-end-Developer-Interview-Questions/tree/master/Chinese\" target=\"_blank\" rel=\"noopener\">https://github.com/darcyclarke/Front-end-Developer-Interview-Questions/tree/master/Chinese</a></li>\n<li><a href=\"https://github.com/komejo/front-end-developer-employer-questions\" target=\"_blank\" rel=\"noopener\">https://github.com/komejo/front-end-developer-employer-questions</a></li>\n<li><a href=\"http://rmurphey.com/blog/2012/04/12/a-baseline-for-front-end-developers/\" target=\"_blank\" rel=\"noopener\">http://rmurphey.com/blog/2012/04/12/a-baseline-for-front-end-developers/</a></li>\n<li><a href=\"https://github.com/fex-team/interview-questions\" target=\"_blank\" rel=\"noopener\">https://github.com/fex-team/interview-questions</a></li>\n</ul>\n<p>综合考察【有答案】</p>\n<ul>\n<li><a href=\"https://github.com/ThomasChan/frontEndInterviewQuestions-Answers\" target=\"_blank\" rel=\"noopener\">https://github.com/ThomasChan/frontEndInterviewQuestions-Answers</a></li>\n</ul>\n<p>基础知识部分</p>\n<ul>\n<li><a href=\"https://github.com/andyshora/front-end-interview-questions\" target=\"_blank\" rel=\"noopener\">https://github.com/andyshora/front-end-interview-questions</a></li>\n</ul>\n","categories":[],"tags":["blog","frontend","collection"]},{"title":"在浏览器中输入地址后发生了什么？","url":"https://vincenthou.github.io/2014/06/01/在浏览器中输入地址后发生了什么？/","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>最近面试都被问到这个问题，对这个问题很有兴趣。说实在的，这个问题很好，可大可小，很能考察出一个人知识的深度和广度，正式总结一下，这里主要从应用层来说的，底层的讨论可以参考<a href=\"http://fex.baidu.com/blog/2014/05/what-happen/\" target=\"_blank\" rel=\"noopener\">这篇</a>。</p>\n<h1 id=\"DNS查询\"><a href=\"#DNS查询\" class=\"headerlink\" title=\"DNS查询\"></a>DNS查询</h1><p>浏览器是不识别域名的，在输入地址后，浏览器需要根据域名查找到实际server的IP，DNS的查询会优先从缓存中获取，这是一级一级进行的，从浏览器，操作系统(Host文件)，路由器，ISP。最新支持的技术，DNS prefetch可以对此优化。DNS Prefetch 是一种DNS 预解析技术，当你浏览网页时，浏览器会在加载网页时对网页中的域名进行解析缓存，这样在你单击当前网页中的连接时就无需进行DNS的解析，减少用户等待时间，提高用户体验。 </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"dns-prefetch\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"http://api.twitter.com\"</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>DNS Prefetch 已经被下面的浏览器支持<br>Firefox: 3.5+<br>Chrome: Supported<br>Safari 5+<br>Opera: Unknown<br>IE: 9</p>\n<h1 id=\"TCP三次握手连接\"><a href=\"#TCP三次握手连接\" class=\"headerlink\" title=\"TCP三次握手连接\"></a>TCP三次握手连接</h1><p>客户端向服务器端发送SYN码请求与服务器进行连接，服务器端返回ACK码响应连接请求，并且为连接分配资源，客户端返回ACK码确认连接。<br><img src=\"http://hi.csdn.net/attachment/201108/7/0_1312718352k8l6.gif\" alt=\"三次握手\"></p>\n<h1 id=\"HTTP-请求的处理\"><a href=\"#HTTP-请求的处理\" class=\"headerlink\" title=\"HTTP 请求的处理\"></a>HTTP 请求的处理</h1><p>浏览器与服务器建立TCP连接之后，浏览器向服务器发送HTTP请求，如果请求地址直接对应静态、动态文件或者服务器端处理程序（某个action），正常情况返回状态码200。其他情况对应状态码：<br>状态码       | 对应说明<br>————- | ————-<br>301            | 永久重定向，拥有多个域名，或者域名迁移时使用<br>302            | 临时重定向，可能被劫持，<a href=\"http://www.dewen.org/q/1233\" target=\"_blank\" rel=\"noopener\">与301区别</a><br>403            | 无权限访问<br>404            | 访问页面不存在<br>500            | 服务器端处理程序抛出异常<br>详细的状态码定义<a href=\"http://tool.oschina.net/commons?type=5\" target=\"_blank\" rel=\"noopener\">参考</a><br>如果请求中包含头信息，服务器对响应内容使用gzip压缩</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure>\n<p>响应中包含头信息</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Content-Encoding: gzip</span><br><span class=\"line\">Content-Type: text/html; charset=utf-8</span><br></pre></td></tr></table></figure>\n<p>浏览器收到服务器响应后，浏览器gzip解压，根据content type渲染响应内容并且根据设定字符集显示。</p>\n<h1 id=\"缓存应用\"><a href=\"#缓存应用\" class=\"headerlink\" title=\"缓存应用\"></a>缓存应用</h1><ul>\n<li>通过配置服务器或者服务器处理程序<a href=\"http://www.fuchaoqun.com/2009/09/php_etag_lastmodified_expires/\" target=\"_blank\" rel=\"noopener\">返回需要的头信息</a>实现ETAG机制，可以有效减少服务器的负载，浏览器从缓存中读取静态资源内容。更加详细的总结看<a href=\"http://www.cnblogs.com/skynet/archive/2012/11/28/2792503.html\" target=\"_blank\" rel=\"noopener\">这里</a></li>\n<li>第一次请求<br><img src=\"http://images.cnblogs.com/cnblogs_com/skynet/201211/201211281402437422.png\" alt=\"第一次请求\"></li>\n<li>之后的请求<br><img src=\"http://images.cnblogs.com/cnblogs_com/skynet/201211/201211281402442505.png\" alt=\"之后的请求\"></li>\n<li>HTML5应用设置<a href=\"http://www.w3school.com.cn/html5/html_5_app_cache.asp\" target=\"_blank\" rel=\"noopener\">appliction cache</a></li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">HTML</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">manifest</span>=<span class=\"string\">\"demo.appcache\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">The content of the document......</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>根据manifest文件中的配置，控制文件的访问（从缓存，直接请求或者是降级的处理），详细的解释看<a href=\"http://www.cnblogs.com/blackbird/archive/2012/06/12/2546751.html\" target=\"_blank\" rel=\"noopener\">这里</a></p>\n<h1 id=\"浏览器渲染\"><a href=\"#浏览器渲染\" class=\"headerlink\" title=\"浏览器渲染\"></a>浏览器渲染</h1><p>浏览器对于返回状态码为200的页面的解析是根据文本序自上而下解析的，一般我们假定应用最佳实践（CSS置顶，JS置尾），浏览器读取到content type为html，便以html的方式解析内容，在header中读取到外链的CSS文件就加载它，但是不会影响页面的渲染，浏览器构造CSS的规则树，随着对于页面内容的解析，浏览器同时构造文档的DOM树，在CSS的规则树构建完成后会与DOM树配合生成渲染树。从根节点递归调用，计算每一个元素的大小、位置等，给每个节点所应该出现在屏幕上的精确坐标，布局渲染树。 遍历渲染树，每个节点将使用UI后端层来绘制渲染树（主要是上色）<br><img src=\"http://taligarsiel.com/Projects/webkitflow.png\" alt=\"Main Flow\"><br>在文档加载中会解析到img标签，根据URL加载图片文件，如果没有设定图片的尺寸，在图片真正加载完成后放置在img容器中会出发浏览器的reflow。作为背景图的图片在渲染树构建的时候根据是否为display：none决定需不需要加载，一般CSS设定的背景图片会比img标签定义图片加载时间滞后，详细实验看<a href=\"http://www.cnblogs.com/smjack/archive/2008/08/21/1272905.html\" target=\"_blank\" rel=\"noopener\">这里</a>。浏览器解析到script标签加载外部JS文件，并且执行脚本内容，如果脚本中有对于DOM元素的操作，位置布局上的改变会触发reflow，颜色样式上的改变会出发repaint。</p>\n<h1 id=\"TCP四次握手断开\"><a href=\"#TCP四次握手断开\" class=\"headerlink\" title=\"TCP四次握手断开\"></a>TCP四次握手断开</h1><p>如果没有配置header中Connection字段值为Keep-Alive（http 1.0中默认是关闭的，不过现在大部分浏览器都是用http1.1协议，也就是说默认都会发起Keep-Alive的连接请求，这一步就没有了），在加载完请求页面后TCP连接会被断开。<br>这个断开操作可以由客户端或者服务器端任一方发起，这里以客户器端为例。客户端发送FIN码告知服务器端没有数据需要发送了（想要断开连接），服务器端返回客户端ACK码，告知客户端已经收到消息，令客户端等待，客户端进入FIN_WAIT状态。服务器端确认没有需要交互的数据后向客户端发送FIN码，并且开始准备关闭连接。客户端返回ACK码确认连接需要关闭，并且进入TIME_WAIT状态。服务器端受到ACK码后关闭连接，客户端等待一定时间后关闭连接。<br><img src=\"http://hi.csdn.net/attachment/201108/7/0_1312718564tZXD.gif\" alt=\"四次握手\"></p>\n<h1 id=\"AJAX交互\"><a href=\"#AJAX交互\" class=\"headerlink\" title=\"AJAX交互\"></a>AJAX交互</h1><p>如果我们希望使用局部刷新页面内容，来提升页面的加载体验，在JS脚本中会向后端的rest service请求数据，在数据加载完成之后会更新局部的DOM元素，触发reflow或者是repaint。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>如果我们使用<a href=\"http://www.searchtb.com/2011/04/an-introduction-to-bigpipe.html\" target=\"_blank\" rel=\"noopener\">bigpipe技术</a>，会在原有的模式上进行改进。浏览器发送访问请求，然后浏览器分步返回不同的pagelet的内容，BigPipe 打破了原有的顺序执行，将页面分成不同的pagelet ，如此一来，所有的pagelet 的执行时间累加起来还是原有的时间。但是， 通过叠加不同pagelet 的不同阶段的执行时间，使总的运行时间大大减少。可以看出，总体的流程是上面罗列的这些，但是不同的技术方案会产生不同的加载处理顺序，这里的总结还有不尽完善的地方，逐步改进。</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://igoro.com/archive/what-really-happens-when-you-navigate-to-a-url/\" target=\"_blank\" rel=\"noopener\">What really happens when you navigate to a URL</a></li>\n<li><a href=\"http://taligarsiel.com/Projects/howbrowserswork1.htm\" target=\"_blank\" rel=\"noopener\">How browsers work</a></li>\n<li><a href=\"https://github.com/alex/what-happens-when\" target=\"_blank\" rel=\"noopener\">what-happens-when</a></li>\n<li><a href=\"https://github.com/vasanthk/how-web-works\" target=\"_blank\" rel=\"noopener\">how-web-works</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzIyMjYyMzg3MA==&amp;mid=2247484408&amp;idx=2&amp;sn=456405dd36fd679dea1470b131924980\" target=\"_blank\" rel=\"noopener\">深入浅出浏览器渲染原理</a></li>\n<li><a href=\"http://blog.csdn.net/whuslei/article/details/6667471\" target=\"_blank\" rel=\"noopener\">TCP协议中的三次握手和四次挥手(图解)</a></li>\n<li><a href=\"http://hi.baidu.com/misaiya2008/item/e254d52303114f85af48f5c7\" target=\"_blank\" rel=\"noopener\">HTTP协议头部与Keep-Alive模式详解Connection: Keep-Alive/close</a></li>\n<li><a href=\"http://blog.csdn.net/21aspnet/article/details/6604805\" target=\"_blank\" rel=\"noopener\">http响应Last-Modified和ETag以及Apache和Nginx中的配置</a></li>\n<li><a href=\"http://hsj69106.blog.51cto.com/1017401/286541/\" target=\"_blank\" rel=\"noopener\">设置html页面不让浏览器缓存的方法</a></li>\n<li><a href=\"http://www.cnblogs.com/smjack/archive/2008/08/20/1272370.html\" target=\"_blank\" rel=\"noopener\">HTML页面元素加载顺序研究报告（1）—-简单Div罗列</a></li>\n</ul>\n","categories":[],"tags":["blog","frontend","todo"]},{"title":"JS继承机制的实现","url":"https://vincenthou.github.io/2014/05/24/JS继承机制的实现/","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>之前对于JS实现继承的机制有一些粗浅的认识，可以简单实现case by case的继承 #16 ，继承的实现是没有复用的，最近专门研究了下，实现一个通用的继承实现</p>\n<h1 id=\"经典继承的实现和改进\"><a href=\"#经典继承的实现和改进\" class=\"headerlink\" title=\"经典继承的实现和改进\"></a>经典继承的实现和改进</h1><h2 id=\"直接使用原型链\"><a href=\"#直接使用原型链\" class=\"headerlink\" title=\"直接使用原型链\"></a>直接使用原型链</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inherit</span>(<span class=\"params\">Sub, Super</span>) </span>&#123;</span><br><span class=\"line\">    Sub.prototype = <span class=\"keyword\">new</span> Super();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这种实现是最简单直接的，但是这样生成的Sub实例在复用Super的属性和方法的时候都是基于原型链查找的，子类如果没有覆盖父类的方法或者属性，所有子类实例都是共享的同一份数据，对于方法这样挺好的，但是对于属性就不行了，特别是对于数组和引用类型的属性（除非重新赋值，不然所有实例引用的是同一份数据）。单纯这样写的继承方式是没有办法自定义构造方法的。</p>\n<h2 id=\"借用构造函数\"><a href=\"#借用构造函数\" class=\"headerlink\" title=\"借用构造函数\"></a>借用构造函数</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Super</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.arr = arr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Sub</span>(<span class=\"params\">arr, age</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">    Super.call(<span class=\"keyword\">this</span>, arr);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>为了保证子类会实现父类属性的深拷贝，在子类的构造函数里面显示调用父类的构造函数，通过向call或者apply函数传递this参数绑定添加属性的上下文。</p>\n<h2 id=\"共享原型\"><a href=\"#共享原型\" class=\"headerlink\" title=\"共享原型\"></a>共享原型</h2><p>通常的做法是上面两种做法的结合，但是这样又会有另外一个问题，那就是两次调用构造函数，这是第一次</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Sub.prototype = <span class=\"keyword\">new</span> Super();</span><br></pre></td></tr></table></figure>\n<p>为了实现原型链，实例化父类对象赋值为Sub的原型，完成一次父类构造含函数调用。<br>这是第二次</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Super.call(<span class=\"keyword\">this</span>, arr);</span><br></pre></td></tr></table></figure>\n<p>为了深拷贝父类的属性，完成二次父类构造含函数调用。<br>既然实例属性复用可以通过借用构造函数，我们其实只是想要获得所有父类原型上的属性或者方法，可以通过共享原型实现替换原来的实现</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inherit</span>(<span class=\"params\">Sub, Super</span>) </span>&#123;</span><br><span class=\"line\">    Sub.prototype = Super.prototype;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"增加代理构造函数\"><a href=\"#增加代理构造函数\" class=\"headerlink\" title=\"增加代理构造函数\"></a>增加代理构造函数</h2><p>共享原型可以方便的让子类使用父类的原型属性和方法了，但是仍然存在问题。因为子类原型是直接指向父类原型的，这种引用类型的赋值倒置，所有继承父类的子类原型是一样的。在完成子类的继承之后，如果修改任何子类的原型，这份修改会影响到所有的其他子类原型和父类。既然不能直接引用父类原型，那就添加一个代理层就好了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inherit</span>(<span class=\"params\">Sub, Super</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> F = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;;</span><br><span class=\"line\">    F.prototype = Super.prototype;</span><br><span class=\"line\">    Sub.prototype = <span class=\"keyword\">new</span> F();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里定义的这个F就是我们说的代理构造函数，因为是单独实例化了代理构造函数( new F() )，这样之后对于子类原型的修改都是单独的，不会相互影响，更不会影响到父类原型。</p>\n<h2 id=\"存储父类原型和重置构造函数指针\"><a href=\"#存储父类原型和重置构造函数指针\" class=\"headerlink\" title=\"存储父类原型和重置构造函数指针\"></a>存储父类原型和重置构造函数指针</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inherit</span>(<span class=\"params\">Sub, Super</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> F = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;;</span><br><span class=\"line\">    F.prototype = Super.prototype;</span><br><span class=\"line\">    Sub.prototype = <span class=\"keyword\">new</span> F();</span><br><span class=\"line\">    Sub.uber = Super.prototype;</span><br><span class=\"line\">    Sub.prototype.construtor = Sub;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>因为添加了代理层，子类和父类的关系不是很明朗，添加一个uber属性标示父类原型。我们如果察看Sub的实例构造器( sub.constructor )，发现结果是Super，为了弥补这一不合理的现象，重置constructor是一个不错的方法。</p>\n<h2 id=\"优化继承的实现\"><a href=\"#优化继承的实现\" class=\"headerlink\" title=\"优化继承的实现\"></a>优化继承的实现</h2><p>其实这里的代理构造函数是可以复用的，不需要每次继承父类的时候都创建一个，通过创建闭包，可以让所有的子类继承都使用，同时由于这里对于子类原型的复制都是实例化一个新的代理实例，不存在原型共享的问题。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> inherit = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> F = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">Sub, Super</span>) </span>&#123;</span><br><span class=\"line\">        F.prototype = Super.prototype;</span><br><span class=\"line\">        Sub.prototype = <span class=\"keyword\">new</span> F();</span><br><span class=\"line\">        Sub.uber = Super.prototype;</span><br><span class=\"line\">        Sub.prototype.constructor = Sub;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<p>搭配借用构造函数为子类属性赋值，这已经是最完美的解决方案了。顺便提一下，这里有一个经典的原型继承模式（我觉得是基于原型链的浅拷贝）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> F = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;;</span><br><span class=\"line\">    F.prototype = o;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;<span class=\"attr\">name</span>:<span class=\"string\">'vincent'</span>&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> cloned = object(obj);</span><br><span class=\"line\">obj.name = <span class=\"string\">'test'</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(cloned.name);<span class=\"comment\">//output 'test'</span></span><br></pre></td></tr></table></figure>\n<p>在ECMAScript 5中通过<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create\" target=\"_blank\" rel=\"noopener\">Object.create</a>实现了这一行为，在现代浏览器和nodejs中可以直接调用。</p>\n<h2 id=\"继承静态属性和方法\"><a href=\"#继承静态属性和方法\" class=\"headerlink\" title=\"继承静态属性和方法\"></a>继承静态属性和方法</h2><p>上面的解决方案已经能够解决我们处理JS面向对象继承的问题了，进一步来说。我们的继承概念需要能够继承父类的静态属性和方法，再添加点修改</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> inherit = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> F = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">Sub, Super</span>) </span>&#123;</span><br><span class=\"line\">        F.prototype = Super.prototype;</span><br><span class=\"line\">        Sub.prototype = <span class=\"keyword\">new</span> F();</span><br><span class=\"line\">        Sub.uber = Super.prototype;</span><br><span class=\"line\">        Sub.prototype.constructor = Sub;</span><br><span class=\"line\">        <span class=\"comment\">//add static function from parent class</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> prop;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (prop <span class=\"keyword\">in</span> Super) &#123;</span><br><span class=\"line\">            !Sub[prop] &amp;&amp; (Sub[prop] = Super[prop]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<h1 id=\"复制属性的继承方式\"><a href=\"#复制属性的继承方式\" class=\"headerlink\" title=\"复制属性的继承方式\"></a>复制属性的继承方式</h1><h2 id=\"简单属性复制\"><a href=\"#简单属性复制\" class=\"headerlink\" title=\"简单属性复制\"></a>简单属性复制</h2><p>我们有的时候不需要进行完成经典的继承，可能只是继承，或者说是拷贝一些属性（基于对象），通过简单的属性循环就可以实现，hasOwnProperty会排除掉原型上的属性。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">extend</span>(<span class=\"params\">parent, child</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> prop;</span><br><span class=\"line\">    child = child || &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (prop <span class=\"keyword\">in</span> parent) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (parent.hasOwnProperty(prop)) &#123;</span><br><span class=\"line\">            child[prop] = parent[prop];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> child;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"深度复制\"><a href=\"#深度复制\" class=\"headerlink\" title=\"深度复制\"></a>深度复制</h2><p>上面的实现其实对于对象的拷贝来说其实只是实现了简单的浅拷贝，对于引用类型和数组类型会有潜在的问题，我们可能需要一个更加健壮的方法实现。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">extend</span>(<span class=\"params\">parent, child, deep</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> prop;</span><br><span class=\"line\">    child = child || &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> aType = <span class=\"string\">'[object Array]'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (prop <span class=\"keyword\">in</span> parent) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (parent.hasOwnProperty(prop)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//check if the value is array or object</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (deep &amp;&amp; <span class=\"string\">'object'</span> === <span class=\"keyword\">typeof</span> parent[prop]) &#123;</span><br><span class=\"line\">                child[prop] = aType ===  &#123;&#125;.toString.call(parent[prop]) ? [] : &#123;&#125;;</span><br><span class=\"line\">                <span class=\"comment\">//recursive extend array and object value</span></span><br><span class=\"line\">                extend(parent[prop], child[prop], <span class=\"literal\">true</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                child[prop] = parent[prop];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> child;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>通过添加第三个参数来确定是否进行深拷贝，这里深拷贝的实现就是在遍历属性的时候判断属性值是否是引用类型或者数组类型，如果是的话继续进行深拷贝，知道拷贝到普通类型值为止。</p>\n<h2 id=\"混入\"><a href=\"#混入\" class=\"headerlink\" title=\"混入\"></a>混入</h2><p>在JS中通过借用多个构造函数，可以实现多继承（基于构造函数）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Super1</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Super2</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Super3</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Sub</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    Super1.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    Super2.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    Super3.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们也可以使用一个更灵活的方法来实现多继承（基于对象），这就是混入，我们可以通过这个方法方便的进行配置参数的合并</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mixin</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> prop, mixed = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = <span class=\"built_in\">arguments</span>.length; i &lt; len; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (prop <span class=\"keyword\">in</span> <span class=\"built_in\">arguments</span>[i]) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(mixed)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">arguments</span>[i].hasOwnProperty(prop)) &#123;</span><br><span class=\"line\">                mixed[prop] = <span class=\"built_in\">arguments</span>[i][prop];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mixed;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Jquery中是通过extend方法来实现的mixin，并且是以上两个功能的合并（同时支持深拷贝和多继承），深拷贝的标示变量是第一个参数，详细的<a href=\"https://github.com/jquery/jquery/blob/master/src/core.js#L124\" target=\"_blank\" rel=\"noopener\">Jquery实现参考</a></p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a href=\"http://www.crockford.com/javascript/inheritance.html\" target=\"_blank\" rel=\"noopener\">Classical Inheritance in JavaScript</a><br><a href=\"http://phrogz.net/JS/classes/OOPinJS2.html\" target=\"_blank\" rel=\"noopener\">OOP in JS, Part 2 : Inheritance</a><br><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Inheritance_and_the_prototype_chain\" target=\"_blank\" rel=\"noopener\">Inheritance and the prototype chain</a></p>\n","categories":[],"tags":["blog","frontend","javascript"]},{"title":"Nginx文件加密","url":"https://vincenthou.github.io/2014/05/21/Nginx文件加密/","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>我们有时候需要放置一些静态文件资源在服务器上方便团队成员共享，但是又不希望这些资源对外可以访问，apache上提供了方便的配置方法实现，nginx上面也有类似的功能，今天配置了下，本来以为挺简单的，还颇费了些周折，记录一下</p>\n<h1 id=\"配置Nginx\"><a href=\"#配置Nginx\" class=\"headerlink\" title=\"配置Nginx\"></a>配置Nginx</h1><p>Nginx有个auth_basic的模块，直接看配置</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location ^~ /protected/ &#123;</span><br><span class=\"line\">    <span class=\"comment\"># First attempt to serve request as file, then</span></span><br><span class=\"line\">    <span class=\"comment\"># as directory, then fall back to index.html</span></span><br><span class=\"line\">    try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ /index.html;</span><br><span class=\"line\">    <span class=\"comment\"># Uncomment to enable naxsi on this location</span></span><br><span class=\"line\">    <span class=\"comment\"># include /etc/nginx/naxsi.rules</span></span><br><span class=\"line\">    auth_basic <span class=\"string\">\"vincent\"</span>;</span><br><span class=\"line\">    auth_basic_user_file /etc/nginx/conf.d/htpasswd.pw;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>主要是最后的两行配置，auth_basic定义弹出输入用户名和密码提示信息，auth_basic_user_file代表导入的用户名和密码列表配置文件，这样配置以后所有访问protected目录下文件的请求都需要用户输入用户名和密码才能登陆。</p>\n<h1 id=\"创建用户名和密码列表文件\"><a href=\"#创建用户名和密码列表文件\" class=\"headerlink\" title=\"创建用户名和密码列表文件\"></a>创建用户名和密码列表文件</h1><p>根据上面的配置创建列表文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /etc/nginx/conf.d</span><br><span class=\"line\">sudo touch htpasswd.pw</span><br></pre></td></tr></table></figure>\n<p>!这里文件可以取任何文件类型，但是千万不要使用.conf后缀，开始文件叫htpasswd.conf，重启nginx一直报语法错误。</p>\n<h1 id=\"创建生成加密密码的脚本\"><a href=\"#创建生成加密密码的脚本\" class=\"headerlink\" title=\"创建生成加密密码的脚本\"></a>创建生成加密密码的脚本</h1><p>在任意目录下面创建perl脚本，保存为gpasswd.pl</p>\n<figure class=\"highlight pl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">my</span> $pw=$ARGV[<span class=\"number\">0</span>] ;</span><br><span class=\"line\"><span class=\"keyword\">print</span> <span class=\"keyword\">crypt</span>($pw,$pw).<span class=\"string\">\"\\n\"</span>;</span><br></pre></td></tr></table></figure>\n<p>为脚本添加可执行权限</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod +x gpasswd.pl</span><br></pre></td></tr></table></figure>\n<h1 id=\"生成crypt加密的密码\"><a href=\"#生成crypt加密的密码\" class=\"headerlink\" title=\"生成crypt加密的密码\"></a>生成crypt加密的密码</h1><p>如果我们想要生成的密码是happy, 执行命令</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gpasswd.pl happy</span><br></pre></td></tr></table></figure>\n<p>在命令行里面输出hafbpgNasZSjY，这就是我们要的crypt加密后的密码了。</p>\n<h1 id=\"将加密后的密码添加到用户列表\"><a href=\"#将加密后的密码添加到用户列表\" class=\"headerlink\" title=\"将加密后的密码添加到用户列表\"></a>将加密后的密码添加到用户列表</h1><p>打开之前创建的htpasswd.pw文件，给用户user添加密码happy</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user:hafbpgNasZSjY</span><br></pre></td></tr></table></figure>\n<p>重启nginx服务器，一般这样当你再次访问{domain}/protected 下文件的时候就需要输入用户名和密码了。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /etc/init.d/nginx reload</span><br></pre></td></tr></table></figure>\n<h1 id=\"可能的问题\"><a href=\"#可能的问题\" class=\"headerlink\" title=\"可能的问题\"></a>可能的问题</h1><ul>\n<li>有时候会报访问权限的错误，可能是文件夹的读写权限没有配置</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /var/www</span><br><span class=\"line\">sudo chown -R www-data:www-data protected</span><br><span class=\"line\">sudo chmod 755 protected</span><br></pre></td></tr></table></figure>\n<ul>\n<li>如果 不用 ^~ /protected/ 而用 /protected 的话 那么将只能对目录进行验证，直接访问其下的文件，将不会弹出登录验证<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1></li>\n<li><a href=\"http://blog.csdn.net/cuiyuan9/article/details/13627359\" target=\"_blank\" rel=\"noopener\">Nginx 目录或 网站加密认证</a></li>\n<li><a href=\"http://bolg.sinaapp.com/html/2011/1105.html\" target=\"_blank\" rel=\"noopener\">Apache和nginx对网站目录加密</a></li>\n<li><a href=\"http://blog.chaorenmao.com/?p=578\" target=\"_blank\" rel=\"noopener\">nginx设置网站密码访问</a></li>\n</ul>\n","categories":[],"tags":["blog","build","linux"]},{"title":"绕不开的兼容性(持续完善)","url":"https://vincenthou.github.io/2014/05/20/绕不开的兼容性-持续完善/","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>随着浏览器的发展，操作系统的更新升级，越来越多的用户开始使用现代浏览器，我们可喜的看见chrome浏览器在国外市场上高歌猛进<br>！<a href=\"http://imgsrc.baidu.com/forum/pic/item/095457fbb2fb43169fbd412022a4462308f7d387.jpg\" target=\"_blank\" rel=\"noopener\">全球浏览器份额</a><br>但是我们还是要面对现实，国内使用IE6, IE7, IE8这些浏览器的用户还是大有人在的<br>看看最新的统计数据：<br><a href=\"http://tongji.baidu.com/data/browser\" target=\"_blank\" rel=\"noopener\">百度统计</a><br><a href=\"http://brow.data.cnzz.com/\" target=\"_blank\" rel=\"noopener\">CNZZ统计</a><br>IE内核的浏览器还是大行其道的，所以就一些常见的兼容性问题做一下总结</p>\n<h1 id=\"CSS兼容性\"><a href=\"#CSS兼容性\" class=\"headerlink\" title=\"CSS兼容性\"></a>CSS兼容性</h1><p>CSS兼容性问题应该是平时开发中最常碰见，也是最令人头疼的问题了，这里重点总结一下，首先有一个原则：浏览器的bug是有的，<br>但是并不像我们自已认为的那么常见，大部分问题是我们对于CSS规范理解的不完整，一般情况下我们优先考虑是不是自己的问题，如<br>果确定不是自己的问题，在从浏览器的bug方面入手突破。</p>\n<h2 id=\"渲染模式控制\"><a href=\"#渲染模式控制\" class=\"headerlink\" title=\"渲染模式控制\"></a>渲染模式控制</h2><p><a href=\"http://www.mangguo.org/compatibility-mode-to-talk-about-x-ua-compatible/\" target=\"_blank\" rel=\"noopener\"></a></p>\n<h2 id=\"CSS-hack\"><a href=\"#CSS-hack\" class=\"headerlink\" title=\"CSS hack\"></a>CSS hack</h2><p>为了获得统一的页面效果，就需要针对不同的浏览器或不同版本写特定的CSS样式，我们把这个针对不同的浏览器/不同版本写相应的CSS code的过程，叫做<a href=\"http://blog.csdn.net/freshlover/article/details/12132801\" target=\"_blank\" rel=\"noopener\">CSS hack</a></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.all</span> <span class=\"selector-tag\">IE</span>&#123;<span class=\"attribute\">property</span>:value\\<span class=\"number\">9</span>;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.IE</span> 9&#123;<span class=\"attribute\">property</span>:value\\<span class=\"number\">9</span>\\<span class=\"number\">0</span>;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.gte</span> <span class=\"selector-tag\">IE</span> 8&#123;<span class=\"attribute\">property</span>:value\\<span class=\"number\">0</span>;&#125;</span><br><span class=\"line\">.lte IE 7&#123;*property:value;&#125;</span><br><span class=\"line\">.IE 7&#123;+property:value;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.IE</span> 6&#123;<span class=\"attribute\">_property</span>:value;&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"常见问题和方案\"><a href=\"#常见问题和方案\" class=\"headerlink\" title=\"常见问题和方案\"></a>常见问题和方案</h2><ul>\n<li>最好使用一些预检查工具（在线或者和开发工具集成的），帮助排除语法错误。</li>\n<li>避免使用更特殊的选择器，遇到问题时候从根源上入手，而不是通过添加更加特殊的选择器，尽可能一般化，只有在细粒度的地方添加更特殊的选择器</li>\n<li>垂直外边距叠加是一个有趣的现象，例如下面的代码</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.wrap</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"comment\">/*border: 1px solid black;*/</span></span><br><span class=\"line\">    <span class=\"comment\">/*padding: 1px;*/</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: red;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.text</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: yellow;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"wrap\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"text\"</span>&gt;</span>Test<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>如果没有使用CSS代码中注释掉的部分，默认渲染的行为是在wrap的外层产生20px的margin而不是10。这是由具有块级子元素的元素计算高度方式造成的。<br>如果元素没有垂直的边框和内边距，那么它的高度就是包含的子元素内容的高度。解决的方法是去掉上面CSS代码中的任一条注释，添加边框或者是那边距。<br>通过chrome的开发调试工具的layout工具可以方便的调试盒模型<br><a href=\"http://wenku.baidu.com/link?url=fPsZEQjjFe8RVzBkTwH130wvj09tr4IC_gObsyqBaW_7DJTOucVM-nGjrufJGVSn6uzFppOcd8nK22UVnm1CA1T8SrEe2tLt2o4QURAnAKO\" target=\"_blank\" rel=\"noopener\">CSS兼容性大全</a></p>\n<h1 id=\"JS兼容性\"><a href=\"#JS兼容性\" class=\"headerlink\" title=\"JS兼容性\"></a>JS兼容性</h1><h2 id=\"常见问题和方案-1\"><a href=\"#常见问题和方案-1\" class=\"headerlink\" title=\"常见问题和方案\"></a>常见问题和方案</h2><h1 id=\"通用的解决方法\"><a href=\"#通用的解决方法\" class=\"headerlink\" title=\"通用的解决方法\"></a>通用的解决方法</h1><h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a href=\"http://zh.learnlayout.com/index.html\" target=\"_blank\" rel=\"noopener\">学习CSS布局</a></p>\n","categories":[],"tags":["frontend","collection"]},{"title":"简单模板的实现","url":"https://vincenthou.github.io/2014/05/19/简单模板的实现/","content":"<p>今天碰到这么一个需求，替换模板样式，需要支持这两种调用</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//两个模板是这样的</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> tpl1 = <span class=\"string\">'My name is #&#123;name&#125;, I am #&#123;age&#125; years old'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> tpl2 = <span class=\"string\">'My name is #&#123;0&#125;, I am #&#123;1&#125; years old'</span>;</span><br><span class=\"line\"><span class=\"comment\">//调用后打印出来</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(render(tpl1, &#123;<span class=\"attr\">name</span>: <span class=\"string\">'vincent'</span>, <span class=\"attr\">age</span>: <span class=\"number\">25</span>&#125;));</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(render(tpl2, <span class=\"string\">'vincent'</span>, <span class=\"number\">25</span>));</span><br><span class=\"line\"><span class=\"comment\">//统一输出 My name is vincent, I am 25 years old</span></span><br></pre></td></tr></table></figure>\n<p>刚开始没什么思路，仔细想想还是挺简单的，实现代码这样</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\">tpl</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> argLen = <span class=\"built_in\">arguments</span>.length;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> regx = <span class=\"regexp\">/#\\&#123;[\\w\\W]+?\\&#125;/gi</span>;<span class=\"comment\">//非贪婪模式</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> matches = tpl.match(regx);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argLen &gt; <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        matches.unshift(<span class=\"literal\">null</span>);<span class=\"comment\">//保证下标对应</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; argLen; i++) &#123;</span><br><span class=\"line\">            tpl = tpl.replace(matches[i], <span class=\"built_in\">arguments</span>[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">2</span> ===  argLen) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> obj = <span class=\"built_in\">arguments</span>[<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">'object'</span> === <span class=\"keyword\">typeof</span>(obj)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> key = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, mLen = matches.length; match = matches[i++];) &#123;</span><br><span class=\"line\">                key = match.slice(<span class=\"number\">2</span>, match.length - <span class=\"number\">1</span>);</span><br><span class=\"line\">                tpl = tpl.replace(match, obj[key]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> tpl;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>总结一条经验，看来TDD开发还是很好的，没有思路的时候可以通过测试驱动，一步步实现需求，不过以上实现应该还有可以优化的地方，先记录下来。</p>\n","categories":[],"tags":["blog","frontend","javascript"]},{"title":"透明化跳板机","url":"https://vincenthou.github.io/2014/05/13/透明化跳板机/","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>最近由于运维升级，原来可以直接连接到stage server，现在需要多一步，通过先登录到跳板机，再从跳板机登录到stage server，实在是太麻烦了，找到解决方案记录一下。</p>\n<h1 id=\"操作步骤\"><a href=\"#操作步骤\" class=\"headerlink\" title=\"操作步骤\"></a>操作步骤</h1><h2 id=\"生成公钥私钥文件\"><a href=\"#生成公钥私钥文件\" class=\"headerlink\" title=\"生成公钥私钥文件\"></a>生成公钥私钥文件</h2><p>一般用git的话，这个文件应该是生成过的，在用户目录的.ssh文件夹下面，没有的话自己生成一份</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>\n<p>之前连接stage server，是限制在.ssh下authorized_keys文件中添加自己的公钥的，都是连接的时候带上私钥的</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -i ~/.ssh/cp_key/id_rsa user@stage_ip</span><br></pre></td></tr></table></figure>\n<p>今天连上去看了下，只有我比较“守规矩”，里面添加了不少个人的公钥，我也就默默的加上去了，这样我们后续连接就轻松许多。</p>\n<h2 id=\"在跳板机和目标机（stage-server）添加本地公钥\"><a href=\"#在跳板机和目标机（stage-server）添加本地公钥\" class=\"headerlink\" title=\"在跳板机和目标机（stage server）添加本地公钥\"></a>在跳板机和目标机（stage server）添加本地公钥</h2><p>跳板机可以直接连，使用ssh-copy-id工具</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-copy-id -i ~/.ssh/id_rsa.pub jump_server_ip</span><br></pre></td></tr></table></figure>\n<p>如果失败可以手动添加（stage server不能直接连，只能手动添加）：连接到要添加公钥的机器，进入用户目录的.ssh文件夹，打开authorized_keys文件，在文件末尾添加自己本地的公钥id_rsa.pub中的内容（一定要是在一行的），拷贝粘帖就搞定了。</p>\n<h2 id=\"隐藏跳板机\"><a href=\"#隐藏跳板机\" class=\"headerlink\" title=\"隐藏跳板机\"></a>隐藏跳板机</h2><p>在.ssh文件夹下面创建config文件，添加以下内容</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Host stage</span><br><span class=\"line\">    ProxyCommand ssh user@jump_server_ip nc stage_server_ip %p</span><br></pre></td></tr></table></figure>\n<p>这个隐藏实际是通过ProxyCommand，可以在开启ssh之前执行一个命令打开代理隧道。</p>\n<h2 id=\"连接测试\"><a href=\"#连接测试\" class=\"headerlink\" title=\"连接测试\"></a>连接测试</h2><p>配置搞定后我们就来连一下吧</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh stage</span><br></pre></td></tr></table></figure>\n<p>一下就来到stage server 的用户目录了，还可以方便的上传文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp project.zip user@stage:~/tmp</span><br></pre></td></tr></table></figure>\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><p><a href=\"http://www.cnblogs.com/lucantang/p/3315329.html\" target=\"_blank\" rel=\"noopener\">SSH免密码登陆以及穿越跳板机</a><br><a href=\"http://wdicc.com/controlmaster-in-ssh/\" target=\"_blank\" rel=\"noopener\">有跳板机的 ssh 登陆</a><br><a href=\"http://blog.sina.com.cn/s/blog_677fbc19010179kv.html\" target=\"_blank\" rel=\"noopener\">SSH自动穿越跳板机 </a></p>\n","categories":[],"tags":["blog","linux"]},{"title":"CSS模块化","url":"https://vincenthou.github.io/2014/05/10/CSS模块化/","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>如果只是几个简单页面从快速实现上来说，CSS模块化完全没有必要，想怎么写就怎么写。但是随着业务需求的变更或者是规模的增长，不只是你一个人在写CSS代码，CSS模块化就显得尤为重要了，如果没有很好的组织，到了后期简直是一场噩梦。</p>\n<h1 id=\"CSS代码组织的理论\"><a href=\"#CSS代码组织的理论\" class=\"headerlink\" title=\"CSS代码组织的理论\"></a>CSS代码组织的理论</h1><p>对于CSS模块化，前辈已经有了很多探索和实践，这里简述一下：</p>\n<h2 id=\"简单的组建化\"><a href=\"#简单的组建化\" class=\"headerlink\" title=\"简单的组建化\"></a>简单的组建化</h2><p>很直观的当我们拿到设计图的时候，会抽出来一些通用的组件，例如按钮，下拉框，选项卡等，这是很自然的行为，当组建的行为或者样式更改的时候，我们之需要修改相关的CSS片段就好了，这里为了防止一些通用名称如hd(header)，ft(footer)冲突，会需要是有后代选择器来构建命名空间，但是权重的提升会带来潜在的问题，这便是最朴素的做法。</p>\n<h2 id=\"OOCSS\"><a href=\"#OOCSS\" class=\"headerlink\" title=\"OOCSS\"></a>OOCSS</h2><p>这里的OO其实不是我们编写代码所理解的OO，其实更准确的理解应该是对于页面元素的抽象。OOCSS有两个最基本的原则就是：</p>\n<ol>\n<li>结构和皮肤分离</li>\n<li>容器和内容分离<br>这样区分的目的其实是分离变化，另外我觉的这两条规则隐含的一点是多使用组合来构建组件，少使用后代选择器（后代选择器提升的权重会是维护的梦魇）。其实在设计时为了保持风格统一，很多组件也会有重复的设计样式。<br>例如gitbhu这个编辑页面上，有个“This repository”和“Unwatch”的button，这两个元素从组件角度来看是不一样的，前者后面紧跟的是一个输入框，而后者后面跟的是操作的统计次数，但是它们又有相同的地方，就是都有圆角（左上和右下）box-shadow和小箭头(点击能有下拉)，这就是两个不同组件的共有特性部分，我们就可以这样来写：</li>\n</ol>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.select-btn</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">    <span class=\"attribute\">border-top-left-radius</span>: <span class=\"number\">2px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-bottom-left-radius</span>: <span class=\"number\">2px</span>;</span><br><span class=\"line\">   <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">81</span>,<span class=\"number\">167</span>,<span class=\"number\">232</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.select-btn</span><span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">4px</span> solid;</span><br><span class=\"line\">    <span class=\"attribute\">border-right-color</span>: transparent;</span><br><span class=\"line\">    <span class=\"attribute\">border-left-color</span>: transparent;</span><br><span class=\"line\">    <span class=\"attribute\">border-bottom-color</span>: transparent;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这种做法会带来一定的复杂度，一般情况下，我们无法一下识别出这些相似的特性，或者由于设计师的修改，相似的特性会被转移或者破坏，这就需要不断的重构代码，对于开发的抽象能力有一定的要求。因为使用组合，这种方式会比较灵活。</p>\n<h2 id=\"SMACSS\"><a href=\"#SMACSS\" class=\"headerlink\" title=\"SMACSS\"></a>SMACSS</h2><p>可扩展和模块化的CSS架构 (Scalable and Modular Architecture for CSS) 是把所有的CSS文件视为一个整体来考虑的，他的基本理论是将CSS代码分类，包括基础，布局，模块，状态和皮肤这5类，对于细节代码的书写没有过多的限制，后代选择器和ID选择器也是可用的。</p>\n<ul>\n<li>基础 就是我们平常会用到的CSS reset，这个一般不会经常修改的</li>\n<li>布局(l-) 页面的大块的布局结构，例如header，content, footer, siebar这些</li>\n<li>模块(modula name) 放在布局结构中的小组件，就是朴素模块化中的组件概念</li>\n<li>状态(is-) 组件或者布局元素的伪类效果（:hover :focus :checked）或者自定义状态类(.is-expanded .is-folded)</li>\n<li>皮肤 定义颜色和字体</li>\n</ul>\n<p>bootstrap就是一个典型的实践，bootstrap使用了normalize.less来reset，布局使用了grid.less来让用户自定义进行布局，core css中的button.less，tables.less等和所有的coponent，状态是跟组件关联的没有单独抽出来，bootstrap有个theme文件方便用户定制组件的皮肤。</p>\n<h2 id=\"DRY-CSS\"><a href=\"#DRY-CSS\" class=\"headerlink\" title=\"DRY CSS\"></a>DRY CSS</h2><p>DRY CSS是最新的一项实践，个人感觉他的上手是最容易，复杂程度也是最低的。他有两条重要的原则</p>\n<ol>\n<li>将样式从内容分离</li>\n<li>通过控制层叠来避免特殊性</li>\n</ol>\n<p>通过内容的语义而不是样式来命名，使用ID选择器也没什么大不了的。<br>之需要三步你就可以开始上手了：</p>\n<ol>\n<li>将可以复用的CSS属性分组</li>\n<li>根据语义为分组命名</li>\n<li>添加相同分组样式的选择器</li>\n</ol>\n<p><img src=\"http://media.creativebloq.futurecdn.net/sites/creativebloq.com/files/images/2013/09/drycss.jpg\" alt=\"DRY\"><br>这样写代码会很快，也会有维护的便捷，但是可读性就一般了，比较适合快速搭建原型或者设计搞已经固定下来的开发。</p>\n<h1 id=\"额外的工具\"><a href=\"#额外的工具\" class=\"headerlink\" title=\"额外的工具\"></a>额外的工具</h1><p>近年来CSS预处理器渐渐流行起来，包括LESS，SASS，Stylus这些工具也有了应用。其实总体看来这些DSL的语法特性差别不是很大，包括变量、方法、嵌套和混入等，详细的语法对比看<a href=\"http://www.oschina.net/question/12_44255\" target=\"_blank\" rel=\"noopener\">这里</a>。如果使用ruby作为开发SASS应该是不二的选择，配合Compass更能显出其威力，对应的LESS也有对应国产的<a href=\"https://github.com/feichang/veryless\" target=\"_blank\" rel=\"noopener\">veryless</a>。stylus比较新，语法更自由些（你甚至可以不用括号和冒号），不过个人感觉过分自由的语法不利于项目的统一（总是看起来怪怪的）。虽然bootstrap有SASS和stylus的port，但是官方还是用LESS来开发的，如果是bootstrap的项目还是还是使用LESS比较方便。另外SASS和stylus需要额外的环境配置和工具安装，LESS在开发阶段之需要引入一个js就可以开始工作了，后期可以再编译合并进行优化。虽然都是DRY的实践，有一个语法特性是值得商榷的，就是mixin。mixin在ruby语法中是一个很好的特性，可以方便的实现多重继承，这些CSS预处理器引入了这一个编程语言特性，本来是未可厚非的，但是我觉得不应该过度使用。mixin的好处不用多说，开发时应用起来也很方便，但是一旦过度使用在编译后，CSS中就会有大量重复的代码块。我觉得组合的思想还是更适合在CSS中使用的，在bootstrap的LESS代码中也有体现，无参数的mixin用的是很少的，大部分mixin是使用有参数的（编译后的值不一样），不会造成重复。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>实际使用CSS预编译器会有一定的学习成本，团队中推动会有阻力（如果大家都有尝试新技术的兴趣，不妨一用），相比之下模块化组织CSS代码的思路会更实用些，根据实际项目需求取舍吧，最适合的才是最好的。<br>我觉得整体的CSS的模块化组织应该是这样的：</p>\n<ul>\n<li>使用SMACSS组织整体项目代码</li>\n<li>base: 尽量使用normal.css来作为base，如果要兼具语义化和设计图还原还是自己写</li>\n<li>layout: 可以认为header、footer这些也是module，layout中只是对于这些module在不同结构中的尺寸和布局（保证module的独立性）</li>\n<li>module: 应用OOCSS的思想，使用组合的类来创建组件，模块内使用百分比给定尺寸</li>\n<li>state: module特有的state直接和module相关代码放在一起，通用的state除了一些伪类的效果还有trasition和animation</li>\n<li>theme: 定义常用字体、字号和颜色，方便组合应用到模块和元素上</li>\n<li>common: 借鉴<a href=\"https://github.com/zhangxinxu/quickLayout\" target=\"_blank\" rel=\"noopener\">quick layout</a>的思路，提取出常用的原子类方便组合。另外，清除浮动，垂直居中，字体溢出处理等元素处理的通用解决方案<br>最好的情况是这些部分由一两个人来维护，保证风格和意义的统一，其他开发之需要像使用bootstrap一样拿来就用就好。以往的开发过程中按照页面自己写自己的CSS虽然可以很方便的分配人物，但是这样的结果是写出来的代码既有重复，命名冲突也很严重。当然这种做法是颇费周折的，使用DRY CSS的做法就没这么麻烦了，就是出来的代码结构没有这么好看，不注意的话，可能会有很多重复的地方。<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1></li>\n<li><a href=\"http://oocss.org/\" target=\"_blank\" rel=\"noopener\">OOCSS</a></li>\n<li><a href=\"http://smacss.com/\" target=\"_blank\" rel=\"noopener\">SMACSS</a></li>\n<li><a href=\"http://www.vanseodesign.com/css/dry-principles/\" target=\"_blank\" rel=\"noopener\">DRY CSS</a></li>\n<li><a href=\"http://www.creativebloq.com/css3/create-modular-and-scalable-css-9134351\" target=\"_blank\" rel=\"noopener\">4 ways to create CSS that’s modular and scalable</a></li>\n<li><a href=\"http://lesscss.net/article/home.html\" target=\"_blank\" rel=\"noopener\">LESS文档</a></li>\n<li><a href=\"http://www.ruanyifeng.com/blog/2012/06/sass.html\" target=\"_blank\" rel=\"noopener\">SASS用法指南</a></li>\n<li><a href=\"http://compass-style.org/\" target=\"_blank\" rel=\"noopener\">Compass官网</a></li>\n<li><a href=\"http://www.ruanyifeng.com/blog/2012/11/compass.html\" target=\"_blank\" rel=\"noopener\">Compass用法指南</a></li>\n<li><a href=\"http://www.zhangxinxu.com/wordpress/2012/06/stylus-nodejs-expressive-dynamic-robust-css/\" target=\"_blank\" rel=\"noopener\">Stylus-NodeJS下构建更富表现力/动态/健壮的CSS</a></li>\n<li><a href=\"http://learnboost.github.io/stylus/\" target=\"_blank\" rel=\"noopener\">stylus官网</a></li>\n</ul>\n","categories":[],"tags":["blog","css","frontend"]},{"title":"【翻译】 facebook的性能优化","url":"https://vincenthou.github.io/2014/04/30/【翻译】-facebook的性能优化/","content":"<h1 id=\"翻译文章\"><a href=\"#翻译文章\" class=\"headerlink\" title=\"翻译文章\"></a>翻译文章</h1><p>在facebook,特性和应用被深度集成在每个页面里面，这样的深度集成给前端性能的优化带来了挑战和机会（前端指的是浏览器的渲染）：</p>\n<ol>\n<li>每个特性被集成到多个页面里面。在不同的页面间有大量的通用HTML，JS，CSS重复。当一个用户在页面之间浏览的时候，即使在本地已经缓存，对于浏览器来说，重复执行通用的JS，重新载入内容是一件头痛的事情。</li>\n<li>几乎Facebook的每个页面都包含不同产品团队开发的不止一个特性的网页内容。评估在页面上添加新的特性对于前端性能的影响是一个巨大的挑战。</li>\n<li>网页上的新特性不仅依赖于快速的产品周期还依赖于用户的接受度。性能优化必须在快速的特性开发中是自适应并且可维护的。</li>\n</ol>\n<p>在这里我们要讨论一些改进和维持前端性能的经验，在以下几个方面详细阐述如何构建和操作这样一套基础架构：</p>\n<ol>\n<li>使用AJAX来渲染整个页面，过去AJAX一般被用来获取动态的内容或者响应用户的操作部分渲染页面，facebook开发了一套框架使用AJAX来渲染整个页面，同时利用JS保持原来传统页面的用户体验。这套纯粹使用AJAX来渲染页面的框架消除了跨页面重复执行通用JS和重新载入内容的问题。</li>\n<li>评估和性能测试：我们开发了一套性能评估框架来模拟和分析网页速度。除了传统的模拟特性，这套框架提供了A/B测试能力并且能与特性启动系统集成，这使得一个新的特性的引入对于整体性能的影响变得可以评估，其实是多个页面混合迭代的特性</li>\n<li>适应性的静态资源打包：许多静态资源打包系统都是在特性部署的时候执行。产品的开发人员指定某个特性可能需要的所有静态资源，构建系统将他们分组打包成JS和CSS文件，以及图片精灵。因为我们页面上用很多特性并且这写特性都是在迭代演进中的，部署时打包系统是不适用的。我们开发了一套适应性打包系统，这套系统基于使用率的评估来优化静态资源。使用成本效益分析模型，这套系统识别最佳打包策略，并且自动重平衡打包来追踪特性的演进。<h1 id=\"个人理解\"><a href=\"#个人理解\" class=\"headerlink\" title=\"个人理解\"></a>个人理解</h1></li>\n</ol>\n<p>2亿的用户，每天400亿的PV (数据有点老了) 虽然是一篇比较老的文章，但是有些思想还是可以借鉴的。</p>\n<ul>\n<li>使用AJAX来实现文中提出的效果会耗费更多的网络资源，一种更实际的技术叫做bigpipe，是为了解决重数据渲染而提出的一种思路，<a href=\"http://weibo.com/\" target=\"_blank\" rel=\"noopener\">新浪微博</a>就是采用了这种技术，如果在网速较差的时候打开页面，可以明显看到，页面的布局结构已经呈现出来，同时数据还在不断的更新加载出空白的部分。打开页面调试工具可以看到在页面底部有一堆的script标签，每个标签中定义的结构大概是</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FM.view(&#123;</span><br><span class=\"line\">     <span class=\"string\">\"pid\"</span>:<span class=\"string\">\"pl_leftnav_common\"</span>,</span><br><span class=\"line\">     <span class=\"string\">\"js\"</span>:[<span class=\"string\">\"home\\/js\\/pl\\/leftnav\\/common\\/index.js?version=c67133302083a411\"</span>],</span><br><span class=\"line\">     <span class=\"string\">\"css\"</span>:[<span class=\"string\">\"style\\/css\\/module\\/global\\/WB_left_nav.css?version=2112cdcd580c86d4\"</span>],</span><br><span class=\"line\">     <span class=\"string\">\"html\"</span>:<span class=\"string\">\"&lt;div class=\\\"level_1_Box\\\"&gt;\\n\\t\\t   ...  &lt;\\/div&gt;\\n\"</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这里就是bigpipe技术的关键，将页面切分成若干模块，每个模块定义其基本组成单元（html+css+js），给模块一个唯一标识的id。在页面加载的时候首先在返回流中写入页面的布局文件，注册页面模块完成填充后的回调函数，让布局页面优先渲染。同时，持续写入模板数据和页面模块到返回流中，在模块和相关模块数据完成填充后，浏览器读取模块js脚本后，触发先前注册的模块事件，将模块添加到到页面的对应位置上。<br>这样的做法有效提升了用户的可感知页面性能，比一开始一个大白屏，等了几秒钟后，一下加载出来要好得多。当然要实现这项技术需要前后端配合，摒弃以往在后端数据填充模板，完成后再返回的模式，保持渲染的连贯性。结合nodejs异步IO的特性，页面渲染的时间将取决于并行异步数据加载中最慢的模块所需要的时间，可以将这一技术的特点进一步发挥。</p>\n<ul>\n<li>对于文中提到的这种框架能力是很强大的，不过对于facebook这样有多条产品线，不同产品线上重复功能的模块这样的框架测试能力是很有必要的，不过暂时没发现有比较好的开源实现。<br>对于一般产品线而言，性能优化总是放在最后来做的（如果定义好开发规范，我们可以通过一些经验和方法延迟甚至避免性能瓶颈的到来），而做性能优化也的确是慢得让我们自己都无法忍受了，这里展开话题就很多了，参考 #20 。有些工具还是很好用的，比如<a href=\"http://jsperf.com/\" target=\"_blank\" rel=\"noopener\">jsperf</a>，最喜欢他跨浏览器测试的能力，图表显示也很直观，不过只适用于对于单独case的测试。整体性能优化就有YSlow，最近用了一款chrome的插件也不错，叫 PageSpeed Insights for Chrome，点击一下分析可以在控制台中查看结果了，很多结果的建议都是最佳实践的体现。</li>\n<li>静态资源的打包工具也用了不少，不过像文中提到的这么智能的还真没用过。打包工具有时是基于js模块管理工具的，例如像requirejs可以用r.js或者grunt插件, seajs有一套自己的打包工具。如grunt和gulp这样的工具灵活性比较强，可以很方便的根据项目的需求定制打包的流程，就是很多重复的工作要自己做。腾讯的前端团队推出了一套打包工具（不仅仅是打包工具）<a href=\"http://madscript.com/modjs/\" target=\"_blank\" rel=\"noopener\">modjs</a> ，完成了一些通用性需求的打包方案，同时又不失灵活性，用起来非常顺手。<h1 id=\"原文资料\"><a href=\"#原文资料\" class=\"headerlink\" title=\"原文资料\"></a>原文资料</h1></li>\n</ul>\n<p><a href=\"http://velocityconf.com/velocity2009/public/schedule/detail/7611\" target=\"_blank\" rel=\"noopener\">原文链接</a><br><a href=\"http://cdn.oreillystatic.com/en/assets/1/event/29/Frontend Performance Engineering in Facebook  Presentation.zip\" target=\"_blank\" rel=\"noopener\">PPT地址</a></p>\n","categories":[],"tags":["blog","frontend","pefermance"]},{"title":"使用ab进行网站压力测试","url":"https://vincenthou.github.io/2014/04/20/使用ab进行网站压力测试/","content":"<p>当我们完成了一个网站的开发工作后，为了保证网站的服务质量一般都会进行压力测试，有很多开源的工具可供使用，每种压力测试工具都提供了很好的特性支持，例如大名鼎鼎的JMeter。如果我们只是想要看到某个页面的效果，或者在几个技术方案中作出权衡，有个很好用的工具apache自带的压力测试工具ab(就是apache benchmark的缩写啦)</p>\n<h1 id=\"ubuntu上安装\"><a href=\"#ubuntu上安装\" class=\"headerlink\" title=\"ubuntu上安装\"></a>ubuntu上安装</h1><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install apache2-utils</span><br></pre></td></tr></table></figure>\n<h1 id=\"工具参数\"><a href=\"#工具参数\" class=\"headerlink\" title=\"工具参数\"></a>工具参数</h1><p>ab 有许多配置参数，就不一一列出，可以通过help指令或者参考资料了解，说一个常用的参数</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- n 总共需要发出的请求数</span><br><span class=\"line\">- c 发送请求使用的并发数（简单理解为客户端数量）</span><br><span class=\"line\">- t 等待服务器的最大响应时间（过期不候）</span><br><span class=\"line\">- k 使用HTTP的keep-alive特性 (这个需要服务器的支持)</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://blog.sina.com.cn/s/blog_564fc50a0100n7r6.html\" target=\"_blank\" rel=\"noopener\">keep-alive特性</a></p>\n<h1 id=\"结果分析\"><a href=\"#结果分析\" class=\"headerlink\" title=\"结果分析\"></a>结果分析</h1><p>贴出一些使用ab压力测试的结果:</p>\n<ul>\n<li><a href=\"https://github.com/matyhtf/swoole/blob/master/wiki/bench.md\" target=\"_blank\" rel=\"noopener\">压测nginx swoole node.js golang的http server</a></li>\n<li><a href=\"http://snoopyxdy.blog.163.com/blog/static/6011744020117315192204/\" target=\"_blank\" rel=\"noopener\">多核单服务器各种配置和业务压力下的node.js性能测试  </a></li>\n</ul>\n<p>测试结果中有很多有用的信息，我们一般比较关注两个指标：<br>Request per second 每秒处理请求数（服务器负载能力的有力体现）<br>Time per request 每个请求的响应时间 （注意这里有两个值）<br>由于对于并发请求，cpu实际上并不是同时处理的，而是按照每个请求获得的时间片逐个轮转处理的，所以基本上第一个Time per request时间约等于第二个Time per request时间乘以并发请求数</p>\n<h1 id=\"小试验\"><a href=\"#小试验\" class=\"headerlink\" title=\"小试验\"></a>小试验</h1><ul>\n<li>基准测试</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ab -c 1000 -n 1000 http://localhost:8001/</span><br><span class=\"line\">ab -c 1000 -n 1000 http://localhost/index.html</span><br><span class=\"line\">ab -c 1000 -n 1000 http://localhost/index.php</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://nodejs.org/\" target=\"_blank\" rel=\"noopener\">nodejs官网</a> hello world: RPS 2000左右(实验次数越多，效率急剧下降)<br>ngnix 默认配置加载静态文件：RPS 10000左右<br>ngnix 默认配置加载php文件：RPS 5000左右<br>ngnix 反向代理nodejs: RPS 7000左右<br>ngnix 反向代理加负载均衡2个nodejs进程: RPS 8000左右</p>\n<ul>\n<li>减小并发数</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ab -c 100 -n 1000 http://localhost:8001/</span><br><span class=\"line\">ab -c 100 -n 1000 http://localhost/index.html</span><br><span class=\"line\">ab -c 100 -n 1000 http://localhost/index.php</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://nodejs.org/\" target=\"_blank\" rel=\"noopener\">nodejs官网</a> hello world: RPS 4000左右<br>ngnix 默认配置加载静态文件：RPS 10000左右 (添加-k选项可以达到16000)<br>ngnix 默认配置加载php文件：RPS 500左右<br>ngnix 反向代理nodejs: RPS 3000左右<br>ngnix 反向代理加负载均衡2个nodejs进程: RPS 2700左右</p>\n<ul>\n<li>增加请求量</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ab -c 1000 -n 2000 http://localhost:8001/</span><br><span class=\"line\">ab -c 1000 -n 2000 http://localhost/index.html</span><br><span class=\"line\">ab -c 1000 -n 2000 http://localhost/index.php</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://nodejs.org/\" target=\"_blank\" rel=\"noopener\">nodejs官网</a> hello world: RPS 2000左右(实验次数越多，效率急剧下降)<br>ngnix 默认配置加载静态文件：RPS  8000左右(添加-k选项可以达到12000)<br>ngnix 默认配置加载php文件：Connection reset<br>ngnix 反向代理nodejs: RPS 2000左右<br>ngnix 反向代理加负载均衡2个nodejs进程: RPS 4000左右（但是不是很稳定）</p>\n<ul>\n<li>结论</li>\n</ul>\n<ol>\n<li>nodejs 处理高并发请求效率较差，并发数越多稳定性越不好</li>\n<li>nginx适合作为静态文件服务器，设置keep-alive header可以有效提升服务性能</li>\n<li>nginx使用负载均衡和反向代理可以有效提高nodejs处理并发的能力</li>\n<li>nodejs 处理低并发的大量请求效率还是很不错的，适合作为rest API</li>\n<li>简单使用php+nginx效率处理大量低并发请求明显小于nodejs, 大并发时效果出奇地好（有点疑问<img src=\"http://mat1.gtimg.com/www/mb/images/face/32.gif\" alt=\"疑问\">）<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1></li>\n</ol>\n<p><a href=\"http://www.nginx.cn/110.html\" target=\"_blank\" rel=\"noopener\">使用ab对nginx进行压力测试</a><br><a href=\"http://leepiao.blog.163.com/blog/static/485031302010234352282/\" target=\"_blank\" rel=\"noopener\">Apache ab 压力测试</a></p>\n","categories":[],"tags":["blog","pefermance"]},{"title":"Linux 工具链安装","url":"https://vincenthou.github.io/2014/04/03/Linux-工具链安装/","content":"<p>最近换用ubuntu的系统，很多工具要安装，挺繁琐的，在这里记录下来</p>\n<h1 id=\"LNMP-Setup\"><a href=\"#LNMP-Setup\" class=\"headerlink\" title=\"LNMP Setup\"></a>LNMP Setup</h1><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n<h2 id=\"Nginx\"><a href=\"#Nginx\" class=\"headerlink\" title=\"Nginx\"></a>Nginx</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get intsall nginx</span><br></pre></td></tr></table></figure>\n<ul>\n<li>所有的配置文件都在/etc/nginx下,并且每个虚拟主机已经安排在了/etc/nginx/sites-available下</li>\n<li>程序文件在/usr/sbin/nginx * 日志放在了/var/log/nginx中</li>\n<li>在/etc/init.d/下创建了启动脚本nginx</li>\n<li>默认的虚拟主机的目录设置在了/var/www/nginx-default</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /etc/init.d/nginx start </span><br><span class=\"line\">    or</span><br><span class=\"line\">service nginx start</span><br><span class=\"line\"></span><br><span class=\"line\">sudo killall apache2</span><br></pre></td></tr></table></figure>\n<h2 id=\"PHP\"><a href=\"#PHP\" class=\"headerlink\" title=\"PHP\"></a>PHP</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install php5 php5-cgi php5-mysql php5-curl php5-gd php5-idn php-pear php5-imagick php5-imap php5-mcrypt php5-memcache php5-mhash php5-ming php5-pspell php5-recode php5-snmp php5-tidy php5-xmlrpc php5-sqlite php5-xsl</span><br></pre></td></tr></table></figure>\n<h3 id=\"spawn-fcgi\"><a href=\"#spawn-fcgi\" class=\"headerlink\" title=\"spawn-fcgi\"></a>spawn-fcgi</h3><p>为什么要安装spawn-fcgi呢,它用来控制php-cgi进程,以防止进程崩溃或是单进程的效率太低.<br>网上很多人都说要使用spawn-fcgi必须得安装lighttpd,实际上不必要,可以直接安装spawn-fcgi</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install spawn-fcgi</span><br></pre></td></tr></table></figure>\n<h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install mysql-server mysql-client</span><br><span class=\"line\">sudo /etc/init.d/mysql start</span><br></pre></td></tr></table></figure>\n<h2 id=\"Configuration\"><a href=\"#Configuration\" class=\"headerlink\" title=\"Configuration\"></a>Configuration</h2><ol>\n<li>配置根目录和绝对路径</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/nginx/sites-available/default</span><br></pre></td></tr></table></figure>\n<p>修改配置文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">   ...</span><br><span class=\"line\">root &#123;web_root&#125;</span><br><span class=\"line\">   ...</span><br><span class=\"line\">location ~ .php$ &#123;</span><br><span class=\"line\">    fastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">    fastcgi_index index.php;</span><br><span class=\"line\">    fastcgi_param SCRIPT_FILENAME /var/www/nginx-default<span class=\"variable\">$fastcgi_script_name</span>;(Optional)</span><br><span class=\"line\">    include /etc/nginx/fastcgi_params; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>去掉注释/etc/php5/cgi/php.ini中cgi.fix_pathinfo=1;这样php-cgi方能正常使用SCRIPT_FILENAME这个变量.</p>\n<ol start=\"2\">\n<li>启动fastcgi并且重新载入nginx配置</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /etc/init.d/nginx reload</span><br><span class=\"line\">sudo /usr/bin/spawn-fcgi -a 127.0.0.1 -p 9000 -C 5 -u www-data -g www-data -f /usr/bin/php5-cgi -P /var/run/fastcgi-php.pid</span><br></pre></td></tr></table></figure>\n<p>参数含义如下</p>\n<ul>\n<li>-f 指定调用FastCGI的进程的执行程序位置,根据系统上所装的PHP的情况具体设置</li>\n<li>-a 绑定到地址addr</li>\n<li>-p 绑定到端口port</li>\n<li>-s 绑定到unix socket的路径path</li>\n<li>-C 指定产生的FastCGI的进程数,默认为5(仅用于PHP)</li>\n<li>-P指定产生的进程的PID文件路径</li>\n<li>-u和-g FastCGI使用什么身份(-u 用户 -g 用户组)运行,Ubuntu下可以使用www-data,其他的根据情况配置,如nobody、apache等现在可以在web根目录下放个探针或php文件测试一下了</li>\n</ul>\n<p>设置开机启动</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/rc.local</span><br></pre></td></tr></table></figure>\n<p>添加一行   </p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/spawn-fcgi -a 127.0.0.1 -p 9000 -C 5 -u www-data -g www-data -f /usr/bin/php5-cgi -P /var/run/fastcgi-php.pid</span><br></pre></td></tr></table></figure>\n<h1 id=\"Sublime-Text\"><a href=\"#Sublime-Text\" class=\"headerlink\" title=\"Sublime Text\"></a>Sublime Text</h1><h2 id=\"Setup\"><a href=\"#Setup\" class=\"headerlink\" title=\"Setup\"></a>Setup</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:webupd8team/sublime-text-2  </span><br><span class=\"line\">sudo apt-get update </span><br><span class=\"line\">sudo apt-get install sublime-text (sublime-text-dev/sublime-text-2)</span><br></pre></td></tr></table></figure>\n<h2 id=\"Plugins\"><a href=\"#Plugins\" class=\"headerlink\" title=\"Plugins\"></a>Plugins</h2><h3 id=\"Package-Control\"><a href=\"#Package-Control\" class=\"headerlink\" title=\"Package Control\"></a>Package Control</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib2,os; pf=<span class=\"string\">'Package Control.sublime-package'</span>; ipp=sublime.installed_packages_path(); os.makedirs(ipp) <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> os.path.exists(ipp) <span class=\"keyword\">else</span> <span class=\"literal\">None</span>; urllib2.install_opener(urllib2.build_opener(urllib2.ProxyHandler())); open(os.path.join(ipp,pf),<span class=\"string\">'wb'</span>).write(urllib2.urlopen(<span class=\"string\">'http://sublime.wbond.net/'</span>+pf.replace(<span class=\"string\">' '</span>,<span class=\"string\">'%20'</span>)).read()); <span class=\"keyword\">print</span> <span class=\"string\">'Please restart Sublime Text to finish installation'</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>Emmet - CSS style HTML Coding <a href=\"https://github.com/emmetio/pyv8-binaries\" target=\"_blank\" rel=\"noopener\">Manually install pyv8</a></li>\n<li>Javascript Refactor - Refactor javascript code tool</li>\n<li>DocBlockr - Generate comment pattern based on your code</li>\n<li>MarkdownEditing - Visual editing markdown document</li>\n<li>Snippets - A lot of snippets for code block generation (AngularJS Jade LESS Sass SCSS CSS Grunt Gulp Mocha PHPUnit)</li>\n<li>Terminal - Open terminal in the sublime text project folders</li>\n<li>jsFormat - Format JS file</li>\n<li>CanIUse - Check the compability of CSS property</li>\n<li>Themes - Theme Brogrammer</li>\n</ul>\n","categories":[],"tags":["blog","linux"]},{"title":"前端性能优化","url":"https://vincenthou.github.io/2014/03/20/前端性能优化/","content":"<p>好久没有梳理知识了，最近在做一些前端性能优化的尝试，一些心得和知识记录下来。<br>网站性能优化从来都不是一个孤立的点，完善的优化一定是要前后端协同配合</p>\n<h1 id=\"经典Web优化14条准则：\"><a href=\"#经典Web优化14条准则：\" class=\"headerlink\" title=\"经典Web优化14条准则：\"></a>经典Web优化14条准则：</h1><p>1.减少HTTP请求数：合并文件，CSS Sprite(工具网站)</p>\n<ol start=\"2\">\n<li>使用CDN：DNS负载均衡将请求分发到近用户的cache服务器</li>\n<li>添加Expire/Cache-Control头（甚用）</li>\n<li>启用Gzip压缩：压缩85%</li>\n<li>CSS放在页面上端：浏览器只会在CSS全部加载完成后渲染</li>\n<li>Script放在页面最下面：减少可视内容加载时间，阻塞并行下载</li>\n<li>避免CSS表达式</li>\n<li>外部化CSS和JS文件</li>\n<li>减少DNS查询：一个页面包含域名数2-4个</li>\n<li>压缩JS和CSS文件</li>\n<li>减少重定向</li>\n<li>移除重复脚本，提高重用性</li>\n<li>配置实体标签ETags：标识资源有效性的标签，Spring Hibernate</li>\n<li>缓存AJAX请求：参考3，使用时间戳<h1 id=\"16ms优化\"><a href=\"#16ms优化\" class=\"headerlink\" title=\"16ms优化\"></a>16ms优化</h1></li>\n</ol>\n<ul>\n<li>You can’t optimize what you can not measure</li>\n<li>优化目标：脚本时间+渲染时间+绘制时间&lt;16ms（每帧）</li>\n<li>工具：Timeline, Profiles, UI Responsiveness, Profile, Traker(Dron blog)</li>\n<li>每帧最多发生两次DOM更新<h1 id=\"Google-1s完成终端首屏渲染：\"><a href=\"#Google-1s完成终端首屏渲染：\" class=\"headerlink\" title=\"Google 1s完成终端首屏渲染：\"></a>Google 1s完成终端首屏渲染：</h1></li>\n</ul>\n<ol>\n<li>服务器响应小于200ms</li>\n<li>尽量少的重定向</li>\n<li>尽量少的第一次请求数</li>\n<li>避免过多堵塞JS和CSS</li>\n<li>给浏览器留200ms渲染时间</li>\n<li>优化JS执行和渲染时间</li>\n<li>减少DNS Lookup</li>\n<li>并行请求</li>\n<li>压缩</li>\n<li>缓存</li>\n<li>按需加载</li>\n<li>模块化<h1 id=\"JS性能优化最佳实践\"><a href=\"#JS性能优化最佳实践\" class=\"headerlink\" title=\"JS性能优化最佳实践\"></a>JS性能优化最佳实践</h1></li>\n<li>使用DocumentFragment或者innerHTML进行大块元素注入</li>\n<li>高频执行事件的消抖：参考underscore的debounce</li>\n<li>使用Session Storage存静态内容或片段</li>\n<li>使用异步加载或者延迟加载依赖文件：RequireJS, curl</li>\n<li>使用array的join方法连接字符串：先将字符片段push到数组中，再join</li>\n<li>使用CSS3动画：transform: transform3d(0,0,0)强制硬件加速</li>\n<li>对于频繁更改或者大量的元素父元素添加事件代理</li>\n<li>使用Data URI代替图片src</li>\n<li>使用媒体查询加载指定大小的图片</li>\n<li>对于频繁查询的列表根据key值建立索引表，减少遍历</li>\n<li>控制DOM元素数量：使用before after伪元素，延迟加载和呈现内容，使用事件委托12. 将节点转化为字符串存储</li>\n<li>使用Web workers处理负责计算，保证UI渲染流畅性</li>\n<li>避免使用@import, 使用SASS将文件合并</li>\n<li>将多份媒体查询代码合并<h1 id=\"移动端良好体验的标准\"><a href=\"#移动端良好体验的标准\" class=\"headerlink\" title=\"移动端良好体验的标准\"></a>移动端良好体验的标准</h1></li>\n</ol>\n<ul>\n<li>流畅：动画和滑动</li>\n<li>稳定：很少crash</li>\n<li>节能：省电</li>\n</ul>\n<p>渲染过程<br><img src=\"https://app.yinxiang.com/shard/s15/res/983b5eff-a042-4127-af1e-20823e9e6d56/IMG_20131118_102334.249.jpg?resizeSmall&amp;width=700\" alt=\"image\"></p>\n<h1 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h1><ul>\n<li><a href=\"http://www.webpagetest.org/\" target=\"_blank\" rel=\"noopener\">Webpagetest</a><h1 id=\"参考资料：\"><a href=\"#参考资料：\" class=\"headerlink\" title=\"参考资料：\"></a>参考资料：</h1></li>\n<li><a href=\"http://stevesouders.com/\" target=\"_blank\" rel=\"noopener\">stevesouders</a></li>\n<li><a href=\"http://www.bookofspeed.com/\" target=\"_blank\" rel=\"noopener\">bookofspeed</a></li>\n</ul>\n","categories":[],"tags":["blog","frontend","pefermance"]},{"title":"Jquery源码结构","url":"https://vincenthou.github.io/2014/01/03/Jquery源码结构/","content":"<p>基于<a href=\"http://code.jquery.com/jquery-2.0.3.js\" target=\"_blank\" rel=\"noopener\">版本2.0.3</a><br>使用闭包包裹实现代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> window, undefined </span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span></span><br><span class=\"line\">    <span class=\"comment\">// A central reference to the root jQuery(document)</span></span><br><span class=\"line\">    rootjQuery,</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"keyword\">typeof</span> <span class=\"built_in\">module</span> === <span class=\"string\">\"object\"</span> &amp;&amp; <span class=\"built_in\">module</span> &amp;&amp; <span class=\"keyword\">typeof</span> <span class=\"built_in\">module</span>.exports === <span class=\"string\">\"object\"</span> ) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">module</span>.exports = jQuery;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"keyword\">typeof</span> define === <span class=\"string\">\"function\"</span> &amp;&amp; define.amd ) &#123;</span><br><span class=\"line\">        define( <span class=\"string\">\"jquery\"</span>, [], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; <span class=\"keyword\">return</span> jQuery; &#125; );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span> === <span class=\"string\">\"object\"</span> &amp;&amp; <span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span>.document === <span class=\"string\">\"object\"</span> ) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.jQuery = <span class=\"built_in\">window</span>.$ = jQuery;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;)( <span class=\"built_in\">window</span> );</span><br></pre></td></tr></table></figure>\n<ul>\n<li>21-94            定义一些变量和函数，包括Jquery生成对象的工厂方法</li>\n<li>96-283          定义Jquery的静态方法</li>\n<li>285-347        定义Jquery的扩展方法extend</li>\n<li>349-817        使用extend扩展一些工具方法</li>\n<li>877-2856       Sizzle选择器</li>\n<li>2879-3042     Callbacks对回调函数的统一管理</li>\n<li>3043-3183     Deferred对异步（延迟）操作的统一管理</li>\n<li>3184-3295     support浏览器功能检测</li>\n<li>3308-3652     data() 数据缓存</li>\n<li>3653-3797     queue 队列管理</li>\n<li>3803-4299     attr(), prop(), addClass()等对于元素属性的操作</li>\n<li>4300-5128     事件操作的相关方法on(), trigger()等</li>\n<li>5140-6057     DOM操作：添加，删除，获取，包装，DOM筛选</li>\n<li>6059-6620     css()方法：样式的操作</li>\n<li>6621-7854     ajax()和提交的数据</li>\n<li>7855-8584     animation 动画相关</li>\n<li>8585-8792     位置和尺寸的方法</li>\n<li>8804-8821     兼容CommonJS和AMD规范，支持模块化</li>\n<li>8826             暴露Jquery对象</li>\n</ul>\n<p><a href=\"http://www.zhangxinxu.com/wordpress/2013/07/jquery-%E5%8E%9F%E7%90%86-%E6%9C%BA%E5%88%B6/\" target=\"_blank\" rel=\"noopener\">jQuery诞生记-原理与机制</a></p>\n","categories":[],"tags":["blog","frontend","javascript"]},{"title":"在Yii框架中使用PHP resque","url":"https://vincenthou.github.io/2013/12/22/在Yii框架中使用PHP-resque/","content":"<p>总体上来说PHP resque做的事情很简单，就是创建后台任务队列，让守护进程去“消费”执行它们，PHP resque为我们做了很多实现的工作，只需要简单的配置，编写我们需要执行的任务代码就可以了。<br><a href=\"https://github.com/blog/542-introducing-resque\" target=\"_blank\" rel=\"noopener\">Resque思想的介绍</a></p>\n<p>因为<a href=\"https://github.com/chrisboulton/php-resque\" target=\"_blank\" rel=\"noopener\">php-resque</a>使用了php的PCNTL函数，所以只能在Linux下运行，下面的安装和说明默认都是在Linux平台下的。<br><strong>Tip</strong>:</p>\n<ol>\n<li>安装的时候要保证clone下载php resque的文件夹是可写的，chmod一下</li>\n<li>修改demo中的resque.php文件，改为”require <strong>DIR</strong>.’/../bin/resque’”,必须加上当前文件的绝对路径，否则不好使，bin目录下方的文件是resque，没有php后缀名的，坑爹啊</li>\n<li>xdebug启用: display_errors=On</li>\n<li>为composer工具设置别名，方便使用</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">alias</span> composer=<span class=\"string\">'/usr/local/bin/composer.phar'</span></span><br></pre></td></tr></table></figure>\n<p>简单实验一下，就有个感性的认识了，下面开始正式的工作。<br>补充：基于开源项目yii-resque开发的项目，添加了一些特性，修复原有代码中的一些bug（原作者好久不维护了，bug真心不少），和同事一起搞出来的<a href=\"http://git.oschina.net/VincentHou/yii-resque-ex\" target=\"_blank\" rel=\"noopener\">yii-resque-ex</a></p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p>安装和简单的Demo实验</p>\n<ul>\n<li><a href=\"http://avnpc.com/pages/run-background-task-by-php-resque\" target=\"_blank\" rel=\"noopener\">http://avnpc.com/pages/run-background-task-by-php-resque</a></li>\n<li><a href=\"http://www.zrwm.com/?p=4464\" target=\"_blank\" rel=\"noopener\">(http://www.zrwm.com/?p=4464)</a></li>\n</ul>\n<p>进一步的介绍</p>\n<ul>\n<li><a href=\"http://blog.hsatac.net/2012/01/php-resque-introduction/\" target=\"_blank\" rel=\"noopener\">http://blog.hsatac.net/2012/01/php-resque-introduction/</a></li>\n<li><a href=\"http://docs.dotcloud.com/tutorials/php/resque/\" target=\"_blank\" rel=\"noopener\">http://docs.dotcloud.com/tutorials/php/resque/</a></li>\n<li><a href=\"http://stackoverflow.com/questions/11814445/what-is-the-proper-way-to-setup-and-use-php-resque\" target=\"_blank\" rel=\"noopener\">Best practice</a></li>\n</ul>\n<p>php-resque的扩展：</p>\n<ul>\n<li><a href=\"http://blog.hsatac.net/2012/02/php-resque-auto-scale-workers/\" target=\"_blank\" rel=\"noopener\">自动根据Job的数量计算需要启动的Worker数</a></li>\n<li><a href=\"https://github.com/ebernhardson/php-resque-pool\" target=\"_blank\" rel=\"noopener\">PHP Resque Pool</a></li>\n</ul>\n<p>Web Monitor</p>\n<ul>\n<li><a href=\"http://resqueboard.kamisama.me/\" target=\"_blank\" rel=\"noopener\">ResqueBoard</a></li>\n<li><a href=\"https://github.com/defunkt/resque-web\" target=\"_blank\" rel=\"noopener\">Resque-web</a></li>\n</ul>\n<p>Bash Monitor</p>\n<ul>\n<li><a href=\"https://github.com/chrisboulton/php-resque/issues/32\" target=\"_blank\" rel=\"noopener\">Supervisord</a></li>\n<li><a href=\"http://www.54chen.com/_linux_/supervisord-manage-service.html\" target=\"_blank\" rel=\"noopener\">Supervisord 配置</a></li>\n</ul>\n","categories":[],"tags":["blog","php"]},{"title":"Javascript OOP","url":"https://vincenthou.github.io/2013/12/21/Javascript-OOP/","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>随着前端开发的复杂性不断提升，规模逐渐增大，OOP的价值就凸显出来了，在开发nodejs应用时这方面的知识更是必不可少的，这里总结一些自己的认识。</p>\n<h1 id=\"对象创建\"><a href=\"#对象创建\" class=\"headerlink\" title=\"对象创建\"></a>对象创建</h1><p>传统面向对象语言是通过类来实现的，类就像一个模板，你定义好模板的样子，就可以用这个模子压制(new)出来你想要的产品了。javascript是基于原型的，我理解就是依葫芦画瓢，所有对象是基于原型的拷贝（浅拷贝，只是复制值，对于引用类型会有操作同一份数据的问题）。这样的差别造就了javascript对象创建的特殊性。</p>\n<h2 id=\"单例对象\"><a href=\"#单例对象\" class=\"headerlink\" title=\"单例对象\"></a>单例对象</h2><p>最简单的对象创建方法莫过于使用对象字面量了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'vincent'</span>,</span><br><span class=\"line\">    gender: <span class=\"string\">'male'</span>,</span><br><span class=\"line\">    say: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hi'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样太暴露了，于是有了工厂方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createObj</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">return</span>  &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'vincent'</span>,</span><br><span class=\"line\">        gender: <span class=\"string\">'male'</span>,</span><br><span class=\"line\">        say: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hi'</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其实这样没有实现隐藏，返回的对象上的属性和方法是完全对外可以访问的，可以使用_name这样的写法来表明该属性是私有的，通过闭包可以有效解决这个问题，这也被称为稳妥的构造函数模式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createObj</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> name = <span class=\"string\">'vincent'</span>;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> gender = <span class=\"string\">'male'</span>;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> sayGender = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">           <span class=\"built_in\">console</span>.log(<span class=\"string\">'My gender is '</span> + gender);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;            </span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hi, I am'</span> + name);</span><br><span class=\"line\">            sayGender();</span><br><span class=\"line\">     &#125;;</span><br><span class=\"line\">     <span class=\"keyword\">return</span>  &#123;</span><br><span class=\"line\">        say: say</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h2><p>单纯使用构造函数和单纯基于原型都会有问题，最好的方式就是结合两者之所长，在构造函数中添加属性，在构造函数原型上添加多个实例共享的方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, gender</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.gender = gender;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype = &#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>: Person, //optional</span><br><span class=\"line\">    say: function() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'I am '</span> + <span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们还可以将原型对象的动态添加放在构造函数里面，这样就有了点后端定义类的感觉了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, gender</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.gender = gender;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"string\">'function'</span> === <span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span>.say) &#123;</span><br><span class=\"line\">        Person.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'I am '</span> + <span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>有时候我们需要扩展某个对象，但是又不希望在原来对象的原型上添加，就可以这样来做了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyDate</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">    date.now = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getTime();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> date;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> MyDate();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(date.now());</span><br></pre></td></tr></table></figure>\n<p>这种方式有点像是一个工厂方法，我们自定义的方法在每个工厂产生的实例上添加，因为有返回值，使用MyDate的时候new关键字是可选的</p>\n<h1 id=\"对象继承\"><a href=\"#对象继承\" class=\"headerlink\" title=\"对象继承\"></a>对象继承</h1><h2 id=\"原型链继承\"><a href=\"#原型链继承\" class=\"headerlink\" title=\"原型链继承\"></a>原型链继承</h2><p>javascript本身没有继承的直接支持，要想实现面向对象思想中继承的特性，就需要些额外的工作了。由于每个对象都会有一个<strong>proto</strong>属性指向自己的原型，而原型链的特性又和作用域链的特性类似（当前scope找不到就向上查找），我们可以通过原型链来模拟简单继承</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Super</span>(<span class=\"params\">prop</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.prop = prop;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Super.prototype.superFn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Sub</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\">Sub.prototype = <span class=\"keyword\">new</span> Super();</span><br></pre></td></tr></table></figure>\n<h2 id=\"借用构造方法\"><a href=\"#借用构造方法\" class=\"headerlink\" title=\"借用构造方法\"></a>借用构造方法</h2><p>这样子类实例就会通过原型链查找访问到父类的所有属性和方法，看起来不错，但是原型浅拷贝带来的问题，这样的方法还有待改进。要想实现子类的深拷贝，调用一下父类的构造方法就好了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Super</span>(<span class=\"params\">prop</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.prop = prop;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Super.prototype.superFn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Sub</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    Super.call(<span class=\"keyword\">this</span>, <span class=\"string\">'hi'</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"组合继承\"><a href=\"#组合继承\" class=\"headerlink\" title=\"组合继承\"></a>组合继承</h2><p>这样属性倒是深拷贝了，同时也可以很方便控制给父类构造函数传递什么样的参数，但是父类的方法就用不了了，组合的方式是一个不错的解决方案</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Super</span>(<span class=\"params\">prop</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.prop = prop;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Super.prototype.superFn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Sub</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    Super.call(<span class=\"keyword\">this</span>, <span class=\"string\">'hi'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Sub.prototype = <span class=\"keyword\">new</span> Super();</span><br></pre></td></tr></table></figure>\n<h2 id=\"寄生组合继承\"><a href=\"#寄生组合继承\" class=\"headerlink\" title=\"寄生组合继承\"></a>寄生组合继承</h2><p>同时照顾到了属性和方法，就像创建对象的构造函数模式一样。这样已经很不错了，不过我们进一步优化，还是能找到问题的。很明显这里Super构造函数被重复调用了两次，一个在子类原型复制时，一个在子类构造函数中。其实我们调用 Sub.prototype = new Super() 的意义在于创建子类关联父类的原型链，父类属性的添加可以通过调用 Super.call(this) 来实现，这就是我们的优化点</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Super</span>(<span class=\"params\">prop</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.prop = prop;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Super.prototype.superFn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Sub</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    Super.call(<span class=\"keyword\">this</span>, <span class=\"string\">'hi'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Sub.prototype = Super.prototype;</span><br><span class=\"line\">Sub.prototype.constructor = Sub; <span class=\"comment\">//保证构造函数检测正确</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> instance = <span class=\"keyword\">new</span> Sub();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(instance.constructor === Sub);</span><br></pre></td></tr></table></figure>\n<h1 id=\"对象mixin\"><a href=\"#对象mixin\" class=\"headerlink\" title=\"对象mixin\"></a>对象mixin</h1><p>以上继承的实现只能实现单继承，如果我们希望动态的多个属性就需要借用mixin的概念，使用过ruby的开发对这个概念不会感到陌生，mixin比纯粹的继承组织模式要灵活很多，下面是一个简单的实现</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.extend = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">dest, src</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (prop <span class=\"keyword\">in</span> src) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (src.hasOwnProperty(prop)) &#123;</span><br><span class=\"line\">              dest[prop] = src[prop];</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> dest;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/jquery/jquery/blob/master/src/core.js#L124\" target=\"_blank\" rel=\"noopener\">jquery的实现</a>，当然jquery为了实现插件的机制，做了一些额外的事情</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://coolshell.cn/articles/6441.html\" target=\"_blank\" rel=\"noopener\">Javascript 面向对象编程</a></li>\n<li><a href=\"http://www.cnblogs.com/TomXu/archive/2012/02/03/2330295.html\" target=\"_blank\" rel=\"noopener\">面向对象编程之概论</a></li>\n<li><a href=\"http://www.cnblogs.com/TomXu/archive/2012/02/06/2330609.html\" target=\"_blank\" rel=\"noopener\">面向对象编程之ECMAScript实现（推荐）</a></li>\n<li><a href=\"http://www.cnblogs.com/JChen666/p/3375894.html\" target=\"_blank\" rel=\"noopener\">不会JS中的OOP，你也太菜了吧</a></li>\n<li><a href=\"https://github.com/jquery/jquery/blob/master/src/core.js\" target=\"_blank\" rel=\"noopener\">Jquery core</a></li>\n</ul>\n","categories":[],"tags":["blog","frontend","javascript"]},{"title":"Video Collections","url":"https://vincenthou.github.io/2013/12/21/Video-Collections/","content":"<p><a href=\"http://i.youku.com/u/UOTA5NjUyNDQ=\" target=\"_blank\" rel=\"noopener\">一些前端技术视频</a><br><a href=\"http://v.youku.com/v_show/id_XMTU3NTM1MjU2.html?f=4262628\" target=\"_blank\" rel=\"noopener\">前端架构</a><br><a href=\"http://study.163.com/plan/planIntroduction.htm?id=425569&amp;6925ecaa9614a750=note_open&amp;9e3293b42e2dee26=hnkfhjj@126.com#/planDetail\" target=\"_blank\" rel=\"noopener\">设计师的自我修炼</a><br><a href=\"http://study.163.com/find.htm#/find/search?p=illustrator\" target=\"_blank\" rel=\"noopener\">Illustrator</a><br><a href=\"http://study.163.com/find.htm#/find/search?p=Photoshop\" target=\"_blank\" rel=\"noopener\">Photoshop</a><br><a href=\"http://study.163.com/find.htm#/find/search?p=after%20effects\" target=\"_blank\" rel=\"noopener\">After Effects</a></p>\n","categories":[],"tags":["collection"]},{"title":"Good Frameworks","url":"https://vincenthou.github.io/2013/12/21/Good-Frameworks/","content":"<h1 id=\"Realtime\"><a href=\"#Realtime\" class=\"headerlink\" title=\"Realtime\"></a>Realtime</h1><ul>\n<li><a href=\"https://www.meteor.com/main\" target=\"_blank\" rel=\"noopener\">Meteor</a>  realtime JS framework (front and end)</li>\n<li><a href=\"https://github.com/brandnewera/clouda\" target=\"_blank\" rel=\"noopener\">Clouda</a>  Baidu JS framework (front and end)</li>\n<li><a href=\"http://blog.csdn.net/justfrozen/article/details/12716669\" target=\"_blank\" rel=\"noopener\">实时框架对比</a><h1 id=\"Canvas\"><a href=\"#Canvas\" class=\"headerlink\" title=\"Canvas\"></a>Canvas</h1></li>\n<li><a href=\"http://calebevans.me/projects/jcanvas/\" target=\"_blank\" rel=\"noopener\">Jcanvas</a></li>\n<li><a href=\"http://kineticjs.com/\" target=\"_blank\" rel=\"noopener\">Kineticjs</a></li>\n<li><a href=\"http://www.createjs.com/#!/EaselJS\" target=\"_blank\" rel=\"noopener\">EaselJS</a><h1 id=\"SVG\"><a href=\"#SVG\" class=\"headerlink\" title=\"SVG\"></a>SVG</h1></li>\n<li><a href=\"http://www.zhangxinxu.com/wordpress/2014/01/snap-svg-study-demo-docs/\" target=\"_blank\" rel=\"noopener\">Snap.svg</a></li>\n<li><a href=\"http://bonsaijs.org/\" target=\"_blank\" rel=\"noopener\">Bonsaijs</a></li>\n<li><a href=\"http://raphaeljs.com/\" target=\"_blank\" rel=\"noopener\">Raphaeljs</a></li>\n<li><a href=\"http://www.svgjs.com/\" target=\"_blank\" rel=\"noopener\">SVGJS</a><h1 id=\"WebGL\"><a href=\"#WebGL\" class=\"headerlink\" title=\"WebGL\"></a>WebGL</h1></li>\n<li><a href=\"http://scenejs.org/\" target=\"_blank\" rel=\"noopener\">Scenejs</a></li>\n<li><a href=\"http://threejs.org/\" target=\"_blank\" rel=\"noopener\">Threejs</a><h1 id=\"Others\"><a href=\"#Others\" class=\"headerlink\" title=\"Others\"></a>Others</h1></li>\n<li><a href=\"http://developer.51cto.com/art/201111/301460.htm\" target=\"_blank\" rel=\"noopener\">10个HTML5/CSS3框架</a><h1 id=\"Ruby\"><a href=\"#Ruby\" class=\"headerlink\" title=\"Ruby\"></a>Ruby</h1></li>\n<li><a href=\"http://www.sinatrarb.com/intro\" target=\"_blank\" rel=\"noopener\">Sinatra</a> light weight MVC web framework<h1 id=\"Open-Source-Platform\"><a href=\"#Open-Source-Platform\" class=\"headerlink\" title=\"Open Source Platform\"></a>Open Source Platform</h1></li>\n<li><a href=\"http://oss.baidu.com/\" target=\"_blank\" rel=\"noopener\">百度开源平台</a></li>\n<li><a href=\"https://github.com/alibaba\" target=\"_blank\" rel=\"noopener\">阿里开源项目</a></li>\n<li><a href=\"http://tencentopen.github.io/\" target=\"_blank\" rel=\"noopener\">腾讯开源项目</a></li>\n</ul>\n","categories":[],"tags":["collection"]},{"title":"javascript 编码规范","url":"https://vincenthou.github.io/2013/12/16/javascript-编码规范/","content":"<h1 id=\"Javascript编码规范\"><a href=\"#Javascript编码规范\" class=\"headerlink\" title=\"Javascript编码规范\"></a>Javascript编码规范</h1><h2 id=\"文件组织\"><a href=\"#文件组织\" class=\"headerlink\" title=\"文件组织\"></a>文件组织</h2><ul>\n<li>所有的javascript文件都要放在项目公共的’’’script’’’文件夹下</li>\n<li>使用的第三方库文件放置在’’’script/lib’’’文件夹下</li>\n<li>可以复用的自定义模块放置在’’’script/commons’’’夹下,复用模块如果涉及多个子文件，需要单独建立模块文件夹</li>\n<li>单独页面模块使用的javascript文件放置在’’’script/{module_name}’’’文件夹下</li>\n<li>项目模拟的json数据放置在’’’script/json’’’文件夹下，按照页面单独建立子文件夹</li>\n<li>javascript应用MVC框架时，使用的模板文件放置在’’’script/templates’’’文件夹下，按照页面单独建立子文件夹<h2 id=\"格式化\"><a href=\"#格式化\" class=\"headerlink\" title=\"格式化\"></a>格式化</h2></li>\n<li>通用原则可以参考[PhpGuideline PHP编码规范]</li>\n<li>始终使用var定义变量</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> global = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">method</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> local = <span class=\"string\">''</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>始终使用分号结束一行声明语句</li>\n<li>对于数组和对象不要使用多余的”,”（兼容IE）</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//wrong</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,];</span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'name'</span>,</span><br><span class=\"line\">    age: <span class=\"number\">20</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">//wrong</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'name'</span>,</span><br><span class=\"line\">    age: <span class=\"number\">20</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>定义顶级命名空间如inBike,在顶级命名空间下自定义私有命名空间，根据模块分级</li>\n<li>所有的模块代码放在匿名自调用函数中，通过给window对象下的自定义命名空间赋值暴露出来</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"built_in\">window</span>.inBike) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.inBike = &#123;&#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.inBike.rideway = rideway;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>绑定事件代码需要放置在dom ready函数中执行</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"comment\">//bind function is in the init function</span></span><br><span class=\"line\">     <span class=\"built_in\">window</span>.inBike.rideway.init();</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<ul>\n<li>将自定义模块方法放置在对象中，方法名紧挨“:”，“:”与function之间空一格，function()与后面的“{”之间空一格</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    method: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用单引号包裹字符串</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">'some text'</span>;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>所用的变量使用之前需要定义，定义之后立即初始化</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> num = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\"><span class=\"keyword\">var</span> isEmpty = <span class=\"literal\">true</span>;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用浏览器console工具之前先要判断是否支持</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"built_in\">console</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'this is my log'</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"命名\"><a href=\"#命名\" class=\"headerlink\" title=\"命名\"></a>命名</h2><ul>\n<li>通用原则可以参考[PhpGuideline PHP编码规范]</li>\n<li>使用驼峰法命名变量和方法名，首字母使用小写,对于类名首字母大写</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> numberList = [<span class=\"number\">1</span>,<span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> util = &#123;</span><br><span class=\"line\">    removeNode: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        ....</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用$name命名jquery对象，原生dom元素使用dom开头,对象中私有变量以下划线开头</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> $image = $(<span class=\"string\">'#cover'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> domImage = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'cover'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    _privateVar: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    method: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h2><ul>\n<li>通用原则可以参考[PhpGuideline PHP编码规范]</li>\n<li>多使用单行注释表明逻辑块的意义</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Handle the case where IE and Opera return items</span></span><br><span class=\"line\"><span class=\"comment\">// by name instead of ID</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( elem.id !== match[<span class=\"number\">2</span>] ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> rootjQuery.find( selector );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Otherwise, we inject the element directly into the jQuery object</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.length = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">this</span>[<span class=\"number\">0</span>] = elem;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>指明类的构造方法</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@constructor</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">some.long.namespace.MyClass = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>标注枚举常量的类型和意义</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/** <span class=\"doctag\">@enum <span class=\"type\">&#123;string&#125;</span> </span>*/</span></span><br><span class=\"line\">some.long.namespace.Fruit = &#123;</span><br><span class=\"line\">  APPLE: <span class=\"string\">'a'</span>,</span><br><span class=\"line\">  BANANA: <span class=\"string\">'b'</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用注释标识方法或者变量的可见性，方便静态检查</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/** <span class=\"doctag\">@protected </span>*/</span></span><br><span class=\"line\">AA_PublicClass.staticProtectedProp = <span class=\"number\">31</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/** <span class=\"doctag\">@private </span>*/</span></span><br><span class=\"line\">AA_PublicClass.prototype.privateMethod_ = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"最佳实践\"><a href=\"#最佳实践\" class=\"headerlink\" title=\"最佳实践\"></a>最佳实践</h2><ul>\n<li>避免使用eval</li>\n<li>对于对象避免使用with，对于数组避免使用for-in</li>\n<li>谨慎使用闭包，避免循环引用</li>\n<li>警惕this所处的上下文</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> $button = $(<span class=\"string\">'#my-button'</span>);</span><br><span class=\"line\">$button.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> util = &#123;</span><br><span class=\"line\">       getVal: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> self.val();</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>尽量使用短码，比如三目运算符，逻辑开关，自增运算等</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = (<span class=\"string\">'undefined'</span> == <span class=\"keyword\">typeof</span>(name)) ? <span class=\"string\">''</span> : name;</span><br><span class=\"line\">(age &lt; <span class=\"number\">0</span>) &amp;&amp; (age = <span class=\"number\">0</span>);</span><br><span class=\"line\">count++;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>不要在块级作用域中使用function</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//wrong</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (x) &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//right</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (x) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> foo = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在父节点上绑定事件监听，根据事件源分别响应</li>\n<li><p>对于复杂的页面模块使用依赖管理库如<a href=\"http://seajs.org/\" target=\"_blank\" rel=\"noopener\">SeaJS</a>, <a href=\"http://requirejs.org/\" target=\"_blank\" rel=\"noopener\">RequireJS</a>, MVC框架<a href=\"http://backbonejs.org/\" target=\"_blank\" rel=\"noopener\">Backbone</a>, <a href=\"http://knockoutjs.com/\" target=\"_blank\" rel=\"noopener\">Knockout</a>, <a href=\"http://hay.github.com/stapes/\" target=\"_blank\" rel=\"noopener\">Stapes</a>组织你的代码</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml\" target=\"_blank\" rel=\"noopener\">Google Javascript Coding Style</a><br><a href=\"http://javascript.crockford.com/code.html\" target=\"_blank\" rel=\"noopener\">Javascript Coding Conventions</a><br><a href=\"http://drupal.org/node/172169\" target=\"_blank\" rel=\"noopener\">Drupal JavaScript Coding Standards</a><br><a href=\"http://nodeguide.com/style.html\" target=\"_blank\" rel=\"noopener\">Node Coding Style</a></p>\n</li>\n</ul>\n","categories":[],"tags":["blog","frontend","javascript"]},{"title":"php 编码规范","url":"https://vincenthou.github.io/2013/12/16/php-编码规范/","content":"<h1 id=\"PHP编码规范\"><a href=\"#PHP编码规范\" class=\"headerlink\" title=\"PHP编码规范\"></a>PHP编码规范</h1><h2 id=\"基本原则\"><a href=\"#基本原则\" class=\"headerlink\" title=\"基本原则\"></a>基本原则</h2><ul>\n<li>简洁，清晰，一致[[BR]]</li>\n<li>健壮[[BR]]</li>\n<li>注意细节[[BR]]</li>\n<li>第一次将事情做好[[BR]]<h2 id=\"格式化\"><a href=\"#格式化\" class=\"headerlink\" title=\"格式化\"></a>格式化</h2></li>\n<li>使用UTF-8作为文件编码格式</li>\n<li>使用空格代替Tab</li>\n<li>运算符两端分别留一个空格</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//wrong</span></span><br><span class=\"line\">$foo=$bar;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//right</span></span><br><span class=\"line\">$foo = $bar;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用空行分隔逻辑代码块</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//get request parameters</span></span><br><span class=\"line\">$keyword =  Yii::app()-&gt;request-&gt;getQuery(<span class=\"string\">'keyword'</span>);</span><br><span class=\"line\">$pageSize =  Yii::app()-&gt;request-&gt;getQuery(<span class=\"string\">'pageSize'</span>);</span><br><span class=\"line\">Yii::log(<span class=\"string\">'request: keyword-&gt;'</span> . $keyword . <span class=\"string\">' pageSize-&gt;'</span> . $pageSize, <span class=\"string\">'debug'</span>, <span class=\"string\">'system.trip.getSystemTags'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//get data from backend</span></span><br><span class=\"line\">$curl = <span class=\"keyword\">new</span> Curl();</span><br><span class=\"line\">$result = $curl-&gt;get(<span class=\"string\">'/tag/list'</span>, <span class=\"keyword\">array</span>(<span class=\"string\">'keyword'</span>=&gt;urlencode($keyword), <span class=\"string\">'pageSize'</span>=&gt;$pageSize));</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $result;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>逻辑代码块哪怕只有一行也要用{}包裹起来，关键字与条件的左括号之间要空一格</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> (...)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    bar();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>switch语句的每一个case都要以break结束，并且有一个default的声明（同样以break结束）</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">switch</span> (condition)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        action1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        action A...;</span><br><span class=\"line\">        action B...;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">default</span> action;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>流程控制的不同部分，新行要以关键字开始而不是“{”</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//wrong</span></span><br><span class=\"line\"><span class=\"keyword\">try</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (<span class=\"keyword\">Exception</span> $e)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//right</span></span><br><span class=\"line\"><span class=\"keyword\">try</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">catch</span> (<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>函数名与参数列表之间不留空格，不同的参数在“,”之后留一个空格（同样适用于数组）</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//wrong</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update_records</span> <span class=\"params\">($table,$parameters,$conditions)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//right</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update_records</span><span class=\"params\">($table, $parameters, $conditions)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//wrong</span></span><br><span class=\"line\">$some_array = <span class=\"keyword\">array</span> (<span class=\"string\">'hello'</span>,<span class=\"string\">'world'</span>,<span class=\"string\">'foo'</span>=&gt;<span class=\"string\">'bar'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//right</span></span><br><span class=\"line\">$some_array = <span class=\"keyword\">array</span>(<span class=\"string\">'hello'</span>, <span class=\"string\">'world'</span>, <span class=\"string\">'foo'</span> =&gt; <span class=\"string\">'bar'</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>不依赖默认的操作符优先级，使用()明确表示出运算的优先级</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//wrong</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>($row[<span class=\"string\">\"col_a\"</span>] == <span class=\"number\">3</span> &amp;&amp; $row[<span class=\"string\">\"col_b\"</span>] == <span class=\"number\">1</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//right</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>((<span class=\"number\">3</span> == $row[<span class=\"string\">'col_a'</span>]) &amp;&amp; (<span class=\"number\">1</span> == $row[<span class=\"string\">'col_b'</span>]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>普通字符串使用单引号包裹，避免使用双引号</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//wrong</span></span><br><span class=\"line\">$str = <span class=\"string\">\"Hello world\"</span>;</span><br><span class=\"line\">$jointStr = <span class=\"string\">\"Hello world $str\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//right</span></span><br><span class=\"line\">$str = <span class=\"string\">'Hello world'</span>;</span><br><span class=\"line\">$jointStr = <span class=\"string\">'Hello world'</span> . $str;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>类中的方法和变量的访问权限使用public、protected、private关键字显示标识</li>\n<li>进行类型转换时，使用括号将目标类型包裹起来，并与变量之间留一个空格</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(int) $mynumber</span><br></pre></td></tr></table></figure>\n<ul>\n<li>过长的控制条件，差分成若干变量，计算出变量结果后再进行逻辑组合判断</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Key is only valid if it matches the current user's ID, as otherwise other</span></span><br><span class=\"line\"><span class=\"comment\">// users could access any user's things.</span></span><br><span class=\"line\">$is_valid_user = (<span class=\"keyword\">isset</span>($key) &amp;&amp; !<span class=\"keyword\">empty</span>($user-&gt;uid) &amp;&amp; $key == $user-&gt;uid);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// IP must match the cache to prevent session spoofing.</span></span><br><span class=\"line\">$is_valid_cache = (<span class=\"keyword\">isset</span>($user-&gt;cache) ? $user-&gt;cache == ip_address() : <span class=\"keyword\">FALSE</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Alternatively, if the request query parameter is in the future, then it</span></span><br><span class=\"line\"><span class=\"comment\">// is always valid, because the galaxy will implode and collapse anyway.</span></span><br><span class=\"line\">$is_valid_query = $is_valid_cache || (<span class=\"keyword\">isset</span>($value) &amp;&amp; $value &gt;= time());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> ($is_valid_user || $is_valid_query)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"命名\"><a href=\"#命名\" class=\"headerlink\" title=\"命名\"></a>命名</h2><ul>\n<li>使用NULL初始化空字符串</li>\n<li><p>文件名和类名首字母大写，使用驼峰命名法 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**Example:** Circle, FilledCircled, ShadedFilledCircle</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>全局方法使用小写字母命名使用“_”分隔 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**Example:** is_valid(), get_script_name()</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>类方法使用驼峰命名法，动宾结构，首字母小写 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**Example:** draw(), drawLine(), getName()</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>普通变量和类成员变量使用驼峰命名法，首字母小写，私有成员以_开头 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**Example:** $currentTime，$_privateVal</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>常量全部使用大写字母命名，以“_”分隔 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**Example:** PI, MAX_BUFFER_SIZE</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h2><ul>\n<li>使用empty标识空执行</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> (condition)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">//empty!</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>文件开头书写注释标识作者、网站主页、版权信息</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * CBooleanValidator class file.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Qiang Xue &lt;qiang.xue<span class=\"doctag\">@gmail</span>.com&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@link</span> http://www.yiiframework.com/</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@copyright</span> Copyright &amp;copy; 2008-2011 Yii Software LLC</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@license</span> http://www.yiiframework.com/license/</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>类定义上方书写注释阐述类的应用场景、作者、版本号、所属的包名称</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * CDefaultValueValidator sets the attributes with the specified value.</span></span><br><span class=\"line\"><span class=\"comment\"> * It does not do validation. Its existence is mainly to allow</span></span><br><span class=\"line\"><span class=\"comment\"> * specifying attribute default values in a dynamic way.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Qiang Xue &lt;qiang.xue<span class=\"doctag\">@gmail</span>.com&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@version</span> 0.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@package</span> system.validators</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>类成员变量上方书写注释阐述变量的类型、意义、默认值等信息</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@var</span> boolean whether to set the default value only when the attribute value is null or empty string.</span></span><br><span class=\"line\"><span class=\"comment\"> * Defaults to true. If false, the attribute will always be assigned with the default value,</span></span><br><span class=\"line\"><span class=\"comment\"> * even if it is already explicitly assigned a value.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>定义方法上方书写注释阐述方法的用途，使用@param详述参数的信息（包括参数类型以及意义），使用@return详述返回值的信息，如果有异常抛出使用@throws注解</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Returns the JavaScript needed for performing client-side validation.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> CModel $object the data object being validated</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> string $attribute the name of the attribute to be validated.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> string the client-side validation script.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@see</span> CActiveForm::enableClientValidation</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.1.7</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>对于实现较为复杂的代码，以空行分隔逻辑块的同时，使用单行注释解释逻辑块的作用</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Put table and key name in variables for easier reading</span></span><br><span class=\"line\">$refTable=$fkEntry[<span class=\"number\">0</span>]; <span class=\"comment\">// Table name that current fk references to</span></span><br><span class=\"line\">$refKey=$fkEntry[<span class=\"number\">1</span>];   <span class=\"comment\">// Key in that table being referenced</span></span><br><span class=\"line\">$refClassName=<span class=\"keyword\">$this</span>-&gt;generateClassName($refTable);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Add relation for this table</span></span><br><span class=\"line\">$relationName=<span class=\"keyword\">$this</span>-&gt;generateRelationName($tableName, $fkName, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">$relations[$className][$relationName]=<span class=\"string\">\"array(self::BELONGS_TO, '$refClassName', '$fkName')\"</span>;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>对于尚未完成的工作使用单行注释 TODO 标注 <h2 id=\"最佳实践\"><a href=\"#最佳实践\" class=\"headerlink\" title=\"最佳实践\"></a>最佳实践</h2></li>\n<li>谨慎使用’echo’, ‘print’, ‘prin_r’和’die’,确保你真的需要它们</li>\n<li>避免使用魔法数，所用的常量使用const定义，所有字母大写以“_”分隔</li>\n<li>Controller中主要完成获取用户输入，从model层获取数据，选择页面渲染的工作<ul>\n<li>HTML和数据字段名不能写在其中，而应该写在view中</li>\n<li>SQL不能写在其中，而应该写在model中，提供方法给controller调用 </li>\n</ul>\n</li>\n<li>所有的controller不能直接继承CController，而是需要自定义一个controller来继承CController，所有其他添加的controller均继承该controller</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Controller is the customized base controller class.</span></span><br><span class=\"line\"><span class=\"comment\"> * All controller classes for this application should extend from this base class.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Controller</span> <span class=\"keyword\">extends</span> <span class=\"title\">CController</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string the default layout for the controller view. Defaults to '//layouts/column1',</span></span><br><span class=\"line\"><span class=\"comment\">     * meaning using a single column layout. See 'protected/views/layouts/column1.php'.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $layout=<span class=\"string\">'//layouts/main'</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array context menu items. This property will be assigned to &#123;<span class=\"doctag\">@link</span> CMenu::items&#125;.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $menu=<span class=\"keyword\">array</span>();</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array the breadcrumbs of the current page. The value of this property will</span></span><br><span class=\"line\"><span class=\"comment\">     * be assigned to &#123;<span class=\"doctag\">@link</span> CBreadcrumbs::links&#125;. Please refer to &#123;<span class=\"doctag\">@link</span> CBreadcrumbs::links&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * for more details on how to specify this property.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $breadcrumbs=<span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">beforeAction</span><span class=\"params\">($action)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>View中主要存放HTML代码，从controller获取数据进行渲染，包含尽量少的逻辑代码<ul>\n<li>收集用户输入（例如 $_GET 和 $_POST）不能写在其中，而应该写在controller中</li>\n<li>SQL不能写在其中，而应该写在model中，提供方法给controller调用<br>模板中的控制语句使用标识性语句而非括号</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//wrong</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($item)) &#123; <span class=\"meta\">?&gt;</span></span><br><span class=\"line\">  &lt;p&gt;<span class=\"meta\">&lt;?php</span> <span class=\"keyword\">print</span> $item; <span class=\"meta\">?&gt;</span>&lt;/p&gt;</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> &#125; <span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">foreach</span> ($items <span class=\"keyword\">as</span> $item) &#123; <span class=\"meta\">?&gt;</span></span><br><span class=\"line\">  &lt;p&gt;<span class=\"meta\">&lt;?php</span> <span class=\"keyword\">print</span> $item; <span class=\"meta\">?&gt;</span>&lt;/p&gt;</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> &#125; <span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//right</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($item)): <span class=\"meta\">?&gt;</span></span><br><span class=\"line\">  &lt;p&gt;<span class=\"meta\">&lt;?php</span> <span class=\"keyword\">print</span> $item; <span class=\"meta\">?&gt;</span>&lt;/p&gt;</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">endif</span>; <span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">foreach</span> ($items <span class=\"keyword\">as</span> $item): <span class=\"meta\">?&gt;</span></span><br><span class=\"line\">  &lt;p&gt;<span class=\"meta\">&lt;?php</span> <span class=\"keyword\">print</span> $item; <span class=\"meta\">?&gt;</span>&lt;/p&gt;</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">endforeach</span>; <span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>数据库表名和字段名使用小写字母，以_分隔多个单词，使用前缀名区分一个数据库下相同表名 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**Example:** product_order</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Model中主要负责对于数据库的访问，为controller提供数据接口</p>\n<ul>\n<li>HTML不应该写在其中，而应该写在view中 </li>\n</ul>\n</li>\n<li>对于简单重复数据库操作；使用AR进行查询，当涉及到多表关联，复杂操作或者性能敏感时使用SQL查询；如果只是进行查询操作，并且兼顾易用性和性能可以使用Query Builder</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//AR save</span></span><br><span class=\"line\">$post=<span class=\"keyword\">new</span> Post;</span><br><span class=\"line\">$post-&gt;title=<span class=\"string\">'sample post'</span>;</span><br><span class=\"line\">$post-&gt;content=<span class=\"string\">'post body content'</span>;</span><br><span class=\"line\">$post-&gt;save();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//SQL query</span></span><br><span class=\"line\">$sql=<span class=\"string\">\"SELECT username, email FROM tbl_user\"</span>;</span><br><span class=\"line\">$connection = Yii::app()-&gt;db;   <span class=\"comment\">// 假设你已经建立了一个 \"db\" 连接</span></span><br><span class=\"line\"><span class=\"comment\">// 如果没有，你可能需要显式建立一个连接：</span></span><br><span class=\"line\"><span class=\"comment\">// $connection =n ew CDbConnection($dsn,$username,$password);</span></span><br><span class=\"line\">$command = $connection-&gt;createCommand($sql);</span><br><span class=\"line\"><span class=\"comment\">// 如果需要，此 SQL 语句可通过如下方式修改：</span></span><br><span class=\"line\"><span class=\"comment\">// $command-&gt;text=$newSQL;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Query Builder</span></span><br><span class=\"line\">$user = Yii::app()-&gt;db-&gt;createCommand()</span><br><span class=\"line\">    -&gt;select(<span class=\"string\">'id, username, profile'</span>)</span><br><span class=\"line\">    -&gt;from(<span class=\"string\">'tbl_user u'</span>)</span><br><span class=\"line\">    -&gt;join(<span class=\"string\">'tbl_profile p'</span>, <span class=\"string\">'u.id=p.user_id'</span>)</span><br><span class=\"line\">    -&gt;where(<span class=\"string\">'id=:id'</span>, <span class=\"keyword\">array</span>(<span class=\"string\">':id'</span>=&gt;$id))</span><br><span class=\"line\">    -&gt;queryRow();</span><br></pre></td></tr></table></figure>\n<ul>\n<li>对于log信息分级，并且明确指定所属的分类名称。调试信息使用trace，产品级信息根据价值程度选择特定的级别，具体可参考[<a href=\"http://www.yiiframework.com/doc/guide/1.1/en/topics.logging\" target=\"_blank\" rel=\"noopener\">http://www.yiiframework.com/doc/guide/1.1/en/topics.logging</a> Logging Topic]</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Yii::log(<span class=\"string\">'request group list: '</span> .$groupList , <span class=\"string\">'trace'</span>, <span class=\"string\">'system.group.search'</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>对于可复用的页面组件或者较为复杂的页面成分，应该抽离出widget，拥有自己独立的view，具体可参考<ul>\n<li>[<a href=\"http://www.yiiframework.com/wiki/23/how-to-create-a-breadcrumb-widget\" target=\"_blank\" rel=\"noopener\">http://www.yiiframework.com/wiki/23/how-to-create-a-breadcrumb-widget</a> Simple Example]</li>\n<li>[<a href=\"http://www.yiiframework.com/doc/guide/1.1/en/basics.view#widget\" target=\"_blank\" rel=\"noopener\">http://www.yiiframework.com/doc/guide/1.1/en/basics.view#widget</a> Widget View]</li>\n</ul>\n</li>\n<li>抛出的异常要明确到某个特定的类型，所有抛出异常的部分使用catch分类捕获，根据具体情况能够处理的直接处理，不能处理的继续抛出</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"> ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">catch</span>(AppException $e)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ErrorHandler::handleDefaultError($e);</span><br><span class=\"line\">    <span class=\"keyword\">$this</span>-&gt;render(<span class=\"string\">'search'</span>, <span class=\"keyword\">array</span>(<span class=\"string\">'filterParams'</span>=&gt;$filterParams));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">catch</span>(SystemException $e)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ErrorHandler::handleDefaultError($e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>由于PHP暂时不支持finally，在异常被捕获之后，或者异常处理结束之后的控制流程中清理资源（例如数据库连接等）</li>\n<li>异常捕获后不能阻塞程序的正常执行，或者容错处理，或者跳转到错误页面</li>\n<li>对异常进行合理的分层，例如不要将SQLException放置到非数据处理层，而出现在业务逻辑层 <h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2></li>\n</ul>\n<p><a href=\"https://drupal.org/coding-standards#helpermod\" target=\"_blank\" rel=\"noopener\">Drupal Coding Standards</a><br><a href=\"http://www.yiiframework.com/wiki/102/code-style/\" target=\"_blank\" rel=\"noopener\">Yii Code Style</a><br><a href=\"http://vadimg.com/2009/07/yii-php-coding-standards-draft/\" target=\"_blank\" rel=\"noopener\">Yii Code Standard</a><br><a href=\"http://www.yiiframework.com/doc/guide/1.1/en/basics.convention\" target=\"_blank\" rel=\"noopener\">Yii Conventions</a><br><a href=\"http://framework.zend.com/manual/1.12/en/coding-standard.html\" target=\"_blank\" rel=\"noopener\">Zend Framework Coding Standards</a><br><a href=\"http://pear.php.net/manual/en/standards.php\" target=\"_blank\" rel=\"noopener\">PHP Coding Standards</a></p>\n","categories":[],"tags":["blog","php"]},{"title":"Css && Html 编码规范","url":"https://vincenthou.github.io/2013/12/16/Css-Html-编码规范/","content":"<h1 id=\"Css-amp-amp-Html-Code-GuideLine\"><a href=\"#Css-amp-amp-Html-Code-GuideLine\" class=\"headerlink\" title=\"Css &amp;&amp; Html Code GuideLine\"></a>Css &amp;&amp; Html Code GuideLine</h1><p><strong>基于以前项目的css书写不规范导致的浏览器兼容问题和多人协作混乱问题，特此制定Css &amp;&amp; Html Code GuideLine，所有参与项目css文件编写的成员请务必参看</strong></p>\n<p><strong>注解：</strong>此GuideLine基于douban和google网上公开的规范，并且加入了一些适用于多人协作的内容整理而成，项目整体css编码风格和思想借鉴了twitter’s bootstrap框架,适用但不局限于IN-BIKE项目</p>\n<ol>\n<li>项目必须有library,即静态示范页，里面包括了项目里所有可能用到的的html结构和css，library应与实际项目最终输出的html保持一致，并作为bug重现/修复参考，如有bug，先看library和当前项目有无冲突，再联系相关人员。</li>\n<li>Library负责人管理HTML结构搭建和基础CSS组建，当开发人员发现自己的页面/模块最终输出与Library不一致时，请与此负责人联系。</li>\n<li>全局CSS文件global.css、reset.css、username.css文件都位于css文件夹根目录，严禁另外创建文件夹存放css文件（防止目录混乱）</li>\n<li>如需使用插件，css文件请存放在lib/pluginname/css,与站点css分开放置</li>\n<li>global.css中包含的是整站的基础模块，由一人撰写和维护（library.html 和 global.css）,其他开发人员禁止修改这两个文件，建议通过svn权限进行控制</li>\n<li>所有参与写样式的开发人员都需要在css文件夹根目录中添加一个以自己英文名命名的css文件，并且联系global.css负责人将其Import进 global.css，<br>当涉及到global没有提供且与自己相关的页面/模块，就将CSS样式写在其中，但是要注意使用mod写法不要影响到他人的模块,如果是公有的，请联系负责人在global.css中添加(@import只是针对多人协作的临时方式，上线时会merge公共部分，其余会按需加载)；</li>\n<li>所有CSS样式至少兼容浏览器IE7+,Opera,firefox3.0+,Safir,Chrome，原则是渐进增强平稳退化，即标准浏览器实现完整交互和视觉效果，非标准浏览器至少保留基本功能</li>\n<li>使用html5 doctype (&lt;!DOCTYPE html&gt; <html lang=\"en\"> … </html>)</li>\n<li>reset.css文件使用yahoo YUI reset</li>\n<li>所有css命名均使用中划线</li>\n<li>css属性推荐使用一行式写法，便于查找，这也是google和douban推荐的写法（不习惯的同学也可以暂时选择多行式写法）</li>\n<li>全局不允许使用通配符 *；</li>\n<li>为防止兼容混乱，暂时不推荐使用css3的选择器，如子选择器&gt;,:firstchild,nth-child,last-child,属性选择器[type=”xxx”]等</li>\n<li>遵循模块化思想，模块命名遵循以下结构:</li>\n</ol>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.xxx-module</span> <span class=\"selector-class\">.ooo</span>&#123;<span class=\"attribute\">property</span>:value;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.bread-module</span>&#123;<span class=\"attribute\">property</span>:value;&#125;</span><br><span class=\"line\">.bread-module .hd&#123;&#125;//hd代表head</span><br><span class=\"line\"><span class=\"selector-class\">.bread-module</span> <span class=\"selector-class\">.hd</span> <span class=\"selector-class\">.operate</span>&#123;&#125;</span><br><span class=\"line\">.bread-module .bd&#123;&#125;//bd代表body</span><br><span class=\"line\">.bread-module .ft&#123;&#125;//ft代表foot</span><br></pre></td></tr></table></figure>\n<ol>\n<li>以下几个css属性慎用，经测试，会导致页面性能下降<br>position:fixed<br>background-position: fixed<br>border-radius<br>background-size<br>box-shadow<br>gradient</li>\n<li>每个模块前加注释，格式 /* modulename */</li>\n<li>清除浮动使用clearfix,避免使用多余标签</li>\n<li>严禁使用css表达式（css expression)</li>\n<li>因需求变动等各种原因导致的无用的css内容/文件请及时删除</li>\n<li>tips:<br>另外给出几个常用的css命名及解释</li>\n</ol>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.hd // header</span><br><span class=\"line\">.bd // body</span><br><span class=\"line\">.ft // foot</span><br><span class=\"line\">.operate // 用在编辑和操作</span><br><span class=\"line\">.pic //图片包裹</span><br><span class=\"line\">.info // 内容</span><br><span class=\"line\">.nav //导航</span><br><span class=\"line\">.active //激活项（用于选项卡，面包屑，其他高亮栏目）</span><br><span class=\"line\">.tab //选项卡</span><br></pre></td></tr></table></figure>\n<p>不允许如下样式出现</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.tips&#123;xxx:ooo;&#125; //错误示例,污染全局</span><br><span class=\"line\">*&#123;xxx:ooo;&#125;//错误示例，全局禁用通配符</span><br></pre></td></tr></table></figure>\n","categories":[],"tags":["blog","frontend"]},{"title":"前端包管理工具Bower","url":"https://vincenthou.github.io/2013/12/12/前端包管理工具Bower/","content":"<p><img src=\"http://bower.jsbin.cn/img/bower-logo.png\" alt=\"image\"><br><a href=\"http://bower.io/\" target=\"_blank\" rel=\"noopener\">Bower</a> 是 twitter 推出的一款包管理工具。我们平时开发过程中不可能所有的功能都是我们白手起家实现的，有一些功能已经有了成熟的解决方案，那就是拿来主义了。作为后端开发来讲，ruby有gem，nodejs有npm，python有pip，java有maven。我们在前端开发时需要一些常用的框架和工具库，例如jqeury,  jquery-ui, underscore,  backbone等等。想想每次我们需要添加这些库的时候是怎么做的吧。</p>\n<p>现在你不需要在四处寻找某个版本的文件，下载并且拷贝到本地了，只需要一条命令就可以搞定</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bower install jquery</span><br></pre></td></tr></table></figure>\n<h1 id=\"开始安装\"><a href=\"#开始安装\" class=\"headerlink\" title=\"开始安装\"></a>开始安装</h1><p>首先确保你已经安装了nodejs和npm包管理工具，最好你的机器上也安装了Git，有些bower以来的包需要通过她来下载安装，在bash中执行命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g bower</span><br></pre></td></tr></table></figure>\n<p>这样就OK了，详细的命令可以查看bower help</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Usage:</span><br><span class=\"line\"></span><br><span class=\"line\">    bower &lt;<span class=\"built_in\">command</span>&gt; [&lt;args&gt;] [&lt;options&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\">Commands:</span><br><span class=\"line\"></span><br><span class=\"line\">    cache                   Manage bower cache</span><br><span class=\"line\">    <span class=\"built_in\">help</span>                    Display <span class=\"built_in\">help</span> information about Bower</span><br><span class=\"line\">    home                    Opens a package homepage into your favorite browser</span><br><span class=\"line\">    info                    Info of a particular package</span><br><span class=\"line\">    init                    Interactively create a bower.json file</span><br><span class=\"line\">    install                 Install a package locally</span><br><span class=\"line\">    link                    Symlink a package folder</span><br><span class=\"line\">    list                    List <span class=\"built_in\">local</span> packages</span><br><span class=\"line\">    lookup                  Look up a package URL by name</span><br><span class=\"line\">    prune                   Removes <span class=\"built_in\">local</span> extraneous packages</span><br><span class=\"line\">    register                Register a package</span><br><span class=\"line\">    search                  Search <span class=\"keyword\">for</span> a package by name</span><br><span class=\"line\">    update                  Update a <span class=\"built_in\">local</span> package</span><br><span class=\"line\">    uninstall               Remove a <span class=\"built_in\">local</span> package</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\"></span><br><span class=\"line\">    -f, --force             Makes various commands more forceful</span><br><span class=\"line\">    -j, --json              Output consumable JSON</span><br><span class=\"line\">    -l, --<span class=\"built_in\">log</span>-level         What level of logs to report</span><br><span class=\"line\">    -o, --offline           Do not hit the network</span><br><span class=\"line\">    -q, --quiet             Only output important information</span><br><span class=\"line\">    -s, --silent            Do not output anything, besides errors</span><br><span class=\"line\">    -V, --verbose           Makes output more verbose</span><br><span class=\"line\">    --allow-root            Allows running commands as root</span><br><span class=\"line\"></span><br><span class=\"line\">See <span class=\"string\">'bower help &lt;command&gt;'</span> <span class=\"keyword\">for</span> more information on a specific <span class=\"built_in\">command</span>.</span><br></pre></td></tr></table></figure>\n<h1 id=\"开始使用\"><a href=\"#开始使用\" class=\"headerlink\" title=\"开始使用\"></a>开始使用</h1><p>打开bash，进入你的项目目录，执行命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bower install jquery</span><br></pre></td></tr></table></figure>\n<p>一个新的文件夹bower_components会被创建出来，你使用bower安装的所有包都会放在这个目录下面，<strong>一般不要直接修改这个目录下的文件</strong>。<br>Bower 在下载的时候会去 server 上找名字对应的 git 库，下载后切换到对应的版本，如果未指定则是最新的。<br>除了通过以上别名的方式，还可以指定github上的代码库，某个文件或者压缩包，本地的Git仓库来进行安装，你还可以指定安装的版本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bower install git://github.com/someone/some-package.git</span><br><span class=\"line\">bower install someone/some-package</span><br><span class=\"line\">bower install &lt;package&gt;<span class=\"comment\">#&lt;version&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>通过 bower list 可以看到本地安装的所有的包。</li>\n<li>如果想要搜索你需要的包何以使用 bower search 命令或者在<a href=\"http://sindresorhus.com/bower-components\" target=\"_blank\" rel=\"noopener\">这里</a>看看。</li>\n<li>另外每次你在线安装后bower都会产生缓存</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bower cache list</span><br></pre></td></tr></table></figure>\n<p>通过这查看缓存，你可以知道你曾经下载过哪些文件，你也可以通过缓存来安装包</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bower install &lt;package&gt; --offline</span><br></pre></td></tr></table></figure>\n","categories":[],"tags":["blog","frontend","build"]},{"title":"使用Grunt构建前端项目","url":"https://vincenthou.github.io/2013/12/11/使用Grunt构建前端项目/","content":"<p><img src=\"http://gruntjs.cn/img/grunt-logo.png\" alt=\"image\"><br>为了保证代码的质量和自动化一些重复的工作，构建工具是不必可少的。C/C++程序通过makefile管理编译测试打包的过程，Java程序通过Maven,Ant实现项目构建管理功能，Ruby有Rake，这些工具都是为后端语言设计的。</p>\n<p>之前如果需要一些简单的前端构建，可以<a href=\"http://book.36ria.com/ant/index.html\" target=\"_blank\" rel=\"noopener\">使用Ant</a>来实现一些基础的比如打包js/css、压缩文件、构建目录、重命名文件，但对于前端开发来说还不够完善。随着前端开发的复杂度逐渐提高，node.js的推广，基于javascript的构建工具应运而生，这就是Grunt。Grunt可以执行像压缩，合并，模糊化代码， 单元测试,，代码检查以及打包发布等等任务。</p>\n<h1 id=\"开始安装使用\"><a href=\"#开始安装使用\" class=\"headerlink\" title=\"开始安装使用\"></a>开始安装使用</h1><h2 id=\"1-安装CLI\"><a href=\"#1-安装CLI\" class=\"headerlink\" title=\"1. 安装CLI\"></a>1. 安装CLI</h2><p>安装CLI之前首先安装Nodejs和npm，安装成功之后</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g grunt-cli</span><br></pre></td></tr></table></figure>\n<p><strong>Tip:</strong>  CLI只是grunt的引导加载器，可以使多个版本的grunt并存</p>\n<h2 id=\"2-安装Grunt\"><a href=\"#2-安装Grunt\" class=\"headerlink\" title=\"2. 安装Grunt\"></a>2. 安装Grunt</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g grunt</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-在项目根目录添加npm项目配置文件\"><a href=\"#3-在项目根目录添加npm项目配置文件\" class=\"headerlink\" title=\"3. 在项目根目录添加npm项目配置文件\"></a>3. 在项目根目录添加npm项目配置文件</h2><p>“package.json” 是npm项目配置文件，使用命令行交互的方式创建pacakge.json文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init</span><br></pre></td></tr></table></figure>\n<p>命令行会提示输入配置信息，或者直接复制下面的内容到一个空的package.json文件中</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"my-project-name\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"0.1.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"devDependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"grunt\"</span>: <span class=\"string\">\"~0.4.2\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"grunt-contrib-jshint\"</span>: <span class=\"string\">\"~0.6.3\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"grunt-contrib-nodeunit\"</span>: <span class=\"string\">\"~0.2.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"grunt-contrib-uglify\"</span>: <span class=\"string\">\"~0.2.2\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>文件中的devDependencies选项需要通过安装才能真正生效，例如安装grunt</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install grunt --save-dev</span><br></pre></td></tr></table></figure>\n<p>–save-dev选项会将grunt配置信息添加到package.json文件中</p>\n<h2 id=\"4-在项目根目录添加grunt配置文件\"><a href=\"#4-在项目根目录添加grunt配置文件\" class=\"headerlink\" title=\"4. 在项目根目录添加grunt配置文件\"></a>4. 在项目根目录添加grunt配置文件</h2><p>“Gruntfile.js”是专门用来配置grunt的配置文件（还可以添加Gruntfile.coffee）<br>“Gruntfile.js”主要由以下几部分组成</p>\n<ul>\n<li>包装函数</li>\n<li>项目和任务的配置</li>\n<li>加载插件和任务</li>\n<li>自定义任务<br>下面一个gruntfile的例子使用uglify来压缩文件，并且添加固定格式的注释信息</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//包装函数</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">grunt</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 项目配置</span></span><br><span class=\"line\">  grunt.initConfig(&#123;</span><br><span class=\"line\">    <span class=\"comment\">//读取npm配置文件信息</span></span><br><span class=\"line\">    pkg: grunt.file.readJSON(<span class=\"string\">'package.json'</span>),</span><br><span class=\"line\">    uglify: &#123;</span><br><span class=\"line\">      options: &#123;</span><br><span class=\"line\">        banner: <span class=\"string\">'/*! &lt;%= pkg.name %&gt; &lt;%= grunt.template.today(\"yyyy-mm-dd\") %&gt; */\\n'</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      build: &#123;</span><br><span class=\"line\">        src: <span class=\"string\">'src/&lt;%= pkg.name %&gt;.js'</span>,</span><br><span class=\"line\">        dest: <span class=\"string\">'build/&lt;%= pkg.name %&gt;.min.js'</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 加载提供“uglify”任务的插件</span></span><br><span class=\"line\">  grunt.loadNpmTasks(<span class=\"string\">'grunt-contrib-uglify'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 设置默认任务为“uglify”</span></span><br><span class=\"line\">  grunt.registerTask(<span class=\"string\">'default'</span>, [<span class=\"string\">'uglify'</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong>Tip:</strong>  需要创建一个src文件夹，并且添加一个与package.jso里面同名的js文件来进行压缩，从代码中可以看到banner的生成是要读取package.json里面信息的</p>\n<h2 id=\"5-安装需要使用的插件\"><a href=\"#5-安装需要使用的插件\" class=\"headerlink\" title=\"5. 安装需要使用的插件\"></a>5. 安装需要使用的插件</h2><p>无论是在package.json里面，还是在Gruntfile中进行配置，这些只是告诉Grunt需要使用的插件和任务是什么，以及使用时传入的参数为何，但是真正的工作的插件还需要自行安装的，通过以下命令来安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install grunt-contrib --save-dev</span><br></pre></td></tr></table></figure>\n<p><strong>安装成功后，新安装的模块会被添加到node_modules中</strong><br>该命令会安装常用的官方工具库，让你能够快速的上手使用grunt（grunt官方的工具库都是以contrib为前缀），在实际开发中要根据需要选择性的下载相应的工具库。<br><a href=\"http://gruntjs.com/plugins\" target=\"_blank\" rel=\"noopener\">所有可用的grunt插件库</a><br><a href=\"https://npmjs.org/package/grunt-contrib\" target=\"_blank\" rel=\"noopener\">常用的grunt插件</a></p>\n<h2 id=\"6-运行grunt命令，开始使用grunt\"><a href=\"#6-运行grunt命令，开始使用grunt\" class=\"headerlink\" title=\"6. 运行grunt命令，开始使用grunt\"></a>6. 运行grunt命令，开始使用grunt</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> project &amp; grunt &lt;task-name&gt;</span><br></pre></td></tr></table></figure>\n<p>如果不指定任务名称，默认会执行default的任务</p>\n<h1 id=\"进一步的深入\"><a href=\"#进一步的深入\" class=\"headerlink\" title=\"进一步的深入\"></a>进一步的深入</h1><p><a href=\"http://gruntjs.com/configuring-tasks\" target=\"_blank\" rel=\"noopener\">配置任务</a><br><a href=\"http://gruntjs.com/api/grunt\" target=\"_blank\" rel=\"noopener\">Grunt API文档</a><br><a href=\"http://gruntjs.com/creating-tasks\" target=\"_blank\" rel=\"noopener\">创建自定义任务</a><br><strong>Tip:</strong>  自定义任务放在文件夹中，通过grunt.loadTasks引入<br><a href=\"http://gruntjs.cn/creating-plugins/\" target=\"_blank\" rel=\"noopener\">创建自定义插件</a><br><a href=\"http://gruntjs.com/project-scaffolding\" target=\"_blank\" rel=\"noopener\">创建项目模板</a></p>\n<h1 id=\"实际的例子\"><a href=\"#实际的例子\" class=\"headerlink\" title=\"实际的例子\"></a>实际的例子</h1><p><a href=\"http://blog.fens.me/nodejs-grunt-intro/\" target=\"_blank\" rel=\"noopener\">入门介绍</a><br><a href=\"http://www.36ria.com/6226\" target=\"_blank\" rel=\"noopener\">常用插件的使用</a><br><a href=\"http://www.36ria.com/6232\" target=\"_blank\" rel=\"noopener\">任务配置详解</a></p>\n","categories":[],"tags":["blog","frontend","build"]},{"title":"在Windows上Git bash集成Gitflow工具","url":"https://vincenthou.github.io/2013/12/11/在Windows上Git-bash集成Gitflow工具/","content":"<p>Git作为版本控制工具越来越流行，但是考虑到Git使用的灵活性，在进行大型项目开发的时候遵循一定的规范还是很有必要的，比较实用的一种工作流程要数<a href=\"https://www.atlassian.com/git/workflows#!workflow-gitflow\" target=\"_blank\" rel=\"noopener\">Gitflow</a>了，刚开始使用的时候会感觉这个流程很复杂，为了简化操作，Gitflow的工具应运而生，下面简单介绍一下。</p>\n<h2 id=\"在Windows上使用Gitflow规范流程\"><a href=\"#在Windows上使用Gitflow规范流程\" class=\"headerlink\" title=\"在Windows上使用Gitflow规范流程\"></a>在Windows上使用Gitflow规范流程</h2><h3 id=\"1-将Gitflow克隆到本地\"><a href=\"#1-将Gitflow克隆到本地\" class=\"headerlink\" title=\"1. 将Gitflow克隆到本地\"></a>1. 将Gitflow克隆到本地</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> -recursive git://github.com/nvie/gitflow.git</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-下载与msysgit集成Bin文件\"><a href=\"#2-下载与msysgit集成Bin文件\" class=\"headerlink\" title=\"2. 下载与msysgit集成Bin文件\"></a>2. 下载与msysgit集成Bin文件</h3><p><a href=\"http://sourceforge.net/projects/gnuwin32/files/util-linux/2.14.1/util-linux-ng-2.14.1-bin.zip/download\" target=\"_blank\" rel=\"noopener\">util-linux-ng-2.14.1-bin</a></p>\n<p><a href=\"http://sourceforge.net/projects/gnuwin32/files/util-linux/2.14.1/util-linux-ng-2.14.1-dep.zip/download\" target=\"_blank\" rel=\"noopener\">util-linux-ng-2.14.1-dep</a></p>\n<h3 id=\"3-将Bin文件拷贝到msysgit的bin目录下\"><a href=\"#3-将Bin文件拷贝到msysgit的bin目录下\" class=\"headerlink\" title=\"3. 将Bin文件拷贝到msysgit的bin目录下\"></a>3. 将Bin文件拷贝到msysgit的bin目录下</h3><p>下载完成后分别将两个压缩包解压文件下bin目录中的getopt.exe，libintl3.dll和libiconv2.dll文件拷贝到msysgit安装目录下的bin目录中</p>\n<h3 id=\"4-安装Gitflow工具\"><a href=\"#4-安装Gitflow工具\" class=\"headerlink\" title=\"4. 安装Gitflow工具\"></a>4. 安装Gitflow工具</h3><p>打开cmd命令行，进入已经克隆好的gitflow contrib目录中执行命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">D:\\gitflow contrib&gt;msysgit-install.cmd <span class=\"string\">\"C:\\Program Files\\Git\"</span>.</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-开始在console中使用Gitflow\"><a href=\"#5-开始在console中使用Gitflow\" class=\"headerlink\" title=\"5. 开始在console中使用Gitflow\"></a>5. 开始在console中使用Gitflow</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">usage: git flow &lt;subcommand&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">Available subcommands are:</span><br><span class=\"line\">   init      Initialize a new git repo with support <span class=\"keyword\">for</span> the branching model.</span><br><span class=\"line\">   feature   Manage your feature branches.</span><br><span class=\"line\">   release   Manage your release branches.</span><br><span class=\"line\">   hotfix    Manage your hotfix branches.</span><br><span class=\"line\">   support   Manage your support branches.</span><br><span class=\"line\">   version   Shows version information.</span><br><span class=\"line\"></span><br><span class=\"line\">Try <span class=\"string\">'git flow &lt;subcommand&gt; help'</span> <span class=\"keyword\">for</span> details.</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用Gitflow之后的开发流程\"><a href=\"#使用Gitflow之后的开发流程\" class=\"headerlink\" title=\"使用Gitflow之后的开发流程\"></a>使用Gitflow之后的开发流程</h2><h3 id=\"1-为本地代码库添加Git-flow特性\"><a href=\"#1-为本地代码库添加Git-flow特性\" class=\"headerlink\" title=\"1. 为本地代码库添加Git flow特性\"></a>1. 为本地代码库添加Git flow特性</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git flow init</span><br></pre></td></tr></table></figure>\n<p>使用默认值进行初始化设定</p>\n<h3 id=\"2-开始增加新特性-修复bug\"><a href=\"#2-开始增加新特性-修复bug\" class=\"headerlink\" title=\"2. 开始增加新特性/修复bug\"></a>2. 开始增加新特性/修复bug</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git flow feature start &lt;feature-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-完成开发的工作\"><a href=\"#3-完成开发的工作\" class=\"headerlink\" title=\"3. 完成开发的工作\"></a>3. 完成开发的工作</h3><p>修改一些文件，添加修改的文件到暂存区(staging area)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br></pre></td></tr></table></figure>\n<p>将修改后的文件提交到本地的版本库中</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -am <span class=\"string\">'Add a new feature'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"4-完成新特性-修复bug\"><a href=\"#4-完成新特性-修复bug\" class=\"headerlink\" title=\"4. 完成新特性/修复bug\"></a>4. 完成新特性/修复bug</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git flow feature finish &lt;feature-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-同步到中央代码库\"><a href=\"#5-同步到中央代码库\" class=\"headerlink\" title=\"5. 同步到中央代码库\"></a>5. 同步到中央代码库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git flow feature publish &lt;feature-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"http://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html\" target=\"_blank\" rel=\"noopener\">详细的Gitflow使用方法参考</a></p>\n<p><a href=\"http://nvie.com/posts/a-successful-git-branching-model/\" target=\"_blank\" rel=\"noopener\">Gitflow原型</a><br><a href=\"http://wenku.baidu.com/view/1ea291bf960590c69ec37694.html\" target=\"_blank\" rel=\"noopener\">TortoiseGit日常使用指南</a></p>\n","categories":[],"tags":["blog","git"]},{"title":"Git 最佳实践","url":"https://vincenthou.github.io/2013/12/06/Git-最佳实践/","content":"<h1 id=\"为什么使用Git\"><a href=\"#为什么使用Git\" class=\"headerlink\" title=\"为什么使用Git\"></a>为什么使用Git</h1><p><a href=\"http://blog.teamtreehouse.com/why-you-should-switch-from-subversion-to-git\" target=\"_blank\" rel=\"noopener\">http://blog.teamtreehouse.com/why-you-should-switch-from-subversion-to-git</a><br><a href=\"http://blog.jobbole.com/20069/\" target=\"_blank\" rel=\"noopener\">http://blog.jobbole.com/20069/</a><br><a href=\"http://www.zzbaike.com/wiki/Git%E4%B8%8ESVN%E9%97%B4%E7%9A%84%E6%AF%94%E8%BE%83\" target=\"_blank\" rel=\"noopener\">http://www.zzbaike.com/wiki/Git%E4%B8%8ESVN%E9%97%B4%E7%9A%84%E6%AF%94%E8%BE%83</a></p>\n<h1 id=\"原则\"><a href=\"#原则\" class=\"headerlink\" title=\"原则\"></a>原则</h1><ol>\n<li>Follow the appropriate workflow</li>\n<li>Make your commit atomic</li>\n<li>Commit early and often</li>\n<li>Write meaningful commit message</li>\n<li>Squash commits with rebase (merge –squash)</li>\n<li>Keep your code up to date before push to server, solve the conflicts yourself</li>\n<li>Integrate with CI system if possible</li>\n<li>Divide large work into different repositories</li>\n<li>add .gitignore for empty folder</li>\n<li>Use alias to accelerate your operations (Command line)</li>\n</ol>\n<p>folder/.gitignore</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*</span><br><span class=\"line\">!.gitignore</span><br></pre></td></tr></table></figure>\n<p>~/.gitconfig (~ stands for the default path when openning git bash)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[alias]</span><br><span class=\"line\">    st = status</span><br></pre></td></tr></table></figure>\n<p>~/.bashrc (to be more efficient, use short command in the console)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alias gst=&apos;git status&apos;</span><br><span class=\"line\">alias ga=&apos;git add&apos;</span><br></pre></td></tr></table></figure>\n<h1 id=\"项目中的Git工作流程\"><a href=\"#项目中的Git工作流程\" class=\"headerlink\" title=\"项目中的Git工作流程\"></a>项目中的Git工作流程</h1><h2 id=\"一些规范\"><a href=\"#一些规范\" class=\"headerlink\" title=\"一些规范\"></a>一些规范</h2><ol>\n<li>项目中有两个固定分支master和develop</li>\n<li>开发本地只克隆develop分支, 只有需要relase或者hotfix时候才会在本地克隆master代码来进行合并</li>\n<li>所有开发时新添加的feature或者新修复的bug都只能直接合并到develop分支上<h2 id=\"实际开发流程\"><a href=\"#实际开发流程\" class=\"headerlink\" title=\"实际开发流程\"></a>实际开发流程</h2><h3 id=\"1-克隆远端的develop分支\"><a href=\"#1-克隆远端的develop分支\" class=\"headerlink\" title=\"1. 克隆远端的develop分支\"></a>1. 克隆远端的develop分支</h3></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> -b develop &lt;remote-repository-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-创建新的分支\"><a href=\"#2-创建新的分支\" class=\"headerlink\" title=\"2. 创建新的分支\"></a>2. 创建新的分支</h3><p>开始实现一个feature或者解决一个bug之前，首先切换到develop分支上</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout develop</span><br></pre></td></tr></table></figure>\n<p>创建feature或者bug的分支,并且切换到该分支</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b &lt;feature-branch-name&gt; develop</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-完成开发的工作\"><a href=\"#3-完成开发的工作\" class=\"headerlink\" title=\"3. 完成开发的工作\"></a>3. 完成开发的工作</h3><p>修改一些文件，添加修改的文件到暂存区(staging area)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br></pre></td></tr></table></figure>\n<p>将修改后的文件提交到本地的版本库中</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -am <span class=\"string\">'Add a new feature'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"4-提交你的代码到中央版本库上\"><a href=\"#4-提交你的代码到中央版本库上\" class=\"headerlink\" title=\"4. 提交你的代码到中央版本库上\"></a>4. 提交你的代码到中央版本库上</h3><p>提交之前保证你本地的develop分支的代码是最新的</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout develop</span><br><span class=\"line\">git pull origin develop</span><br></pre></td></tr></table></figure>\n<p>将你在branch上完成的代码修改合并到develop分支上</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout develop</span><br><span class=\"line\">git merge &lt;feature-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<p><strong>or 推荐使用rebase</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout &lt;feature-branch-name&gt;</span><br><span class=\"line\">git rebase -i master</span><br><span class=\"line\">git checkout develop</span><br><span class=\"line\">git merge &lt;feature-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<p>详细的rebase的使用案例看<a href=\"https://www.atlassian.com/git/tutorials/rewriting-history/git-rebase-i\" target=\"_blank\" rel=\"noopener\">这里</a></p>\n<p>提交代码到中央版本库</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push</span><br></pre></td></tr></table></figure>\n<p>*删除本地创建的分支（可选）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d &lt;feature-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"在Windows上使用Gitflow规范流程\"><a href=\"#在Windows上使用Gitflow规范流程\" class=\"headerlink\" title=\"在Windows上使用Gitflow规范流程\"></a>在Windows上使用Gitflow规范流程</h2><h3 id=\"1-将Gitflow克隆到本地\"><a href=\"#1-将Gitflow克隆到本地\" class=\"headerlink\" title=\"1. 将Gitflow克隆到本地\"></a>1. 将Gitflow克隆到本地</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> -recursive git://github.com/nvie/gitflow.git</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-下载与msysgit集成Bin文件\"><a href=\"#2-下载与msysgit集成Bin文件\" class=\"headerlink\" title=\"2. 下载与msysgit集成Bin文件\"></a>2. 下载与msysgit集成Bin文件</h3><p><a href=\"http://sourceforge.net/projects/gnuwin32/files/util-linux/2.14.1/util-linux-ng-2.14.1-bin.zip/download\" target=\"_blank\" rel=\"noopener\">util-linux-ng-2.14.1-bin</a></p>\n<p><a href=\"http://sourceforge.net/projects/gnuwin32/files/util-linux/2.14.1/util-linux-ng-2.14.1-dep.zip/download\" target=\"_blank\" rel=\"noopener\">util-linux-ng-2.14.1-dep</a></p>\n<h3 id=\"3-将Bin文件拷贝到msysgit的bin目录下\"><a href=\"#3-将Bin文件拷贝到msysgit的bin目录下\" class=\"headerlink\" title=\"3. 将Bin文件拷贝到msysgit的bin目录下\"></a>3. 将Bin文件拷贝到msysgit的bin目录下</h3><p>下载完成后分别将两个压缩包解压文件下bin目录中的getopt.exe，libintl3.dll和libiconv2.dll文件拷贝到msysgit安装目录下的bin目录中</p>\n<h3 id=\"4-安装Gitflow工具\"><a href=\"#4-安装Gitflow工具\" class=\"headerlink\" title=\"4. 安装Gitflow工具\"></a>4. 安装Gitflow工具</h3><p>打开cmd命令行，进入已经克隆好的gitflow contrib目录中执行命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">D:\\gitflow contrib&gt;msysgit-install.cmd <span class=\"string\">\"C:\\Program Files\\Git\"</span>.</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-开始在console中使用Gitflow\"><a href=\"#5-开始在console中使用Gitflow\" class=\"headerlink\" title=\"5. 开始在console中使用Gitflow\"></a>5. 开始在console中使用Gitflow</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">usage: git flow &lt;subcommand&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">Available subcommands are:</span><br><span class=\"line\">   init      Initialize a new git repo with support <span class=\"keyword\">for</span> the branching model.</span><br><span class=\"line\">   feature   Manage your feature branches.</span><br><span class=\"line\">   release   Manage your release branches.</span><br><span class=\"line\">   hotfix    Manage your hotfix branches.</span><br><span class=\"line\">   support   Manage your support branches.</span><br><span class=\"line\">   version   Shows version information.</span><br><span class=\"line\"></span><br><span class=\"line\">Try <span class=\"string\">'git flow &lt;subcommand&gt; help'</span> <span class=\"keyword\">for</span> details.</span><br></pre></td></tr></table></figure>\n<p>详细的Gitflow使用方法参考<a href=\"http://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html\" target=\"_blank\" rel=\"noopener\">Git Flow Cheatsheet</a></p>\n<h2 id=\"使用Gitflow之后的开发流程\"><a href=\"#使用Gitflow之后的开发流程\" class=\"headerlink\" title=\"使用Gitflow之后的开发流程\"></a>使用Gitflow之后的开发流程</h2><h3 id=\"1-为本地代码库添加Git-flow特性\"><a href=\"#1-为本地代码库添加Git-flow特性\" class=\"headerlink\" title=\"1. 为本地代码库添加Git flow特性\"></a>1. 为本地代码库添加Git flow特性</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git flow init</span><br></pre></td></tr></table></figure>\n<p>使用默认值进行初始化设定</p>\n<h3 id=\"2-开始增加新特性-修复bug\"><a href=\"#2-开始增加新特性-修复bug\" class=\"headerlink\" title=\"2. 开始增加新特性/修复bug\"></a>2. 开始增加新特性/修复bug</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git flow feature start &lt;feature-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-完成开发的工作-1\"><a href=\"#3-完成开发的工作-1\" class=\"headerlink\" title=\"3. 完成开发的工作\"></a>3. 完成开发的工作</h3><p>修改一些文件，添加修改的文件到暂存区(staging area)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br></pre></td></tr></table></figure>\n<p>将修改后的文件提交到本地的版本库中</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -am <span class=\"string\">'Add a new feature'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"4-完成新特性-修复bug\"><a href=\"#4-完成新特性-修复bug\" class=\"headerlink\" title=\"4. 完成新特性/修复bug\"></a>4. 完成新特性/修复bug</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git flow feature finish &lt;feature-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-同步到中央代码库\"><a href=\"#5-同步到中央代码库\" class=\"headerlink\" title=\"5. 同步到中央代码库\"></a>5. 同步到中央代码库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git flow feature publish &lt;feature-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html/#features\" target=\"_blank\" rel=\"noopener\">详细说明参考</a></p>\n<h2 id=\"准备release\"><a href=\"#准备release\" class=\"headerlink\" title=\"准备release\"></a>准备release</h2><h3 id=\"1-创建release分支\"><a href=\"#1-创建release分支\" class=\"headerlink\" title=\"1. 创建release分支\"></a>1. 创建release分支</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b &lt;release-branch-name&gt; develop</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-完成relase的相关工作\"><a href=\"#2-完成relase的相关工作\" class=\"headerlink\" title=\"2. 完成relase的相关工作\"></a>2. 完成relase的相关工作</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br><span class=\"line\">git commit -am <span class=\"string\">'Finish release related work'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3-将relase分支合并到master和develop分支，并且同步到中央版本库\"><a href=\"#3-将relase分支合并到master和develop分支，并且同步到中央版本库\" class=\"headerlink\" title=\"3. 将relase分支合并到master和develop分支，并且同步到中央版本库\"></a>3. 将relase分支合并到master和develop分支，并且同步到中央版本库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge &lt;release-branch-name&gt;</span><br><span class=\"line\">git push</span><br><span class=\"line\">git checkout develop</span><br><span class=\"line\">git merge &lt;release-branch-name&gt;</span><br><span class=\"line\">git push</span><br><span class=\"line\">git branch -d &lt;release-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-在主分支上添加tag，并且同步到中央服务器\"><a href=\"#4-在主分支上添加tag，并且同步到中央服务器\" class=\"headerlink\" title=\"4. 在主分支上添加tag，并且同步到中央服务器\"></a>4. 在主分支上添加tag，并且同步到中央服务器</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -a &lt;version-number&gt; -m <span class=\"string\">'Create 0.1 version release'</span> master</span><br><span class=\"line\">git push --tags</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://danielkummer.github.io/git-flow-cheatsheet/\" target=\"_blank\" rel=\"noopener\">使用Gitflow准备release</a></p>\n<h2 id=\"创建hotfix\"><a href=\"#创建hotfix\" class=\"headerlink\" title=\"创建hotfix\"></a>创建hotfix</h2><h3 id=\"1-从master分支上创建一个hotfix的新分支\"><a href=\"#1-从master分支上创建一个hotfix的新分支\" class=\"headerlink\" title=\"1. 从master分支上创建一个hotfix的新分支\"></a>1. 从master分支上创建一个hotfix的新分支</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b &lt;hotifx-branch-name&gt; master</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-修复问题\"><a href=\"#2-修复问题\" class=\"headerlink\" title=\"2. 修复问题\"></a>2. 修复问题</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br><span class=\"line\">git commit -am <span class=\"string\">'Fix the crash bug'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3-将relase分支合并到master和develop分支，并且同步到中央版本库-1\"><a href=\"#3-将relase分支合并到master和develop分支，并且同步到中央版本库-1\" class=\"headerlink\" title=\"3. 将relase分支合并到master和develop分支，并且同步到中央版本库\"></a>3. 将relase分支合并到master和develop分支，并且同步到中央版本库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge &lt;hotifx-branch-name&gt;</span><br><span class=\"line\">git push</span><br><span class=\"line\">git checkout develop</span><br><span class=\"line\">git merge &lt;hotifx-branch-name&gt;</span><br><span class=\"line\">git push</span><br><span class=\"line\">git branch -d &lt;hotifx-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html#hotfixes\" target=\"_blank\" rel=\"noopener\">使用Gitflow创建hotfix</a></p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a href=\"http://rogerdudler.github.io/git-guide/\" target=\"_blank\" rel=\"noopener\">Simple get started reference</a><br><a href=\"http://nvie.com/posts/a-successful-git-branching-model/\" target=\"_blank\" rel=\"noopener\">A Successful Git Branching Model</a><br><a href=\"http://marklodato.github.io/visual-git-guide/index-en.html\" target=\"_blank\" rel=\"noopener\">A Visual Git Reference</a><br><a href=\"https://www.atlassian.com/git/\" target=\"_blank\" rel=\"noopener\">Git Tutorials</a><br><a href=\"https://help.github.com/\" target=\"_blank\" rel=\"noopener\">Github help</a><br><a href=\"http://git-scm.com/book/en\" target=\"_blank\" rel=\"noopener\">Git book</a><br><a href=\"http://gitready.com/\" target=\"_blank\" rel=\"noopener\">Gitready</a><br><a href=\"https://www.atlassian.com/git/workflows#!workflow-gitflow\" target=\"_blank\" rel=\"noopener\">Gitflow工作流英文版</a><br><a href=\"http://rogerdudler.github.io/git-guide/\" target=\"_blank\" rel=\"noopener\">快速开始</a><br><a href=\"http://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html\" target=\"_blank\" rel=\"noopener\">如何使用Gitflow插件</a><br><a href=\"http://git-scm.com/book/en\" target=\"_blank\" rel=\"noopener\">Git文档</a><br><a href=\"https://github.com/vincenthou/vincenthou.github.io/issues/1\" target=\"_blank\" rel=\"noopener\">我的Github工作流</a></p>\n","categories":[],"tags":["git"]},{"title":"Technology Tutorials","url":"https://vincenthou.github.io/2013/12/06/Technology-Tutorials/","content":"<h1 id=\"General\"><a href=\"#General\" class=\"headerlink\" title=\"General\"></a>General</h1><ul>\n<li>在线精品教程 <a href=\"http://build-podcast.com/\" target=\"_blank\" rel=\"noopener\">build podcast</a><h1 id=\"Frontend\"><a href=\"#Frontend\" class=\"headerlink\" title=\"Frontend\"></a>Frontend</h1></li>\n<li><a href=\"https://github.com/chemdemo/chemdemo.github.io/blob/master/blogs/frontend_knowledge.md\" target=\"_blank\" rel=\"noopener\">前端知识整理</a> </li>\n<li><a href=\"http://thecodeplayer.com/\" target=\"_blank\" rel=\"noopener\">CodePlayer</a> 炫酷的教程</li>\n<li>Yeoman 官网 <a href=\"http://yeoman.io/\" target=\"_blank\" rel=\"noopener\">Yeoman</a>, <a href=\"http://www.html5rocks.com/en/tutorials/webcomponents/yeoman/\" target=\"_blank\" rel=\"noopener\">Building Web Apps With Yeoman And Polymer</a>, <a href=\"http://yeoman.io/generators.html\" target=\"_blank\" rel=\"noopener\">定制模板Official</a>, <a href=\"http://www.36ria.com/6156\" target=\"_blank\" rel=\"noopener\">定制模板Personal</a></li>\n<li>Jquery <a href=\"http://www.learnjquery.org/tutorials/\" target=\"_blank\" rel=\"noopener\">LearnJquery</a></li>\n<li>AngularJS <a href=\"http://www.ng-newsletter.com/posts/beginner2expert-how_to_start.html\" target=\"_blank\" rel=\"noopener\">Get started</a>, <a href=\"http://blog.jobbole.com/46589/\" target=\"_blank\" rel=\"noopener\">使用思路</a></li>\n<li><a href=\"https://github.com/angular/angular.js/wiki/Understanding-Scopes\" target=\"_blank\" rel=\"noopener\">AngularJS Scope</a></li>\n<li><a href=\"http://ify.io/lazy-loading-in-angularjs/\" target=\"_blank\" rel=\"noopener\">AngularJS Lazy loading</a></li>\n<li>Skills <a href=\"https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Canvas_tutorial/Using_images\" target=\"_blank\" rel=\"noopener\">处理图片</a>, <a href=\"http://blog.jobbole.com/47179/\" target=\"_blank\" rel=\"noopener\">有限状态机</a></li>\n<li><a href=\"http://smacss.com/book\" target=\"_blank\" rel=\"noopener\">Scalable and Modular Architecture for CSS</a></li>\n<li><a href=\"http://learn.shayhowe.com/advanced-html-css/\" target=\"_blank\" rel=\"noopener\">Advanced HTML and CSS</a></li>\n<li><a href=\"https://gitcafe.com/riku/Markdown-Syntax-CN/blob/master/syntax.md\" target=\"_blank\" rel=\"noopener\">Markdown Tutorials</a></li>\n<li><a href=\"https://bitbucket.org/ant512/canvaslayers/wiki/Tutorial_1.wiki\" target=\"_blank\" rel=\"noopener\">Canvas Layers</a></li>\n<li><a href=\"http://www.cnblogs.com/cloudgamer/archive/2009/01/06/Tween.html\" target=\"_blank\" rel=\"noopener\">Tween 算法</a></li>\n<li><a href=\"http://net.tutsplus.com/tutorials/tools-and-tips/travis-ci-what-why-how/\" target=\"_blank\" rel=\"noopener\">Using Travis CI</a></li>\n<li><a href=\"https://github.com/modulejs/pragmatic-jquery\" target=\"_blank\" rel=\"noopener\">Jquery最佳实践</a></li>\n<li><a href=\"https://github.com/chemdemo/chemdemo.github.io/blob/master/blogs/network.md\" target=\"_blank\" rel=\"noopener\">网络通讯协议</a><h1 id=\"Backend\"><a href=\"#Backend\" class=\"headerlink\" title=\"Backend\"></a>Backend</h1></li>\n<li><a href=\"http://www.ibm.com/developerworks/cn/web/1103_chenyan_restapi/index.html?ca=drs\" target=\"_blank\" rel=\"noopener\">REST API</a>, <a href=\"http://www.infoq.com/cn/articles/designing-restful-http-apps-roth\" target=\"_blank\" rel=\"noopener\">RESTful HTTP的实践</a></li>\n<li><a href=\"http://tech.pro/tutorial/1555/10-easy-steps-to-a-complete-understanding-of-sql\" target=\"_blank\" rel=\"noopener\">Understanding SQL</a></li>\n<li><a href=\"http://blog.csdn.net/smarttony/article/details/5874485\" target=\"_blank\" rel=\"noopener\">高并发高流量网站架构</a></li>\n<li>MongoDB <a href=\"https://github.com/justinyhuang/the-little-mongodb-book-cn/blob/master/mongodb.md\" target=\"_blank\" rel=\"noopener\">Little Book</a></li>\n<li>MongoDB <a href=\"http://www.cnblogs.com/huangxincheng/archive/2012/02/18/2356595.html\" target=\"_blank\" rel=\"noopener\">快速入门</a></li>\n<li>Resis <a href=\"http://www.redisbook.com/en/latest/internal/aof.html\" target=\"_blank\" rel=\"noopener\">持久化</a></li>\n<li><a href=\"http://developer.51cto.com/art/201401/427370.htm\" target=\"_blank\" rel=\"noopener\">十步完全理解SQL</a><h1 id=\"Git\"><a href=\"#Git\" class=\"headerlink\" title=\"Git\"></a>Git</h1></li>\n<li>快速入门 <a href=\"http://rogerdudler.github.io/git-guide/index.zh.html\" target=\"_blank\" rel=\"noopener\">Simple Guide</a></li>\n<li><a href=\"http://www-cs-students.stanford.edu/~blynn/gitmagic/intl/zh_cn/\" target=\"_blank\" rel=\"noopener\">Git Magic</a></li>\n<li>保存<a href=\"https://gist.github.com/canton7/1423106\" target=\"_blank\" rel=\"noopener\">本地版本的Config文件</a><h1 id=\"Nodejs\"><a href=\"#Nodejs\" class=\"headerlink\" title=\"Nodejs\"></a>Nodejs</h1></li>\n<li>7天nodejs <a href=\"http://nqdeng.github.io/7-days-nodejs/\" target=\"_blank\" rel=\"noopener\">7-day-nodejs</a></li>\n<li>npm packages <a href=\"https://npmjs.org/\" target=\"_blank\" rel=\"noopener\">npmjs</a></li>\n<li>How to docs <a href=\"http://docs.nodejitsu.com/\" target=\"_blank\" rel=\"noopener\">nodejitsu</a></li>\n<li>使用 Express + MongoDB 搭建多人博客 <a href=\"https://github.com/nswbmw/N-blog/wiki/_pages\" target=\"_blank\" rel=\"noopener\">nswbmw / N-blog</a></li>\n<li>从零开始nodejs<a href=\"http://blog.fens.me/series-nodejs/#gsc.tab=0\" target=\"_blank\" rel=\"noopener\">系列文章</a></li>\n<li><a href=\"https://github.com/chemdemo/chemdemo.github.io/blob/master/blogs/exception_catch.md\" target=\"_blank\" rel=\"noopener\">异常捕获</a></li>\n<li>异步工作流<a href=\"https://github.com/chemdemo/chemdemo.github.io/blob/master/blogs/stepify.md\" target=\"_blank\" rel=\"noopener\">Stepify</a></li>\n<li>Scrapy <a href=\"https://github.com/orkz/scrapy\" target=\"_blank\" rel=\"noopener\">https://github.com/orkz/scrapy</a></li>\n<li>distribute_crawler <a href=\"https://github.com/gnemoug/distribute_crawler\" target=\"_blank\" rel=\"noopener\">https://github.com/gnemoug/distribute_crawler</a><h1 id=\"PHP\"><a href=\"#PHP\" class=\"headerlink\" title=\"PHP\"></a>PHP</h1></li>\n<li><a href=\"http://www.laruence.com/2011/04/13/1991.html\" target=\"_blank\" rel=\"noopener\">PHP asynchronous call</a></li>\n<li><a href=\"http://www.phptherightway.com/#top\" target=\"_blank\" rel=\"noopener\">PHP Right Way</a></li>\n<li><a href=\"http://avnpc.com/pages/best-wheels-for-php\" target=\"_blank\" rel=\"noopener\">PHP 轮子</a></li>\n<li><a href=\"http://phptrends.com/\" target=\"_blank\" rel=\"noopener\">流行de框架</a><h1 id=\"Ruby\"><a href=\"#Ruby\" class=\"headerlink\" title=\"Ruby\"></a>Ruby</h1></li>\n<li>gem packages <a href=\"http://rubygems.org/\" target=\"_blank\" rel=\"noopener\">gen</a></li>\n<li>扎实的学习 <a href=\"http://ruby.learncodethehardway.org/\" target=\"_blank\" rel=\"noopener\">Learn Ruby The Hard Way</a><h1 id=\"C\"><a href=\"#C\" class=\"headerlink\" title=\"C\"></a>C</h1></li>\n<li><a href=\"http://www.oschina.net/question/tag/clang-lie\" target=\"_blank\" rel=\"noopener\">C编程鬼话</a><h1 id=\"Funny-Links\"><a href=\"#Funny-Links\" class=\"headerlink\" title=\"Funny Links\"></a>Funny Links</h1></li>\n<li><a href=\"http://developer.51cto.com/art/201105/265512.htm\" target=\"_blank\" rel=\"noopener\">解释设计模式</a></li>\n<li><a href=\"http://developer.51cto.com/art/201105/265507.htm\" target=\"_blank\" rel=\"noopener\">解释OOD</a></li>\n</ul>\n","categories":[],"tags":["collection"]},{"title":"Frontend Tools","url":"https://vincenthou.github.io/2013/12/05/Frontend-Tools/","content":"<ul>\n<li>比照设计图 <a href=\"http://htmlpreview.github.io/?https://github.com/zhangxinxu/uiMatch/blob/master/index.html\" target=\"_blank\" rel=\"noopener\">compare visual design</a></li>\n<li>预览静态页面<a href=\"http://htmlpreview.github.io/\" target=\"_blank\" rel=\"noopener\">htmlpreview</a></li>\n<li>前端构建工具<a href=\"https://github.com/modjs/mod\" target=\"_blank\" rel=\"noopener\">Modjs</a></li>\n<li>CSSSprite工具<a href=\"https://github.com/iazrael/ispriter\" target=\"_blank\" rel=\"noopener\">Ispriter</a></li>\n<li>为前端开发创建实时后台<a href=\"https://www.firebase.com/\" target=\"_blank\" rel=\"noopener\">Firebase</a></li>\n<li>免费后台支持<a href=\"https://www.dreamfactory.com/\" target=\"_blank\" rel=\"noopener\">Dreamfactory</a></li>\n<li>dribbble <a href=\"http://dribbble.com/\" target=\"_blank\" rel=\"noopener\">http://dribbble.com/</a></li>\n<li>创意图片集Openclipart <a href=\"http://openclipart.org/\" target=\"_blank\" rel=\"noopener\">http://openclipart.org/</a></li>\n<li>iconfans <a href=\"http://www.iconfans.com/\" target=\"_blank\" rel=\"noopener\">http://www.iconfans.com/</a></li>\n<li>UI 盒子 <a href=\"http://www.boxui.com/\" target=\"_blank\" rel=\"noopener\">http://www.boxui.com/</a></li>\n<li>CSS Sprite Generator <a href=\"http://spritegen.website-performance.org/\" target=\"_blank\" rel=\"noopener\">http://spritegen.website-performance.org/</a></li>\n<li><a href=\"http://www.igvita.com/slides/2012/devtools-tips-and-tricks/#2\" target=\"_blank\" rel=\"noopener\">Chrome developer tools</a></li>\n<li>阿里测，专业的网站即时探测工具 <a href=\"http://alibench.com/\" target=\"_blank\" rel=\"noopener\">http://alibench.com/</a></li>\n<li>CloudConvertor <a href=\"https://cloudconvert.org/\" target=\"_blank\" rel=\"noopener\">https://cloudconvert.org/</a></li>\n<li>Covert SVG to PNG <a href=\"https://cloudconvert.org/svg-to-png\" target=\"_blank\" rel=\"noopener\">https://cloudconvert.org/svg-to-png</a></li>\n<li>Covert markdown to HTML <a href=\"http://markdowntohtml.com/\" target=\"_blank\" rel=\"noopener\">http://markdowntohtml.com/</a></li>\n<li>Markdown编辑器 <a href=\"http://mahua.jser.me/\" target=\"_blank\" rel=\"noopener\">http://mahua.jser.me/</a></li>\n<li>机器学习服务器 <a href=\"http://prediction.io/\" target=\"_blank\" rel=\"noopener\">http://prediction.io/</a></li>\n<li>Google 短地址服务 <a href=\"http://goo.gl/\" target=\"_blank\" rel=\"noopener\">http://goo.gl/</a></li>\n<li>Tiny 短地址服务 <a href=\"http://tiny.cc/\" target=\"_blank\" rel=\"noopener\">http://tiny.cc/</a></li>\n<li>二维码生成服务 <a href=\"http://www.liantu.com/\" target=\"_blank\" rel=\"noopener\">http://www.liantu.com/</a></li>\n<li>批量邮件发送 <a href=\"http://mailchimp.com/\" target=\"_blank\" rel=\"noopener\">Mailchimp</a></li>\n<li>又拍云存储 <a href=\"https://www.upyun.com/\" target=\"_blank\" rel=\"noopener\">https://www.upyun.com/</a></li>\n<li><a href=\"http://www.jsdelivr.com/\" target=\"_blank\" rel=\"noopener\">JS CDN</a></li>\n<li>各种HTML5兼容解决方案 <a href=\"https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-browser-Polyfills\" target=\"_blank\" rel=\"noopener\">HTML5Polyfills</a></li>\n<li><a href=\"http://www.bootcss.com/\" target=\"_blank\" rel=\"noopener\">Bootstrap and tools</a></li>\n<li><a href=\"http://www.uupoop.com/\" target=\"_blank\" rel=\"noopener\">Online PS</a></li>\n<li>压力测试<a href=\"http://keenwon.com/235.html\" target=\"_blank\" rel=\"noopener\">online</a></li>\n<li>流程图绘制工具<a href=\"https://www.websequencediagrams.com/#\" target=\"_blank\" rel=\"noopener\">online</a></li>\n</ul>\n<p>选择开源软件协议<br><img src=\"http://7ls0pw.com1.z0.glb.clouddn.com/free_software_licenses.png\" alt=\"Licence\"></p>\n<h2 id=\"开放API\"><a href=\"#开放API\" class=\"headerlink\" title=\"开放API\"></a>开放API</h2><p>图片搜索：<a href=\"http://baike.so.com/resource/other/bkeditor/server/getImgJson.php\" target=\"_blank\" rel=\"noopener\">http://baike.so.com/resource/other/bkeditor/server/getImgJson.php</a> 参数：q (query keyword)<br>百度图片搜索: <a href=\"http://image.baidu.com/data/imgs?sort=0&amp;pn=page*pageSize&amp;rn=pageSize&amp;col=keyword&amp;tag=全部&amp;tag3=&amp;p=channel&amp;from=1\" target=\"_blank\" rel=\"noopener\">http://image.baidu.com/data/imgs?sort=0&amp;pn=page*pageSize&amp;rn=pageSize&amp;col=keyword&amp;tag=全部&amp;tag3=&amp;p=channel&amp;from=1</a><br>360图片搜索：<a href=\"http://image.so.com/j?q=keyword&amp;sn=100&amp;pn=30\" target=\"_blank\" rel=\"noopener\">http://image.so.com/j?q=keyword&amp;sn=100&amp;pn=30</a><br>百度音乐歌词：<a href=\"http://tingapi.ting.baidu.com/v1/restserver/ting?from=webapp_music&amp;method=baidu.ting.song.lry&amp;format=jsonp&amp;callback=test&amp;songid=91084723\" target=\"_blank\" rel=\"noopener\">http://tingapi.ting.baidu.com/v1/restserver/ting?from=webapp_music&amp;method=baidu.ting.song.lry&amp;format=jsonp&amp;callback=test&amp;songid=91084723</a><br>豆瓣：<a href=\"http://developers.douban.com/wiki/?title=api_v2\" target=\"_blank\" rel=\"noopener\">http://developers.douban.com/wiki/?title=api_v2</a><br>Flickr： <a href=\"http://www.flickr.com/services/api/\" target=\"_blank\" rel=\"noopener\">http://www.flickr.com/services/api/</a><br>Last.fm Web Services：<a href=\"http://cn.last.fm/api\" target=\"_blank\" rel=\"noopener\">http://cn.last.fm/api</a><br>人工智能Simsimi:<br><a href=\"http://sandbox.api.simsimi.com/request.p?key=&amp;lc=zh&amp;text=\" target=\"_blank\" rel=\"noopener\">http://sandbox.api.simsimi.com/request.p?key=&amp;lc=zh&amp;text=</a><br><a href=\"http://developer.simsimi.com/api\" target=\"_blank\" rel=\"noopener\">http://developer.simsimi.com/api</a><br>iRobot: <a href=\"http://nlp.xiaoi.com/\" target=\"_blank\" rel=\"noopener\">http://nlp.xiaoi.com/</a><br>免费共享API: <a href=\"http://bbs.we7.cc/thread-535-1-1.html\" target=\"_blank\" rel=\"noopener\">http://bbs.we7.cc/thread-535-1-1.html</a><br><a href=\"http://rmbz.net/Api/AiTalk.aspx?key=rmbznet&amp;word=&amp;talk=xiaoi/sim\" target=\"_blank\" rel=\"noopener\">http://rmbz.net/Api/AiTalk.aspx?key=rmbznet&amp;word=&amp;talk=xiaoi/sim</a><br>IT ebook API  <a href=\"http://it-ebooks-api.info/\" target=\"_blank\" rel=\"noopener\">http://it-ebooks-api.info/</a></p>\n<p>微信测试平台：<a href=\"http://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index\" target=\"_blank\" rel=\"noopener\">http://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index</a><br>百度控制台：<a href=\"http://developer.baidu.com/dev\" target=\"_blank\" rel=\"noopener\">http://developer.baidu.com/dev</a><br>在线脑图：<a href=\"http://fex-team.baidu.com/kityminder/dist/\" target=\"_blank\" rel=\"noopener\">http://fex-team.baidu.com/kityminder/dist/</a><br>在线PPT制作: <a href=\"http://airjd.com/\" target=\"_blank\" rel=\"noopener\">http://airjd.com/</a></p>\n","categories":[],"tags":["frontend","collection"]},{"title":"Good Blog Links","url":"https://vincenthou.github.io/2013/12/05/Good-Blog-Links/","content":"<p><a href=\"https://github.com/JacksonTian/fks\" target=\"_blank\" rel=\"noopener\">前端技能汇总</a>(<a href=\"https://github.com/JacksonTian/fks\" target=\"_blank\" rel=\"noopener\">https://github.com/JacksonTian/fks</a>)<br><a href=\"http://developer.51cto.com/art/201212/375204.htm\" target=\"_blank\" rel=\"noopener\">前端提升渠道</a><br><a href=\"http://kb.cnblogs.com/page/159704/\" target=\"_blank\" rel=\"noopener\">前端十日谈</a><br><a href=\"http://developer.51cto.com/art/201312/425003.htm\" target=\"_blank\" rel=\"noopener\">靠谱的JSer</a></p>\n<p>English</p>\n<ul>\n<li><a href=\"http://rmurphey.com/blog/2012/04/12/a-baseline-for-front-end-developers/\" target=\"_blank\" rel=\"noopener\">A Baseline for front end developers</a></li>\n<li><a href=\"https://github.com/krasimir/blog-posts\" target=\"_blank\" rel=\"noopener\">krasimir</a></li>\n<li>苹果设计师Bret Victor <a href=\"http://worrydream.com/\" target=\"_blank\" rel=\"noopener\">http://worrydream.com/</a></li>\n<li>Paul Irish <a href=\"http://www.paulirish.com/\" target=\"_blank\" rel=\"noopener\">http://www.paulirish.com/</a></li>\n<li>David Walsh <a href=\"http://davidwalsh.name/\" target=\"_blank\" rel=\"noopener\">http://davidwalsh.name/</a></li>\n<li>John Resig <a href=\"http://ejohn.org/\" target=\"_blank\" rel=\"noopener\">http://ejohn.org/</a></li>\n<li>Steve Souders <a href=\"http://stevesouders.com/\" target=\"_blank\" rel=\"noopener\">http://stevesouders.com/</a></li>\n<li>Addy Osmani <a href=\"http://addyosmani.com/blog/\" target=\"_blank\" rel=\"noopener\">http://addyosmani.com/blog/</a></li>\n<li>CSS Tricks <a href=\"http://css-tricks.com/\" target=\"_blank\" rel=\"noopener\">http://css-tricks.com/</a></li>\n<li>CSS Ninja <a href=\"http://www.thecssninja.com/\" target=\"_blank\" rel=\"noopener\">http://www.thecssninja.com/</a></li>\n</ul>\n<p>中文</p>\n<ul>\n<li>玉伯 <a href=\"https://github.com/lifesinger/lifesinger.github.com/issues?labels=blog\" target=\"_blank\" rel=\"noopener\">lifesinger.github.com</a></li>\n<li>汤姆大叔 <a href=\"http://www.cnblogs.com/TomXu\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/TomXu</a></li>\n<li>阮一峰 <a href=\"http://www.ruanyifeng.com/blog/archives.html\" target=\"_blank\" rel=\"noopener\">http://www.ruanyifeng.com/</a></li>\n<li>王子墨 <a href=\"http://julying.com/\" target=\"_blank\" rel=\"noopener\">http://julying.com/</a></li>\n<li>JerryQu 的小站 <a href=\"https://www.imququ.com/\" target=\"_blank\" rel=\"noopener\">https://www.imququ.com/</a></li>\n<li>前端观察 <a href=\"http://www.qianduan.net/\" target=\"_blank\" rel=\"noopener\">http://www.qianduan.net/</a></li>\n<li>豆瓣前端架构 [<a href=\"http://hikejun.com/sharing/2010webrebuild/?file=fe-infrastructure.html#1\" target=\"_blank\" rel=\"noopener\">http://hikejun.com/sharing/2010webrebuild/?file=fe-infrastructure.html#1</a>)</li>\n<li>结构之法 算法之道 <a href=\"http://blog.csdn.net/v_july_v\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/v_july_v</a></li>\n<li>CloudGamer <a href=\"http://www.cnblogs.com/cloudgamer/\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/cloudgamer/</a></li>\n<li>RIA之家 <a href=\"http://www.36ria.com/\" target=\"_blank\" rel=\"noopener\">http://www.36ria.com/</a></li>\n<li>Hongru <a href=\"http://hongru.cnblogs.com/\" target=\"_blank\" rel=\"noopener\">http://hongru.cnblogs.com/</a></li>\n<li>张鑫旭 <a href=\"http://www.zhangxinxu.com/wordpress/\" target=\"_blank\" rel=\"noopener\">http://www.zhangxinxu.com/wordpress/</a></li>\n<li>BeiYuu <a href=\"http://beiyuu.com/\" target=\"_blank\" rel=\"noopener\">http://beiyuu.com/</a></li>\n<li>聂微东 <a href=\"http://www.cnblogs.com/Darren_code/\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/Darren_code/</a></li>\n<li>牛魔王的世界观 <a href=\"http://www.niumowang.org/\" target=\"_blank\" rel=\"noopener\">http://www.niumowang.org/</a></li>\n<li>淘宝昂天<a href=\"http://fgm.cc/learn/\" target=\"_blank\" rel=\"noopener\">http://fgm.cc/learn/</a></li>\n<li>peiwen <a href=\"http://peiwen.lu/\" target=\"_blank\" rel=\"noopener\">http://peiwen.lu/</a></li>\n<li>chuome <a href=\"http://chuo.me/archive/\" target=\"_blank\" rel=\"noopener\">http://chuo.me/archive/</a></li>\n<li>小鱼 <a href=\"http://sofish.de/\" target=\"_blank\" rel=\"noopener\">http://sofish.de/</a></li>\n<li>创意代码分享codrops <a href=\"http://tympanus.net/codrops/\" target=\"_blank\" rel=\"noopener\">http://tympanus.net/codrops/</a></li>\n<li>刘淼 <a href=\"http://liumiao.me/\" target=\"_blank\" rel=\"noopener\">http://liumiao.me/</a></li>\n<li>蔡宝坚 <a href=\"http://caibaojian.com/\" target=\"_blank\" rel=\"noopener\">http://caibaojian.com/</a></li>\n<li><a href=\"http://www.cssforest.org/blog/index.php?s=archive_lists\" target=\"_blank\" rel=\"noopener\">CSS森林</a></li>\n<li>bingo <a href=\"http://blog.bingo929.com/\" target=\"_blank\" rel=\"noopener\">http://blog.bingo929.com/</a></li>\n<li>宅居 <a href=\"http://otakustay.com/\" target=\"_blank\" rel=\"noopener\">http://otakustay.com/</a></li>\n<li>前端博客 <a href=\"http://qianduanblog.com/\" target=\"_blank\" rel=\"noopener\">http://qianduanblog.com/</a></li>\n<li>粉丝日志 <a href=\"http://blog.fens.me/\" target=\"_blank\" rel=\"noopener\">http://blog.fens.me/</a></li>\n<li>IT技术精研院 <a href=\"http://ittechnical.sinaapp.com/\" target=\"_blank\" rel=\"noopener\">http://ittechnical.sinaapp.com/</a></li>\n</ul>\n<p>组织</p>\n<ul>\n<li>奇舞团 <a href=\"http://www.75team.com/\" target=\"_blank\" rel=\"noopener\">http://www.75team.com/</a></li>\n<li>HTML5Rocks <a href=\"http://www.html5rocks.com/zh/\" target=\"_blank\" rel=\"noopener\">http://www.html5rocks.com/zh/</a></li>\n<li>前端圈 <a href=\"http://sentsin.com/daohang/\" target=\"_blank\" rel=\"noopener\">http://sentsin.com/daohang/</a></li>\n<li>5迷3道 <a href=\"http://5m3d.com/\" target=\"_blank\" rel=\"noopener\">http://5m3d.com/</a></li>\n<li>w3cfuns <a href=\"http://www.w3cfuns.com/\" target=\"_blank\" rel=\"noopener\">http://www.w3cfuns.com/</a></li>\n<li>业界新闻dailyjs <a href=\"http://dailyjs.com/\" target=\"_blank\" rel=\"noopener\">http://dailyjs.com/</a></li>\n<li>前端开发 <a href=\"http://www.css88.com/\" target=\"_blank\" rel=\"noopener\">http://www.css88.com/</a></li>\n<li>大前端 <a href=\"http://www.daqianduan.com/\" target=\"_blank\" rel=\"noopener\">http://www.daqianduan.com/</a></li>\n</ul>\n<p>公司</p>\n<ul>\n<li>淘宝 <a href=\"http://ued.taobao.org/blog/\" target=\"_blank\" rel=\"noopener\">http://ued.taobao.org/blog/</a></li>\n<li>阿里巴巴 <a href=\"http://www.aliued.cn/\" target=\"_blank\" rel=\"noopener\">http://www.aliued.cn/</a></li>\n<li>一淘 <a href=\"http://ux.etao.com/\" target=\"_blank\" rel=\"noopener\">http://ux.etao.com/</a></li>\n<li>天猫 <a href=\"http://ued.tmall.com/\" target=\"_blank\" rel=\"noopener\">http://ued.tmall.com/</a></li>\n<li>百度 <a href=\"http://ued.baidu.com/\" target=\"_blank\" rel=\"noopener\">http://ued.baidu.com/</a></li>\n<li>腾讯 <a href=\"http://www.alloyteam.com/\" target=\"_blank\" rel=\"noopener\">http://www.alloyteam.com/</a></li>\n<li>ISUX <a href=\"http://isux.tencent.com/\" target=\"_blank\" rel=\"noopener\">http://isux.tencent.com/</a></li>\n<li>CDC <a href=\"http://cdc.tencent.com/\" target=\"_blank\" rel=\"noopener\">http://cdc.tencent.com/</a></li>\n<li>MXD <a href=\"http://mxd.tencent.com/\" target=\"_blank\" rel=\"noopener\">http://mxd.tencent.com/</a></li>\n<li>人人小站 <a href=\"http://zhan.renren.com/\" target=\"_blank\" rel=\"noopener\">http://zhan.renren.com/</a></li>\n<li>搜狗 <a href=\"http://ued.sogou.com/\" target=\"_blank\" rel=\"noopener\">http://ued.sogou.com/</a></li>\n<li>新浪 <a href=\"http://ued.sina.com/\" target=\"_blank\" rel=\"noopener\">http://ued.sina.com/</a></li>\n<li>网易 <a href=\"http://uedc.163.com/\" target=\"_blank\" rel=\"noopener\">http://uedc.163.com/</a></li>\n<li>搜狐 <a href=\"http://ued.focus.cn/wordpress/\" target=\"_blank\" rel=\"noopener\">http://ued.focus.cn/wordpress/</a></li>\n<li>携程 <a href=\"http://ued.ctrip.com/blog/\" target=\"_blank\" rel=\"noopener\">http://ued.ctrip.com/blog/</a></li>\n</ul>\n","categories":[],"tags":["frontend","collection"]},{"title":"我的Git工作流","url":"https://vincenthou.github.io/2013/12/05/我的Git工作流/","content":"<p>git现在使用的人越来越多，和传统的cvs，svn等工具相比有很多的<a href=\"http://www.oschina.net/news/12542/git-and-svn\" target=\"_blank\" rel=\"noopener\">优势和特性</a>。当<br>你开始使用起来之后，你会发现自己逐渐的爱上她。基本的git操作这里就不赘述了，<br>查阅<a href=\"http://gitref.org/\" target=\"_blank\" rel=\"noopener\">参考文档</a>，或者一些<a href=\"http://rogerdudler.github.io/git-guide/index.zh.html\" target=\"_blank\" rel=\"noopener\">简明教程</a>，就能大致的了解，最关键是自己建一个自己的<br>库，多加练习。</p>\n<p><a href=\"https://github.com/\" target=\"_blank\" rel=\"noopener\">GitHub</a>是全球最大的社交编程及代码托管网站，GitHub可以托管各种git库，并提<br>供一个web界面，但与其它像<a href=\"http://sourceforge.net/\" target=\"_blank\" rel=\"noopener\">SourceForge</a>或<a href=\"http://code.google.com/intl/zh-CN/\" target=\"_blank\" rel=\"noopener\">Google Code</a>这样的服务不同，GitHub的<br>独特卖点在于从另外一个项目进行分支的简易性而且主要是使用git作为管理工具。</p>\n<p>在github上可以找到很多优秀的开源软件，这是一个学习的好机会，我们也可以坚<br>持拿来主义，大量的优秀软件帮助我们解决开发中遇到的难题。同时这也是一个共享<br>与交流的平台，你不仅仅可以学习和使用别人的代码，还能创建自己的库，向别人的<br>库中提交代码，为开源社区贡献自己的力量。这里就说一下一般是如何向已有的库提<br>交代码的。</p>\n<h1 id=\"Fork-你想要贡献代码的库\"><a href=\"#Fork-你想要贡献代码的库\" class=\"headerlink\" title=\"Fork 你想要贡献代码的库\"></a>Fork 你想要贡献代码的库</h1><p><img src=\"https://github.s3.amazonaws.com/docs/bootcamp_3_fork.jpg\" alt=\"image\"><br>找到你想要贡献代码的库的主页，点击图中标出来的fork按钮，这样就会在你自己的库<br>中添加一个和你fork的库（我们叫它upstream）同名的库（我们叫它mystream）。</p>\n<h1 id=\"克隆你fork的库\"><a href=\"#克隆你fork的库\" class=\"headerlink\" title=\"克隆你fork的库\"></a>克隆你fork的库</h1><p>使用git clone命令将mystream克隆到本地。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> git@github.com:&lt;username&gt;/&lt;repo-name&gt;.git</span><br></pre></td></tr></table></figure>\n<p>这个克隆出来的库只是你github上面的库在本地一个副本，你可以对它任意的操作，<br>只要不push你的改动，是不会对你github上面的代码产生任何影响，同时也体现了git<br>离线提交的好处。</p>\n<h1 id=\"在remote列表中添加你要贡献代码的库\"><a href=\"#在remote列表中添加你要贡献代码的库\" class=\"headerlink\" title=\"在remote列表中添加你要贡献代码的库\"></a>在remote列表中添加你要贡献代码的库</h1><p>既然要贡献你的代码给别人，就要先把别人的地址给记下来吧，使用git remote add命<br>令来添加upstream。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote add upstream &lt;original repo git url&gt;</span><br></pre></td></tr></table></figure>\n<p>到这里主要的准备工作就做完了。可以使用git remote命令查看你的remote列表。</p>\n<h1 id=\"创建一个工作分支，在上面完成你的工作\"><a href=\"#创建一个工作分支，在上面完成你的工作\" class=\"headerlink\" title=\"创建一个工作分支，在上面完成你的工作\"></a>创建一个工作分支，在上面完成你的工作</h1><p>使用git和别人协同工作一个很重要的原则是不要在主分支上进行修改，这个原则和后<br>面提到的原子性提交以及pull request 都是有关系的，后面会说到。首先确认你在主分<br>支上</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br></pre></td></tr></table></figure>\n<p>创建并且切换到一个新的工作分支</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b &lt;new-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<p>在这个工作分支上你就可以为所欲为了，你可以添加，修改代码，并且进行正常的<br>commit提交</p>\n<h1 id=\"保持你的代码同步\"><a href=\"#保持你的代码同步\" class=\"headerlink\" title=\"保持你的代码同步\"></a>保持你的代码同步</h1><p>因为我们的开发和修改是独立的，和我们fork的代码库是并行进行的，所以在我们fork<br>后，或者上次同步一段时间后，我们本地的代码已经不是最新的了。当你完成了修改<br>并且想向主库提交代码时，首先要做的事情就是同步你的代码。<br>确认你工作在主分支上</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br></pre></td></tr></table></figure>\n<p>从upstream的主代码库获取最新的代码并且与本地的主分支合并</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull upstream master</span><br></pre></td></tr></table></figure>\n<p>这是懒人的做法，你也可以选择使用git fetch和git merge，选择性合并主分支的代<br>码，这里有它们的<a href=\"http://www.tech126.com/git-fetch-pull/\" target=\"_blank\" rel=\"noopener\">区别</a>另外，你也可以将你<br>自己在github上的mystream主分支更新，当然这个是可选的。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin master</span><br></pre></td></tr></table></figure>\n<p>一般默认你克隆下来本地对应的远端mystream被命名为origin</p>\n<h1 id=\"同步你想要提交的分支代码\"><a href=\"#同步你想要提交的分支代码\" class=\"headerlink\" title=\"同步你想要提交的分支代码\"></a>同步你想要提交的分支代码</h1><p>到这里你本地的主分支已经和upstream的主分支同步了，真正的好戏才刚刚开始。前<br>面提到提交的原子性，那什么是提交的原子性呢？我们都知道乐高积木，这个提交的<br>原子性就是保证我们使用乐高积木拼装成的艺术品，随时可以进行调整。每一次提交<br>就像一个积木块一样，可以随时拔掉或者插上。</p>\n<p>但是当我们在本地为了添加一个功能或者修复一个bug，很多时候不会只做一次提交，<br>而是可能会进行多次commit提交。如果直接将这些改动与upstream主分支合并，那么<br>以后如果希望撤销这次的操作或者将这次的改动合并到其他分支上就会很麻烦。</p>\n<p>首先确保你在你一直辛勤工作的分支</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout &lt;working-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<p>将你本地的工作分支与master主分支“合并”</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rebase -i master</span><br></pre></td></tr></table></figure>\n<p>这里用到的rebase命令不是简单的合并，这里有<a href=\"http://www.liuhui998.com/4_2.html\" target=\"_blank\" rel=\"noopener\">rebase与merge的区别</a>，-i参数会引导<br>我们一步一步解决冲突，你也可以选择先解决冲突再使用rebase。使用rebase命令会<br>将你原来多次的提交合并成一次提交。<br>其中-i 参数会用交互的方式引导你合并为一次提交，一般你会看到这样的编辑界面</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pick ff76694 add line 3</span><br><span class=\"line\">pick 8e49657 add line 4</span><br><span class=\"line\"><span class=\"comment\"># Rebase d879706..8e49657 onto d879706</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Commands:</span></span><br><span class=\"line\"><span class=\"comment\">#  p, pick = use commit</span></span><br><span class=\"line\"><span class=\"comment\">#  r, reword = use commit, but edit the commit message</span></span><br><span class=\"line\"><span class=\"comment\">#  e, edit = use commit, but stop for amending</span></span><br><span class=\"line\"><span class=\"comment\">#  s, squash = use commit, but meld into previous commit</span></span><br><span class=\"line\"><span class=\"comment\">#  f, fixup = like \"squash\", but discard this commit's log message</span></span><br><span class=\"line\"><span class=\"comment\">#  x, exec = run command (the rest of the line) using shell</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># These lines can be re-ordered; they are executed from top to bottom.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># If you remove a line here THAT COMMIT WILL BE LOST.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># However, if you remove everything, the rebase will be aborted.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Note that empty commits are commented out</span></span><br></pre></td></tr></table></figure>\n<p>下面的注释中Command有详细的解释，一般将你要合并的多个提交前面的pick改为squash（如果有多个commit除了第一个是pick其他都是squash），对于我们的示例，修改为</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pick ff76694 add line 3</span><br><span class=\"line\">squash 8e49657 add line 4</span><br><span class=\"line\"><span class=\"comment\"># Rebase d879706..8e49657 onto d879706</span></span><br><span class=\"line\"><span class=\"comment\">#...</span></span><br></pre></td></tr></table></figure>\n<p>保存文件退出编辑，正常情况下这样就完事了，但是如果master分支上有新的提交和你的工作分支提交发生冲突，就会看到下面的情况</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">error: could not apply ff76694... add line 3</span><br><span class=\"line\"></span><br><span class=\"line\">When you have resolved this problem, run <span class=\"string\">\"git rebase --continue\"</span>.</span><br><span class=\"line\">If you prefer to skip this patch, run <span class=\"string\">\"git rebase --skip\"</span> instead.</span><br><span class=\"line\">To check out the original branch and stop rebasing, run <span class=\"string\">\"git rebase --abort\"</span>.</span><br><span class=\"line\">Could not apply ff76694624019140e05cd9d443aa547e62c5c24b... add line 3</span><br></pre></td></tr></table></figure>\n<p>编辑冲突文件（冲突文件中可能不会列出你在当前分支上所有的改动，只会标出冲突部分），选择需要的部分，保存文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add &lt;modified files&gt;</span><br><span class=\"line\">git rebase --<span class=\"built_in\">continue</span></span><br></pre></td></tr></table></figure>\n<p>之后你会看到类似这样的提示</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">add line 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Please enter the commit message for your changes. Lines starting</span></span><br><span class=\"line\"><span class=\"comment\"># with '#' will be ignored, and an empty message aborts the commit.</span></span><br><span class=\"line\"><span class=\"comment\"># rebase in progress; onto d879706</span></span><br><span class=\"line\"><span class=\"comment\"># You are currently rebasing branch 'feature' on 'd879706'.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Changes to be committed:</span></span><br><span class=\"line\"><span class=\"comment\">#       modified:   test.txt</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n<p>这里是让你编辑你第一次提交的comment，更改comment内容后保存退出，记着会提示你编辑合并commit的comment，你在上一次添加的comment会合并进来，你看到的会是这样的</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># This is a combination of 2 commits.</span></span><br><span class=\"line\"><span class=\"comment\"># The first commit's message is:</span></span><br><span class=\"line\"></span><br><span class=\"line\">add line 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># This is the 2nd commit message:</span></span><br><span class=\"line\"></span><br><span class=\"line\">add line 4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Please enter the commit message for your changes. Lines starting</span></span><br><span class=\"line\"><span class=\"comment\"># with '#' will be ignored, and an empty message aborts the commit.</span></span><br><span class=\"line\"><span class=\"comment\"># rebase in progress; onto d879706</span></span><br><span class=\"line\"><span class=\"comment\"># You are currently editing a commit while rebasing branch 'feature' on 'd879706'.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Changes to be committed:</span></span><br><span class=\"line\"><span class=\"comment\">#       modified:   test.txt</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n<p>去掉多余的comment内容，保存退出。<br>到这里工作分支和master的合并就完成了，使用rebase，你只在工作分支上做到了两件事：</p>\n<ol>\n<li>同步本地master的最新代码到工作分支<br>2 .将工作分支上的多次提交合并成一次提交，同时append到时间轴的最后<br>更详细的说明看<a href=\"http://gitready.com/advanced/2009/02/10/squashing-commits-with-rebase.html\" target=\"_blank\" rel=\"noopener\">这里</a><br><strong>这时你在新的分支上的改动还没有同步到本地master</strong>，你需要切换回master分支，将改动合并回来</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge &lt;working-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<p>你看到maser上的时间轴将会是优雅的直线</p>\n<h1 id=\"提交本地分支代码\"><a href=\"#提交本地分支代码\" class=\"headerlink\" title=\"提交本地分支代码\"></a>提交本地分支代码</h1><p>以上的一切操作都是发生在本地，为了能够发送pull request，你需要将本地的改动提<br>交到github。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin &lt;working-branch-name&gt;</span><br></pre></td></tr></table></figure>\n<p> 到这里我们的一个工作流程就完成了，如果我们有一个CI系统，我们可以选择我们提<br>交的这个分支跑一下CI，确保不会让我们的系统挂掉。最后就是发送一条<br>pull request，这个<a href=\"https://help.github.com/articles/using-pull-requests\" target=\"_blank\" rel=\"noopener\">官网介绍</a>的很详细啦。</p>\n<p>最后说明一下为什么要创建分支而不直接在主分支上操作。其实主要是为了保证一个<br>干净的主分支。随时让我们可以基于这个干净的分支创建新的分支，所有的操作和修<br>改都是与主分支隔离开的。主分支只负责和upstream进行同步。如果在本地提交了有<br>问题的代码那还好，大不了就是删掉本地的库，重新再克隆一个。一旦提交到github<br>上，主分支就污染了，为了保证减少无意义的提交（revert之前的commit）就需要重<br>新fork了。</p>\n<p><a href=\"http://codeinthehole.com/writing/pull-requests-and-other-good-practices-for-teams-using-github/\" target=\"_blank\" rel=\"noopener\">Effective pull requests and other good practices for teams using github</a></p>\n","categories":[],"tags":["blog","git"]},{"title":"about","url":"https://vincenthou.github.io/about/index.html","content":"","categories":[],"tags":[]},{"title":"category","url":"https://vincenthou.github.io/category/index.html","content":"","categories":[],"tags":[]},{"title":"","url":"https://vincenthou.github.io/css/style.css","content":"html.page-home {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(to left, #5f2c82, #49a09d);\n  background-blend-mode: screen;\n  -webkit-animation: blur 5s;\n  animation: blur 5s;\n}\n\n.content-home .slogan {\n  color: #fff;\n}\n\n@-webkit-keyframes blur\n{\n  from {\n    -webkit-filter: blur(2px);\n  }\n  to {\n    -webkit-filter: initial;\n  }\n}\n\n@keyframes blur\n{\n  from {\n    filter: blur(2px);\n  }\n  to {\n    filter: initial;\n  }\n}\n","categories":[],"tags":[]},{"title":"link","url":"https://vincenthou.github.io/link/index.html","content":"","categories":[],"tags":[]},{"title":"project","url":"https://vincenthou.github.io/project/index.html","content":"","categories":[],"tags":[]},{"title":"search","url":"https://vincenthou.github.io/search/index.html","content":"","categories":[],"tags":[]},{"title":"tag","url":"https://vincenthou.github.io/tag/index.html","content":"","categories":[],"tags":[]}]