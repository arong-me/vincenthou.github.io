# 背景

图片精灵的概念由来已久，长久以来作为网站性能优化的一条金科玉律，但是在实践过程中一直是一条头痛的事情。
我们在网站开发中会使用到各种图片资源，小到一个button的icon，大到整个网站的banner图片，每一个图片资源都需要单独发送请求。图片精灵就是将这些静态的图片资源按照需要合并为一张或者少数几张图片，通过CSS的background-position取得合适图片的技术。
# 以往的图片精灵做法

在迭代开发中，图片资源可能会经常变动，或者图片的总量的不缺定的，这样就无法有效的进行预先合并。往往是设计人员根据开发提出的需求，单个单个地提供需要的图片或者icon，开发拿来就直接使用。最终图片和icon不需要变动的时候，基于开发的自我修养（加载图片真的成为瓶颈），开发会要求设计合并图片，开发拿到新合并的图片文件，苦逼地调CSS。
这样反人类的做法怎么能忍，各种工具应运而生。
- 手动合并图片，生成对应的CSS代码
  腾讯的团队搞出来的[GoPng](http://alloyteam.github.io/gopng)，可以自定义图片的位置，在画布上随意拖动位置，能够自定义生成代码的模板，导出元数据（JSON格式）随时恢复原来的工作（个人认为可以用localstorage实现，体验会更好些）。具体特性和使用说明看[这里](http://www.alloyteam.com/2012/05/gopng-sprite-figure-synthesis-tool-another-html5-app/)
- 自动生成工具
1. [grunt-spritesmith](https://github.com/Ensighten/grunt-spritesmith), [gulp-spritesmith](https://www.npmjs.org/package/gulp.spritesmith/)只是把上面手动的流程自动化，指定原始图片的目录，设定图片文件通配符，生成合并图片文件和对应的CSS。还是需要手动更改原有的CSS文件（替换图片引用，添加background-position）
2. [grunt-sprite](https://github.com/hellometers/grunt-sprite) 会自动从原来的CSS文件中获取到需要合并的图片链接，合并图片，修改原有CSS文件，真正实现自动化的CSS Sprite（国人开发的项目，赞一个）。gulp也有个[类似的项目](https://www.npmjs.org/package/gulp-sprite-generator/)
# 使用SVG制作图片精灵

SVG 作为矢量图形的绘制工具价值正在与日俱增，很多SVG的库也如雨后春笋般茁壮成长，[raphael](http://raphaeljs.com/)，[D3](http://d3js.org/)，[highcharts中文](http://www.hcharts.cn/)，[highcharts官网](http://www.highcharts.com/)，还有新近看到的[snap.svg](http://www.zhangxinxu.com/wordpress/2014/01/snap-svg-study-demo-docs/)。SVG的优点就不一一列举了，对应到本主题，SVG可以很方便地帮我们实现简单的icon设计。
随着技术的发展，图标的制作产生了几个方向：
1. 字体文件图标
   例如[font-awesome](http://fontawesome.io/)已经让我们看到了icon的可能性，如果设计师没有特殊的要求（粗细，比例），我们的大部分需求都能得到满足。国内的[阿里巴巴 Iconfont](http://iconfont.cn/)也提供了丰富的字体图标支持。
2. CSS3制作
   这个部分可以参考[这篇文章](http://www.zhangxinxu.com/wordpress/2014/04/css3-icon-%E5%9B%BE%E6%A0%87%E7%94%9F%E6%88%90%E6%8A%80%E6%9C%AF/)，写得还是很详细的，主要介绍了[one-div](http://one-div.com/)，创意很好，但是个人感觉还是更适合开发玩玩。
3. SVG图标文件
   终于铺垫完了，这里才是 **重点** 。因为SVG文件本质上是用来描述图形的XML文件，可以自定义填充色，阴影和尺寸，给了开发和设计同样的发挥空间。SVG图片精灵的核心思想就是将原来的几个单独icon的SVG文件合并之后，使用symbol标签定义图形，并且给每个symbol定义一个ID，在后续引用中只要使用use标签xlink:href=“#id”就可以引用到合并后SVG中的图片了。发现这里神奇的地方了吗？不需要使用background-position定位图片，而且获取的尺寸绝对精确。参考中的[文章](http://www.zhangxinxu.com/wordpress/2014/07/introduce-svg-sprite-technology/)介绍的更加详细，使用了[SVG Grunt合并工具](https://github.com/FWeinb/grunt-svgstore/)，只是我自己尝试的时候发现配置有点问题，文中的写法是

``` js
  grunt.initConfig({
    svgstore: {
      options: {
        includedemo: true
      },
      files: {
          'dist/mytest.svg': ['mytest/*.svg']
      }
    }
  });
```

实际我试验成功的写法是

``` js
// 包装函数
module.exports = function(grunt) {

  // 任务配置
  grunt.initConfig({
    svgstore: {
      options: {
        includedemo: true,
        cleanup: true
      },
      //**different here**
      default: {
        files: {
          'dist/mytest.svg': ['mytest/*.svg']
        }
      }
    }
  });

  // 任务加载
  grunt.loadNpmTasks('grunt-svgstore');

  // 自定义任务
  grunt.registerTask('default', ['svgstore']);

};
```

需要加default的key，才能生效，不知道是不是版本升级造成的。还有些类似的工具[svg-sprite](https://www.npmjs.org/package/svg-sprite)，[gulp-svg-sprites](https://www.npmjs.org/package/gulp-svg-sprites/)等等。[icomoon导出SVG Sprite](http://icomoon.io/app/#/select)提供类似的功能，同样很方便，值得一提的是这个网站**还支持font图标的导出** :+1:。后续可以扩展下，把grunt-svgstore加入自动化中，自动生成引用，通过[HTML Import partials](https://github.com/Polymer/HTMLImports)外链SVG文件，而不是在隐藏元素中放置SVG来做。
# 更好的开发方式

在以后的开发中可以和设计师商量，如果对于没有特殊要求的icon可以直接使用[bootstrap](http://v3.bootcss.com/components/), [font-awesome](http://fontawesome.io/)，打包的[iconfont](http://iconfont.cn)来做字体图标，使用现成的嘛，只是会多出加载字体文件的请求。对于有特殊尺寸、粗细的icon，设计师导出为SVG，通过SVG Sprite进行合并。或者更干脆，直接都使用SVG来做。
# 参考

[SVG `symbol` a Good Choice for Icons](http://css-tricks.com/svg-symbol-good-choice-icons/)
[未来必热：SVG Sprite技术介绍](http://www.zhangxinxu.com/wordpress/2014/07/introduce-svg-sprite-technology/)
[使用CSS sprite 的好处和坏处](http://www.alixixi.com/web/a/2010041159648.shtml)
